<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 6, revision: 1, date: new Date("Aug 18, 2010"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2009

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> Fudge RPG TiddlyWiki - A portable, reusable, and personal System Reference Document for Fudge, the Role Playing Game! </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity=60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->

<!--TIDDLYSPOT_INJECT-->
<div style="display:none"><img src="http://tiddlyspot.com/_ts/stats/fudgerpg"/></div>
<!--TCEJNI_TOPSYLDDIT-->

<!--TIDDLYSPOT_INJECT-->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct="UA-96965-3";urchinTracker();</script>

<!--TCEJNI_TOPSYLDDIT-->
<div id="storeArea">
<div title="1. Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010201255" modified="201010220400" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="36">
<pre>This chapter contains all the information you’ll need to create human characters, including character traits and trait levels, and some different ways to allocate them.

For non-human characters — or characters with supernormal abilities (magic, psionics, super powers, etc.) — you will also need to read Chapter 2, Supernormal Powers, before your characters will be complete.

[[1.1  Character Creation Terms]]
[[1.2  Fudge Trait Levels]]
[[1.3  Character Traits]]
[[1.4  Allocating Traits]]
[[1.5  Subjective Character Creation]]
[[1.6  Objective Character Creation]]
[[1.7  Uncommitted Traits]]
[[1.8  Random Character Creation]]
[[1.9  Minimizing Abuse]]</pre>
</div>
<div title="1.1  Character Creation Terms" creator="JonasSusara" modifier="JonasSusara" created="201010220352" changecount="1">
<pre>;Trait
: Anything that describes a character. A trait can be an attribute, skill, inherited gift, fault, supernormal power, or any other feature that describes a character. The GM is the ultimate authority on what is an attribute and what is a skill, gift, etc.
;Level
: Most traits are described by one of seven adjectives. These seven descriptive words represent levels a trait may be at. In addition, the Objective Character Creation method grants the player free levels, and demands he keep track of them. In this case, one level is required to raise a trait to the next better adjective.
;Attribute
: Any trait that everyone in the game world has, in some degree or other. See Section 1.31, Attributes, for a sample list of attributes. On a scale of Terrible ... Fair ... Superb, the average human will have an attribute at Fair.
;Skill
: Any trait that isn’t an attribute, but can be improved through practice. The default for an unlisted skill is usually Poor, though that can vary up or down a little.
;Gift
: Any trait that isn’t an attribute or skill, but is something positive for the character. Some ~GMs will define a certain trait as a gift, while others will define the same trait as an attribute. In general, if the trait doesn’t easily fit the Terrible ... Fair ... Superb scale, it’s probably a gift.
;Fault
: Any trait that limits a character’s actions, or earns him a bad reaction from other people.
;Supernormal Power
: Although technically gifts, supernormal powers are treated separately in Chapter 2.
</pre>
</div>
<div title="1.2  Fudge Trait Levels" creator="JonasSusara" modifier="JonasSusara" created="201010220353" changecount="1">
<pre>Fudge uses ordinary words to describe various traits of a character. The following terms of a seven-level sequence are suggested (from best to worst):
* Superb
* Great
* Good
* Fair
* Mediocre
* Poor
* Terrible
These levels should be written on each character sheet for easy reference.

A GM may alter this list in any way she desires, including expanding or shrinking it. For example, if Superb doesn’t sound right to you, use Awesome — or even Way Cool. If the words Mediocre and Fair don’t make sense to you, change them. These seven terms will be used in the rules, however, for clarity.

To remember the order, compare adjacent words. If, as a beginner, your eventual goal is to become an excellent game player, for example, ask yourself if you’d rather be called a Fair game player or a Mediocre game player.

There is an additional level that can be used in Fudge, but is not listed above: Legendary, which is beyond Superb. Those with Legendary Strength, for example, are in the 99.9th percentile, and their names can be found in any book of world records.

Important Note: not every GM will allow ~PCs to become Legendary. Even in games that do include the Legendary level, it is not recommended that any character be allowed to start the game as Legendary. Superb represents the 98th to 99.9th percentile of any given trait, which should be enough for any beginning PC. Of course, if a player character gets a bit overconfident, meeting an NPC Legendary swordswoman can be a grounding experience…
If someone really has to begin play as a Legendary swordsman, strong man, etc., doing the GM’s laundry for half a year or so (in advance) should be a sufficient bribe to be allowed to start at that level. Of course, working towards Legendary makes a great campaign goal, and so ~PCs may rise to that height, given enough playing time and a generous GM.
</pre>
</div>
<div title="1.3  Character Traits" creator="JonasSusara" modifier="JonasSusara" created="201010220355" modified="201010220441" changecount="3">
<pre>Traits are divided into Attributes, Skills, Gifts, Faults, and Supernormal Powers. Not every GM will have all five types of traits in her game. These traits are defined under Section 1.1, Character Creation Terms, above.

[[1.31  Attributes]]
[[1.32  Skills]]
[[1.33  Gifts]]
[[1.34  Faults]]
[[1.35  Personality]]
[[1.36  Fudge Points]]
</pre>
</div>
<div title="1.31  Attributes" creator="JonasSusara" modifier="JonasSusara" created="201010220437" changecount="1">
<pre>Gamers often disagree on how many attributes a game should have. Some prefer few attributes, others many. Even those that agree on the number of attributes may disagree on the selection. While Fudge discusses some attributes (Strength, Fatigue, Constitution, etc.) in later sections, none of these are mandatory. The only attribute the basic Fudge rules assume is Damage Capacity, and even that is optional — see Section 4.52, Damage Capacity.

Here is a partial list of attributes in use by other games; select to your taste, or skip these altogether:
* Body: Agility, Aim, Appearance, Balance, Brawn, Build, Constitution, Coordination, Deftness, Dexterity, Endurance, Fatigue, Fitness, Health, Hit Points, Manual Dexterity, Muscle, Nimbleness, Quickness, Physical, Reflexes, Size, Smell, Speed, Stamina, Strength, Wound Resistance, Zip, and so on.
* Mind: Cunning, Education, Intelligence, Knowledge, Learning, Mechanical, Memory, Mental, Mental Strength, Perception, Reasoning, Smarts, Technical, Wit, and so on.
* Soul: Channeling, Charisma, Charm, Chutzpah, Common Sense, Coolness, Disposition, Drive, Ego, Empathy, Fate, Honor, Intuition, Luck, Magic Resistance, Magic Potential, Magical Ability, Power, Presence, Psyche, Sanity, Self Discipline, Social, Spiritual, Style, Will, Wisdom, and so on, and so on.
* Other: Rank, Status, Wealth.
Most games combine many of these attributes, while others treat some of them as gifts or even skills. In Fudge, if you wish, you can even split these attributes into smaller ones: Lifting Strength, Carrying Strength, Damage-dealing Strength, etc.
At this point, the GM decides how many attributes she deems necessary – or she might leave it up to each player. (Commercial games range from one or two to over 20.) See Section 6.3, Character Examples, for some possibilities.
</pre>
</div>
<div title="1.32  Skills" creator="JonasSusara" modifier="JonasSusara" created="201010220437" modified="201010230701" changecount="4">
<pre>Skills are not related to attributes or their levels in Fudge. Players are encouraged to design their characters logically — a character with a lot of Good physical skills should probably have better than average physical attributes, for example. On the other hand, Fudge allows a player to create someone like Groo the Wanderer*, who is very clumsy yet extremely skilled with his swords.

(*GROO is a trademark of Sergio Aragonés. If you don’t know Groo, go to a comic book store and check him out!)

The GM should then decide what level of skill depth she wants. Are skills broad categories such as “Social skills,” or moderately broad abilities, such as “Inspire People, Parley, and Market Savvy,” or are they specific abilities such as “Barter, Seduce, Repartee, Persuade, ~Fast-Talk, Bully, Grovel, Carouse, Flatter, Bribe,” etc.?

{{{
Examples of Skill Depth:
Animal Skills	Riding	Riding Horses
			Riding Camels
			Riding Elephants
			Driving Oxen
		Driving	Driving Mules &amp; Horses
			Driving Dogs
			Grooming
		Care	Feeding
			Breeding	
			Veterinary	First Aid
					Diagnosis
					Medicine
					Surgery
}}}

An attribute is, in some ways, a very broad skill group, and skills may be ignored altogether if desired.

Combat skills require special consideration. The broadest possible category is simply that: Combat Skills. A broad range breaks that down to Melee Weapons, Unarmed Combat, and Missile Weapons. A somewhat narrower approach would break down Melee Weapons into Close Combat Melee Weapons (knives, blackjacks, etc.), One-handed Melee Weapons (one-handed swords, axes, maces, etc.) and Two-handed Melee Weapons (polearms, spears, battle-axes, two-handed swords, etc.). Or, for a precise list of skills, each group in parentheses could be listed as a separate skill; a character skilled at using a broadsword knows nothing about using a saber, for example.

Each choice has its merits. Broad skill groups that include many sub-skills make for an easy character sheet and fairly competent characters, while specific skills allow fine-tuning a character to a precise degree.
See Section 6.3, Character Examples, for an idea of how broadly or finely skills can be defined in a game.</pre>
</div>
<div title="1.33  Gifts" creator="JonasSusara" modifier="JonasSusara" created="201010220438" modified="201010230836" changecount="3">
<pre>A gift is a positive trait that doesn’t seem to fit the Terrible ... Fair ... Superb scale that attributes and skills fall into. However, this will vary from GM to GM: a photographic memory is a gift to one GM, while it is a Superb Memory attribute to another. Some ~GMs will define Charisma as an attribute, while others define it as a gift. To one Gamemaster, a character either has Night Vision or he doesn’t; another will allow characters to take different levels of it. A Gamemaster may not even have gifts in her game at all.

Alternatively, gifts can come in levels, but the levels don’t necessarily coincide with the levels used by other traits. For example, Status might be three- or four-tiered, or even nine-tiered instead of fitting into the seven levels of attributes and skills. Wealth might come only in five different levels — whatever each GM desires.

Supernormal powers, such as the ability to cast magic spells, fly, read minds, etc., are technically powerful gifts, but are handled separately in Chapter 2. Likewise, traits above the human norm, such as a super strong fantasy or alien race, are treated by definition as supernormal powers.

In general, if a gift isn’t written on the character sheet, the character doesn’t have it.

Some possible gifts include: Absolute Direction; Always keeps his cool; Ambidextrous; Animal Empathy; Attractive; Beautiful speaking voice; Bonus to one aspect of an attribute; Combat Reflexes; Contacts in police force; Danger Sense; Extraordinary Speed; Healthy Constitution; Keen senses; Literate; Lucky; Many people owe him favors; Never disoriented in zero Gravity; Never forgets a name/face/whatever; Night Vision; Patron; Perfect Timing; Peripheral Vision; Quick Reflexes; Rank; Rapid Healing; Reputation as Hero; Scale; Sense of empathy; Single-minded (+1 to any lengthy task); Status; Strong Will; Tolerant; Tough Hide (–1 to damage) Wealth; etc.

See also Section 6.3, Character Examples, for examples of different gifts. Many others are possible.</pre>
</div>
<div title="1.34  Faults" creator="JonasSusara" modifier="JonasSusara" created="201010220440" changecount="1">
<pre>Faults are anything that makes life more difficult for a character. The primary faults are those that restrict a character’s actions or earn him a bad reaction from chance-met ~NPCs. Various attitudes, neuroses and phobias are faults; so are physical disabilities and social stigmas. There are heroic faults, too: a code of honor and inability to tell a lie restrict your actions significantly, but are not signs of flawed personality.

Some sample faults: ~Absent-Minded; Addiction; Ambitious; Amorous heartbreaker; Bloodlust; Blunt and tactless; Bravery indistinguishable from foolhardiness; Can’t resist having the last word; Code of Ethics limits actions; Code of Honor; Compulsive Behavior; Coward; Curious; Finicky; Easily Distractible; Enemy; Fanatic patriot; Full of bluff and bluster and machismo; Garrulous; Getting old; Glutton; Goes Berserk if Wounded; Gossip; Greedy; Gullible; Humanitarian (helps the needy for no pay); Idealist (not grounded in reality); Indecisive; Intolerant; Jealous of Anyone Getting More Attention; Lazy; Loyal to Companions; ~Manic-Depressive; Melancholy; Multiple Personality; Must obey senior officers; Nosy; Obsession; Outlaw; Overconfident; Owes favors; Phobias; Poor; Practical Joker; ~Quick-Tempered; Quixotic; Self-defense Pacifist; Socially awkward; Soft-hearted; Stubborn; Quick to take offense; Unlucky; Vain; Violent when enraged; Vow; Worry Wart; Zealous behavior; etc.

See also Section 6.3, Character Examples, for examples of different faults. Many others are possible.
</pre>
</div>
<div title="1.35  Personality" creator="JonasSusara" modifier="JonasSusara" created="201010220440" modified="201010230836" changecount="2">
<pre>A character’s personality may be represented by one or more traits, or it can be written out as character background or description.
As an example of the first case, courage is an attribute, a gift, or even a fault. As an attribute, Superb Courage or Terrible Courage has an obvious meaning. As a gift, obvious bravery gives the character a positive reaction from people he meets (assuming they see him being courageous, or have heard of his deeds, of course).

However, both Very Courageous and Very Cowardly can be faults because they can limit a character’s actions. A courageous character might not run away from a fight even if it were in his best interest, while a cowardly one would have a hard time staying in a fight even if he stood to gain by staying.

Or a character’s level of courage might not be a quantified trait at all, but something the player simply decides. “Moose is very brave,” a player jots down, and that is that. It doesn’t have to count as a high attribute, gift, or fault.

A player should ask the GM how she wants to handle specific personality traits. If the player describes his character in detail, the GM can easily decide which personality traits are attributes, gifts, or faults. However they are handled, most characters benefit by having their personalities fleshed out.
</pre>
</div>
<div title="1.36  Fudge Points" creator="JonasSusara" modifier="JonasSusara" created="201010220441" modified="201010231147" changecount="2">
<pre>Fudge Points are meta-game gifts that may be used to buy “luck” during a game — they let the players fudge a game result. These are “meta-game” gifts because they operate at the player-GM level, not character-character level. Not every GM will allow Fudge Points — those who prefer realistic games should probably not use them.

The GM sets the starting number of Fudge Points. The recommended range is from one to five. Unused Fudge Points are saved up for the next gaming session. Each player may get an additional number each gaming session. (This is also set by the GM, and may or may not equal the starting level.) Alternately, the GM may simply allow Experience Points (EP) to be traded for Fudge Points at a rate appropriate for the campaign: 3 EP = 1 Fudge Point, down to 1 EP = Fudge Point.

Fudge Points can be used in many ways, depending on what level on the realistic-legendary scale the game is played at. Here are some suggested ways to use them — the GM can create her own uses, of course. A GM may allow as few or many of these options as she wishes — the players should ask her before assuming they can do something with Fudge Points.
# Spending a Fudge Point may accomplish an Unopposed action automatically and with panache — good for impressing members of the appropriate sex, and possibly avoiding injury in the case of dangerous actions. The GM may veto this use of Fudge Points for actions with a Difficulty Level of Beyond Superb. The GM may disallow this option for an Opposed action, such as combat.
# A player may spend one Fudge Point to alter a die roll one level, up or down as desired. The die roll can be either one the player makes, or one the GM makes that directly concerns the player’s character.
# A player may spend one Fudge Point to declare that wounds aren’t as bad as they first looked. This reduces the intensity of each wound by one or two levels (a Hurt result becomes a Scratch, for example, or even a Very Hurt becomes a Scratch). Or it can mean that any one wound (or more), regardless of level, is just a Scratch. This latter option may cost more than one Fudge point. The GM can restrict this to outside of combat time.
# A player may spend one (or more) Fudge Points to get an automatic +4 result, without having to roll the dice. This use is available in Opposed actions, if allowed.
# For appropriately legendary games, a ~GM-set number of Fudge Points can be spent to ensure a favorable coincidence. (This is always subject to GM veto, of course.) For example, if the ~PCs are in a maximum security prison, perhaps one of the guards turns out to be the cousin of one of the ~PCs — and lets them escape! Or the captain of the fishing boat rescuing the ~PCs turns out to be someone who owes a favor to one of them, and is willing to take them out of his way to help them out… And so on. This option should cost a lot of Fudge Points, except in certain genres where bizarre coincidences are the norm.</pre>
</div>
<div title="1.4  Allocating Traits" creator="JonasSusara" modifier="JonasSusara" created="201010220356" modified="201010230837" changecount="2">
<pre>Character creation in Fudge assumes the players will design their characters, rather than leaving attributes and other traits to chance. The GM may allow randomly determined traits if she desires — a suggested method is given in Section 1.8, Random Character Creation.
There are no mandatory traits in Fudge. The GM should inform the players which traits she expects to be most important, and the players may suggest others to the GM for her approval. The GM may even make a template, if desired — a collection of traits she deems important (with room for customization) — and let the players define the level of each trait. See Section 6.12, Templates.

When a character is created, the player should define as many character traits as he finds necessary — which may or may not coincide with a ~GM-determined list. If a player adds an attribute the GM deems unnecessary, the GM may treat that attribute as simply a description of the character. She may require a roll against a different attribute than the player has in mind, and the player must abide by her decision.

As an example, a certain GM decides she wants characters to have a general Dexterity attribute. A player takes Good Dexterity for his PC, but wants to show that the character is better at whole body dexterity than at manual dexterity. So he writes: Great Agility and Fair Manual Dexterity. However, the GM can ignore these distinctions, and simply require a Dexterity roll, since that is the trait she has chosen. (She can average the ~PC-chosen levels, or simply select one of them.) Of course, she can also allow him to roll on the attributes he has created.

In Fudge, a character with a trait at Fair will succeed at ordinary tasks 62% of the time — there is usually no need to create a superstar. In fact, Great is just that: great! Superb should be reserved for the occasional trait in which your character is the best he’s ever met.

Any trait that is not defined at character creation will be at a default level:
For attributes: Fair.
For most skills: Poor (easier skills are at Mediocre, while harder ones are at Terrible). A skill default means untrained, or close to it. However, it is possible to take a skill at Terrible (below the default level for most skills), which implies an ineptitude worse than untrained.
For most gifts, supernormal powers and certain ~GM-defined skills: ~Non-Existent. (That is, the default is non-existent. The trait itself exists in some character, somewhere.)

Each player should expect the GM to modify his character after creation — it’s the nature of the game. The GM should expect to review each character before play. It would, in fact, be best if the characters were made in the presence of the GM so she can answer questions during the process.

</pre>
</div>
<div title="1.5  Subjective Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010220357" modified="201010230837" changecount="2">
<pre>An easy way to create a character in Fudge is simply to write down everything about the character that you feel is important. Any attribute or skill should be rated using one of the levels Terrible through Superb (see Section 1.2, Fudge Trait Levels).

It may be easiest, though, if the GM supplies a template of attributes she’ll be using. See Section 6.3, Character Examples, for template ideas.

The GM may also tell the player in advance that his character can be Superb in a certain number of attributes, Great in so many others, and Good in yet another group. For example, in an epic-style game with eight attributes, the GM allows one Superb attribute, two Greats, and three Goods. In a more realistic game, this is one Superb, one Great, and two Goods.

This can apply to skills, too: one Superb skill, two Great skills, and six Good skills is a respectable number for a realistic campaign, while two Superbs, three Greats, and ten Goods is quite generous, even in a highly cinematic game.

The GM may also simply limit the number of skills a character can take at character creation: 10, 15, or 20 are possible choices.
Gifts and faults can be restricted this way, also. For example, a GM allows a character to have two gifts, but he must take at least three faults. Taking another fault allows another gift, or another skill at Great, and so on.

These limitations help the player define the focus of the character a bit better: what is his best trait (what can he do best)?

A simple “two lower for one higher” trait-conversion mechanic can also be used. If the GM allows one Superb attribute, for example, the player may forego that and take two attributes at Great, instead. The converse may also be allowed: a player may swap two skills at Good to get one at Great.

Example: a player wants a Jack-of-all-trades character, and the GM has limits of one Superb skill, two Great skills and six Good skills. The player trades the one Superb skill limit for two Great skills: he can now take four skills at Great. However, he trades all four Great skills in order to have eight more Good skills. His character can now have 14 skills at Good, but none at any higher levels.

In the Subjective Character Creation system, it is easy to use both broad and narrow skill groups, as appropriate for the character. In these cases, a broad skill group is assumed to contain the phrase, “except as listed otherwise.”

For example, a player wishes to play the science officer of a starship. He decides this character has spent so much time studying the sciences, that he’s weak in most physical skills. So on his character sheet he could simply write:

Physical Skills: Poor

He also decides that his character’s profession would take him out of the ship in vacuum quite a bit, to examine things. So he’d have to be somewhat skilled at zero-G maneuvering. So he then adds:

~Zero-G Maneuvering: Good

Even though this is a physical skill, it is not at Poor because he specifically listed it as an exception to the broad category.
When the character write-up is done, the player and GM meet and discuss the character. If the GM feels the character is too potent for the campaign she has in mind, she may ask the player to reduce the character’s power — see Section 1.9, Minimizing Abuse.

The GM may also need to suggest areas that she sees as being too weak — perhaps she has a game situation in mind that will test a trait the player didn’t think of. Gentle hints, such as “Does he have any social skills?” can help the player through the weak spots. Of course, if there are multiple players, other ~PCs can compensate for an individual PC’s weaknesses. In this case, the question to the whole group is then, “Does anyone have any social skills?”

Instead of the player writing up the character in terms of traits and levels, he can simply write out a prose description of his character. This requires the GM to translate everything into traits and appropriate levels, but that’s not hard to do if the description is well written. This method actually produces some of the best characters.

An example:
GM: “I see you rate Captain Wallop’s blaster skill highly, and also his piloting and gunnery, but I’m only allowing one Superb skill — which is he best at?”
Player: “Blaster!”
GM: “Okay, Superb Blaster. That would then be Great Piloting and Great Gunnery, all right? That leaves you with two more skills to be at Great, since I allow four to start out. Hmmm — I notice he successfully penetrated the main Khothi hive and rescued the kidnapped ambassador — that sounds like a Great Ability to Move Quietly to me — is that accurate, or would you describe it as some other ability?”
Player: “Uh, no — sorry, I didn’t write that clearly enough. He disguised himself and pretended to be a Khothi worker!”
GM: “Ah, I see! How about Great Disguise skill and Great Acting ability, then? And he must be Good at the Khothi language, right?”
And so on.</pre>
</div>
<div title="1.6  Objective Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010220358" modified="201010220446" changecount="2">
<pre>For those who don’t mind counting numbers a bit, the following method creates interesting and well-balanced characters.
In this system, all traits start at default level. The GM then allows a number of free levels the players may use to raise selected traits to higher levels. Players may then lower certain traits in order to raise others even further. Finally, a player may opt to trade some levels of one trait type (such as attributes) for another (skills, for example). The whole process insures that no single character will dominate every aspect of play.

[[1.61  Attributes]]
[[1.62  Skills]]
[[1.63  Gifts &amp; Faults]]
[[1.64  Trading Traits]]
</pre>
</div>
<div title="1.61  Attributes" creator="JonasSusara" modifier="JonasSusara" created="201010220444" changecount="1">
<pre>A GM using the Objective Character Creation system should decide how many attributes she deems necessary in the campaign. She can choose to leave it up to each player, if she wishes. Players then have a number of free attribute levels equal to half the number of attributes (round up). For example, if she selects four attributes, each player starts with two free levels he can use to raise his character’s attributes.

For a more high-powered game, the GM may allow a number of free levels equal to the number of attributes chosen.

All attributes are considered to be Fair until the player raises or lowers them. The cost of raising or lowering an attribute is:
	+3  	Superb
	+2  	Great
	+1  	Good
 	0  	Fair
	–1  	Mediocre
	–2  	Poor
	–3  	Terrible

Thus, a player may raise his Strength attribute (which is Fair by default) to Good by spending one free attribute level. He could then spend another free level to raise Strength again to Great. This would exhaust his free levels if there were only four attributes — but he would have one more if there were six attributes, and eight more free levels if there were 20 attributes.

When the free attribute levels have been exhausted, an attribute can be raised further by lowering another attribute an equal amount. (See also Section 1.64, Trading Traits.) From the previous example, Strength can be raised one more level (to Superb) if the player lowers the character’s Charm to Mediocre to compensate for the increase in Strength.

If the GM allows the players to choose their own attributes, she may simply tell them to take half as many free levels as attributes they choose. If a player chooses an attribute and leaves it at Fair, that attribute does not count towards the total of attributes which determines the amount of free levels. That is, a player cannot simply add twelve attributes, all at Fair, in order to get six more free levels to raise the others with. ~GM-mandated attributes left at Fair do count when determining the number of free levels, though.

As an interesting possibility for those who want attributes and skills to reflect each other accurately, do not let the players adjust attribute levels at all. Instead, they select only skill levels, gifts and faults for their characters. When the character is done, the GM can then determine what attribute levels make sense for the skill levels chosen, and discuss it with the player.

Example: a character is made with many combat and wilderness skills, but no social skills. He also has a smattering of intelligence skills. The GM decides that this character has Strength, Dexterity and Health of Great from spending a lot of time outdoors, practicing with weapons, etc. She will even let the player choose one to be at Superb, if desired. Perception is probably Good, since wilderness survival depends on it. Any social attribute is Mediocre at best — possibly even Poor — while Intelligence is Mediocre or Fair. If the player objects to the low Intelligence ranking, the GM can point out that the character hasn’t spent much time in skills that hone Intelligence, and if he wants his character’s IQ to be higher, he should adjust his skill list.</pre>
</div>
<div title="1.62  Skills" creator="JonasSusara" modifier="JonasSusara" created="201010220445" changecount="1">
<pre>In the Objective Character Creation system, each player has a number of free skill levels with which to raise his skills. Suggested limits are:

For Extremely Broad Skill Groups: 15 levels.
For Moderately Broad Skill Groups: 30 levels.
For Specific Skills: 40 to 60 levels.

Ask the GM for the allotted amount, which will give you a clue as to how precisely to define your skills. Of course, the GM may choose any number that suits her, such as 23, 42, or 74…. See Section 6.3, Character Examples. Gamemasters may devise their own skill lists to choose from — some possibilities are included in the skill lists on page 126.

Most skills have a default value of Poor unless the player raises or lowers them — see Section 1.4, Allocating Traits.
Certain skills have a default of non-existent. These would include Languages, Karate, Nuclear Physics, or Knowledge of Aztec Rituals, which must be studied to be known at all. When a character studies such a skill (puts a level into it at character creation, or experience points later in the game), the level he gets it at depends on how hard it is to learn. Putting one level into learning the Spanish language, for example, would get it at Mediocre, since it’s of average difficulty to learn. Nuclear Physics, on the other hand, might only be Poor or even Terrible with only one level put into it. It would take four levels just to get such a skill at Fair, for example.

For ease in character creation, use the following table:

{{{
Cost of Skills in Objective Character Creation
					Very
		Easy	Most	Hard	Hard
Terrible	–2	–1	0	1
Poor		–1	0	1	2
Mediocre	0	1	2	3
Fair		1	2	3	4
Good		2	3	4	5
Great		3	4	5	6
Superb		4	5	6	7
}}}

Easy = Cost of ~GM-Determined Easy Skills
Most = Cost of Average Skill
Hard = Cost of ~GM-Determined Hard Skills
VH = Cost of ~GM-Determined Very Hard Skills
(usually related to Supernormal Powers)

As in the Subjective Character Creation system, the GM may limit the number of Superb and Great skills each character may have at character creation. For a highly cinematic or super-powered game, no limit is necessary. For example, the GM sets a limit of one Superb skill, three or four Great skills, and eight or so Good skills. These limits can be exceeded through character development, of course. See Section 6.3, Character Examples.

Once the free levels are used up, a skill must be dropped one level (from the default Poor to Terrible) to raise another skill one level. (See also Section 1.64, Trading Traits.) All choices are subject to GM veto, of course.
It is possible to mix different breadths of skill groupings. A GM who has little interest in combat can simply choose Unarmed Combat, Melee Weapons and Ranged Weapons as the only three combat skills. But this does not stop her from using all the individual Social skills (and many more) listed as examples on page 126. If this option is chosen, the broad groups cost double the levels of the narrower groups.

Mixing skill group sizes within the same areas is awkward in the Objective Character Creation system. For example, it is difficult to have a generic Thief Skills group and also have individual skills of lockpicking, pick-pocketing, palming, security-device dismantling, etc. If she does wish to do this, then the broad skill group in this case has a maximum limit of Good, and triple cost to raise — or more, if the GM so mandates.

If the GM is using broad groups, a player may raise a specific skill (such as Poker, for example, instead of general Gambling skill). A player would give his character a specific skill when the GM is using broad-based skill groups to fit a character concept. Do not expect the character to be equally adept with the other skills in the group. This would be true for Groo* the Wanderer, for instance, who would simply raise Sword skill, even if the GM is using the broad term Melee Weapons as a skill group. Groo would have, in fact, a Poor rating with all other Melee weapons, and this would accurately reflect the character.

</pre>
</div>
<div title="1.63  Gifts &amp; Faults" creator="JonasSusara" modifier="JonasSusara" created="201010220445" modified="201010230838" changecount="2">
<pre>If the GM has gifts in her game, she may allow player characters to start with one or two free gifts — more for epic campaigns. Any further gifts taken must be balanced by taking on a fault, or by trading traits.

A player may gain extra trait levels by taking ~GM-approved faults at the following rate:
1 fault = 1 gift.
1 fault = 2 attribute levels.
1 fault = 6 skill levels.

However, the GM may rule that a particular fault is not serious enough to be worth two attribute levels, but may be worth one attribute level or three skill levels. On the other hand, severe faults may be worth more attribute levels.
</pre>
</div>
<div title="1.64  Trading Traits" creator="JonasSusara" modifier="JonasSusara" created="201010220446" changecount="1">
<pre>During character creation, free levels may be traded (in either direction) at the following rate:

1 attribute level = 3 skill levels.
1 gift = 6 skill levels.
1 gift = 2 attribute levels.

Fudge Points cannot be traded without GM permission. (If tradable, each Fudge Point should be equal to one or two gifts.)

So a player with three free attribute levels and 30 free skill levels may trade three of his skill levels to get another free attribute level, or six skill levels to get another free gift.

</pre>
</div>
<div title="1.7  Uncommitted Traits" creator="JonasSusara" modifier="JonasSusara" created="201010220359" changecount="1">
<pre>Whether the character is created subjectively or objectively, each character has some free uncommitted traits (perhaps two or three). At some point in the game, a player will realize that he forgot something about the character that should have been mentioned. He may request to stop the action, and define a previously undefined trait, subject to the GM’s approval. A sympathetic GM will allow this to happen even during combat time.

~GM-set skill limits (such as one Superb, three Greats) are still in effect: if the character already has the maximum number of Superb skills allowed, he can’t make an uncommitted trait a Superb skill.
See the sample character, Dolores Ramirez, Section 6.331.</pre>
</div>
<div title="1.8  Random Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010220359" changecount="1">
<pre>Some players like to roll their attributes randomly. Here is one possible method to use in such cases. Alternate techniques can be easily designed.

Have the player roll 2d6 for each attribute. Use the following table to find the attribute level:

{{{
	2	 = 	Terrible
	4	 = 	Poor
	3,5	 = 	Mediocre
	6-8	 = 	Fair
	9,11	 = 	Good
	10	 = 	Great
	12	 = 	Superb
}}}

The GM needs to decide if the player still gets the standard number of free levels or not. She may also restrict trading levels.
For skills, the results are read as:

{{{
	2-5,12	 = 	Terrible
	6-8	 = 	Poor
	9-10	 = 	Mediocre
	11	 = 	Fair
}}}

The player still gets the standard number of free skill levels, or the GM may allow only half the normal levels.
The GM can let the players choose their gifts and faults, or she may wish to make up separate tables of gifts and faults, and have the players roll once or twice on each. (Conflicting traits should be rerolled.) For example:

{{{
Roll	Gift			Fault
2	Nice Appearance		Poor Appearance
3	Tough Hide		Bruises Easily
4	Charismatic		Aura of Untrustworthiness
5	Keen Hearing		Hard of Hearing
6	Detects Lies Easily	Gullible
7	Melodious Voice		Stammers
8	…			…
}}}

And so on. The GM should customize and complete to her taste. Of course, she could set up a 3d6 table instead of a 2d6 table, or even use a 1d6 table listing general gift or fault areas (Social, Physical, Emotional, Mental, Wealth/Status, etc.) and then roll again on an appropriate second table. This would allow 36 equally likely choices.

</pre>
</div>
<div title="1.9  Minimizing Abuse" creator="JonasSusara" modifier="JonasSusara" created="201010220400" changecount="1">
<pre>Obviously, character creation in Fudge can be abused. There are many ways to avoid this:
# The GM can require that the character take another fault or two to balance the power. (“Okay, I’ll allow you to have all that… but you need a challenge. Take on another weakness: maybe some secret vice, or be unable to tell a believable lie, or anything that fits the character concept that I can use to test you now and then.”)
# She can simply veto any trait (or raised/lowered combination) she feels is abusive. (“I see you raised ~Battle-Axe in exchange for lowering Needlepoint. Hmmm.”) This allows the GM to customize the power level of a game. For high-powered games, allow most anything; for less cinematic campaigns, make them trade equally useful trait for trait.
# She can simply note the character weaknesses and introduce a situation into every adventure where at least one of them is significant to the mission. (“You’ll be sent as an emissary to the Wanduzi tribe — they value fine Needlepoint work above all other skills, by the way…”)
# She can use the “disturbance in the force” technique of making sure that more powerful characters attract more serious problems. (“The bruiser enters the bar with a maniacal look in his eye. He scans the room for a few seconds, then begins to stare intently at you.”)</pre>
</div>
<div title="2. Supernormal Powers" creator="JonasSusara" modifier="JonasSusara" created="201010201256" modified="201010230620" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="14">
<pre>If your game doesn’t have any supernormal powers, you don’t need to read Chapter 2 at all. Genres such as modern espionage, WWII French resistance, gunslingers of the Old West, or swashbuckling Musketeers are frequently played without supernormal powers. Feel free to skip ahead directly to Chapter 3, Action Resolution.

However, those who play in games with non-human races, magic, psi, superpowers, etc., will need to read this chapter before character creation is complete.

[[2.1 Supernormal Power Terms]]
[[2.2  Powers at Character Creation]]
[[2.3 Non-humans]]
[[2.4 Legendary Heroes]]
[[2.5 Magic]]
[[2.6  Miracles]]
[[2.7 Psi]]
[[2.8 Superpowers]]
[[2.9 Cybernetic Enhancements]]</pre>
</div>
<div title="2.1 Supernormal Power Terms" creator="JonasSusara" modifier="JonasSusara" created="201010230413" modified="201010230839" changecount="4">
<pre>;Supernormal power
: that which is beyond the capability of human beings as we know them. Supernormal powers are treated as powerful gifts. Some may have associated skills (which are taken separately, using the normal skill rules).
;Power
: a supernormal power.
;Mana 
:magical energy. Mana is an invisible substance that magicians can detect (or even create) and manipulate to alter matter, time and space.
;Magic
: the art of influencing events through manipulation of mana, or through compelling beings from another dimension, or channeling power from some other source. Magic may be studied by humans, but it is inherent in some races, such as natives of Faerie.
;Miracle
: magic performed by a deity. Miracles are often subtle. Holy persons can attempt to work miracles by invoking their deity. Some religions call any non- or semi-material being greater than human a deity. Others believe there is only one Deity, and that these other beings are simply angels, demons, djinni, efriti, etc. In the former belief, magical results wrought by these superhuman beings are miracles; in the latter belief, they are not miracles, but merely a display of more psychic power than humans are capable of.
;Psi 
:any power that involves mind over matter, time or space.
;Superpower
: any supernormal power that is an inherent ability, whether because of mutation, exposure to radiation, a gift of space aliens, etc., or granted by a device, such as an alien-science belt. Examples of superpowers can be found in many comic books, and include super strength, the ability to fly, see through walls, cling to ceilings, become invisible, etc.
;Cybernetic Enhancement
: any mechanical or electronic enhancement to a normal body that gives the character supernormal powers.
;Non-human Races
: certain fantasy and science fiction races (actually species) have abilities beyond the human norm, such as being much stronger, or able to fly, etc. Most of these abilities could also be classified as Psi or Superpowers, so they are not treated separately, except for Mass and Strength. Androids and robots are considered races for rules purposes.
;Scale
: characters may have certain attributes that are well beyond the human norm, one way or the other, but that need to be related to the human norm. Prime examples include Strength, Mass, and Speed. Such attributes are rated in Scale. Human Scale is 0. A race (or individual) of greater than human average strength, for example, would be Scale 1 Strength or more, while a race of lesser average strength than humans would be Scale –1 Strength or less. Individuals can then be of Fair strength, or Good strength, etc., relative to those of their own Scale.
;Genetic Enhancement
: a genetic enhancement may or may not give a character supernormal powers. If it does, then it must be treated like any other supernormal power listed above.</pre>
</div>
<div title="2.2  Powers at Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010230425" modified="201010230518" changecount="2">
<pre>Supernormal powers may or may not be available in a given game. They are not appropriate to all genres.

The best way to design a supernormal character is through close discussion with the GM. A player should describe what he wants the character to be able to do, and the GM will decide if that’s within the limits she has in mind for the game. If not, she’ll make suggestions about how to change the character to fit her campaign.

Supernormal powers are treated as powerful gifts, with availability set by the GM. The GM may decide that each player can take two Powers for free, for example, or five, or more. The player may make a case for further Powers, but may need to take faults to balance them.

Some Powers are so effective that they are worth more than other Powers. In the Objective Character Creation system, the GM may set the cost of a certain supernormal power equal to two or three “average” supernormal powers. In some cases, the GM may veto player suggestions outright: omniscience and omnipotence are good examples!

The GM may decide that supernormal powers may be pooled with other traits for trading purposes. In this case, one average Power is worth two gifts. For example, a player who wishes to play a magician in a fantasy setting will need to trade some skill, attribute, or gift levels to buy magical Powers.

Undefined Powers have a default of non-existent — that is, they do not have a default value of Fair, like attributes, or Poor, like skills. If a supernormal power is not defined for a character, he doesn’t have it.

[[2.21 Powers Available]]
[[2.22 Associated Skills]]
[[2.23 Combat Powers]]
</pre>
</div>
<div title="2.21 Powers Available" creator="JonasSusara" modifier="JonasSusara" created="201010230512" modified="201010230513" changecount="2">
<pre>The GM needs to design the type, number allowed, and drawbacks of Powers in her game. Some examples:

Types of Powers: a given campaign may allow magic, psi, superpowers, etc., or some combination of the above. The GM also needs to decide how finely a supernormal power is subdivided. Is ESP a generic Power, or is it split into separate Powers such as Precognition and Clairvoyance? Is magic subdivided into spells, or groups of spells (such as elemental magic) or simply the ability to break the laws of nature in any way that can be imagined? And so on.

Number of Powers allowed: the GM may set the number of Powers allowed per character. The number may range from one to 20 — or even more. Multiple Powers per character are especially likely in a fantasy campaign where individual spells are separate Powers.

Drawbacks of Powers: in some campaigns, using a Power may bear a penalty or have some drawback. Typical drawbacks include mental or physical fatigue, lengthy time requirements, unreliable or uncontrollable results, and undesirable side effects (such as loud noises, bad smells, and the like). Some Powers will only work under certain conditions or with certain materials, or are limited to a certain number of uses per day — or month. Others may be risky to the character, affecting physical or mental health. The GM may allow drawbacks to count as faults: a number of them can offset the cost of a Power in the Objective Character Creation system.

{{{
Scale Table
	Scale:			Multipliers:
			Strength		Speed

	-11		0.01		0.13
	-10		0.02		0.16
	-9		0.03		0.2
	-8		0.04		0.23
	-7		0.06		0.28
	-6		0.1		0.3
	-5		0.15		0.4
	-4		0.2		0.5
	-3		0.3		0.6
	-2		0.5		0.7
	-1		0.7		0.8
	0		1		1
	1		1.5		1.2
	2		2.3		1.4
	3		3.5		1.7
	4		5		2
	5		7.5		2.5
	6		10		3
	7		15		3.5
	8		25		4
	9		40		5
	10		60		6
	11		90		7.5
	12		130		9
	13		200		11
	14		300		13
	15		450		15
	16		650		18
	17		1000		22
	18		1500		27
	19		2500		32
	20		4000		38
}}}</pre>
</div>
<div title="2.22 Associated Skills" creator="JonasSusara" modifier="JonasSusara" created="201010230515" modified="201010230516" changecount="2">
<pre>If a Power logically requires a skill to use it efficiently, the skill must be bought separately. For example, the superpower Flight allows a character to fly, and usually no skill roll is needed. But the ability to make intricate maneuvers in close combat without slamming into a wall requires a roll against a Flying skill. (The GM may ignore this and simply say that no roll is needed for any flying maneuver with a Flight Power.)

Another common skill is Throwing: hurling balls of fire or bolts of energy at a foe. Or the GM might rule that being able to aim and accurately release such energy comes with the power for free: no roll needed, it automatically hits the target every time unless the target makes a Good Dodge roll (see Chapter 4, Combat, Wounds &amp; Healing).

This can be especially true with magic: the ability to cast spells at all may be a gift, but to do it right is a skill, or even many different skills.
</pre>
</div>
<div title="2.23 Combat Powers" creator="JonasSusara" modifier="JonasSusara" created="201010230517" changecount="1">
<pre>If a supernormal power can be used to attack a foe, the GM must determine the strength of the Power for damage purposes — preferably during character creation. An offensive Power is usually handled as a propelled weapon, such as a gun, or as being equivalent to a certain melee weapon. This can just be expressed in terms of damage, though, such as Ball of Fire, +6 damage, or large Claws, +3 damage. (See Section 4.54, Sample Wound Factors List.)

In the case of a magical or superhero attack, the more potent the attack, the greater the power required, or perhaps the greater the strain on the character who uses it. This can be a penalty to the skill level, greater fatigue, and/or some other disadvantage.

</pre>
</div>
<div title="2.3 Non-humans" creator="JonasSusara" modifier="JonasSusara" created="201010230614" modified="201010230631" changecount="5">
<pre>Some campaigns will have characters (or animals, monsters, etc.) with traits beyond the human norm. In particular, characters with Strength and Speed well above or below the human range are common in role-playing games. Examples include giants, superheroes, pixies, aliens, ogres, intelligent rabbits, robots, etc.

In Fudge, Strength, Mass and Speed are rated by the GM in terms of Scale for different races. Most other traits that may be different for non-humans are handled with a Racial Bonus or Penalty rather than being on a different Scale — see Section 2.35. Of course, the GM may assign any trait she wishes in terms of Scale.

Humans are of Scale 0, unless some other race is the game-world norm. (E.g., if all the PCs are playing pixies or giants. In these cases, the PCs’ race is Scale 0, and humans would be a different Scale.) Non-human races can have a positive or negative number for Scale, depending on whether they are stronger (or bigger or faster) or weaker (or smaller or slower) than humans.

[[2.31 Strength and Mass]]
[[2.32 Speed]]
[[2.33 Scale Correlations]]
[[2.34 Cost of Scale]]
[[2.35 Racial Bonuses and Penalties]]</pre>
</div>
<div title="2.31 Strength and Mass" creator="JonasSusara" modifier="JonasSusara" created="201010230520" changecount="1">
<pre>The word Scale used alone always means Strength/ Mass Scale in Fudge — any other Scale, such as Speed, or Strength without Mass, will be defined as such.

Each level of Strength (from Terrible to Superb) is defined to be 1.5 times stronger than the previous level. A character with Good Strength is thus 1.5 times as strong as a character with Fair Strength. Note that this progression is not necessarily true for any other attribute. There is a wider range of strength in humans than dexterity, for example: Superb Dexterity is only about twice as good as Fair Dexterity.

Strength Scale increases in the same way: a Scale 1, Fair Strength individual is 1.5 times stronger than a Scale 0, Fair Strength individual. This holds for each increase in Scale: a Scale 10 Superb Strength creature is 1.5 times stronger than a Scale 9 Superb Strength creature, for example.

At this point, it is tempting to say that a Scale 1 Fair Strength is equal to a Scale 0 Good Strength. This is true for Strength, but not for Mass. Scale really measures Mass, or Density, and Strength just goes along for the ride.

In Fudge, Mass has a specific meaning: how wounds affect a character. (This may or may not coincide with the scientific definition of Mass.) It takes more human-powered hits to weaken a giant than a human, for example. She may not really be a healthy giant, but her sheer bulk means that human-sized sword strokes don’t do as much damage relative to her as they would to a human — unless they hit a vital spot, of course. Likewise, a pixie can be healthy and robust, but not survive a single kick from a human. The difference is Mass, and the strength related to it.

A Scale 1 Fair Strength fighter has an advantage over a Scale 0 Good Strength fighter, even though their Strengths are equal. The Scale 1 fighter is less affected by the other’s damage due to his mass. Therefore, do not blithely equate Scale 0 Good with Scale 1 Fair.

Of course, the GM may envision a less massive but harder to kill race than humans. This is best handled by a Racial Bonus (Section 2.35), either as a Toughness Gift (Tough Hide, or Density — either one would subtract from damage), or by a bonus to Damage Capacity.

The GM may decide that increased Mass does not necessarily mean of greater size — the race may be of denser material. Dwarves in northern European legend were derived from stone, and are hence denser than humans. Such a dwarf hits harder and shrugs off damage easier than most humans: he is Scale 1, though shorter than a human. (Of course, the GM should define dwarves’ attributes and Scale to her own requirements.)

Normally, Strength and Mass are handled by a single Scale figure. That is, if a creature is said to be Scale 7, that means Scale 7 Mass and Scale 7 Strength. Strength can vary within each race just as it can for humans. You can have Scale 10 Superb Strength Giants and Scale 10 Terrible Strength Giants. Unlike Strength, though, it is not recommended that Mass vary much within a race. If you do allow Mass to vary for an individual, it should never be worse than Mediocre or better than Good. In fact, it is far better to call Good Mass a Gift, and Mediocre Mass a fault than treat it as an attribute.

The GM may choose to separate Strength Scale from Mass Scale. This would allow Pixies of Strength Scale –6 and Mass Scale –4, for example. However, combat between two Pixies would not work the same as combat between two humans. In this case, they would have a harder time hurting each other than humans would, since their Strength Scale (ability to give out damage) is lower than their Mass Scale (ability to take damage). This may actually be what she wants: a super-strong superhero who can dish out punishment but can’t take it can be represented by Strength Scale 10, Mass Scale 2, for example.

See also Section 4.58, Non-human Scale in Combat.

</pre>
</div>
<div title="2.32 Speed" creator="JonasSusara" modifier="JonasSusara" created="201010230625" changecount="1">
<pre>Each level of Speed (from Terrible to Superb) is defined to be 1.2 times faster than the previous level. A character with Good Speed is thus 1.2 times as fast as a character with Fair Speed. This is not the same progression as for Strength.

Speed Scale increases in the same manner: a Scale 1, Fair Speed individual is 1.2 times faster than a Scale 0, Fair Speed individual. This holds for each increase in Scale: a Scale 10 Superb Speed animal is 1.2 times faster than a Scale 9 Superb Speed animal, for example.

Speed is not a necessary attribute, of course, and can be ignored entirely if desired. It is included primarily for creatures and vehicles significantly faster than humans. For comparison purposes, assume a Fair Speed human can run at about 10 mph (16 kph) over some distance, provided they are in shape, of course. Sprinting short distance is somewhat faster. This comes to about 15 yards (meters) per three-second combat round.

Note that in short races, you don’t really have to roll the dice to see if someone of Superb Speed can beat someone of Good Speed — he 
can, and will, much more often than rolling the dice would reveal.

The Speed Scale rises too slowly for comparing such things as race cars or space ships to human movement. In these cases, either use a rough human Scale, or simply set the average space ship at Space Ship Speed Scale 0, and rate others relative to it. Thus, the average race car will be roughly human Scale 12 — or you can simply call it Race Car Scale 0, and compare other race cars to it. A Space Ship might be Human Scale 100, or Space Ship Scale 0.</pre>
</div>
<div title="2.33 Scale Correlations" creator="JonasSusara" modifier="JonasSusara" created="201010230630" changecount="1">
<pre>The Gamemaster should refer to the following table when assigning a Scale to a race. This only has to be done once, at race creation.
First, the GM should decide how much stronger (or weaker or faster, etc.) the average member of race X is compared to the average human. For example, she decides that Ogres are three times stronger than humans, and pixies are eight times weaker (which equals 0.12 times as strong). She then needs to look up the closest numbers to these strength multipliers on the table below, and look in the corresponding Scale column to find the correct racial Strength/Mass Scales. In this example, Ogres are Scale 3 creatures, while Pixies are Scale –6. (You may envision Ogres and Pixies differently, of course.)

(See Miscellaneous Charts and Tables for a sample Mass Scale Table with examples.)

The Strength/Mass Scale number is figured into damage in combat, and all weapons and armor are assumed to be of the same Scale as the wielder. (These numbers have been rounded to the nearest useful number. They are only roughly 1.5 times the previous number, but close enough for game purposes.)

Other examples: a GM reads in a Medieval text that a dragon is “as strong as 20 warriors.” Looking at the table, 20 times the human norm is Scale 8. However, since the average warrior has Good strength, she chooses Scale 9 for the average dragon in her world. Of course, an individual dragon can still have Poor Strength compared to other dragons. This is simply listed as Strength Poor (–2), Scale 9.

This same GM wants PC leprechauns to be available. While they are small, she decides their magic makes them a bit stronger than their size would otherwise indicate: Scale –4. So a Good Strength leprechaun is as strong as a Terrible Strength human in her world.

The GM can also use this table to determine relative lifting strength or carrying capacity of characters or beasts if she wishes.

The GM may require a Strength roll to lift a given object. This will depend on the Scale of the character, of course. Thus, a leprechaun might need a Good Difficulty Level Strength roll to lift a rock that a human could lift without even a roll. (See Chapter 3, Action Resolution.)</pre>
</div>
<div title="2.34 Cost of Scale" creator="JonasSusara" modifier="JonasSusara" created="201010230628" changecount="1">
<pre>If you are using the Objective Character Creation system, each step of increased Strength/Mass Scale for a player character should cost one attribute level and one gift. This is because each level of Scale includes +1 Strength and extra Mass, which is the equivalent of the Tough Hide gift. However, a generous GM may charge less.

In a superhero game, this gets very expensive, very quickly. An alternative method: let one supernormal power equal a certain Scale. For example, the GM allows one Power to equal Scale 4 (five times as strong as the average human). A character buys three Powers of super strength and has Scale 12 Strength. Another GM allows Scale 13 (200 times as strong as the average human) to equal one Power. Since a character with two Powers in super strength would have Scale 26 Strength (!), the GM decides to limit the amount of super strength available to one Power.

A player then raises or lowers his character’s Strength attribute to show how he compares to the average super-strong superhero. Strength can then be raised to Scale 13 Good, for example, at the cost of one attribute level.
The GM may also allow separate Mass and Strength for superheroes (or even races). For example, the superhero mentioned in Section 2.31 with Strength Scale 10 and Mass Scale 2 would only have to pay for two gifts and ten attribute levels. Or, with a generous GM, a single supernormal power covers the entire cost.

Other supernormal powers may have levels. Examples include Telekinesis (increased power allows greater weight to be lifted), Telepathy (increased power equals greater range), Wind Control (increased power allows such things as a jet of wind, whirlwind, or tornado), etc.
In these cases, each level can be bought as a separate supernormal power, which is expensive. Or you could use the option given above for Scale: one supernormal power buys the supernormal ability at a middling power range, and a simple attribute (or even skill) level raises or lowers it from there.

For Scales below the human norm, each step of Mass Scale includes a fault equivalent to Easily Wounded, and the GM may allow this to be used to balance other traits like any other fault — see Section 1.64, Trading Traits.</pre>
</div>
<div title="2.35 Racial Bonuses and Penalties" creator="JonasSusara" modifier="JonasSusara" created="201010230631" changecount="1">
<pre>There is rarely any need to use Scale for traits other than Strength, Mass and Speed. It’s easy to imagine someone wanting to play a race that is slightly more intelligent than humans, but a race ten times smarter than the smartest human is so alien that it would be impossible to play. This is true for most traits — we just can’t grasp such extreme differences from our world view.
Actually, there is a way to use intelligence in Scale: in a non-quantified manner. For example, when creating a dog character, you can list:

Intelligence:   Great (Scale: Dog)

Since no one is able to quantify inter-species intelligence accurately, do not expect to use it comparatively. It gives an indication that, relative to other dogs, this dog has Great intelligence. The word “Scale” isn’t necessary — “Great canine intelligence” works just as well.
The GM should usually use Racial Bonuses or Penalties for traits other than Strength, Mass and Speed. If the GM envisions halflings as being particularly hardy, she can give them a +1 bonus to Constitution: halfling Fair Constitution equals human Good Constitution. As another example, an alien race, Cludds, have a racial penalty of –1 to Intelligence.

It is best to use trait levels relative to humans on the character sheets, though you should put the racial-relative term in brackets. (Example: Grahkesh, Intelligence Poor [Cludd Fair].) However, always list Strength relative to the character’s own race, with the Scale (if other than 0), so the Mass will be accurate. See the sample character, Brogo the Halfling (Section 6.311), for an example of both racial bonus and different Scale.

Racial bonuses and penalties can be used for any type of trait: attributes, skills, gifts, supernormal powers, or faults.

If using the Objective Character Creation system, each level of a Racial Bonus or Penalty is usually equal to one level of the specific trait raised or lowered normally. That is, if you are granting a +1 to Agility or +1 to Perception for a race, it should cost one attribute level. If a race has a bonus of a Perfect Sense of Direction, it should cost one gift. The innate ability to fly or cast magic spells should cost one supernormal power, etc.

If a race is at –1 to all Social skills, however, this should only be worth –1 skill level if you have a single skill called Social Skills. If you have many social individual social skills, it should be worth one fault. The converse is true for Bonuses that affect many skills: it should cost one or more gifts.</pre>
</div>
<div title="2.4 Legendary Heroes" creator="JonasSusara" modifier="JonasSusara" created="201010230616" modified="201010230840" changecount="2">
<pre>Some genres allow human characters to develop beyond the realm of the humanly possible. Such campaigns eventually involve planes of existence beyond the mundane as the ~PCs require greater and greater challenges.

This style of gaming can be represented in Fudge by Legendary Levels. Section 1.2, Levels, introduced the concept of Legendary traits as a goal for PCs to work toward. This section expands that concept infinitely.

If the GM and players prefer this type of gaming, any skill can be raised beyond Legendary. Instead of renaming each level, simply use a numbering system: Legendary 2nd Level Swordsman, Legendary 3rd Level Archer, etc. Attributes can also be raised, but (except for Strength) this is much rarer.

Each level of Legendary gives a +1 bonus to any action resolution. The character Hugh Quickfinger, for example, has a Longbow skill of Legendary 2nd Level. This gives him a total bonus of +5 (+3 for Superb, and +2 for two levels of Legendary). In any contest against a Fair Longbowman (+0), Hugh should easily triumph.

The Objective Character Development system, Section 5.2, lists suggested experience point costs for attaining these levels.
These levels do not automatically exist in any given game: these are strictly optional levels for specific, non-realistic genres.</pre>
</div>
<div title="2.5 Magic" creator="JonasSusara" modifier="JonasSusara" created="201010230617" modified="201010230841" changecount="2">
<pre>If the Gamemaster wishes to include magic in the campaign, it may be easiest to translate whatever magic system she is familiar with into Fudge. If she wishes to craft her own Fudge magic rules, she should consider what she wants magic to be like in her game world.

Questions to ask include: What is the source of magic? Is it a natural process, such as mana manipulation? If it does use mana, does the mage create the mana, or is it inherent in a locale? Or does the mage summon other-world entities to do his bidding? Or must the mage find a source of Power and channel it to his own ends? Or is the source of magic something altogether different?

Can anyone learn to work magic, or is it an inherent talent (that is, does it require a supernormal power)? Are there levels of Power available, and what would having more levels mean? Is a skill also required? Of course, even if a magician must have a Power to cast spells, there may also be magic items that anyone can use — these are common in tales and legends.

If beings are summoned, are they evil, good, neutral, confused? How do they feel about being commanded to work for the magician? Can they adversely affect the magician if he fails a spell roll? If Power is being channeled from an external source, is that source in the physical plane or astral? Is it from a living being, or contained in an inanimate object as inert energy, like a piece of coal before going into a fire?

What is the process of using magic? Does it involve memorized spells? Physical components? Meditation? Complex and time-consuming ritual? How long does it take to cast a spell? Can a spell be read out of a book? Improvised on the spot?

How reliable is magic? Are there any drawbacks? Any societal attitudes toward magicians? Is it common knowledge that magicians exist, or are they a secret cabal, whose doings are only whispered about in ever-changing rumors?

Once these issues have been resolved, and the degree of magic in the game decided on, the magic system can be created using Fudge mechanics. A sample magic system, Fudge Magic, is included in Chapter 7, The Addenda.
</pre>
</div>
<div title="2.6  Miracles" creator="JonasSusara" modifier="JonasSusara" created="201010230617" changecount="1">
<pre>Fudge assumes miracles are powered by a deity. Some miracles may happen at the deity’s instigation (GM whim, or deus ex machina for plot purposes), and some may be petitioned by characters.

Miracles may take place in a startling fashion or in a mundane way. In fact, many people believe that miracles occur daily, but we don’t notice them because they appear as simple coincidences. The stranger walking down the road who just happens to have the tools you need to fix your wagon might indeed be just a coincidence, or it may have been divinely arranged that he chanced by at that time. If the tools were simply to appear by themselves, or the wagon fix itself, there would be little doubt that a miracle had occurred. This is neither good nor bad — the GM can choose either method of granting miracles, and need not feel bound to be consistent.

The GM must decide whether miracles can occur in her world, and whether they can be called by character petition. If the latter, then she has to make many other decisions. Can any character petition a particular deity? Does it matter if the character is actually a member of a religious order? How important is the character’s behavior — would a deity help a member of a particular religious order even if he had been acting against the deity’s goals? How certain is the miracle to occur? How soon will it become manifest? How broad and how specific can requests be? Are any Ritual or Supplication skills needed to petition a deity, or can anyone simply breathe a prayer for help?

The answers will vary from GM to GM — no “generic” system of miracles is possible. A sample miracle system, Fudge Miracles, is included in Chapter 7, The Addenda.
</pre>
</div>
<div title="2.7 Psi" creator="JonasSusara" modifier="JonasSusara" created="201010230618" modified="201010230841" changecount="2">
<pre>Again, it is probably easiest for the GM to translate whatever psionics rules she knows to Fudge. As a simple system, each psionic ability can be a separate supernormal power. The ability to read minds, or foresee the future, or telekinetically move an object, etc., each cost one supernormal power (two gifts). Just how powerful the psionic ability is depends on the level of psi the GM wants for the game world. 

Someone who can telekinetically lift a battleship is obviously more powerful than someone who can’t lift anything heavier than a roulette ball — though the latter may make more money with his power, if he’s highly skilled!

If the game world has more than one level of power available, then a character must spend multiple free power levels to get the higher levels. See also Section 2.34, Cost of Scale.

In general, higher levels of Psi Powers equal greater range, or the ability to affect larger or more subjects at once, or access to a greater number of related skills (a low Telepathy Power lets you send your thoughts to another, for example, but greater Power lets you read minds, send painful waves of energy, sense emotions, and possibly even control others). A higher level might also let you use less fatigue or have a lower risk of burnout, take less time in concentration to use, or allow more uses per day, or be used in a broader range of conditions (a low ESP Power can only be accessed in a darkened room, for example, while a high Power level can be used at any time), and so on.

The GM may also require skills to use these powers. Having the psionic ability to use telekinesis just allows you to pick an object up with your mental powers, and move it crudely about. Fine manipulation, such as picking a pocket, requires a successful roll against a telekinetic skill.

A sample psi system, Fudge Psi, is included in Chapter 7, The Addenda.

</pre>
</div>
<div title="2.8 Superpowers" creator="JonasSusara" modifier="JonasSusara" created="201010230619" changecount="1">
<pre>If the campaign allows superpowers similar to those found in comic books, there will probably be a wide variety of powers available. How many an individual character can have depends on the power level of the campaign. A common treatment of superheroes involves faults related to Powers, which makes more Powers available to the character. For example, a super hero is able to fly, but only while intangible. The accompanying fault lowers the cost of the Power to that of a gift.

There are far too many powers to list in Fudge — browsing through a comic store’s wares will give you a good idea of what’s available. As with psionics, each power costs one of the free supernormal powers available, and some can be taken in different levels. Potent ones cost two or more of the “average” superpowers.

Super strength is treated as a separate scale — see Section 2.3, Non-humans. Other superpowers that come in levels are discussed in Section 2.34, Cost of Scale.
</pre>
</div>
<div title="2.9 Cybernetic Enhancements" creator="JonasSusara" modifier="JonasSusara" created="201010230620" changecount="1">
<pre>Artificial limbs, organs, implants and neural connections to computers are common in some science fiction settings. If these grant powers beyond the human norm, they must be bought with supernormal power levels if using the Objective Character Creation system, or with the GM’s approval in any case.

If an implant grants a bonus to an attribute, it should cost as much as the attribute bonus, which is not necessarily as much as a supernormal power. Since an artificial implant may occasionally fail, however, the GM can give a slight cost break by also allowing a free skill level elsewhere on the character sheet.</pre>
</div>
<div title="3. Action Resolution" creator="JonasSusara" modifier="JonasSusara" created="201010201257" modified="201010230649" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="7">
<pre>This chapter covers how to determine whether or not a character succeeds at an attempted action. In the previous chapters, traits were defined in terms of levels: Superb, Great, Good, etc. This chapter explains how those levels affect a character’s chances of success at an action, whether fighting a giant or tracking down a clue. Sometimes a Fair result is sufficient to complete a task, and sometimes a Good or better result is needed. The better your skill, the better your chances of getting these higher results.

[[3.1 Action Resolution Terms]]
[[3.2 Rolling the Dice]]
[[3.3 Action Modifiers]]
[[3.4 Unopposed Actions]]
[[3.5 Opposed Actions]]
[[3.6 Critical Results]]
[[3.7 NPC Reactions]]
</pre>
</div>
<div title="3.1 Action Resolution Terms" creator="JonasSusara" modifier="JonasSusara" created="201010230639" modified="201010230641" changecount="3">
<pre>;Dice
: Various options for dice are given: players may use either three or four six-sided dice (3d6 or 4d6), or two ten-sided dice as percentile dice (d%), or four Fudge dice (4dF), described in the text. It is also possible to play Fudge diceless.
;Unopposed Action
: some actions are Unopposed, as when a character is trying to perform an action which isn’t influenced by anyone else. Examples include jumping a wide chasm, climbing a cliff, performing a chemistry experiment, etc. The player simply rolls the dice and reads the result.
;Rolled Degree
: this refers to how well a character does at a particular task. If someone is Good at Climbing in general, but the die-roll shows a Great result on a particular attempt, then the rolled degree is Great.
;Difficulty Level
: the GM will set a Difficulty Level when a character tries an Unopposed Action. Usually it will be Fair, but some tasks are easier or harder. Example: climbing an average vertical cliff face, even one with lots of handholds, is a fairly difficult obstacle (Fair Difficulty Level). For a very hard cliff, the GM may set the Difficulty Level at Great: the player must make a rolled degree of Great or higher to climb the cliff successfully.
;Opposed Action
: actions are Opposed when other people (or animals, etc.) may have an effect on the outcome of the action. In this case, each contestant rolls a set of dice, and the results are compared to determine the outcome. Examples include combat, seduction attempts, haggling, tug-of-war, etc.
;Relative Degree
: this refers to how well a character did compared to another participant in an Opposed Action. Unlike a rolled degree, relative degree is expressed as a number of levels. For example, if a PC gets a rolled degree result of Good in a fight, and his NPC foe gets a rolled degree result of Mediocre, he beat her by two levels — the relative degree is +2 from his perspective, –2 from hers.
;Situational Roll
: the GM may occasionally want a die roll that is not based on a character’s trait, but on the overall situation or outside circumstances. This Situational roll is simply a normal Fudge die roll, but not based on any trait. That is, a result of 0 is a Fair result, +1 a Good result, –1 a Mediocre result, and so on. This is most commonly used with Reaction and damage rolls, but can be used elsewhere as needed. For example, the players ask the GM if there are any passersby on the street at the moment — they’re worried about witnesses. The GM decides there are none if a Situational roll gives a Good or better result, and rolls the dice. (A close approximation to 50% is an even/odd result: an even result on 4dF occurs 50.6% of the time. Of course, 1d6 or a coin returns an exact 50% probability.)
;Beyond Superb
: it is possible to achieve a level of rolled degree that is beyond Superb. Rolled degrees from Superb +1 to Superb +4 are possible. These levels are only reachable on rare occasions by human beings. No trait may be taken at (or raised to) a level beyond Superb (unless the GM is allowing a PC to be at Legendary, which is the same as Superb +1 — see Section 5.2, Objective Character Development). For example, the American baseball player Willie Mays was a Superb outfielder. His most famous catch, often shown on television, is a Superb +4 rolled degree. It isn’t possible for a human to have that level of excellence as a routine skill level, however: even Willie was “just” a Superb outfielder, who could sometimes do even better. A GM may set a Difficulty Level beyond Superb for nearly impossible actions.
;Below Terrible
: likewise, there are rolled degrees from Terrible –1 down to Terrible –4. No Difficulty Level should be set this low, however: anything requiring a Terrible Difficulty Level or worse should be automatic for most characters — no roll needed.</pre>
</div>
<div title="3.2 Rolling the Dice" creator="JonasSusara" modifier="JonasSusara" created="201010230642" modified="201010230658" changecount="2">
<pre>There is no need to roll the dice when a character performs an action that is so easy as to be automatic. Likewise, an action so difficult that it has no chance to succeed requires no roll, either — it simply can’t be done. Dice are used solely in the middle ground, where the outcome of an action is uncertain.

The GM is encouraged to keep die-rolling to a minimum. Do not make the players roll the dice when their characters do mundane things. There is no need to make a roll to see if someone can cook lunch properly, or pick an item from a shelf, or climb a ladder, etc. Don’t even make them roll to climb a cliff unless it’s a difficult cliff or the situation is stressful, such as a chase. (And possibly a Superb climber wouldn’t need a roll for a difficult cliff. He should get up it automatically unless it’s a very difficult cliff.)

For any action the player character wishes to perform, the Gamemaster must determine which trait is tested. (This will usually be a skill or an attribute.) If the action is Unopposed, the GM also determines the Difficulty Level — usually Fair. (See also Section 3.5, Opposed Actions.)

For running Fudge Diceless, see the Addenda, Section 7.42.

[[3.21 Reading the Dice: Fudge Dice]]
[[3.22 Other Dice Techniques]]
[[3.23 Success Rates]]
</pre>
</div>
<div title="3.21 Reading the Dice: Fudge Dice" creator="JonasSusara" modifier="JonasSusara" created="201010230654" changecount="1">
<pre>Of the four dice techniques presented in Fudge, this one is recommended. It gives results from –4 to +4 quickly and easily, without intruding into role-playing or requiring complex math or a table.

Fudge dice are six-sided dice with two sides marked +1, two sides marked –1, and two sides marked 0. They are commercially available from Grey Ghost Press, Inc. — see http://www.fudgerpg.com.

You can make your own Fudge dice easily enough. Simply get four normal white d6s. Using a permanent marker, color two sides of each die green, two sides red, and leave the other two sides white. When the ink has dried, spray the dice lightly with clear matte finish to prevent the ink from staining your hands. You now have 4dF: the green sides = +1, the red sides = –1, and the white sides = 0.

(While you can try to play with normal d6s — reading: 1,2 = –1;  3,4 =  0; 5,6 = +1 — this is not recommended. It takes too much effort, and intrudes into role-playing. 4dF is functionally equivalent to 4d3–8, but this is also not recommended for the same reason, even if you have d6s labeled 1-3 twice.)

To use Fudge dice, simply roll four of them, and total the amount. Since a +1 and a –1 cancel each other, remove a +1 and –1 from the table, and the remaining two dice are easy to read no matter what they are. (Example: if you roll +1, +1, 0, –1, remove the –1 and one of the +1s, as together they equal 0. The remaining two dice, +1 and 0, are easily added to +1.) If there is no opposing pair of +1 and –1 dice, remove any zeros and the remaining dice are again easy to read.

The result of a die roll is a number between –4 and +4. At the top of the character sheet, there should be a simple chart of the attribute levels, such as:
* Superb
* Great
* Good
* Fair
* Mediocre
* Poor
* Terrible

To determine the result of an action, simply put your finger on your trait level, then move it up (for plus results) or down (for minus results).
Example: Nathaniel, who has a Good Bow Skill, is shooting in an archery contest. The player rolls 4dF, using the procedure described above. If he rolls a 0, he gets a result equal to Nathaniel’s skill: Good, in this case. If he rolls a +1, however, he gets a Great result, since Great is one level higher than his Good Archery skill. If he rolls a –3, unlucky Nathaniel has just made a Poor shot.

It is not always necessary to figure the exact rolled degree. If you only need to know whether or not a character succeeded at something, it is usually sufficient for the player simply to announce the appropriate trait level and the die roll result. The game goes much faster this way. For example, a player wants his character, Captain Wallop of the Space Patrol, to fly between two asteroids that are fairly close together. The GM says this requires a Great Difficulty Level Piloting roll and asks the player to roll the dice. The player looks up Captain Wallop’s Piloting skill, which is Great, and rolls a +2 result. He simply announces “Great +2” as the result. This answer is sufficient — the GM knows that Captain Wallop not only succeeded at the task, but didn’t even come close to damaging his craft.

Of course, there are many times when you want to know exactly how well the character did, even if it’s not a matter of being close. If the character is composing a poem, for example, and his Poetry skill is Fair, you will want to figure out what “Fair+2” means: he just wrote a Great poem! There are many other instances where degrees of success is more important than merely knowing success/failure.
</pre>
</div>
<div title="3.22 Other Dice Techniques" creator="JonasSusara" modifier="JonasSusara" created="201010230656" modified="201010230657" changecount="2">
<pre>For those who don’t want to make or buy Fudge dice, three different options are available:
;4d6
: this method requires 2d6 of one color (or size) and 2d6 of another color or size. First declare which two dice are the positive dice, and which two the negative, then roll all four dice. Do not add the dice in this system. Instead, remove from the table all but the lowest die (or dice, if more than one has the same lowest number showing). If the only dice left on the table are the same color, that is the result: a positive die with a “1” showing is a +1, for example. If there are still dice of both colors showing, the result is “0”.
:Examples (p = positive die, n = negative die): you roll p4, p3, n3, n3. The lowest number is a 3, so the p4 is removed, leaving p3, n3 and n3. Since there are both positive and negative dice remaining, the result is 0. On another roll, you get p1, p1, n2, n4. Remove the highest numbers, n2 and n4. This leaves only positive dice, so the result is +1, since a “1” is showing on a positive die, and there are no negative dice on the table.
;3d6
: Roll 3 six-sided dice. Add the numbers and look up the results on the table below. The table is so small that it could easily fit on a character sheet. Example: a roll of 3, 3, 6 is a sum of 12. Looking up 12 on the table yields a result of +1.

{{{
Rolled:  3-4	5	6-7	8-9	10-11	12-13	14-15	16	17-18
Result:   –4	–3	–2	–1	+0	+1	+2	+3	+4
}}}

;d%
: roll two ten-sided dice, having first declared which will be the “tens” digit. Read the tens die and the ones die as a number from 1 to 100 (01 = 1, but 00 = 100), and consult the table below, which should be printed on the character sheet:

{{{
Rolled:   1	2-6	7-18	19-38	39-62	63-82	83-94	95-99	00
Result:  –4	–3	–2	–1	+0	+1	+2	+3	+4
}}}

Of course, the GM may customize this table as she wishes. These numbers were chosen to match 4dF, which the author feels is an ideal spread for Fudge.

</pre>
</div>
<div title="3.23 Success Rates" creator="JonasSusara" modifier="JonasSusara" created="201010230658" modified="201010230659" changecount="2">
<pre>The following table is provided so that players can better evaluate their chances of success.
{{{
	Chance	4dF
	of achieving	or d%	3d6	4d6
	+5 or better:	—	—	0.2%
	+4 or better:	1%	2%	2%
	+3 or better:	6%	5%	7%
	+2 or better:	18%	16%	18%
	+1 or better:	38%	38%	39%
	  0 or better:	62%	62%	61%
	–1 or better:	82%	84%	82%
	–2 or better:	94%	95%	93%
	–3 or better:	99%	98%	98%
	–4 or better:	100%	100%	99.8%
	–5 or better:	—	—	100%
}}}

Thus, if your trait is Fair, and the GM says you need a Good result or better to succeed, you need to roll +1 or better. You’ll do this about two times out of five, on the average.
You’ll notice that using 3d6 or 4d6 the results, while slightly different, are close enough for a game called Fudge. The 4d6 results do allow +/–5, however, but this shouldn’t be a problem since they occur so rarely. In fact, you could use 5dF to allow +/–5 if you wanted….
</pre>
</div>
<div title="3.3 Action Modifiers" creator="JonasSusara" modifier="JonasSusara" created="201010230644" modified="201010230644" changecount="2">
<pre>There may be modifiers for any given action, which can affect the odds referred to in the preceding section. Modifiers temporarily improve or reduce a character’s traits.

Examples: Joe, Good with a sword, is Hurt (–1 to all actions). He is thus only Fair with his sword until he’s healed. Jill has Mediocre Lockpicking skills, but an exceptionally fine set of lock picks gives her a Fair Lockpicking skill while she’s using them.

If a character has a secondary trait that could contribute significantly to a task, the GM may allow a +1 bonus if the trait is Good or better.

Example: Verne is at the library, researching an obscure South American Indian ritual. He uses his Research skill of Good, but he also has a Good Anthropology skill. The GM decides this is significant enough to give Verne a Great Research skill for this occasion. If his Anthropology skill were Superb, the GM could simply let Verne use that instead of Research: you don’t get to be Superb in Anthropology without having done a lot of research.

Other conditions may grant a +/–1 to any trait. In Fudge, +/–2 is a large modifier — +/–3 is the maximum that should ever be granted except under extreme conditions.</pre>
</div>
<div title="3.4 Unopposed Actions" creator="JonasSusara" modifier="JonasSusara" created="201010230646" modified="201010230844" changecount="4">
<pre>For each Unopposed action, the GM sets a Difficulty Level (Fair is the most common) and announces which trait should be rolled against. If no Skill seems relevant, choose the most appropriate Attribute. If there is a relevant Skill, but the character is untrained in it (it’s not listed on his character sheet), then use the default: usually Poor. If a high attribute could logically help an untrained skill, set the default at Mediocre. For example, a character wishes to palm some coins without being observed. The GM says to use Sleight of Hand skill, but the character is untrained in Sleight of Hand. The player points out that the character’s Dexterity attribute is Superb, so the GM allows a default of Mediocre Sleight of Hand for this attempt.

The player then rolls against the character’s trait level, and tries to match or surpass the Difficulty Level set by the GM. In cases where there are degrees of success, the better the roll, the better the character did; the worse the roll, the worse the character did.

In setting the Difficulty Level of a task, the GM should remember that Poor is the default for most skills. The average trained climber can climb a Fair cliff most of the time, but the average untrained climber will usually get a Poor result. In the example in Section 3.2 (Nathaniel shooting at an archery target), if the target is large and close, even a Mediocre archer could be expected to hit it: Mediocre Difficulty Level. If it were much smaller and farther away, perhaps only a Great archer could expect to hit it regularly: Great Difficulty Level. And so on.

Example of setting Difficulty Level: Two ~PCs (Mickey and Arnold) and an NPC guide (Parri) come to a cliff the guide tells them they have to climb. The GM announces this is a difficult, but not impossible, cliff: a Good Difficulty Level roll is required to scale it with no delays or complications. Checking the character sheets, they find that Parri’s Climbing skill is Great and Mickey’s is Good. Arnold’s character sheet doesn’t list Climbing, so his skill level is at default: Poor. Parri and Mickey decide to climb it, then lower a rope for Arnold.

Parri rolls a +1 result: a rolled degree of Superb. She gets up the cliff without difficulty, and much more quickly than expected. Mickey rolls a –1, however, for a rolled degree of Fair. Since this is one level lower than the Difficulty Level, he’s having problems. Had Mickey done Poorly or even Mediocre, he would perhaps have fallen — or not even been able to start. Since his rolled degree is only slightly below the Difficulty Level, though, the GM simply rules he is stuck half way up, and can’t figure out how to go on. Parri ties a rope to a tree at the top of the cliff, and lowers it for Mickey. The GM says it is now Difficulty Level: Poor to climb the cliff with the rope in place, and Mickey makes this easily on another roll.

Arnold would also need a Poor rolled degree to climb the cliff with the rope, but since his skill is Poor, they decide not to risk it. Mickey and Parri have Arnold loop the rope under his arms, and pull him up as he grabs handholds along the way in case they slip. No roll is needed in this case, unless they are suddenly attacked when Arnold is only half way up the cliff….

(The whole situation was merely described as an example of setting Difficulty levels. In actual game play, the GM should describe the cliff, and ask the players how the characters intend to get up it. If they came up with the idea of Parri climbing the cliff and lowering a rope, no rolls would be needed at all — unless, possibly, time was a critical factor, or there were hidden difficulties the GM chose not to reveal because they couldn’t have been perceived from the bottom of the cliff.)

Occasionally, the GM will roll in secret for the PC. There are times when even a failed roll would give the player knowledge he wouldn’t otherwise have. These are usually information rolls. For example, if the GM asks the player to make a roll against Perception attribute (or Find Hidden Things skill), and the player fails, the character doesn’t notice anything out of the ordinary. But the player now knows that there is something out of the ordinary that his character didn’t notice…. Far better for the GM to make the roll in secret, and only mention it on a successful result.</pre>
</div>
<div title="3.5 Opposed Actions" creator="JonasSusara" modifier="JonasSusara" created="201010230647" modified="201010230845" changecount="2">
<pre>To resolve an Opposed action between two characters, each side rolls dice (4dF, d%, 3d6, 4d6, or whatever is your chosen dice technique) against the appropriate trait and announces the result. The traits rolled against are not necessarily the same: for example, a seduction attempt would be rolled against a Seduction skill for the active participant (or possibly Appearance attribute) and against Will for the resisting participant. There may be modifiers: someone with a vow of chastity might get a bonus of +2 to his Will, while someone with a Lecherous fault would have a penalty — or not even try to resist.

The Gamemaster compares the rolled degrees to determine a relative degree. For example, Lisa is trying to flimflam Joe into thinking she’s from the FBI and rolls a Great result. This is not automatic success, however. If Joe also rolls a Great result on his trait to avoid being flimflammed (Knowledge of Police Procedure, Learning, Intelligence, etc. — whatever the GM decides is appropriate), then the relative degree is 0: the status quo is maintained. In this case, Joe remains unconvinced that Lisa is legitimate. If Joe rolled a Superb result, Lisa’s Great result would have actually earned her a relative degree of –1: Joe is not going to be fooled this encounter, and will probably even have a bad reaction to Lisa.

The Opposed action mechanism can be used to resolve almost any conflict between two characters. Are two people both grabbing the same item at the same time? This is an Opposed action based on a Dexterity attribute — the winner gets the item. Is one character trying to shove another one down? Roll Strength vs. Strength (or Wrestling skill) to see who goes down. Someone trying to hide from a search party? Perception attribute (or Find Hidden skill) vs. Hide skill (or Camouflage, Stealth, etc.). Trying to out-drink a rival? Constitution vs. Constitution (or Drinking skill, Carousing, etc.). And so on.

Some Opposed actions have a minimum level needed for success. For example, an attempt to control a person’s mind with a Telepathy skill might require at least a Fair result. If the telepath only gets a Mediocre result, it doesn’t matter if the intended victim rolls a Poor resistance: the attempt fails. Most combat falls into this category — see Chapter 4.

For an example of Opposed actions involving more than two characters, see Section 4.34, Multiple Combatants in Melee.

An Opposed action can also be handled as an Unopposed action. When a PC is opposing an NPC, have only the player roll, and simply let the NPC’s trait level be the Difficulty Level. This method assumes the NPC will always roll a 0. This emphasizes the PCs’ performance, and reduces the possibility of an NPC’s lucky roll deciding the game.

As a slight variation on the above, the GM rolls 1dF or 2dF when rolling for an NPC in an opposed action. This allows some variation in the NPC’s ability, but still puts the emphasis on the PCs’ actions.

For those without Fudge dice, the GM can simply roll 1d6 for an NPC. On a result of 2-5, the NPC gets the listed trait level as a result. On a result of 1, the NPC did worse than her trait level; on a result of 6 the NPC did better than her trait level. Those who want to know precisely how much better or worse should roll a second d6: 
{{{
1,2,3 = +/–1 (as appropriate)
 4,5  = +/–2
  6   = +/–3
}}}
</pre>
</div>
<div title="3.6 Critical Results" creator="JonasSusara" modifier="JonasSusara" created="201010230649" modified="201010230845" changecount="2">
<pre>Critical results are an optional Fudge rule for ~GMs who like the idea. A natural rolled result of +4 can be considered a critical success — the character has done exceptionally well, and the GM may grant some special bonus to the action. Likewise, a natural result of –4 is a critical failure, and the character has done as poorly as he possibly can in the given situation.

Note that achieving +/–4 with die modifiers does not count as a critical result, though the character has done exceptionally well or poorly. When a natural critical result is rolled, the GM may ignore what the rolled degree would be, and treat it as an automatic beyond Superb or below Terrible result.

Optionally, if a character gets a rolled degree four or more levels better than the Difficulty Level, he has gotten a critical success. Likewise, four levels below a Difficulty Level is a critical failure.

A critical result in combat can mean many things: one fighter falls down, or drops his weapon, or is hurt extra badly, or is stunned for a round and can’t even defend himself, or is temporarily blinded, or knocked out, etc. The GM should be creative, but not kill a character outright.

The GM may even wish to make a table, such as these sample melee critical results:

{{{
Roll 2d6:
2	Blinded for the next combat round — no defense or offense!
3	Fall down: skill at –2 for one round.
4	Armor badly damaged — no armor value rest of fight!
5	Weapon finds chink in armor — do not subtract for armor.
6	Off balance — skill at –1 next turn.
7	Drop Weapon.
8	Weapon breaks, but still useful: –1 to damage.
9	…
}}}

And so on — finish and customize to your tastes.
This is an easy way to achieve a lot of detail without complicating Fudge. Those with Internet access are invited to add any interesting critical results tables they create to the Fudge sites.

</pre>
</div>
<div title="3.7 NPC Reactions" creator="JonasSusara" modifier="JonasSusara" created="201010230650" modified="201010230846" changecount="3">
<pre>Sometimes a non-player character has a set reaction to the ~PCs. Perhaps she’s automatically their enemy, or perhaps the party has rescued her, and earned her gratitude. But there will be many ~NPCs that don’t have a set reaction. When the ~PCs request information or aid, it might go smoothly or it might not go well at all. Negotiation with a stranger is always an unknown quantity to the players — it may be so for the GM, too.

When in doubt, the GM should secretly make a Situational roll. If the PC in question has a trait that can affect a stranger’s reaction, this should grant a +/–1 (or more) to the result. Examples include Appearance (which could be an attribute, gift or fault), Charisma, Reputation, Status, and such habits as nose-picking or vulgar language. The Reaction roll can also be modified up or down by circumstances: bribes, suspicious or friendly nature of the NPC, proximity of the NPC’s boss, observed PC behavior, etc.

The higher the Reaction roll result, the better the reaction. On a Fair result, for example, the NPC will be mildly helpful, but only if it’s not too much effort. She won’t be helpful at all on Mediocre or worse results, but will react well on a Good result or better.

Example: Nathaniel needs some information about the local duke, who he suspects is corrupt. He has observed that folks are reticent to talk about the duke to strangers. Nathaniel decides to approach a talkative vegetable seller at the open market. Nathaniel has an average appearance (no modifier), but is charismatic: +1 to any Reaction roll. He makes small talk for a while, then slowly brings the duke into the conversation. The GM decides this was done skillfully enough to warrant another +1 on the reaction roll. However, the situation is prickly: –2 in general to elicit any information about the sinister local ruler. This cancels Nathaniel’s bonuses. The GM rolls in secret, and gets a Fair result. The old lady slips out a bit of useful information before realizing what she’s just said. At that point she clams up, but Nathaniel casually changes the subject to the weather, dispelling her suspicions. He wanders off to try his luck elsewhere.</pre>
</div>
<div title="4. Combat, Wounds &amp; Healing" creator="JonasSusara" modifier="JonasSusara" created="201010201258" modified="201010230806" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="4">
<pre>Unless one participant is unaware of an attack or decides to ignore it, combat is an Opposed action in Fudge. The easiest way to handle combat in Fudge is as a series of Opposed actions. This can be done simply or with more complexity. The author of Fudge uses simple and loose combat rules in order to get combat over with quickly and get back to more interesting role-playing. This chapter, largely optional, is for players who prefer combat options spelled out in detail.

Melee combat and Ranged combat are treated separately. 

[[4.1 Combat Terms]]
[[4.2 Melee Combat]]
[[4.3 Melee Combat Options]]
[[4.4 Ranged Combat]]
[[4.5 Wounds]]
[[4.6 Wound Options]]
[[4.7 Combat and Wounding Example]]
[[4.8 Healing]]</pre>
</div>
<div title="4.1 Combat Terms" creator="JonasSusara" modifier="JonasSusara" created="201010230801" modified="201010230848" changecount="3">
<pre>;Melee
: any combat that involves striking the opponent with a fist or hand-held weapon. Any attack from further away is a Ranged attack.
;Story Element
: a distinct segment of the storyline in the game. In combat, the interval between story elements can be a practical place for a die roll.
;Combat Round
: an indeterminate length of time set by the GM — around three seconds seems reasonable to some people, while that seems grossly short or absurdly long to others. A given GM’s combat round may vary in length, depending on the situation. Generally, when each character involved has made an action, a given round is over.
;Offensive damage factors
: those which contribute to damaging an opponent: Strength (if using a Strength-driven weapon), Scale, and deadliness of weapon.
;Defensive damage factors
: those which contribute to reducing the severity of a received blow: Scale, armor, and possibly Damage Capacity.
;Total damage factor (or simply damage factor)
: the attacker’s offensive damage factor minus the defender’s defensive damage factor.
</pre>
</div>
<div title="4.2 Melee Combat" creator="JonasSusara" modifier="JonasSusara" created="201010230802" modified="201010230854" changecount="2">
<pre>Fudge gives three options available for handling the pacing of melee combat: moving from story element to story element, using simultaneous combat rounds, or alternating combat turns. An individual GM may devise others.

[[4.21 Story Elements]]
[[4.22 Simultaneous Combat Rounds]]
[[4.23 Alternating Combat Turns]]</pre>
</div>
<div title="4.21 Story Elements" creator="JonasSusara" modifier="JonasSusara" created="201010230850" modified="201010230852" changecount="3">
<pre>In the simplest combat system, the GM explains the situation in as much detail as is apparent, then asks the players to describe what their characters are doing. The more complete the description of their characters’ actions, the better the GM knows how to assess the situation. This can be important if she has something that won’t be revealed until the middle of a battle. Die rolls, if any, are required by the GM for each story element.

A story element is the smallest unit of time in this type of combat resolution. The GM may break the battle down into several story elements, or treat the whole encounter as one element. This depends on the GM’s style, the importance of the battle, the number of participants, whether or not there are unexpected surprises, etc. Each element should be a dramatic unit.

For example, the ~PCs are faced with a detachment of guards at the door while the evil mastermind is trying to activate the Doomsday machine at the back of the room. The fight with the guards might be one element while the confrontation with Dr. Doomsday could be a second. Another GM might treat the whole battle as one story element, while a third GM would treat each 5-second segment separately. 
Whatever the number of elements, keep the battle description as word-oriented as possible.

The GM may ask for a single die roll from a player occasionally, or require three rolls and take the median roll.

(The median is the middle value die roll, which may be the same as either the high or low die roll. For example, if the player rolls a Good, a Mediocre, and a Superb result, the median is Good, since it’s the result in between Mediocre and Superb. But a result of Poor, Great, and Great gives a median die roll of Great. Using a median tends to soften the role of extreme luck. Some ~GMs use a median when a single die result represents many actions.)

Once the GM has decided which trait (or traits) each PC should use for this combat, she then gives them a modifier, ranging from –3 to +3. Zero should be the most common modifier. The modifier is based partly on how well the ~PCs’ plan would work, given what the GM knows of the ~NPCs, and partly on circumstances: fatigue, lighting, footing, surprise, weapon superiority, bravery or cowardice of ~NPCs, wounds, etc.

Here is a long example of story element style of combat:

Gunner, separated from the other ~PCs, surprises five members of a rival gang in a garage. The player announces that Gunner will shout and charge the rival mob, carrying his Tommy gun as if he’s about to fire — they don’t know it’s irreparably jammed. He hopes to see them run away, hit the dirt, or freeze in fear. He’ll then use his Tommy gun as a club, starting at the left end of their line. He’ll keep his current opponent in between him and the others as long as possible. He hopes to then roll up their line, one at a time, keeping the wall to his left side as he charges.

The GM makes a Situational roll for the mob: Mediocre. The mob members don’t recover quickly from their surprise, so she gives Gunner a +1 to his Brawling skill of Good for this plan. She also decides that one mobster will run away and the others won’t draw their guns until Gunner has already engaged the first enemy. His Running skill is Great, so she gives him another +1, since he can cover ground quickly. Total modifier for Gunner is +2, bringing his Brawling skill to Superb for this combat. Since this is a fairly long action and she doesn’t want a single unlucky roll to ruin Gunner’s chances, she asks him for three Brawling skill rolls (at the +2 modifier), and to use the median roll.

Gunner rolls a Good, Superb, and Great result, in that order. The median roll is Great, and the GM decides this is good enough to have downed the first two mobsters, and describes the battle so far in entertaining detail. Now Gunner is facing the last two thugs, who finally have their pistols out and could probably plug him before he charges that far. The GM asks, “What does Gunner do now?”

Gunner hurls the Tommy gun into the face of one gunman while making a low diving tackle for the other, hoping to dodge under any bullets. The GM calls for a single roll against Brawling to cover this whole action: Gunner gets a Fair result. The GM rules that Gunner throws the Tommy gun well enough to distract one gunman, but not harm him. He does, however, manage to tackle and subdue his other foe, whose shots all go wild.

At this point, the GM rules that the mobster grazed by the thrown Tommy gun now steps over and points his pistol to Gunner’s head while he’s kneeling over the other mobster. Gunner wisely heeds the call to surrender and hopes his friends can rescue him….
</pre>
</div>
<div title="4.22 Simultaneous Combat Rounds" creator="JonasSusara" modifier="JonasSusara" created="201010230854" changecount="1">
<pre>Those who like their combat broken down into discrete bits can use combat “rounds.” In simultaneous action rounds, all offensive and defensive maneuvers happen at the same time. This is realistic: few real combats consist of fighters taking turns whacking at each other.
The GM determines which traits the combatants should roll against. This depends largely on which weapon they are using, which might simply be a fist. Weapon type also affects damage — see Section 4.5, Wounds.

Each combatant makes an Opposed action roll. On a relative degree of zero, the combat round is a stand-off — the fighters either circled each other looking for an opening, or exchanged blows on each other’s shields, etc. — nobody is hurt.

A minimum result of Poor is needed to hit a (roughly) equal-sized opponent. That is, a human needs to score a Poor blow (and still win the Opposed action) in order to hit another human. If both opponents roll worse than Poor, the round is a standoff.

If one opponent is significantly bigger than the other (of a different Scale, at least), he needs a Mediocre or even Fair result to hit his smaller foe, while even a Terrible result will allow the small fighter to hit the larger. (Of course, such a blow must still win the Opposed action.) 

Extremely small targets, such as a pixie, may require a Good or even a Great result. Examples include humans fighting giants, or very large or small animals.

If the result is a relative degree other than zero, and the minimum level needed to score a hit is achieved or surpassed, the winner checks to see if he hit hard enough to damage the loser. In general, the better the hit (the greater the relative degree), the greater the likelihood of damage.

If one combatant is unable to fight in a given round (possibly because he’s unaware of the attacker, or because of a critical result in the previous round — see Section 3.6, Critical Results), the combat may become an Unopposed Action for the active fighter, usually with a Poor Difficulty Level. If a character can defend himself in some way, such as using a shield, it is still an Opposed Action, but the defending character cannot hurt the other character even if he wins the combat round.

Combat often takes more than one combat round. Characters are not limited to attacking each round — they may attempt to flee, negotiate, try a fancy acrobatic stunt, or any other appropriate action.</pre>
</div>
<div title="4.23 Alternating Combat Turns" creator="JonasSusara" modifier="JonasSusara" created="201010230855" changecount="1">
<pre>Using alternating combat turns, each combat round consists of two actions: the fighter with the higher initiative attacks while the other defends, then the second combatant attacks while the first defends. With multiple characters involved in combat, the side with the initiative makes all their attacks, then the other side makes all their attacks. Or the GM may run the combat in initiative order, even if fighters from both sides are interspersed throughout the combat turn.

Gaining initiative is an Opposed action. If the characters don’t have an Initiative attribute or skill — such as Reflexes or Speed — simply use Opposed Situational rolls. A gift such as Combat Reflexes can grant a +1 to initiative. Surprise may grant a bonus to the roll, or give automatic initiative. Initiative can be rolled once for each battle or once each round. Perhaps a character could trade skill for initiative: attack hastily (+1 to initiative that round) but be slightly off balance because of it (–1 to attack and defend that round).

Each attack is an Opposed Action: the attacker’s Offensive skill (Sword, Melee Weapon, Martial Art, etc.) against a defender’s Defensive skill (Shield, Parry, Dodge, Duck, etc.). This type of combat take longer than simultaneous rounds, but some players feel it gives a character more control over his own fate.

Using these rules, a Defensive parry skill may simply equal the weapon skill, or it may be a separate skill that must be bought independently of an Offensive skill. The GM must tell the players at character creation which method she is using — or allow them extra levels on the fly to adjust their defensive abilities.

Some weapons, such as an Axe, are poor parrying weapons. Players should ask the GM at character creation if a weapon may be used to parry and still be used to attack without penalty in the next turn — and give their characters decent Shield or Dodge skills to compensate for poor parrying weapons.

All-out offensive and defensive tactics can be used. A character forfeits his attack for a round if he chooses All-out defense, and is at –2 on his defense on his opponent’s next turn if choosing All-out offense — or perhaps gets no defense at all!

The default defense for animals depends on their type: carnivores will usually have a Defense value one level less than their Offense, while this is reversed for most prey species.
</pre>
</div>
<div title="4.3 Melee Combat Options" creator="JonasSusara" modifier="JonasSusara" created="201010230803" modified="201010230906" changecount="4">
<pre>The various options listed below may be used with any melee system. This is not a comprehensive or “official” list of options. The GM should, in fact, consider these options merely as examples to stimulate her imagination. The GM may wish to import complex combat options from other games into Fudge.

[[4.31 Melee Modifiers]]
[[4.32 Offensive/Defensive Tactics]]
[[4.33 PCs vs. NPCs]]
[[4.34 Multiple Combatants in Melee]]
[[4.35 Hit Location]]
[[4.36 Fancy Stuff]]</pre>
</div>
<div title="4.31 Melee Modifiers" creator="JonasSusara" modifier="JonasSusara" created="201010230857" changecount="1">
<pre>Some situations call for one side or the other’s trait level to be modified. Here are some examples:
A fighter who is Hurt is at –1, while one who is Very Hurt is at –2.
If one fighter has a positional advantage over the other, there may be a penalty (–1 or –2) to the fighter in the worse position. Examples include bad footing, lower elevation, light in his eyes, kneeling, etc.

Subtract the value of a shield from the opponent’s weapon skill. A small shield has a value of +1 in melee combat only, while a medium shield has a value of +1 in melee combat and +1 to defense against ranged attacks (if the shield material is impervious to the weapon). A large shield (+2 in all combat) is cumbersome to lug around. The larger the shield carried, the more the GM should assess penalties for things such as acrobatic and other fancy maneuvers. Shields can also be used offensively to push an opponent back, for example, or knock someone over.

Compare combatants’ weapon sizes and shields (see Section 4.54, Sample Wound Factors List). If one fighter’s weapon + shield value is +2 (or more) greater than the other fighter’s weapon + shield value, the fighter with the smaller weapon is at –1 to his combat skill. 

(Example: one fighter has a Two-handed sword: +4 to damage. His opponent has a knife and an average shield: +1 to damage, +1 for shield makes a total of +2. The knife wielder is at –1 to skill in this combat since his weapon modifier is –2 less than the sword fighter’s.)

Aiming at a specific small body part (such as an eye or hand) will require a minimum result of Good or Great to hit and also have a –1 to the trait level. If a result of Great is needed and the fighter only gets a Good result but still wins the Opposed action, he hits the other fighter — but not in the part aimed for.

A fighter may have a magical blessing (+1 or more) or curse (–1 or worse).

All-out offense, such as a berserk attack, grants a +1 to the combat skill (and an additional +1 for damage, if successful). However, if an all-out attacker ties or loses the Opposed action, the other fighter wins, and gets +2 to damage!

An All-out defensive stance earns a +2 to the combat skill, but such a combatant cannot harm his foe except with a critical result.

A successful All-out Defense and a successful Perception or Tactics roll produces a –1 penalty to the opponent on the next round. The fighter takes a few seconds to scope out the area and maneuvers to take advantage of any terrain or conditional irregularity. Similar combat subtleties are possible, and encouraged — taking a successful All-out defense one round can allow a player to try an acrobatics maneuver the next combat round without risk of being hit, for example.</pre>
</div>
<div title="4.32 Offensive/Defensive Tactics" creator="JonasSusara" modifier="JonasSusara" created="201010230858" modified="201010230900" changecount="4">
<pre>This optional rule, used with simultaneous combat rounds, allows more tactical flavor to combat at a small expense of complexity. This option replaces the All-out attack and defense options listed above, and allows for both combatants to be injured in the same combat round.
Before each round, a fighter may choose to be in a normal posture, an offensive posture or defensive posture. An offensive or defensive stance increases combat skill in one aspect of combat (offense or defense), and decreases the same skill by an equal amount for the other aspect of combat.
There are five basic options:
{{{
+2 to Offense, –2 to Defense
+1 to Offense, –1 to Defense
Normal Offense and Defense
–1 to Offense, +1 to Defense
–2 to Offense, +2 to Defense
}}}

Each combat round, a player secretly chooses a combat stance by selecting two Fudge dice and setting them to a result from +2 to –2, which represents an offensive modifier. (The defensive modifier shown above with the offensive modifier is automatically included.) Both sides simultaneously reveal their choices.
For those without Fudge dice, choose one die placed as follows:
{{{
	Die face:	Option:
	1		–2 to offense
	2		–1 to offense
	3,4		Normal offense
	5		+1 to offense
	6		+2 to offense
}}}

Each fighter then makes a single Opposed action roll as normal. The result is applied to both offense and defense, however, and will thus have different results for offense and defense if anything other than a normal posture is chosen. The offensive rolled result of each fighter is then compared to the defense of the other fighter.

For example, a fighter with Good sword skill chooses +1 to offense and –1 to defense for a particular combat round: his offensive sword skill is Great this round, while his defensive sword skill is Fair. His opponent, a Great swordswoman, chooses normal posture. The swordswoman rolls a –1: a Good result for both her offense and defense. The first fighter rolls a 0 result: his offensive rolled result is Great, his defense is Fair.

His offense result of Great is compared with her Good defense: he wins by +1. However, her offense result of Good is simultaneously compared with his defense of Fair: she also wins the Opposed action by +1. Both sides check for damage, to see if they got through each other’s armor — see Section 4.5, Wounds.

</pre>
</div>
<div title="4.33 PCs vs. NPCs" creator="JonasSusara" modifier="JonasSusara" created="201010230901" modified="201010230901" changecount="2">
<pre>If a PC is fighting an NPC the GM can treat combat as an Unopposed action by assuming the NPC will always get a result equal to her trait level. In this case, the PC will have to tie the NPC’s trait level to have a stand-off round, and beat the NPC’s trait in order to inflict damage. This option stresses the player characters’ abilities by disallowing fluke rolls by ~NPCs.
</pre>
</div>
<div title="4.34 Multiple Combatants in Melee" creator="JonasSusara" modifier="JonasSusara" created="201010230903" modified="201010230904" changecount="3">
<pre>When more than one opponent attacks a single fighter, they have, at least, a positional advantage. To reflect this, the lone fighter is at –1 to his skill for each additional foe beyond the first. (For epic-style games, with a few heroes battling hordes of enemies, this penalty can be reduced, or the GM can simply give the hordes Poor skills and low Damage Capacity — which is not out of character for a horde.)

The lone fighter rolls once, and the result is compared with each of the opponents’ rolled degrees, one after the other. The solo combatant has to defeat or tie all of the opponents in order to inflict a wound on one of them. If he beats all of his foes, he may hit the foe of his choice. If he ties his best opponent, he can only wound another whose result is at least two levels below his.

Example: Paco is facing three thugs, who have just rolled a Great, Good, and Mediocre result, respectively. Paco rolls a Great result, tying the best thug. He hits the thug who scored a Mediocre result (at least two levels below his result) and is not hit himself (he tied the best thug).

The lone fighter takes multiple wounds in a single round if two or more enemies hit him. Usually, he can inflict damage on only one foe in any given round — his choice of those he bested. It’s also possible to allow a sweeping blow to damage more than one foe at a time. Of course, this slows a slash down: reduce damage done by 1 or 2 for each foe cut through.

A well-armored fighter facing weak opponents can simply concentrate on one foe and let the others try to get through his armor (that is, not defend himself at all against some of his attackers). In this case, the lone fighter can damage his chosen foe even if he is hit by other, ignored foes. This is historically accurate for knights wading through peasant levies, for example. There may or may not be a penalty for the lone fighter in this case.

There’s a limit to the number of foes that can simultaneously attack a single opponent. Six is about the maximum under ideal conditions (such as wolves, or spear-wielders), while only three or four can attack if using weapons or martial arts that require a lot of maneuvering space. If the lone fighter is in a doorway, only one or two fighters can reach him.

When multiple ~NPCs beset a lone PC, the GM may wish to use the option in Section 4.33, ~PCs vs. ~NPCs. This will save a lot of die rolling.
Alternately, she may wish to roll only once for all the ~NPCs. The lone fighter is still at –1 per extra opponent. The GM rolls 2dF, and applies the result to each NPC. For example, if the GM gets a +1 result, each attacker scores a +1.

For those without Fudge dice, the GM could simply use the 1d6 method discussed in Section 3.5, Opposed Actions.

Example: Three ~NPC pirates, complete with eye-patches, scars, earrings, sneers and generally bad attitudes, are attacking dashing PC hero Tucker. The pirates (whose names are Molly, Annie, and Maggie) are Fair, Good, and Mediocre, respectively, at combat skills. Tucker is a Superb swordsman, but is at –2 for having two extra fighters attacking him at once: his skill is Good for this combat. The GM wants to roll just once (applying the result to all three pirates) rather than rolling three times each combat round.

Rolling 2dF, she gets a +1 on the first round. The pirates have just gotten Good, Great, and Fair results, respectively. If Tucker scores a Superb result, he could hit the pirate of his choice and remain unhit. On a Great result, Tucker would be unhit, and could land a blow on Maggie. On a Good result, he doesn’t hit anyone, but Annie hits him. If Tucker rolls a Fair result, both Molly and Annie would hit him. The process is repeated each round.

</pre>
</div>
<div title="4.35 Hit Location" creator="JonasSusara" modifier="JonasSusara" created="201010230905" changecount="1">
<pre>A light blow to an eye is very different from a light blow to an armored shoulder, or to a shield. Using a hit location system adds flavor to combat and the description of a character’s equipment, wounds — and scars! Many games have a hit location system, and a GM can easily translate one she is familiar with to Fudge. Or she can use the simple system given here.

The simplest system is not to worry about “called shots.” Merely say the better the relative degree, the better the location of the blow. Winning a battle by +8 will allow the attacker to pierce an eye, if desired. Hopefully, the players will describe their actions in such detail that the GM will know how close they came to their objective merely by looking at the relative degree.

A more complicated system: an attacker can announce that he is aiming at a specific body location — this must be done before rolling to hit. The GM decides the minimum relative degree necessary for such a shot to succeed, usually ranging from 2 to 4, though extreme locations (such as an eyeball) are harder to hit. So if a player wishes his character to hit his opponent’s weapon arm, the GM can respond, “You have to win by 2 to do so.” If the player then does win by relative degree 2 or more, the weapon arm is hit, and the wound is specific to that arm.

If the attacker wins the combat round, but not by the minimum relative degree needed to hit the called target, the defender names which part of the body — or shield! — is hit. This will most likely be general body (if there is no shield), but it could be the off-hand, which would carry a lesser combat penalty than a wound to the torso. The GM may have to fudge some here.

A damaged specific body part can be described as being Scratched (no real game effect), Hurt (a penalty to use, but the body part still functions), and Incapacitated. After battle is the time to decide if an Incapacitated body part can be healed, or is permanently Incapacitated.
A Hurt body part is generally at –1 to its normal use. A Hurt sword arm gives a –1 penalty to combat, for example, while a Hurt leg is –1 to any running, acrobatics, etc. A Hurt eye is –1 to vision, and so on.

To determine the exact level of the damage, the GM should consider how well the hit scored, as well as the Strength of the attacker and the weapon being used. Winning by the minimum relative degree necessary to hit the specific body part shouldn’t make the victim Incapacitated unless the attacker is of a much larger Scale than the defender. On the other hand, an arm hit with a battle axe wielded by a large, berserk Viking has a good chance of being cut off even if the Viking just rolled exactly what he needed to hit the arm….

As a guideline, if the attacker surpasses the relative degree necessary to hit the body part at all, the part is Scratched or Hurt, depending on Strength and weapon deadliness. If he surpasses it significantly, the part is Hurt or Incapacitated.

Species other than humans may have a different list of body parts to hit, and/or different difficulty modifiers.</pre>
</div>
<div title="4.36 Fancy Stuff" creator="JonasSusara" modifier="JonasSusara" created="201010230907" changecount="1">
<pre>A lot of fancy maneuvers are possible in Fudge combat. All require a bit of thought on the GM’s part.

What if you want a Speed or Reflexes trait to affect how often you can strike in combat? How would you handle someone of Good Speed vs. someone of Fair Speed?

If someone has a Power that speeds him up beyond the human norm, you can simply have him attack every other round as if his opponent wasn’t aware of the attack. That is, every other round, an Unopposed result of Poor or better hits the foe, with no chance to be hit back in return.

For more subtle differences, the GM may allow an Opposed action to determine if one fighter gets to land a blow first: after declaring their actions, each fighter makes a roll against a Speed trait. The winner of the Opposed action, if any, adds the difference to his weapon skill.

How about Fudge’s “graininess” getting in the way of interesting combat? That is, since there are only seven levels in Fudge, a Good fighter will often meet another Good fighter, and it doesn’t seem right that you can’t meet someone who’s just a little better or worse than you.

In this case, the GM can create new levels of combat skills (there’s no point in using this option with other skills). These new levels require full experience points to reach, but function only as “half” levels, called “plus” levels. Thus, you can have:
Superb +
Superb
Great +
Great
Good +
Good

And so on. In any combat, someone with a “+” has the skill level listed before the “+”, but gets a +1 every other round, starting with the second round. So in a combat between Gus (skill Great) and Ivan (skill Good +), Gus would have the higher skill on on rounds one, three, five, etc. But on rounds two, four, six, etc., Ivan will roll as if he had a Great skill, thus being Gus’s equal those rounds.

What about swinging on chandeliers and other swashbuckling moves? Since role-playing games have more to do with movies than real life, this should be encouraged if the genre is at all cinematic.

In these cases, have the player describe his swashbuckling intentions as fully and dramatically as he can. The better the story, the better the bonus to the die roll — or no roll needed if the outcome is entertaining enough. You may then request a roll against Dexterity, or Acrobatics (or even Chutzpah!) and let that determine how well he accomplished his aim. Maybe the swing on the chandelier came off great, but the landing on the banister was a little rough, so the slide down to slam the villain in the back was a tad off, and instead of knocking him out, you merely made him drop his weapon, but then fell on the floor yourself, and now he’s mad, and maybe you should get up before he picks up his pistol, or you could try to yank the carpet while you’re down there, right next to it, and he seems to standing on it a bit off-balance… Whatever is fun!
</pre>
</div>
<div title="4.4 Ranged Combat" creator="JonasSusara" modifier="JonasSusara" created="201010230804" modified="201010230909" changecount="2">
<pre>Ranged combat may or may not be an Opposed action.

If the target is unaware of the assault, the attacker makes an Unopposed action roll to see if he hits his target. The GM sets the Difficulty Level based on distance, lighting, cover, etc. Do not modify the attacker’s skill for range, partial cover, or other circumstances — that’s included in the Difficulty Level. Equipment such as a laser sighting scope can modify the attacker’s skill, though.

If the defender is aware of the attack it is an Opposed action: the attacker’s ranged weapon skill against the defender’s defensive trait. (A Difficulty Level for range, lighting, etc., is still set by the GM, and is the minimum rolled degree needed to hit.) A defensive roll should be made against a Dodge skill, or Agility attribute, or something similar.

If the ranged weapon is thrown, there is no modifier to the defense roll. However, a propelled weapon, such as a bow, gun, or beam weapon, is much harder to avoid. In this case, reduce the defender’s trait by –2 or –3. Obviously, the defender isn’t trying to dodge a bullet, but dodging the presumed path of a bullet when an attacker points a gun at him.

Of course, the defender may decline to dodge, but shoot back instead. In this case, the action is Unopposed — making the Difficulty Level is all that is needed to hit. The GM may make such actions simultaneous.

Example: Nevada Slim and the El Paso Hombre are facing off in a showdown. Both are in the open, in the sunlight, so there’s no lighting or cover difficulty. The range is obviously the same for both — the GM rules it’s a Fair task to hit each other. Slim rolls a Poor result, and the Hombre a Mediocre result. The Hombre’s bullet came closer to Nevada Slim than vice versa, but both missed since neither made the Difficulty Level.

Another Example: Will Scarlet is shooting a longbow from the greenwood at Dicken, the Sheriff’s man, who has a crossbow. Dicken knows Will is there, because the man next to him just keeled over with an arrow through his chest. Dicken is in the open, in good light, so only range is of any concern to Will Scarlet: the GM says even a Mediocre shot will hit since they are fairly close. The range for Dicken to hit Will is of course the same, but Will is partially hidden behind a log (cover), and just inside the foliage, so the lighting makes it hard to see him clearly. The GM decrees Dicken needs a Good roll to hit Will. Dicken rolls a Fair result, missing Will. Will rolls a Mediocre result, which hits Dicken, even though it wasn’t as good a shot as Dicken’s.

In both examples, the fighters forfeited their Dodges in order to shoot simultaneously. Each combatant needed to make the appropriate Difficulty Level to hit. Under these conditions, it’s possible for both combatants to succeed in the same combat round. Had Dicken’s shot hit, Will and Dicken would have skewered each other.

Guns and similar weapons that do not rely on muscle power should be rated for damage at the beginning of the game. No detailed list is provided, but as a rough guideline: The average small hand gun might be of +2 to +3 Strength, while a derringer might be +1 or even +0. Powerful two-handed projectile weapons are at +5 and higher, while bazookas and other anti-tank weapons are at +10 and higher. Science fiction small weapons may do as much damage as a modern bazooka — but some are designed to capture people without injuring them.

Automatic weapons can be simulated roughly by allowing more bullets to hit with higher relative degrees. That is, blasting away with a 
weapon that fires 20 bullets in a combat round and hitting with relative degree +1 — a graze — means only one or two hit the target. If a relative degree +8 represents maximum amount of ammunition on target (whatever that may be for a given weapon), then hitting with a +4 means about half maximum hit the target, while +2 means only one quarter.

If there is no effective armor, simply add a big damage number if lots of bullets hit: this is going to Incapacitate anyone, at the very least. If armor is at all likely to slow down a bullet, you can’t just add a bigger and bigger damage number if more bullets hit: the armor has a chance to slow down each bullet. In this case, rather than roll damage for each bullet, or have them all stopped, the GM needs to fudge some medium result: give a slight damage bonus if more projectiles hit the target.</pre>
</div>
<div title="4.5 Wounds" creator="JonasSusara" modifier="JonasSusara" created="201010230804" modified="201010230955" changecount="7">
<pre>Fudge offers various methods of tracking wounds, with many options. It is impossible to be 100% accurate when simulating damage to such an intricate mechanism as a living being. This is true even for detailed simulations — for an abstract role-playing game, it is hard to get close to reality at all.

Consequently, many ~GMs don’t try to be very accurate, and want a simple system that works and lets the story flow. Others want as much accuracy as they can get. Fudge presents a simple freeform system that works, and suggests some options to make it more mechanical, and encourages each GM to add as much detail as she is happy with.

[[4.51 Wound Levels]]
[[4.52 Damage Capacity]]
[[4.53 Wound Factors]]
[[4.54 Sample Wound Factors List]]
[[4.55 Determining Wound Level]]
[[4.56 Grazing]]
[[4.57 Recording Wounds]]
[[4.58 Non-human Scale in Combat]]</pre>
</div>
<div title="4.51 Wound Levels" creator="JonasSusara" modifier="JonasSusara" created="201010230915" changecount="1">
<pre>Combat damage to a character can be described as being at one of seven stages of severity. The stages are:
;Undamaged
: no wounds at all. The character is not necessarily healthy — he may be sick, for example. But he doesn’t have a combat wound that’s recent enough to be bothering him.
;Just A Scratch
: no real game effect, except to create tension. This may eventually lead to being Hurt if the character is hit again. This term comes from the famous movie line, “I’m okay, it’s only a scratch.” The actual wound itself may be a graze, bruise, cut, abrasion, etc., and the GM whose game is more serious in tone may choose to use one of these terms instead.
;Hurt
: the character is wounded significantly, enough to slow him down: –1 to all traits which would logically be affected. A Hurt result in combat can also be called a Light Wound.
;Very Hurt
: the character is seriously hurt, possibly stumbling: –2 to all traits which would logically be affected. A Very Hurt result can also be called a Severe Wound.
;Incapacitated
: the character is so badly wounded as to be incapable of any actions, except possibly dragging himself a few feet every now and then or gasping out an important message. A lenient GM can allow an Incapacitated character to perform such elaborate actions as opening a door or grabbing a gem….
;Near Death
: the character is not only unconscious, he’ll die in less than an hour — maybe a lot less — without medical help. No one recovers from Near Death on their own unless very lucky.
;Dead
: he has no more use for his possessions, unless he belongs to a culture that believes he’ll need them in the afterlife….

The GM may expand or contract these stages. For example, expand Hurt and Very Hurt to Light Wound, Moderate Wound and Severe Wound. In this case, a Severe Wound might be –3 to all actions — or the GM might leave it at –2, make Moderate Wound = –1, and make Light Wound something in between a Scratch and Moderate Wound. That is, maybe a Light Wound causes no penalty during combat (you don’t notice such a slight wound in the heat of battle), but after combat the character will be at –1 to all skills until it’s healed (such wounds can be annoying later).

The GM may allow a high Difficulty Level Willpower roll to reduce or even nullify penalties listed at Hurt, Very Hurt, and possibly Incapacitated. A gift of a High Pain Threshold will reduce the penalties by one level, while a fault of a Low Pain Threshold will increase penalties by one.

Some players delight in describing their characters’ wounds in detail, even writing resulting scars into the character story.
Automatic Death: sometimes you don’t have to roll the dice. Holding a knife to a helpless character’s throat is a good example — no roll needed to kill such a character, but the killer’s karma suffers.</pre>
</div>
<div title="4.52 Damage Capacity" creator="JonasSusara" modifier="JonasSusara" created="201010230920" modified="201010230923" changecount="4">
<pre>In Fudge, Damage Capacity determines how wounds affect a character. Damage Capacity may be called Hit Points, if desired. It may be tied to a character trait such as Constitution (or Hardiness, Fitness, Health, Body, Strength, etc.), or it may be a separate trait — see Section 6.3, Character Examples. It can also be treated as a gift/fault.

The GM decides how to handle the differing abilities of humans to take damage. It really does vary, but how much is open to debate.

As an extreme example, take the death of the Russian monk Rasputin, the adviser to Czarina Alexandra, in 1916. He was fed enough cyanide to kill three normal people, but showed no signs of it. He was then shot in the chest and pronounced dead by a physician. A minute later he opened his eyes and attacked his assassins! They shot him twice more, including in the head, and beat him severely with a knuckle-duster. He was again pronounced dead, tied in curtains and ropes, and tossed into a river. When his body was retrieved three days later, it was found he had freed an arm from his bindings before finally dying of drowning! Clearly, the man could soak up damage well beyond most peoples’ abilities. He is not unique, however: there are many cases in history of people being hard to kill.

On the other hand, the phrase “glass jaw” is familiar to most English speakers, referring to those who are hurt from the slightest blow.
So there is undoubtedly some room for variation in damage capacity in characters.

If the GM is handling wounds in a freeform matter, make Damage Capacity an attribute and let players rate their characters in it like any other attribute. Or have a gift (Damage Resistant, perhaps) and a fault (Fragile, maybe), and let everyone without either the gift or the fault be normal in this regard. The GM can assess the character’s ability to take damage based on that information and the situation at hand.

If the GM wants a more numerical approach to wound determination, it requires some forethought. If Damage Capacity is an attribute, the easiest way to rate it numerically in Fudge is the standard:
+3 for Superb Damage Capacity
+2 for Great Damage Capacity
+1 for Good Damage Capacity
+0 for Fair Damage Capacity
–1 for Mediocre Damage Capacity
–2 for Poor Damage Capacity
–3 for Terrible Damage Capacity

However, since light metal armor, as listed in Section 4.54, Sample Wound Factors List, only grants a +2 to defense against being wounded, it is easily seen that a Great Damage Capacity is equal to light metal armor. Some ~GMs will find this absurd: a naked person of Great Damage Capacity can turn a sword as well as an armored person of Fair Damage Capacity. Others will remember Rasputin, and consider it within the bounds of reason — it could be part body size (vital organs harder to reach) and part healthiness (muscle tissue more resistant to being cut).

For simplicity, any equation-driven approach to wounds in Fudge assumes the GM will use a Damage Capacity attribute, and it is rated from +3 to –3, as listed above. If you are not happy with this, please make the necessary mental substitution.

Here are some other possible ways to handle Damage Capacity numerically:
1. Make Damage Capacity an attribute, as above, but instead of automatically granting a bonus, require a Damage Capacity die roll every time a character is hit for at least a Light Wound (Hurt result). On a result of:
Great or better: reduce the severity of the wound by one.
Mediocre to Good: no adjustment to the severity of the wound.
Poor or worse: increase the severity of the wound by one.

This adjustment can either be one wound level, or simply one damage point, as the GM sees fit.

For certain types of damage — perhaps from a stun ray or a quarterstaff across the ribs — the GM can use the values from +3 to –3 without requiring a roll.

2. Do not use a Damage Capacity attribute; instead allow the players to take a gift of Damage Resistant (reduces wound severity by one) or a fault of Fragile (increases wound severity by one). Again, this adjustment can be one wound level, or one damage point.

3. Use a Damage Capacity attribute, as outlined as the first suggestion under Section 4.57, Recording Wounds. Each hit temporarily reduces your Damage Capacity attribute one or more levels.

4. Use a Willpower attribute instead of Damage Capacity. ~GMs who believe that Rasputin was able to overcome so much damage because his will was focused on overcoming his enemies may use this method. Grant an adjustment to the wound level based on the result of a Willpower die roll. This can be temporary — until the battle is over — or actually have a permanent affect on reducing wound severity.</pre>
</div>
<div title="4.53 Wound Factors" creator="JonasSusara" modifier="JonasSusara" created="201010230924" modified="201010230924" changecount="2">
<pre>When determining how wounded a character is when hit in combat, take into consideration all of the following factors:
# The relative degree the attack succeeded by — the better the hit, the greater likelihood of damage. Winning a combat round with a relative degree of +1 means you probably hit where the opponent is most heavily armored. Scoring a hit with a +3 finds a chink in the armor.
# The strength of the blow. For muscle-powered weapons, such as melee weapons, unarmed attacks, bows, slings, etc., this is determined by the attacker’s Strength attribute: stronger folks tend to hit harder. The relative Scale modifier is also figured in here. For things like guns, beam weapons, etc., it is relative to the nature of the weapon: a .38 usually does more damage than a .22. The technological level of the weapon can be important.
# The deadliness of the attacker’s weapon. Big weapons tend to do more damage than little weapons; sharp weapons rip tissue more than dull ones, but blunt weapons can cause concussive damage through armor thick enough to stop a sharp weapon. People trained in Karate tend to do more damage than those untrained in any martial art.
# The defender’s armor. People wearing thicker armor, and more of it, tend to get hurt less than those wearing no armor. Armor can be finely differentiated, or simply said to be Light, Medium, or Heavy armor. Science fiction scenarios will have ~Extra-Heavy armor, and even further levels. Fantasy campaigns may include magic armor that offers even greater protection, sometimes specific against certain types of damage.
# The amount of damage the victim can soak up (Robustness, Damage Capacity, or Mass). Big, healthy guys can take more damage before collapsing than little, sickly guys. But it’s your call if it’s a big, sickly fighter against a little, healthy fellow.
</pre>
</div>
<div title="4.54 Sample Wound Factors List" creator="JonasSusara" modifier="JonasSusara" created="201010230937" modified="201010230937" changecount="2">
<pre>For those who prefer numerical values, here are some suggested numbers to attach to the factors listed in the previous section. These may be customized to taste, of course, and are only offered as a starting point. If used, they should be written down on the character sheet at character creation (probably with the weapons and armor), so as to be readily available during combat.

Offensive factors:
For Character’s Strength (muscle-powered weapons only):
+3 for Superb Strength
+2 for Great Strength
+1 for Good Strength
+0 for Fair Strength
–1 for Mediocre Strength
–2 for Poor Strength
–3 for Terrible Strength

For Attacker’s Scale:
Plus the attacker’s Strength Scale(see Section 4.68, Non-human Scale in Combat).
Note: the attacker’s Strength Scale is relevant only for muscle-powered weapons and for those projectile weapons scaled to the attacker’s size, such as miniature bazookas or giant-sized handguns. A superhero of Scale 10 using an ordinary pistol would not figure his Scale into the Offensive Damage Modifier.

For Weapon’s Strength(Guns, Crossbows, Beam weapons, etc.):
+/– Strength of weapon(see Section 4.4, Ranged Combat).

For ~Muscle-Powered Weapon:
–1 for no weapon, not using a Martial Art skill.
+0 Martial Art skill, or for small weapons(blackjack, knife, brass knuckles,sling, thick boots if kicking, etc.).
+1 for medium-weight one-handed weapons(billy club, machete, shortsword,epee, hatchet, rock, etc.).
+2 for large one-handed weapons(broadsword, axe, large club, etc.),or for light two-handed weapons(spear, bow, etc.).
+3 for most two-handed weapons(polearm, two-handed sword, battleaxe, etc.).
+1 for sharpness(add to other weapon damageknife becomes +1, shortsword +2,broadsword +3, greatsword +4, etc.).
Note: For a less lethal game, subtract 1 from each type of weapon except sharpness. (This will lengthen combats.)
Note: the value of a shield may be subtracted from the opponent’s skill — see Section 4.31, Melee Modifiers.
Optional note, as an example of the detail you can achieve in Fudge: for heavy blunt metal weapons, such as maces and flails, halve any protection from the defender’s armor, round down. The concussive damage from such weapons is slowed, but not totally stopped, by most armor. Example: if using a large mace (+2 weapon) against plate armor (+4 armor), the armor only counts as +2 armor.

Defensive factors:
For Character’s Damage Capacity Attribute:
Note: this is optional — see Section 4.52, Damage Capacity, for a complete discussion.
+3 for Superb Damage Capacity
+2 for Great Damage Capacity
+1 for Good Damage Capacity
+0 for Fair Damage Capacity
–1 for Mediocre Damage Capacity
–2 for Poor Damage Capacity
–3 for Terrible Damage Capacity

For Armor:
+1 for light, pliable non-metal armor.
+2 for heavy, rigid non-metal armor
+2 for light metal armor.
+3 for medium metal armor.
+4 for heavy metal armor.
+5 or more for science fiction advanced armor.
Note: magical armor may add anywhere from +1 to whatever the GM will allow to any given armor type above.

For Defender’s Mass Scale:
Plus the defender’s Mass Scale(see Section 4.58, Non-human Scale in Combat).
(If the defender has Mass other than Fair, or a gift of Tough Hide, it should also be figured in.)</pre>
</div>
<div title="4.55 Determining Wound Level" creator="JonasSusara" modifier="JonasSusara" created="201010230939" modified="201010230941" changecount="3">
<pre>A given blow will cause a certain level of wounding. In the simplest wound determination system, the GM assesses all of the Wound Factors (Section 4.53) and announces how bad the wound is. (In some cases, however, the ~PCs won’t know the precise degree of damage. In those cases, the GM can simply say, “You think you wounded her, but she’s still on her feet,” or, “You don’t notice any effect.”)

As an example, the GM thinks to herself, “Okay, the fighter with Good Strength just scored a Great hit with a broadsword. The loser rolled a Fair combat roll, has Good Damage Capacity and heavy leather armor. Hmmm — I’ll say the Strength and Damage Capacity cancel each other, while the sharp sword should be able to penetrate the leather armor if the blow is good enough. A Great hit against a Fair defense is enough, but not really massive: I’d say the loser is Hurt.” This result would then be announced to the loser of the combat round.

The GM can also use a Situational roll to help her. Roll the dice behind a GM screen, and let the result guide you. A roll of –1 to +1 isn’t significant — no change from what you decided. But a roll of +3 or +4 adds a wound level or two to the damage.

See Section 4.57, Recording Wounds, for details on how to keep track of wounds received.

That system, while simple and satisfying to a certain type of GM, doesn’t do much for those who prefer the system detailed in Section 4.54, Sample Wound Factors List. There’s no point in figuring out the offensive and defensive factors if you don’t do something with the numbers.

One system that uses the offensive and defensive factors requires finding the total damage factor. This is derived by adding up all the attacker’s offensive factors and then subtracting all the defender’s factors.

Example, first Leroy attacking Theodora, then vice versa:

Leroy:
Good Strength (+1)
Scale 0
Broadsword (+2 for size, +1 for sharpness = +3 weapon).
Offensive damage factors = 1+0+3 = 4

Theodora:
Fair Damage Capacity (+0)
Scale 0
Boiled leather armor (+2)
Defensive damage factors = 0+0+2 = 2.

Leroy’s total damage factor against Theodora is 4–2 = 2.

Theodora:
Superb Strength (+3)
Poleaxe (+4)
Offensive damage factors = 3+0+4 = 7

Leroy:
Good Damage Capacity (+1)
Scale mail armor (+3)
Defensive damage factors = 1+0+3 = 4.
Theodora’s total damage factor against Leroy is 7–4 = 3.
Since Theodora’s damage factor is larger, if she hits him, she’ll do more damage to him than he would to her for an equally well-placed blow.
Once these numbers are determined, jot them down so you don’t have to refigure them each combat round.
This system requires each character sheet to have a wound record track which looks like:

		1,2		3,4		5,6		7,8		9+
Wounds:	Scratch		Hurt		Very Hurt	Incapac.		Nr. Death

The numbers above the wound levels represent the amount of damage needed in a single blow to inflict the wound listed under the number. For example, a blow of 3 or 4 points Hurts the character, while a blow of 5 or 6 points inflicts a Very Hurt wound.

These numbers can be customized by the GM to fit her conception of how damage affects people. Raising the numbers makes it harder to wound someone, while lowering them makes combat more deadly.

Note that there is no number given for Dead. This is left up to the GM, and deliberately not included to prevent accidental PC death.
However, you can’t simply use the damage factor you determined above — relative degree is also important.

A relative degree of +1 is treated as a graze — see Section 4.56, Grazing.

Otherwise, simply add the relative degree to the damage factor. (You may also wish to include a damage roll — see Section 4.61, Damage Die Roll.)

The result is a number that may or may not be a positive number. If it’s zero or less, no damage is scored.

If the number is positive, look up the result across the top of the wound levels, and figure the wound as described above. If Leroy hits Theodora with a relative degree of +2, he adds that to his damage potential of +2 to produce a damage number of 4. Looking down, we see that a result of 4 is a Hurt result (Light Wound). Theodora is Hurt, and at –1 until she is healed.

For more detail, see Section 4.7, Combat and Wounding Example.

There are other ways to figure damage. A GM who believes the relative degree is more important than the damage factor would double it before adding it to the damage factor. The numbers above the wound levels should be adjusted in this case:

{{{
	1-3		4-6		7-9		10-12		13+
Wounds:	Scratch		Hurt		Very Hurt	Incapac.	Nr. Death
}}}

This is a satisfying system that is recommended for those who don’t mind doubling relative degree.

Others feel Strength is more important, and so on. A totally different wounding system is given in Section 4.63, ~Min-Mid-Max Die Roll. Many others have been proposed for Fudge over the years, and it would be easy to import one from another game system. Use what you feel comfortable with.</pre>
</div>
<div title="4.56 Grazing" creator="JonasSusara" modifier="JonasSusara" created="201010230943" changecount="1">
<pre>Any relative degree of +1 can do at most a GM-set Wound level (plus any Scale difference). It may do no damage at all, depending on the opponent’s defensive factors: a fist hitting plate mail won’t hurt the armored knight in the slightest — unless it’s a giant’s fist.
Sample graze severity table:
{{{
	Damage
	Factor	Result
	&lt;0	Undamaged
	0-4	Scratch
	 5+	Hurt
}}}

A GM may or may not allow a damage die roll on a graze, even if using the die rolls for other hits. If allowed, a damage roll shouldn’t change the result of a graze by more than one level.
Scale difference is a little trickier to figure, but it should be minimized for such a narrow victory: a giant’s club could give a human a glancing blow that might inflict a Very Hurt result, but not necessarily Incapacitate.
On the other hand, a tiger biting a mouse with a relative degree of +1 grazes the mouse as a cow grazes grass….
</pre>
</div>
<div title="4.57 Recording Wounds" creator="JonasSusara" modifier="JonasSusara" created="201010230945" modified="201010230954" changecount="5">
<pre>Once the final damage is determined, it is recorded on the wounded fighter’s character sheet. Each individual wound is described as a Scratch, Hurt (Light Wound), etc., as introduced in Section 4.51, Wound Levels.

Use a Damage Capacity attribute as an easy way to record wounds. (In this case, Damage Capacity is not figured into determining wound severity.) Each hit that is greater than a Scratch reduces a character’s Damage Capacity attribute one level — or more, if the GM deems the hit to be severe enough. (Scratches can accumulate as the GM desires — perhaps three Scratches equal one hit.)

When someone is reduced to Mediocre Damage Capacity, he is Hurt: –1 to all actions. When he is at Poor Damage Capacity, he is Very Hurt: –2 to all actions. When he drops to Terrible, he is at –3 to all actions — or Incapacitated, if a GM wishes to play it that way. Damage Capacity below Terrible is Incapacitated, at least — possibly worse.

(For characters of Mediocre or worse Damage Capacity, these levels only affect them when damaged. That is, an undamaged character of Mediocre Damage Capacity is not at –1 to all actions. However, if he takes even one hit, he drops to Poor Damage Capacity, and is at –2 to all actions.)

Healing in such a system cannot raise Damage Capacity above a character’s undamaged level — that can only be raised through Character Development (see Chapter 5).

A more detailed method requires a space on the character sheet to record wounds. This would look like:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[   ]		[   ]		[   ]		[   ]
}}}

The numbers above the wound levels are discussed in Section 4.55, Determining Wound Level.

The boxes below the wound levels represent how many of each wound type a fighter can take.

When a wound is received, mark off the appropriate box. A character takes a Very Hurt result in the first round of combat. The character sheet would then look like:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[   ]		[X]		[   ]		[   ]
}}}

This character is at –2 to all skills since he’s Very Hurt.

If he then received a Hurt result, he would check it off like so:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[X]		[X]		[   ]		[   ]
}}}

This character is still at –2 to all skills. The Hurt result is not cumulative with the Very Hurt result; only the penalty for the highest recorded wound level counts.

If there is no open box for a given wound result, the character takes the next highest wound for which there is an open box. If the character above, for example, takes another Hurt result, we see that there is no open box in either Hurt or Very Hurt, so we have to go to Incapacitated: the character is now incapacitated, and the sheet would look like:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[X]		[X]		[H]		[   ]
}}}

Note that an “H” is recorded under the Incapacitated label. The character is indeed Incapacitated — he can’t fight any more — but for healing (and scarring) purposes, he has only received two Hurt wounds and one Very Hurt wound — never an Incapacitating wound in one blow. Since Incapacitating blows are harder to heal from, this is important.

As another example, a character that takes two Very Hurt results without taking any other hits is Incapacitated, since that is the next highest wound level.

Note that three boxes are provided under Scratch. This can be customized by each GM, of course. A Scratch wound will not make a fighter Hurt until he receives his fourth Scratch. Optionally, a Scratch will never raise a character’s wound level beyond Very Hurt, no matter how many he takes. The GM should not to use this rule when the ~PCs fight a monster of huge Scale. Otherwise, they’d never be able to kill such a creature when the worst wound they can inflict is a Scratch.

The wound progression above makes for a fairly realistic campaign. For a more cinematic campaign (especially those without magic or science fiction healing), add an extra box for Scratch, Hurt, and possibly Very Hurt: lesser blows won’t accumulate so quickly to hinder the character. A moderately cinematic character sheet looks like:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[   ]  [   ]	[   ]		[   ]		[   ]
}}}

It wouldn’t be out of line, for an epic scale game, to add up to two more boxes to Hurt and Very Hurt.

Be warned that adding boxes can lengthen combat significantly.

Never add boxes for cannon-fodder ~NPCs, though you may wish to do so for major ~NPCs. In fact, NPC pawns don’t even need the system above. A simple three-stage system of Undamaged, Hurt, Out of the Battle is good enough for most of them. Simply make a mark under an NPC’s name for Hurt, and cross out the name for Out of the Battle.</pre>
</div>
<div title="4.58 Non-human Scale in Combat" creator="JonasSusara" modifier="JonasSusara" created="201010230955" modified="201010230957" changecount="3">
<pre>The attacker’s Strength Scale is added to his offensive damage factors, and the defender’s Mass Scale is added to her defensive damage factors. If you have combat with beings weaker than humans, remember what you learned in school about adding and subtracting negative numbers….

Armor and weapons affect the damage done normally, since they are scaled to the folks using them. Hits become Scratches, Hurt, etc., as usual – see Section 4.55, Determining Wound Level.

However, an extremely small character is not likely to be able to wound a large one in the numerical value wounding system. The GM may allow a point or two of damage to penetrate if the small character gets a critical success. Poison-tipped arrows and lances are also a possibility: the small character can aim for joints in the armor and merely has to break the skin to inject the poison.

Also, this system treats Mass Scale like armor, which isn’t quite accurate. In reality, a small opponent may be slowly carving the larger fighter up, but each wound is too petty, relative to the large scale, to do much damage by itself. To reflect a lot of small wounds gradually inflicting a hit on a large-scale foe, allow a damage roll when Scale prevents a hit from doing any damage – that is, when Scale is the only difference between getting a Scratch and no damage at all. See Section 4.61, Damage Die Roll.

There are also “scale piercing” weapons, such as whale harpoons and elephant guns. These don’t have massive damage numbers: instead, if they hit well, simply halve the Scale value, or ignore it all together. Of course, if such a weapon is used on a human, it would indeed have a massive damage modifier….

Combat Examples: In the following examples, each fighter’s Strength Scale equals his own Mass Scale, but not his opponent’s. (E.g., Wilbur’s Strength is Scale 0 and his Mass is Scale 0.) Also, it is assumed the GM is not using the optional damage roll, which could vary damage in all three combats discussed.

First example:
Sheba, a human warrior, has just kicked ~McMurtree, a wee leprechaun. Sheba’s offensive damage factor = +1:
Fair Strength: +0
Unarmed Combat Skill, with thick boots: +1
Scale: +0
(Sheba’s martial art skill normally earns her a +0 to damage, and boots normally earns a +0. The GM rules that using both together allows a +1, however.)

~McMurtree’s defensive damage factor is –3:
Light Leather Armor: +1
Fair Damage Capacity: +0
Scale: –4.

Sheba’s damage factor against ~McMurtree is 1–(–3) = +4. (Subtracting a negative number means you add an equal but positive amount.)
If Sheba wins the first combat round with a relative degree of +2 she scores a total of 4+2 = 6 points. ~McMurtree’s player looks up 6 on the wound table on his character sheet: Very Hurt – he’s at –2 for the next combat round, and in grave danger if she hits again.

Second example:
~McMurtree’s friend, Fionn, now swings his shillelagh (oak root club) at Sheba’s knee. Fionn’s offensive damage factor is –1:
Good Strength: +1
Shillelagh: +2
(medium sized relative to Fionn, not sharp)
Scale: –4

Sheba’s defensive damage factor is +2:
Heavy Leather Armor: +2
Scale: +0
Fionn’s damage factor against Sheba is –1–2 = –3.

If Fionn wins by +3, a solid blow, he adds –3+3 = 0. Unfortunately for Fionn, she takes no damage from an excellently placed hit.
Fionn had better think of some other strategy, quickly. Fortunately for Fionn, he knows some magic, and if he can dodge just one kick from Sheba, she’ll learn the hard way why it’s best not to antagonize the Wee folk….

Third example:
Wilbur, a human knight with a sword, is attacking a dragon. Wilbur’s offensive damage factor is a respectable +6:
Great Strength: +2
Two-handed sword: +4 (+3 for size, +1 for sharpness)
Scale: +0

The dragon’s defensive damage factor is +8:
Fair Damage Capacity: +0
Tough hide: +2
Scale: +6

Wilbur’s damage factor against the dragon is therefore 6–8 = –2.
If Wilbur hits the dragon with a relative degree of +3, he does 3–2 = 1 point of damage. Given his Strength, weapon, and the amount he won by, this would be a severe blow to a human, even one wearing armor. But this is no human opponent. Only one point get through the dragon’s Scale and tough hide. The GM checks off a Scratch for the dragon, and the fight continues. Since there are three Scratch boxes for a major NPC, Wilbur will have to do this thrice more before he finally Hurts the dragon. He may need help, or have to go back for his magic sword.</pre>
</div>
<div title="4.6 Wound Options" creator="JonasSusara" modifier="JonasSusara" created="201010230805" modified="201010231010" changecount="2">
<pre>This section introduces some of the simpler options for determining wounds. Many others are possible in Fudge, and this list should not be considered official or exhaustive. They are included for possible use, but also to inspire the GM to create her own.

[[4.61 Damage Die Roll]]
[[4.62 Stun, Knockout, and Pulling Punches]]
[[4.63 Min-Mid-Max Die Roll]]
[[4.64 PC Death]]
[[4.65 Technological Levels as Scale]]</pre>
</div>
<div title="4.61 Damage Die Roll" creator="JonasSusara" modifier="JonasSusara" created="201010231000" changecount="1">
<pre>Although the damage roll is optional, it is recommended if you are using numerical damage factors. This is because the damage factors are generally fixed for the entire fight, and things tend to get stagnant. It also allows a tiny fighter to have a chance against a larger foe — a satisfying result.

There are many possible ways to use a damage die roll.

One could roll a single Fudge die for a result of –1, 0, or +1. This can be added to the damage factor, or, more broadly, to the actual wound level.

For example, if a fighter inflicts 4 points of damage, that is normally a Hurt result. If a +1 on 1dF is rolled, however, that can make the result +5 (if adding to the damage factor), which brings it up to Very Hurt result. However, a –1 wouldn’t change the wound: it would lower the result to 3, which is still a Hurt result. But if the GM is using 1dF to alter the wound level, then a –1 changes the result to a Scratch, since that’s one wound level below Hurt.

Instead of a separate damage roll, one could simply use the die rolls used to resolve the Opposed action. If the attacker wins with an even roll (–4, –2, 0, +2, +4), add one to his offensive factor. If he wins with an odd result (–3, –1, +1, +3), his offensive factor is unchanged. Do the same for the defender, except it affects his defensive factor. This system will help the defender 25% of the time, the attacker 25% of the time, and won’t affect the damage results at all 50% of the time.

Example: the defender loses the combat round, but rolls his trait level exactly (die roll of 0): he adds one to his defensive damage factor. The attacker wins with a die roll of +3: his offensive damage factor is unchanged. The final damage number is reduced by one — the defender, although losing the round, managed to dodge left as the attacker thrust a bit to the right, perhaps. He may still be wounded, but he got his vital organs out of the way of the blow.

This system could also be applied to the wound level instead of the damage factor.

A more complicated system uses a Situational roll (result from –4 to +4, not based on any trait), and adds it to the calculated damage number (the number over the wound level), as found in Section 4.55, Determining Wound Level. Negative final damage is treated as zero damage.

The GM may wish to apply some limitations to the damage roll, to restrict too wild a result. For example:
# If the calculated damage is positive, the damage roll cannot exceed the calculated damage. That is, if the calculated damage is +2, any damage roll of +3 or +4 is treated as +2, for a total of 4 points of damage.
# If the calculated damage is positive, the final damage cannot be less than +1.
# If the calculated damage is negative or zero, the final damage may be raised to a maximum of +1 by a damage roll.

First Example: The calculated damage is found to be –2 due to armor and Scale. It would take a +3 or +4 die roll to inflict a wound on the defender in this case, and then only 1 point of calculated damage: a Scratch.

Second Example: The calculated damage is +2 (a Scratch). A damage roll of +2 to +4 results in final damage of four points, since calculated damage cannot be more than doubled by a damage roll. A damage roll of +1 results in final damage of three points, while a damage roll of 0 results in two points of final damage. Any negative die roll results in one point of final damage, since a positive calculated damage cannot be reduced below one by a damage roll.

For simplicity, of course, the GM can simply ignore the limitations, and allow the damage roll to be anywhere from –4 to +4, let the chips fall where they may….

Many other damage die rolls are possible — these are only given as examples to the GM.</pre>
</div>
<div title="4.62 Stun, Knockout, and Pulling Punches" creator="JonasSusara" modifier="JonasSusara" created="201010231001" changecount="1">
<pre>A player can announce that his character is trying to stun or knock his opponent out rather than damage her. Using the flat of a blade instead of the edge, for example, can accomplish this. Damage is figured normally, but any damage inflicted doesn’t wound the opponent: it stuns her instead.

In this case, a Hurt result is called a “Stun” — a stunned character cannot attack or all-out defend, and is at –1 to defend for one combat turn only. However, the Stun result stays on the character sheet: that is, a second Stun result, even if delivered more than one combat round after the first, will cause the character to become Very Stunned. (Stun results heal like Scratches: after combat is over.)

A Very Hurt result in a stunning attack is called a Very Stunned result instead: no attacks and –2 to all actions for two combat rounds.
A result of Incapacitated or worse when going for stun damage results in a knockout. A knocked-out character doesn’t need healing to recuperate to full health — just time. (Only a harsh GM would roll for the possibility of brain damage — this is fiction, not reality.)

The GM may simply decide that a successful Good blow (or better) to the head knocks someone out automatically. In an Opposed action, the Good blow would also have to win the combat, of course.

Likewise, a player may choose to have his character do reduced damage in any given attack. This is known as “pulling your punch,” even if you are using a sword. This commonly occurs in duels of honor, where it is only necessary to draw “first blood” to win, and killing your opponent can get you charged with murder. A Scratch will win a “first blood” duel — it is not necessary to Hurt someone.

To pull your punch, simply announce the maximum wound level you will do if you are successful. A fencer can say he is going for a Scratch, for example. In this case, even if he wins the Opposed action by +8, and adds in +3 for his sword, the worst he can do is nick his foe. He was just trying for a Scratch — but the Scratch is probably in the shape of the letter “Z” with such a result!</pre>
</div>
<div title="4.63 Min-Mid-Max Die Roll" creator="JonasSusara" modifier="JonasSusara" created="201010231004" modified="201010231007" changecount="4">
<pre>This system of wound determination does not pretend to be a realistic method, and can produce some wildly varying results. But it’s quick, easy, and lots of fun, and so works well in a certain style of gaming.

This system requires 3d6 for a damage roll, even if using 4dF for action resolution.

Overview: roll 3d6 when a damage roll is called for. You will probably only read one of the dice, however: either the lowest value (Min), median value (Mid) or highest value (Max), depending on damage factor and relative degree. The greater the damage factor and/or relative degree, the greater the d6 you read for result.

If using the ~Min-Mid-Max system, use the wound track on the character sheet listed in Section 4.57, Recording Wounds:
{{{
	1,2			3,4		5,6		7,8		9+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[   ]		[   ]		[   ]		[   ]
}}}

The offensive and defensive damage factors listed in Section 4.54, Sample Wound Factors List, are used.  However, they are not added to the relative degree. Instead, simply derive the total damage factor as normal: (attacker’s Strength + Scale + weapon) minus (defender’s Damage Capacity + Scale + armor). Each player should jot down this number once it is known for the combat.

Before the game begins, the GM decides how important the damage factor and relative degree are in determining wound severity. The following table is recommended as a starting point; the GM can adjust it as she sees fit:
{{{
	Damage		Bonus		Relative Degree
	 Factor
	&lt; 0		–1		—
	0,1,2		0		2,3
	3,4,5		+1		4,5
	6+		+2		6+
}}}

A damage factor of 3, for example, has a die-reading bonus of +1, while a relative degree of 3 has a die-reading bonus of 0. The GM may charge a –2 penalty if the damage factor is well below zero (–5 or worse).

Since the graze rules are used unchanged with this system, there is no listing for relative degree less than 2.

Add the bonus for damage factor with the bonus for relative degree to get a final bonus. Example: a character has a damage factor of +3 (bonus: +1) and a relative degree of +5 (bonus: +1).  His total bonus for that round of combat is +2.

What do these bonuses represent?

A total “bonus” of less than zero means no damage is possible — don’t even roll the dice. Otherwise, locate the total bonus on the following table:
{{{
	Total Bonus	Die to Read
	0		Min
	1		Mid
	2		Max
	3		Add Max + Min
	4		Add all three
}}}
Min = lowest die.
Mid = median die.
Max = highest die.

The median is the value in the middle. This may be the same as the highest or lowest, as in a roll of 2, 4, 4: the Min = 2, the Mid = 4, and the Max = 4. A roll of triples means Min = Mid = Max. (Please read the median value — not necessarily the die that is physically between the other two on the table.)

Once you have determined which die to read, compare it with the numbers above the wound levels. With a roll of 1, 3, 5, for example, the Min die = 1 (a Scratch result), the Mid die = 3 (a Hurt result), and the Max die = 5 (a Very Hurt result). You would only read one of these results, however — not all three.

With three or more bonuses, add the appropriate dice as listed on the table. For results beyond 9, the GM is free to kill the recipient outright, or merely keep it as a Near Death result, as called for by the situation.

The tables are not meant to be intrusive, merely guidelines. The basic intent is to read the Mid if the attacker has either a decent damage factor or a decent relative degree; to read the Min if he has neither; and to read the Max if he has both. All other values are derived from that simple idea. So the GM can ignore all the tables, and with that idea in mind, just fudge which die to read.

For example, a GM might say, “Whoa! You just hit him across the forehead as he backed into a bucket left by the hastily fleeing janitor. Nice shot — he topples over onto his back. For damage, roll 3d6 and read the Max!”
This would have come out of a descriptive game, in which the players describe their characters’ actions in great detail.

Example of the ~Min-Mid-Max system:
Valorous Rachel is fighting the villainous Archie. Both are Scale 0, so Scale won’t be mentioned.

Rachel:
	Quarterstaff: +2
	Strength Fair: +0
		Offensive damage factor: +2
	Light Leather Armor: +1
	Damage Capacity Good: +1
		Defensive damage factor: +2
Archie:
	Greatsword: +4
	Strength Great: +2
		Offensive damage factor: +6
	Heavy Leather Armor: +2
	Damage Capacity Fair: +0
		Defensive damage factor: +2

So Rachel’s damage factor is 2–2 = 0. She gets no bonus.

Archie’s damage factor is 6–2 = 4.  He gets +1 bonus, according to the table above.

On the first round, Rachel wins by +2, whacking Archie across the ribs. Relative degree +2 doesn’t get any bonus (and she has none from her damage factor), so Rachel will read the Min. She rolls 3d6 and gets lucky: a 3, 5, and 6. The Min is a 3: she Hurts Archie, who is now at –1 and checks off his Hurt box.

On the second round, Archie manages to win with a graze: +1 relative degree. Do not even calculate a bonus in this case — use the graze rule unchanged from Section 4.56, Grazing. His damage factor is only 4, so he scores a Scratch on Rachel.

On the third round, Archie does very well: he wins by +4 as Rachel backs into a chair! He now gets two bonuses, one from his damage factor and one from his relative degree: he will read the Max die. But Archie’s karma is in serious need of overhaul: he rolls a 1, 2, and 3. 

Rachel is only Hurt, and the GM checks off the Hurt box.

Rachel all-out attacks in the following round, and with the +1 to hit she scores an awesome +6 over Archie! She gets two bonuses for such a high relative degree — she’ll read the Max die — and gets +1 to the die roll for all-out attacking. (Note that this is +1 to the die result, not a +1 to the die-reading bonus.) The GM rolls a 1, 4, 6. She reads the Max and adds 1 for a total of 7. Reading the wound table on the character sheet, she sees that this is Incapacitated, and declares that Rachel’s staff just smashed across the bridge of Archie’s nose, probably doing serious damage, and at least knocking him out of this battle….

For a more epic game, where it’s important to be able to Incapacitate in one blow, use the following wound track on the character sheet:
{{{
	1			2,3		4,5		6		7+
Wounds:	Scratch			Hurt		Very Hurt	Incapac.	Nr. Death
	[   ]  [   ]  [   ]	[   ]  [   ]	[   ]		[   ]		[   ]
}}}

The extra wound boxes are in keeping with an epic style game, but are optional.</pre>
</div>
<div title="4.64 PC Death" creator="JonasSusara" modifier="JonasSusara" created="201010231009" modified="201010231009" changecount="3">
<pre>4.64 PC Death
Sometimes the dice try to kill a PC. In most campaigns, PC death shouldn’t occur through a bad die roll, but only if the character’s actions were truly self-sacrificing – or stupid – enough to warrant death. Three methods of preventing accidental PC death are presented. They may be used separately or together or not at all.

These should not be used for run-of-the-mill ~NPCs, but could be used for major ones.

The “automatic death” rule in Section 4.51, Wound Levels, takes precedence over these suggestions.
# A character cannot take more than three levels of wounds in one blow. For example, an unwounded character could be Scratched, Hurt, or Very Hurt in one blow, but any excess damage points beyond that would be lost. A Hurt character could go all the way to Near Death in one blow, but not be killed outright.
# A character cannot be rendered Near Death unless he began that combat round Incapacitated. This is simpler to keep track of than the first system, and assumes there is some great difference between a severe wound and mortal wound. There probably isn’t, but the rule isn’t intended to be realistic: it’s to make the ~PCs more heroic than real life.
# A player may spend a Fudge Point (Section 1.36) to convert a deadly wound to a merely serious one.</pre>
</div>
<div title="4.65 Technological Levels as Scale" creator="JonasSusara" modifier="JonasSusara" created="201010231010" changecount="1">
<pre>Technological differences between weapons and armor can be expressed as Scale if the GM desires. Instead of figuring exactly how much mega-damage a transvibrational subneural pulverizer does, the GM can simply say, “This is a weapon that is of the same technological level as the armor of the defender — therefore, it has the same effect on her as a modern pistol would on kevlar.” However, if used against someone who is wearing kevlar, the transvibrational subneural pulverizer does lots and lots of damage — kevlar wasn’t designed to stop this type of thing.

Basically, there isn’t much difference between thrusting a sword through a naked man’s kidney, or shooting him with a .38 through the kidney, or using a transvibrational subneural pulverizer on the kidney: naked people don’t resist most weapons well. Plate armor stops the sword well, but won’t slow down the .38 enough to help much — unless it can deflect it away from the kidney, that is. It probably won’t help at all against the pulverizer, but it may: the GM will have to decide the effect of such a weapon on plate armor.

The concept of technological levels as Scale only comes into effect when weapons of one technological era are used against armor of another technological era. At that point, the GM can add an arbitrary Scale difference to the weapon — or armor, whichever is of the higher tech level. No attempt to quantify tech levels is made here. This section is merely food for thought.
</pre>
</div>
<div title="4.7 Combat and Wounding Example" creator="JonasSusara" modifier="JonasSusara" created="201010230806" modified="201010230911" changecount="2">
<pre>This example uses the numerical offensive and defensive factors in Section 4.54, Sample Wound Factors List. It also uses a damage die roll: the 4dF option, with the three limitations listed.

The two opponents are Medieval warriors, Snorri and Brynhild. The fight takes place in a barroom, which quickly empties of other occupants once weapons are drawn. No one noticed that the innkeeper’s son had actually left much earlier than this, when the belligerent Snorri was merely exchanging insults with the proud Brynhild. Both fighters are human (Scale 0), so Scale is left out of the discussion.

Snorri:
Sword skill: Great
No shield
Strength: Good (+1)
Weapon: Magic Sword
		(+2 for size, +1 for Sharp, +1 for Magic = +4)
	Offensive damage factor: +5
Damage Capacity: Good (+1)
Armor: Heavy Leather (+2)
	Defensive damage factor: +3

Brynhild:
Axe skill: Good
Shield: Medium (–1 to foe’s weapon skill)
Strength: Great (+2)
Weapon: Axe (+2 for size, +1 for Sharpness = +3)
	Offensive damage factor: (+5)
Damage Capacity: Fair (+0)
Armor: Heavy Leather (+2)
	Defensive damage factor: (+2)

Snorri’s damage factor vs. Brynhild: 5-2 = +3
Brynhild’s damage factor vs. Snorri: 5-3 = +2
Snorri’s skill is reduced to Good for this combat by Brynhild’s shield — see Section 4.31, Melee Modifiers.

In the first round, Snorri gets a Great result on his weapon skill (die roll = +1), and Brynhild gets a Fair result (die roll = –1). Snorri wins with a relative degree of +2. Snorri’s damage factor of +3 is added in, bringing the damage to +5. Looking at the character sheet, a +5 result equals a Very Hurt wound — before rolling for damage.

The GM is requiring damage rolls, so Snorri’s player rolls the dice: a –2 result, too bad. This brings the damage down to 3. Since Brynhild is an NPC, the GM looks at the wound chart on her character sheet, and finds 3: a Hurt Wound. The GM marks off the box under the word “Hurt,” and the next round is fought. Brynhild is now at –1 for the rest of the combat.

In the second round, both combatants get Good results — a standoff. The GM describes it as a give-and-take of blows that are all parried or blocked as the fighters circle each other. Another five seconds have passed this round, the GM decrees.

In the third round, Snorri gets a Great result and Brynhild only a Good result — Snorri has hit again. Since the relative degree is +1, this is a graze. The GM does allow a damage die roll on a graze, but won’t let it change the result by more than one level. Snorri’s damage factor of +3 normally means a Scratch on a graze.

Snorri rolls a 0 for damage, so the GM marks off a Scratch box on Brynhild’s character sheet.

In the fourth round, Snorri decides to finish off the Hurt Brynhild in one blow: he all-out attacks, which gives him a +1 modifier to his skill, and a +1 to damage if he wins. Brynhild had decided to try for a situational advantage, though: she’s spending this round in all-out defense, hoping to spot some way to get an advantage over Snorri for the fifth round. Brynhild gets a +2 modifier to her skill this turn, but can’t hurt Snorri if she wins. Snorri gets a Great result, even counting his +1 for all-out attacking, and Brynhild also gets a Great result. Snorri would ordinarily have lost the combat round (all-out attackers lose tie results), but Brynhild’s all-out defense means she doesn’t aim any blows at Snorri, just beats his attack down.

The GM requires a Good Perception roll from Brynhild in order to spot a situational advantage. Her Perception attribute is Great, so she easily makes it. She notices a drink on the floor, spilled earlier by a customer in full flight. Since she successfully defended that round, the GM rules she maneuvers Snorri into the slippery puddle for one round.

In the fifth round, the GM gives Snorri a –1 to skill this round (down to Fair) for bad footing. Snorri tries an ordinary attack, and Brynhild, wounded, desperate, and sensing this may be her only chance, now tries an all-out attack: +1 modifier to her skill, bringing her up to an effective skill of Good from her wounded Fair state. Brynhild rolls a Great result, and Snorri only gets a Good result: Brynhild wins this round by +1.

Since she was doing an all-out attack, she gets a bonus of +1 to damage. This does affect a graze, so her normal Scratch result (for a graze) is increased to Hurt. She rolls a 0 on the damage roll, so Snorri is now Hurt: –1 until healed.
The combat is interrupted at this point by the town guards, who had been alerted by the innkeeper’s son. Snorri and Brynhild are hauled off to separate cells, probably only too glad to get out of what had become a potentially deadly duel….
</pre>
</div>
<div title="4.8 Healing" creator="JonasSusara" modifier="JonasSusara" created="201010230807" modified="201010230912" changecount="2">
<pre>Wounds are healed through a medical skill or supernormal power.

A Scratch is too insignificant to require a roll on a healing skill (although it might require a kiss to make it better…). Scratches are usually erased after a battle, provided the characters have five or ten minutes to attend to them. An individual GM may rule otherwise, of course: they may linger on for a day or two.

A Good result on a healing skill heals all wounds one level (Hurt to healed, Very Hurt to Hurt, etc.). (Scratches do not count as a level for healing purposes. That is, a Hurt wound that is healed one level is fully healed.) A Great result heals all wounds two levels, and a Superb result heals three levels.

Healing with realistic medical skills takes time: the success of the roll merely insures the wounds will heal, given enough rest. How long this takes depends on the technological level of the game setting, and is up to the GM. (A day per treated wound is extremely fast healing, but may be appropriate in an epic-style game. Likewise, one minute per magically healed wound is fast.) Whether or not strenuous activity before the healing period ends reopens a wound is also left up to the GM….

Example: a character with three wounds (two Hurt results and one Very Hurt) is healed with a roll of Good. After the appropriate time, the two Hurt wounds will be fully healed, while the Very Hurt wound will now be a Hurt wound (and carries a –1 modifier as such).

Otherwise, wounds heal on their own at one wound level per week of rest — or longer, if the GM is being more realistic. That is, after a week of rest, an Incapacitated character becomes Very Hurt, etc. The GM may also require a successful roll against a Constitution attribute: Fair Difficulty Level for Hurt, Good Difficulty Level for Very Hurt, and Great Difficulty Level for Incapacitated. Failing this roll slows the healing process. Someone Near Death should take a long time to heal, even with magical or high tech healing.</pre>
</div>
<div title="5. Character Development" creator="JonasSusara" modifier="JonasSusara" created="201010201258" modified="201010230721" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="7">
<pre>After playing a bit, perhaps each session, a player will want the character to grow in abilities. At this point, a developing character can exceed the initial GM-set skill limits (such as one Superb, three Greats). There are two ways to handle character development, or “experience,” as it’s often called.

[[5.1 Subjective Character Development]]
[[5.2 Objective Character Development]]
[[5.3 Development through Training]]
[[5.4 Alternative Experience System]]
</pre>
</div>
<div title="5.1 Subjective Character Development" creator="JonasSusara" modifier="JonasSusara" created="201010230717" modified="201010230721" changecount="2">
<pre>When the player feels the character has accomplished enough to warrant improving in some trait (and he feels he’s been role-playing well), he petitions the GM for permission to raise it. A trait can only be raised one level at a time. A trait must be used more to raise it from Good to Great than Fair to Good, and so on. It should be easier to raise a Skill than an attribute.

Or the GM can simply award an improvement in a trait she feels deserves to be raised. In these cases, there is never a corresponding reduction of another trait — this is character development, not creation.

</pre>
</div>
<div title="5.2 Objective Character Development" creator="JonasSusara" modifier="JonasSusara" created="201010230718" modified="201010230723" changecount="3">
<pre>In the Objective Character Development system, the GM can award experience points (EP), which the player can trade in any way he wants at the following rates:

Raising a skill
{{{
	From:		To:		Costs:
	Terrible	Poor 		1 EP
	Poor		Mediocre	1 EP
	Mediocre	Fair		1 EP
	Fair		Good		2 EP
	Good		Great		4 EP
	Great		Superb		8 EP
	Superb		Legendary	16 EP + GM permission
	Legendary	Legendary 2nd	30 EP + GM permission
	Each add’l level of Legendary:	50 EP + GM permission

}}}

Raising an attribute:
Triple the cost for skills of the same level.

Adding a gift:
6 EP (or more) + GM approval.

Adding a supernormal power:
12 EP (or more) + GM approval.

A trait can only be raised one level at a time.

The GM may adjust these point levels as she sees fit and should require that the player may only raise traits that were used significantly during an adventure. If a long campaign is planned, these EP costs could be doubled to allow room for character growth.

Defining skills narrowly will also ensure characters don’t become too powerful too quickly.
As a guideline, good role-playing should be rewarded with 1 to 3 EP per gaming session, with a suggested upper limit of 4 EP for flawless role-playing. Players may save EP as long as they wish.

Attribute levels may or may not affect EPs put into skills. For simplicity, you can ignore attribute levels entirely when raising skill levels. For greater realism, however, the GM can add a surcharge of +2 EP (or more) when a skill is raised above an appropriate attribute.

Example: Violet the Herbalist has Good Intelligence.  EP costs for raising Herb Lore skill are normal until she tries to raise it to Great, which is higher than her natural Intelligence. At that point, she must pay +2 EP beyond what the table calls for: 6 EP to raise Herb Lore to Great, and another 10 EP to raise it to Superb.

This proposal is recommended only for character development — not for character creation. The GM should inform the players at character creation if this option is in force so they can plan their characters’ attributes accordingly.</pre>
</div>
<div title="5.3 Development through Training" creator="JonasSusara" modifier="JonasSusara" created="201010230719" modified="201010230724" changecount="2">
<pre>Improving skills through EP is not always realistic, to be honest. A gaming session might only cover a few hours of campaign time. Allowing a character to improve one or two different skills from Fair to Good in that time is far-fetched. But it’s fun for the players, and psychologically satisfying, and so recommended.

As an alternative, or in addition to the methods described above, the GM may allow traits to be raised through appropriate amounts of training time. This would require finding a teacher (which would cost money) or taking an appropriate job (which may not be totally dedicated the skill you wish to learn, and so take longer). It’s also possible to learn something on your own, but the GM should double the time required. If using the Objective Character Development system, the GM may (or may not) require that EPs be spent in this manner — that is, you can’t spend EPs unless you also take the time to train.

The GM sets training time and costs, and difficulty of finding a teacher. The teacher has two skills that must be considered: Teaching skill, and the appropriate skill being taught. The player may need to roll the dice to see how diligently the character studied the skill. The die roll should be on an attribute such as Willpower, Drive, Zeal, Wisdom, Self Discipline, Self Motivation, Psyche, Intelligence, etc. If the player can give a valid reason why the character is extremely motivated to learn this skill, the GM may grant up to +2 to the trait tested. The GM may request a single die roll, or a roll per week, month, etc. If multiple rolls are called for, at least half of them should succeed to earn the skill improvement.

Example: Billy Blaster, space cadet, is back at the Academy after his first tour of duty. He considers his Fair Laser Pistol skill to be substandard. He takes a six-week training course in Laser pistol use, taught by an instructor of Superb Laser skill and Great Teaching skill. (Since Billy has Gift: Employed by Space Patrol, this is free training for him.) The GM decides that Billy’s player needs to make a Willpower roll for each two-week period to see how dedicated he is to studying. If at least two of the three rolls are Mediocre or better, Billy can raise his Laser pistol skill from Fair to Good, given the length of training and quality of the instructor. Had the training been shorter, or the instructor worse, he would have needed a preponderance of Fair or even Good rolls to have successfully raised his Laser pistol skill.

Remember that it is much easier to improve a skill from Poor to Mediocre than from Great to Superb. Require more time, or higher Difficulty Levels on the Will rolls to raise an already high skill.

</pre>
</div>
<div title="5.4 Alternative Experience System" creator="JonasSusara" modifier="JonasSusara" created="201010230721" modified="201010230725" changecount="2">
<pre>Note: The following was taken from the author’s “Thoughts on Fudge” (online at http://www.io.com/~sos/rpg/fudlatest.html).

After a convention game one time, Ann Dupuis and I were discussing how well the game went, especially with the one newcomer to gaming at the table. The woman was not only at her first convention, but was playing her first RPGs that weekend. Fudge was the last game in her schedule that con, and she was blown away by how easy it was compared to the other games. She said she understood the character sheet without having to have anything explained to her – and that the single mechanic to resolve all actions was the best she’d seen in the five different games she’d tried.

So we were congratulating ourselves, when I mentioned to Ann (President and Dictator for Life of Grey Ghost Games) that Fudge did have its drawbacks – experience being the most glaring. Yes, it’s great for one-shot con games, but it seems to allow characters to develop too quickly or not at all in long-term games.

Ann came up with an idea which we batted around a bit, and it looks something like this:
Instead of awarding Experience Points, the GM awards Fudge Points at the end of a gaming session. These can be turned in for Experience Points, but the ratio in Section 1.36 (suggested 3 EP = 1 Fudge Point) is reversed. That is, you may turn in three Fudge Points for one EP.

Raising traits is unchanged from Chapter 5.

What this does is force the player to consider whether he needs to save his Fudge Points to get out of a jam the next session, or convert them to EP to raise a trait. He can save Fudge Points from session to session, so he can eventually swap 12 Fudge Points for 4 EP to raise a trait or two – but he may have to use some of those Fudge Points along the way to survive!

The net effect is that character development is left totally in the hands of the player, but is slowed down from the rate suggested in the book. This means a long-term campaign becomes more viable in Fudge.

</pre>
</div>
<div title="6. Tips and Examples" creator="JonasSusara" modifier="JonasSusara" created="201010201259" modified="201010230749" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="7">
<pre>[[6.1 GM Tips and Conversion]]
[[6.2 Character Sheet Example]]
[[6.3 Character Examples]]
[[6.4 Class and Racial Template Examples]]
[[6.5 Animal &amp; Creature Examples]]
[[6.6 Equipment Examples]]</pre>
</div>
<div title="6.1 GM Tips and Conversion" creator="JonasSusara" modifier="JonasSusara" created="201010230737" changecount="1">
<pre>Always remember the main point of the game is to have fun….

The GM should translate at least one of her favorite characters into Fudge from whatever system she is used to. This will give her a good idea of what traits to choose, and how many.

Fudge is incredibly flexible, possibly more so than any system you’ve played before. 

Once you’ve translated a favorite character, fiddle with her a bit. Can you tweak her to be exactly what you want, possibly in ways your previous system wouldn’t allow? What if you split that attribute into two or three effects – ah! See, she can be smart in some ways, but dumb in others; knowledgeable of some things, ignorant of others. Hmmm – too many attributes? Make some of them gifts, then — that might be easier to deal with. 

And so on – have fun!

It is easy to create NPCs to challenge the player characters by counting levels. Figure roughly how many levels have been spent on combat skills by the average player character. This figure, put into combat skills in an NPC, should give a fair fight. For example, if the PCs are built on 40 skill levels and four free attribute levels, the average character might have ten levels in combat skills directly. In that case, a gang of thugs with ten levels each of combat skills and two attribute levels put into physical attributes should challenge the player characters pretty closely.

6.11  Conversion Hints
It is not practical to give guidelines for converting every game system to and from Fudge. However, two systems of trait measurement are in widespread use: a 3-18 scale, and a percentile system. While these are not used uniformly (and there are many games that don’t use either system), it is still useful to discuss translating between such systems and Fudge.
Standard 3-18 scale traits are converted as follows:

	Fudge Level	3-18 Level
	Superb		18+
	Great		16-17
	Good		13-15
	Fair		9-12
	Mediocre	6-8
	Poor		4-5
	Terrible		3 or less

Percentile traits are converted roughly as follows:

	Fudge Level	Percentile Level
	Superb		98-100
	Great		91-97
	Good		71-90
	Fair		31-70
	Mediocre	11-30
	Poor		4-10
	Terrible		1-3

6.111 Translations to/from Other RPGs
Note: The following was taken from the author’s “Thoughts on Fudge” (online at http://www.io.com/~sos/rpg/fudlatest.html).
Mike Harvey suggested the table in Section 6.11 on converting characters to/from Fudge isn’t accurate. He points out that my conversions of
Mediocre: 6-8
Poor: 4-5
Terrible: 3 or less
are especially off — because no RPG really uses those numbers! And he’s right. I doubt you’ll find one GURPS® character in a hundred with skills below 9.
Therefore, a more accurate chart for Section 6.11 might look like:
Superb: 19+
Great: 16-18
Good: 14-15
Fair: 12-13
Mediocre: 9-11
Poor: 6-8
Terrible: 5 or less

6.12  Templates
A GM can create a character template for the players. This may help a player make his first Fudge character, or allow players coming from a game with a character class system to feel at home. She should also allow custom-designed characters, though, for players who feel limited by character classes.
The “GM limits” and the list of attributes at the beginning of each sample character in Section 6.3 are templates. The GM can hand out character sheets with attributes and limits already printed on them. This can be accompanied by a copy of the list of sample skills on page 126, and possibly the sample lists of gifts and faults in Sections 1.33, Gifts, and 1.34, Faults. The players can then create characters with a minimum of hassle.
For more detail, the GM can actually create templates of character “classes.” As an example familiar to many gamers, the GM may have guidelines for players wishing to play a fantasy fighter character, or magician, or cleric, or thief, etc. The GM can set up minimum attribute standards for each character class, recommended gifts, and minimum skill levels.
Templates can be set up for any genre, not just fantasy. You may have guidelines for a typical scientist character, or policeman, or psychic phenomenon investigator, or King’s Musketeer, etc.
See Section 6.4, Class and Racial Template Examples.
A different type of template shows the player the native abilities and limitations of a fantasy or science fiction race. See the sample character Seihook (Section 6.342), for a science fiction race, and Section 6.43, Cercopes, for a fantasy race.</pre>
</div>
<div title="6.2 Character Sheet Example" creator="JonasSusara" modifier="JonasSusara" created="201010230740" changecount="1">
<pre>A character sheet can be any scrap paper, of course. However, it’s handy to include the Trait Level progression and GM starting limits, if any, such as 1 Superb skill, 3 Great skills, magic available, etc.

Sample character sheets may be found online at http://www.fudgerpg.com/fudge and other sources. Many other character sheet designs are possible. 
Refer to the Cost of Skills table for Objective Character Creation when creating characters using the objective system.
</pre>
</div>
<div title="6.3 Character Examples" creator="JonasSusara" modifier="JonasSusara" created="201010230745" modified="201010231246" changecount="3">
<pre>The following characters are designed to different GM standards to show some of the many possibilities. Each character example includes the GM guidelines used. All but the last one are made with the Objective Character Creation system, though all are compatible with the Subjective Character Creation system, of course. Easy and hard skills are denoted as such. (In the Objective Character Creation system, it costs less to get an easy skill at a given level, and more for a hard skill.) Skills that have defaults of non-existent and cost one level just to get at Terrible are listed as: Telepathy (VH). These are usually skills that control Supernormal Powers.
The numbers in parentheses after trait levels are the Objective level costs, and are optional on any given character sheet (but make it easy to tally).
Some characters have a separate Damage Capacity attribute; others have Damage Capacity represented by some other attribute, such as Strength, Health, Body, Constitution, Physical, etc.
Most of the gifts and faults were chosen with an eye towards variety, for purposes of example. Of course, if you use these characters, feel free to change any of the traits.

!6.31  Fantasy Characters
Brogo, Floranna, and Moose have some magic abilities, using the sample Fudge Magic system found in the Addenda. Brogo is just a dabbler in magic, and Moose is only slightly better. Floranna is a full magician, however.

!!6.311  Brogo the Scout, Halfling

GM limits: Eight attributes (four free levels); 50 free skill levels, with maximum of one Superb, three Greats; two free gifts; magic available.
Note: spell-casting is equal to Coolness –2 in this game, with a maximum level of Fair — no Spell-casting skill need be bought. Also, Magic Potential isn’t limited to a specific effect in this game: Brogo can try for any effect, except as limited by his fault. “Halfling” is defined under Brogo’s faults.

Attributes
(Four free levels, ten levels taken,balanced by three faults)
Coolness:	Good	(1)
Damage Capacity:	Good	(1)
Dexterity:	Great	(2)
Empathy:	Good	(1)
Health:	Good	(0)
		[Halfling Fair]
Intelligence:	Good	(1)
Perception:	Superb	(3)
Strength:	Good	(1)		[Scale –2]

Skills
(50 free levels, 50 taken)
Area Knowledge
	large area (easy):	Good	(2)
Bow:	Good	(3)
Climbing:	Good	(3)
Elvish Language(hard):	Mediocre	(2)
Evaluate Goods:	Fair	(2)
Farming (easy):	Fair	(1)
Fellowship:	Great	(4)
Find Secret Passages:	Terrible	(–1)
First Aid:	Good	(3)
Haggle:	Good	(3)
Interrogation:	Terrible	(–1)
Knowledge of Old Tales:	Fair	(2)
Lockpicking:	Terrible	(–1)
Mimic AnimalNoises (hard):	Great	(4)
Move Quietly:	Superb	(5)
Orcish Language:	Fair	(2)
Pickpocketing:	Terrible	(–1)
Riding: Pony:	Fair	(2)
Staff:	Good	(3)
Storytelling:	Good	(3)
Survival:	Good	(3)
Tracking:	Good	(3)
Wildcraft:	Great	(4)

Gifts
(Two free gifts, four taken,balanced by faults)
Absolute Direction; Animal Empathy; Lucky; Night Vision

Supernormal Powers
(One taken, balanced by two faults)
Magic Potential, one level

Faults
Can only cast trivial spells; Curious; Glutton; Humanitarian (helps the needy for no pay); Self-defense Pacifist; Halfling (Scale –2, Racial Bonus to Health, counts as two faults)

!!6.312  Floranna, Elven Magician

GM limits: Two attributes (one free level); 50 free skill levels, with maximum of one Superb, three Greats; four free gifts; magic available.
Note: There are two separate Spell-casting skills, and the GM allows them to be raised above Fair at a rate of one gift per skill level. It costs four levels to get “Spell Casting on Others” at Fair, then six more levels to get it at Good, since one gift = 6 skill levels.

Attributes
(One free level, one taken)
Material:	Mediocre	(–1)
Spiritual:	Great	(2)


Skills
(50 free levels, 32 taken,the rest traded for three gifts)
Acrobatics/Athletics:	Mediocre	(1)
Animal Skills:	Good	(3)
Camaraderie:	Mediocre	(1)
Combat Skills:	Poor	(0)
Courtly Ways:	Poor	(0)
Cultural Knowledge:	Good	(3)
Doctoring:	Great	(4)
Manipulate People:	Poor	(0)
Move Quietly/Gracefully:	Fair	(2)
Scientific Knowledge:	Mediocre	(1)
Spell Casting on Others (VH):	Good	(10)
Spell Casting on Self (VH):	Fair	(4)
Thievery:	Terrible	(–1)
Woodland Ways/Nature Lore:	Great	(4)

Gifts
(Four free gifts, none taken)
Supernormal Powers
(Six taken, balanced by faults, reduced gifts, and reducedskill levels)
Elf: extended lifespan, animals (not monsters) react well to her, Perception = +1 to Material attribute
Magic Potential, White Magic, Five levels

Faults
Absent-Minded
Heart of gold – any halfway skillful liar can get sympathy &amp; help
Idealist – not grounded in reality
Melancholy
Zealous behavior – tries to dissuade others from violence

!!6.313  Moose the Mage, Human Combat Magician
GM limits: Six attributes (three free levels); 30 free skill levels, with maximum of one Superb, three Greats; two free gifts; magic available.
Note: Moose’s Spell-casting skill costs double levels because of his low Intelligence attribute. It would also take double EP to raise.

Attributes
(Three free levels, four levels taken, balanced by a fault)
Charisma:	Poor	(–2)
Dexterity:	Great	(2)
Drive:	Good	(1)
Health:	Great	(2)
Intelligence:	Mediocre	(–1)
Strength:	Great	(2)

Skills
(30 free levels, 36 taken,balanced by a fault)
Armory:	Good	(3)
Brawling: 	Great	(4)
Breaking andEntering:	Terrible	(–1)
Climbing:	Fair	(2)
Crafts:	Fair	(2)
Flirtatious Skills:	Terrible	(–1)
Knowledge of Old Tales:	Terrible	(–1)
Merchant:	Mediocre	(1)
Riding:	Good	(3)
Shield:	Great	(4)
Singing:	Terrible	(–1)
Spell-Casting (VH):	Mediocre	(6)
Stealth:	Good	(3)
Storytelling:	Terrible	(–1)
Sword:	Superb	(5)
Tactics:	Good	(3)
Throwing:	Great	(4)
Woodcraft:	Mediocre	(1)

Gifts
(Two free gifts, two taken)
Combat Reflexes; Affluent Wealth (good equipment)
Supernormal Powers
(2 taken, balanced by faults)
Magic Potential, Combat spells, two levels

Faults
Blunt and tactless — doesn’t mince words; Fear of the Dark; Full of bluff and bluster and machismo to hide inadequacy feelings (he’ll never live up to the impossibly heroic image of his father); Quick-Tempered; No patience with fools or knaves; Spell-casting skill costs double due to low IQ; Vow: Destroy the brigand band that killed his father

!!6.314  Tarag Half-Ogre
GM limits: Three attributes (three free levels); ten free skill levels, with maximum of one Superb, two Greats; three free gifts; magic available. Half-Ogre is Scale 3.

Attributes
(Three free levels, two taken,one traded for three skill levels)
Body:	Good	Scale 3	(1)
Mind:	Mediocre	(0)	[Half-Ogre Fair]
Psyche:	Good	(1)

Skills
(Ten free levels, 13 taken, balanced by low attributes)
Animal Skills:	Fair	(2)
Artistic Skills:	Terrible	(–1)
Balance Skills:	Good	(3)
Medical Skills:	Terrible	(–1)
Melee Weapons:	Superb	(5)
Merchant Skills:	Terrible	(–1)
Outdoor Skills:	Good	(3)
Ranged Weapons:	Good	(3)
Social Skills:	Terrible	(–1)
Technical Skills:	Terrible	(–1)
Thief Skills:	Terrible	(–1)
Unarmed Combat:	Good	(3)

Gifts
(Three free gifts, three taken)
Quick Reflexes; Peripheral Vision — no penalty facing two foes at once; Tough Hide (–1 to damage)

Supernormal Powers
(1.5 taken, balanced by faults)
Half-Ogre (Body Scale 3, Mind at –1); Anti-Magic Aura — spells cast on her are at –1 (counts as only 1 gift because it also interferes with beneficial spells)

Faults
Goes Berserk if Hurt — liable to attack friends; Gullible; Poor (not much equipment)

!6.32  Historical Fiction Characters

!!6.321  Hakim al-Saari, Thief of Baghdad, 792 A.D.
GM limits: Four attributes (two free levels); 35 free skill levels, with maximum of one Superb, one Great; one free gift; no supernormal powers available.

Attributes
(Two free levels, four taken, balanced by fault)
Brawn:	Mediocre	(–1)
Cunning:	Good	(1)
Deftness:	Superb	(3)
Ego:	Good	(1)

Skills
(35 free levels, 47 taken, balanced by two faults)
Acrobatics: 	Good	(3)
Assess Merchandise: 	Good	(3)
Begging: 	Fair	(2)
Climbing: 	Good	(3)
Disguise: 	Fair	(2)
Dodge: 	Good	(3)
Knife: 	Mediocre	(1)
Knowledge of Baghdad: 	Good	(3)
Lockpicking: 	Good	(3)
Lying: 	Good	(3)
Pick Pockets: 	Good	(3)
Quote the Koran
	and Arab proverbs: 	Mediocre	(1)
Running: 	Fair	(2)
Servant: 	Mediocre	(1)
Stealth: 	Superb	(5)
Storytelling: 	Fair	(2)
Urban Survival: 	Great	(4)
Witty Insults:	Good	(3)

Gifts
(One free gift, three taken, balanced by faults)
Healthy Constitution (+1 to Brawn to recover from illness); Keen senses (+1 to Cunning to notice something); Many people owe him favors

Faults
Can’t resist having the last word; Greedy; Many people would love to turn him in to the authorities; Soft-hearted toward children; Boasts openly of his thieving abilities

!!6.322  Arian o Gwent, Welsh Archer, 1190
A Norman conqueror murdered Arian’s family under the guise of a flag of truce. When Arian slew him in vengeance, she was outlawed from Wales. Escaping north, the embittered Arian is about to join Robin Hood’s outlaw Saxon band and introduce into England a new Welsh invention, the longbow….
GM limits: Six attributes (four free levels); 30 free skill levels, with maximum of one Superb, two Great; two free gifts; no supernormal powers available; must take two faults: Outlaw &amp; Loyal to Companions, which do not count as trading for other traits.

Attributes
(Four free levels, four taken)
Calmness: 	Mediocre	(–1)
Constitution: 	Fair	(0)
Dexterity: 	Great	(2)
Reasoning: 	Good	(1)
Senses: 	Great	(2)
Strength: 	Fair	(0)

Skills
(30 free levels, 36 taken,balanced by one fault)
Acrobatics: 	Good	(3)
Archery: 	Superb	(5)
Bowyer: 	Great	(4)
Climbing: 	Good	(3)
Disguise: 	Good	(3)
Dodge: 	Good	(3)
Fletcher: 	Good	(3)
Move Quietly: 	Great	(4)
Riding: 	Good	(3)
Tactics: 	Fair	(2)
Woodcraft: 	Good	(3)

Gifts
(Two free gifts, three taken, balanced by fault)
Literate — in 1190, this is rare enough to be called a gift; Attractive; +3 Calmness while shooting a bow

Faults
Outlaw; Loyal to Companions; Speaks English with a strong Welsh accent; Despises Normans — Fair Calmness roll to avoid acting rashly

!!6.323  Henri le Rouge, Musketeer of King Louis XIII, 1627
GM limits: since this is a cinematic campaign without magical or SF healing, the GM has set higher limits: Nine attributes (eight free levels); 60 free skill levels, with maximum of two Superb, five Greats; three free gifts; no supernormal powers available

Attributes
(Eight free levels, twelve taken, balanced by faults)
Charm: 	Great	(2)
Coolness: 	Superb	(3)
Damage Capacity: 	Great	(2)
Dexterity: 	Great	(2)
Health: 	Good	(1)
Perception: 	Fair	(0)
Strength: 	Fair	(0)
Will: 	Fair	(0)
Wit: 	Great	(2)

Skills
(60 free levels, 72 taken, balanced by two faults)
Acrobatics: 	Superb	(5)
Acting: 	Good	(3)
Boating: 	Terrible	(–1)
Brawling: 	Good	(3)
Carousing: 	Good	(3)
Climbing: 	Great	(4)
Disguise: 	Good	(3)
Dodge: 	Good	(3)
Engineer: 	Terrible	(–1)
Fencing: 	Superb	(5)
First Aid: 	Good	(3)
Flirting: 	Good	(3)
Knowledgeof Europe: 	Mediocre	(1)
Knowledge of France: 	Good	(3)
Knowledge of Paris: 	Good	(3)
Knowledge of Planet: 	Mediocre	(1)
Lockpicking: 	Terrible	(–1)
Main Gauche: 	Great	(4)
Matchlock Musket: 	Good	(3)
Mechanic: 	Terrible	(–1)
Move Quietly: 	Good	(3)
Political Knowledge: 	Fair	(2)
Quick-Draw Sword (easy): 	Good	(2)
Oratory: 	Mediocre	(1)
Repartee: 	Great	(4)
Riding: 	Great	(4)
Savoir-Faire: 	Good	(3)
Shadowing: 	Fair	(2)
Swimming: 	Terrible	(–1)
Tactics: 	Good	(3)
Wheellock Pistol: 	Good	(3)

Gifts
(Three free gifts, five taken, balanced by faults)
Combat Reflexes; Handsome; Patron: Captain of Musketeers; Rapid Healing; Status: Gentleman

Faults
Code of Honor; Compulsive Carouser; Disgusted by Non-Gourmet Food; Extremely Loyal to Companions; Intolerant of Protestants; Thin-skinned — quick to take offense

!!6.324  Scruffy Sanders,Stagecoach Driver,1870s, Western U.S.A.
GM limits: Five attributes (three free levels); 30 free skill levels, with maximum of one Superb, two Great; two free gifts; no supernormal powers available; minimum one fault that doesn’t count for trading. Scruffy traded his one Superb skill limit for two extra Greats, so he has four Great skills, and no Superb skills.

Attributes
(Three free levels, three taken)
Agility: 	Mediocre	(–1)
Health: 	Good	(1)
Perception: 	Good	(1)
Savvy: 	Great	(2)
Strength: 	Fair	(0)

Skills
(35 free levels, 53 taken, balanced by three faults)
Area Knowledge,
	Western States: 	Good	(3)
Bluffing: 	Great	(4)
Brawling: 	Fair	(2)
Concertina (Squeezebox): 	Good	(3)
Dodge: 	Good	(3)
First Aid: 	Good	(3)
Holds His Liquor: 	Good	(3)
Hunting: 	Good	(3)
Move Quietly: 	Good	(3)
Pistols: 	Fair	(2)
Riding: 	Good	(3)
Shotgun: 	Great	(4)
Singing: 	Good	(3)
StagecoachMechanic: 	Good	(3)
Tall Tales: 	Good	(3)
Teamster: 	Great	(4)
Witty Insults: 	Great	(4)

Gifts
(Two free gifts, two taken)
Never forgets a face; Sense of empathy; gets a feel for people

Faults
Garrulous; Addiction to disgusting habit: spitting chewing tobacco; Lazy — would “rather talk than do;”Getting old, and all that implies….

!6.33  Modern Characters

!!6.331  Dolores Ramirez, Journalist, 1990s
GM limits: Ten attributes (five free levels); 50 free skill levels, with maximum of one Superb, four Greats; two free gifts; limited Psi available.
Note: The player forgot an important skill for Dolores, and one a journalist would logically have: Research. This was noticed during a game, and the player petitioned the GM to add Research as an Uncommitted trait. The GM agreed, and [Research: Good] was added to Dolores’ character sheet. Dolores already had one Superb and four Great skills, so this is the best she could start with it. This does not count against starting free levels — Uncommitted traits are extra.

Attributes
(Five free levels, seven taken, balanced by fault)
Appearance: 	Good	(1)
Constitution: 	Good	(1)
Coolness: 	Good	(1)
Damage Capacity: 	Good	(1)
Dexterity: 	Fair	(0)
Intelligence: 	Great	(2)
Luck: 	Good	(1)
Sanity: 	Great	(2)
Strength: 	Poor	(–2)
Will: 	Fair	(0)

Skills
(50 free levels, 56 taken, balanced by fault)
Acrobatics: 	Fair	(2)
Acting: 	Great	(4)
Breaking &amp; Entering: 	Good	(3)
Climbing: 	Fair	(2)
Computer Use: 	Good	(3)
Criminology: 	Mediocre	(1)
Disguise: 	Great	(4)
Driving: 	Good	(3)
Interviewing: 	Great	(4)
Karate (hard): 	Fair	(3)
Mexican Cuisine: 	Mediocre	(1)
Move Quietly: 	Good	(3)
Occultism: 	Good	(3)
Photography: 	Good	(3)
Pistol: 	Good	(3)
Shadowing: 	Great	(4)
Shady Contacts: 	Good	(3)
Swimming: 	Fair	(2)
Writing: 	Superb	(5)

Gifts
(Two free Gifts, four taken, balanced by faults)
Ambidextrous; Beautiful speaking voice; Danger Sense; Never forget a name

Faults
Overconfident; Ambitious; Stubborn; Vain

!!6.332  Sherman Foley,homeless person and scanner, modern day
By: Bernard Hsiung

GM limits: no specified attributes — free levels = 1/2 of number of attributes taken; 50 free skill levels, with maximum of one Superb, four Greats; two free gifts; semi-limited Psi
Note: Sherman’s player only chose four attributes when the GM gave free rein: Sherman has any unlisted attribute the GM considers essential at Fair.

Attributes
(Four attributes selected: 
two free levels, two taken)
Damage Capacity: 	Mediocre	(–1)
Health: 	Mediocre	(–1)
Perception: 	Great	(2)
Willpower: 	Great	(2)

Skills
(50 free levels, 44 taken, six used to balance one gift)
Area Knowledge
	inner city (easy): 	Great	(3)
Area Knowledge, Earth: 	Mediocre	(1)
Begging: 	Fair	(2)
Climbing: 	Terrible	(–1)
Drinking: 	Good	(3)
Driving: 	Terrible	(–1)
Forage: 	Good	(3)
Knife: 	Mediocre	(1)
Knowledge, Phobias (hard): 	Good	(4)
Meditation: 	Good	(3)
Sewing: 	Mediocre	(1)
Stealth/Urban: 	Fair	(2)
Street Gossip: 	Good	(3)
Survival/Urban: 	Great	(4)
Use  MindControl VH): 	Great	(6)
Use Telepathy (VH): 	Good	(5)
Use Telekinesis (VH): 	Good	(5)

Gifts
(Two free gifts, none taken)

Supernormal Powers
(Three taken, balanced by faults,reduced gifts, and reduced skills)
Mind Control; Telepath; Telekinetic

Faults
Use of Psi Requires Immobile Concentration; Materially Poor; Unlucky

!!6.333  Dragonfly (James Stoddard), Secret Superhero
GM limits: Seven attributes (four free levels); 50 free skill levels, with maximum of two Superb, six Greats; two free gifts; four free Superpowers

Attributes
(Four free levels, eight taken, balanced by faults)
Damage Capacity: 	Fair	(0)
Dexterity: 	Great	(2)
Health: 	Good	(1)
Intelligence: 	Great	(2)
Intuition: 	Great	(2)
Speed: 	Good	(1)
Strength: 	Fair	(0)

Skills
(50 free levels, 56 taken, balanced by fault)
Acrobatics: 	Great	(4)
Acting: 	Good	(3)
Bureaucracy: 	Fair	(2)
Computer Use: 	Great	(4)
Control Superpower
	(Electron Flow) VH): 	Superb	(7)
Control Superpower
	(Flight) (VH): 	Good	(5)
Criminology: 	Good	(3)
Disguise: 	Good	(3)
Dodge: 	Great	(4)
Driving: 	Good	(3)
Electronics Engineering
	Computers (hard): 	Great	(5)
Japanese Language: 	Great	(4)
Judo (hard): 	Great	(5)
Singing: 	Terrible	(–1)
Stealth: 	Superb	(5)

Gifts
(Two free gifts, three taken, balanced by a fault)
Perfect Timing; Good Looking; Tough Hide (–1 to damage)

Supernormal Powers
(Four free Superpowers, four taken)
Control Inanimate Electronic Devices; Shrink to 1” (25 mm) for up to an hour, two times/day (Scale = –10); Fly, only while 1” (25 mm) high; Electrical Surge (Short-out Machines)

Faults
Ethically unable to use Powers to get out of massive debt; Quixotic — always looking for wrongs to right; Phobia of animals bigger than a collie;Socially awkward (bit of a nerd)

!6.34  Science Fiction Characters

!!6.341  Captain Wallop of the Space Patrol
This character is from a cinematic Space Opera campaign, so the limits are high.
GM limits: Four attributes (four free levels); 50 free skill levels, with maximum of one Superb, three Greats, eight Goods; two free gifts; one free Supernormal power, subject to GM approval

Attributes
(Four free levels, six taken, balanced by fault):
Body: 	Good	(1)
Reason/Mechanical: 	Great	(2)
Perceive/React: 	Superb	(3)
Willpower: 	Fair	(0)

Skills
(50 Free levels, 56 taken, balanced by fault)
Acrobatics: 	Good	(3)
Acting/Disguise: 	Great	(4)
Barroom Savvy: 	Good	(3)
Blaster: 	Superb	(5)
ComputerOperation: 	Fair	(2)
Diplomacy: 	Good	(3)
Electronics: 	Good	(3)
Familiarity with
	Major Planetary Systems: 	Good	(3)
Gunnery: 	Great	(4)
Haggle: 	Fair	(2)
Hard Sciences: 	Fair	(2)
Mimicry: 	Mediocre	(1)
Navigation: 	Good	(3)
Pick Up Languages: 	Fair	(2)
Piloting: 	Great	(4)
Repair Scoutship Systems: 	Good	(3)
Stealth: 	Great	(4)
Unarmed Combat: 	Fair	(2)
Zero-GManeuvering: 	Good	(3)

Gifts
(Two free gifts, four taken, balanced by faults)
Handsome; Reputation as Hero; Never disoriented in zero Gravity; Rank of Captain in the Space Patrol

Supernormal Powers
(One free Supernormal power, one taken)
Able to key in on one mind up to a mile (1.5 km) away and follow the trail on Good Situational roll or better every 15 minutes.

Faults
Amorous heartbreaker — love ’em and leave ’em; Bravery indistinguishable from foolhardiness; Fanatic patriot; Must obey senior officers in the Space Patrol

!!6.342  Seihook — Alien from Aldebaran
The erlesti are a non-humanoid race from the star system Aldebaran. An erlest resembles a collection of animated twine and moss-covered rock. It digests the moss through its “skin” — but to a human observer, the moss appears to be digesting the erlest. Erlesti can also use the “twine” pieces as straws to drink fluids — alcohol affects them as it does humans. While erlesti have nothing resembling hands, they have strong psi powers that enable them to manipulate their environment and even travel space.

Erlesti are friendly with humanity — “interesting auras,” they say, “always interesting.” In general, they are bewildered by red tape, dislike war, value their families above all things, and like comfort, but don’t seek extreme wealth.

Their Damage Capacity is determined by their Size attribute (their small size and increased density balance out to the same Scale as humans); Perception is determined by Empathy Skill, which they say extends to inanimate objects, and refuse to use any other word to describe the ability. Psi attributes rate raw strength; psi skills fine manipulation of that strength. Erlesti are hermaphroditic (they exchange “twine” with each other to procreate), so Seihook is both male and female.

GM limits: Eight attributes (five free levels); 40 free skill levels, with maximum of one Superb, three Greats; two free gifts; Supernormal Powers count as attributes — no extra cost.

Attributes
(Five free levels, seven taken, balanced by fault):
Empathy Power: 	Fair	(0)
Levitation Power: 	Good	(1)
Reasoning: 	Great	(2)
Reaction: 	Fair	(0)
Size: 	Good	(1)
	(size of 4-year old human)
Telekinesis Power: 	Great	(2)
Telepathy Power: 	Good	(1)
Will: 	Fair	(0)
Skills
(40 Free levels, 40 taken)
Bar Etiquette: 	Fair	(2)
Barter: 	Great	(4)
Empathy Skill: 	Great	(4)
Folklore: 	Fair	(2)
Hard Sciences: 	Mediocre	(1)
History: 	Fair	(2)
Knowledge of Alien (including
	Human) Customs: 	Good	(3)
Levitate Other: 	Fair	(2)
Levitate Self: 	Superb	(5)
Medical Skills: 	Good	(3)
Psychology: 	Great	(4)
Telekinesis Skill: 	Good	(3)
Telepathy, Dampen Thoughts: 	Poor	(0)Read Thoughts: 	Fair	(2)Project Thoughts: 	Good	(3)

Gifts
(Two free gifts, four taken, balanced by faults)
Can’t feel physical pain (no penalty for being Hurt or Very Hurt); Animals do his bidding in simple, non-threatening matters on a Great Empathy Power roll or better; Tolerant of Appearances — Never disgusted by any alien form; Wealthy (for an Erlest)

Fault
Practical Joker (for example, loves to “speak” in bad accents in thought projection); Gossip; Coward — fears death

!!6.343  Screamer (Frederick Grant); Occupation: Decker
Cyberpunk character by: Stephan Szabo
GM limits: Seven attributes (three free levels); 30 free skill levels, with maximum of one Superb, four Greats; two free gifts; Cybernetic enhancements count as gifts, not supernormal powers.

Attributes
(Three free levels, five taken, balanced by fault):
Body: 	Good	(1)
Charisma: 	Poor	(–2)
Intelligence: 	Superb	(3)
Quickness: 	Good	(1)
Reaction: 	Great	(2)
Strength: 	Fair	(0)
Willpower: 	Fair	(0)

Skills
(30 Free levels, 30 taken)
Computer Build/Repair: 	Great	(4)
Programming: 	Superb	(5)
Computer Theory: 	Great	(4)
Cycle: 	Fair	(2)
Electronics: 	Great	(4)
Firearms: 	Great	(4)
Matrix Etiquette: 	Good	(3)
Street Etiquette: 	Fair	(2)
Unarmed Combat: 	Fair	(2)

Gifts
(Two free gifts, six taken, balanced by faults)
Cybernetics, Datajack; Cybernetics, Can multitask cognitive processes; Cybernetics, Thermographic Vision; Cybernetics, Flash Compensation; Cybernetics, Telescopic Sight; Lucky

Faults
Bloodlust; Doesn’t care if he lives or dies; Manic/Depressive; Multiple Personality; Overconfident

!!6.344 Jard Melloch, Interstellar Gem Merchant
GM limits: Three Attributes, but the default for Psi is Poor (two free levels), 15 free skill levels, two free gifts, two faults required.

Attributes
(Two free levels, one taken, traded for three skill levels):
Mind: 	Great	(2)
Body: 	Mediocre	(–1)
Psi: 	Poor	(0)

Skills
(15 Free levels, 18 taken, balanced by low attributes)
Merchant Skills:	Great	(4)
Knowledge ofGem Trade:	Good	(3)
Fellowship Skills:	Good	(3)
Observation:	Good	(3)
Bluffing:	Fair	(2)
Xeno-Etiquette:	Fair	(2)
Xeno-Archaeology:	Mediocre	(1)

Gifts
(Two free gifts, two taken)
Wealthy; Never Forgets a Face

Faults
(Two required, two taken)
Code of Honor: honestly assess gem quality; Fat

!6.35  Miscellaneous Characters

!!6.351  Fan Yin Wong, Ghost
Fan Yin is from a campaign where all the PCs are ghosts with low karma levels. She must do a number of good deeds before she can risk being reborn again, but her ability to influence the material world is limited.

GM limits: Twelve attributes (six free levels); 25 free skill levels, with maximum one Superb, two Great; no free gifts, but six Supernormal Powers, with constraint on the number of uses per day; two personality faults required, do not count for trading purposes.

Note: the supernormal powers are described with “uses per day” and skill levels. The default skill level is Poor; it takes one gift to raise a supernormal power each level above Poor.

Attributes
(Six free levels, four taken, balance taken as six skills)
Appearance: 	Great	(2)
Charisma: 	Fair	(0)
Dexterity: 	Good	(1)
Fitness: 	Good	(1)
Mechanical Aptitude: 	Poor	(–2)
Mind: 	Fair	(0)
Perception: 	Superb	(3)
Reflexes: 	Good	(1)
Sanity: 	Mediocre	(–1)
Strength: 	Fair	(0)
Will: 	Fair	(0)
Wisdom: 	Mediocre	(–1)

Skills
(25 free levels, 31 taken, balanced by attribute levels)
Accounting: 	Good	(3)
Animal Care: 	Fair	(2)
Area Knowledge (easy): 	Good	(2)
Athletics: 	Poor	(0)
Bargain: 	Good	(3)
Computer Use: 	Fair	(2)
Driving: 	Fair	(2)
Folklore: 	Fair	(2)
Knowledge of
	Detective Fiction: 	Great	(4)
Lying: 	Fair	(2)
Move Quietly: 	Mediocre	(1)
	(vs. other spirits)
Outdoor Skills: 	Mediocre	(2)
Sciences: 	Mediocre	(1)
Women’s Magazine Lore: 	Superb	(5)

Gifts
(No free gifts, two taken, balanced by faults)
“Green thumb” — knack for making plants healthy (even as a ghost!); Single-minded — +1 to any lengthy task

Supernormal Powers
(Six free Supernormal Powers, five taken. One traded, plus two Faults taken, to raise these four levels)
Pass through Walls (6/day):	Fair
Screech (temporarily paralyze multiple living people) (3/day): 	Mediocre
Affect Dreams (1/day): 	Poor
Control Vermin (3/day): 	Poor
Read Minds (4/day): 	Mediocre

Faults
Fear of spiders (even as a ghost); Worry Wart; Waffles — can’t make decisions until forced to; Obsessed with regrets over missed opportunities

!!6.352  Cassandra Pine, Vampire Private InvestigatorModern vampire character
by Deird’Re Brooks
GM limits: Ten Attributes (five free levels), 60 free skill levels, with maximum of one Superb, four Greats, two free gifts, three free supernatural powers.

Attributes
(Five free levels, Seven taken, balanced by fault)
Appearance: 	Fair	(0)
Charisma: 	Fair	(0)
Dexterity: 	Great	(2)
Humanity: 	Mediocre	(–1)
Intelligence: 	Good	(1)
Perception &amp; Alertness: 	Great	(2)
Stamina: 	Good	(1)
Strength: 	Fair (Scale 3)	(0)
Willpower: 	Good	(1)
Wits: 	Good	(1)

Skills
(60 free levels, 60 taken)
Animal Handling: 	Mediocre 	(1)
Area Knowledge
	home city (easy): 	Good	(2)
Athletics: 	Fair	(2)
Computer: 	Fair	(2)
Control Power: Mind Control (VH): 	Fair	(4)
Control Power:
	Psychometry (VH): 	Fair	(4)
Dodge: 	Good	(3)
Driving: 	Good	(3)
Electronic Security: 	Great	(4)
Firearms: 	Good	(3)
Intimidation: 	Good	(3)
Investigation: 	Superb	(5)
Knife: 	Fair	(2)
Language: 	Spanish: Mediocre	(1)
Law &amp; Police Procedure (hard): 	Fair	(3)
Research: 	Great	(4)
Stealth: 	Good	(3)
Streetwise: 	Great	(4)
Subterfuge: 	Good	(3)
Tae Kwon Do (hard): 	Good	(4)

Gifts
(Two free gifts, two taken)
Contacts in police force; Night Vision

Supernormal Powers
(Three free Powers, eight taken, balanced by faults)
Extraordinary Speed; Can change into Mist Form; Mind Control; Only immobilized by stake through heart; Psychometry; Regeneration; Scale 3 (unobservable); Can change into Wolf Form

Faults
Burns heal slowly; Low financial resources; Mind control needs eye contact; Must sleep most of the daylight hours; Violent when enraged
Note: The following three faults count as two faults each: Burned by Sun; Needs blood to live; Dangerous Secret — she’s destroyed if it’s revealed

!!6.353  Chicory, Bunny
Chicory is a character in a game where rabbits are the norm, and humans are giant monsters. The scale is therefore relative to rabbits.
GM limits: Six attributes (three free levels); 40 free skill levels, with maximum one Superb, three Great; two gifts, one Supernormal Power

Attributes
(Three free levels, seven taken, balanced by faults)
Dexterity: 	Good	(1)
Health: 	Good	(1)
Perception: 	Superb	(3)
Smarts: 	Great	(2)
Speed: 	Good	(1)
Strength: 	Mediocre	(–1)

Skills
(40 free levels, 52 taken, balanced by faults)
Acrobatics: 	Terrible	(–1)
Area Knowledge: 	Good	(3)
Detect Traps: 	Great	(4)
Fighting: 	Good	(3)
Gambling: 	Good	(3)
Herb Lore (hard): 	Superb	(6)
Knowledge of Burrow Construction: 	Good	(3)
Knowledge of
	Humans (VH): 	Fair	(4)
Knowledge of Non-Rabbit Behavior: 	Good	(3)
Language:
	Bug: (H) 	Fair	(3)
	Common Bird
	 (H): 	Good	(4)
	Mouse/Rat (H): 	Great	(5)
Mechanical Skills: 	Terrible	(–1)
Mimic Non-Rabbit Sounds (H): 	Fair	(3)
Move Quietly: 	Fair	(2)
Spring Traps: 	Fair	(2)
Storytelling: 	Fair	(2)
Tracking: 	Great	(4)

Gifts
(Two free gifts + one Supernormal Power; four gifts taken,  balanced by not taking a Power.)
Unafraid of Loud Noises (unlike most rabbits); Never Forgets a Scent; Strong Will; Night Vision

Faults
Nosy; Compulsive Gambler; Phobia: Canines; Jealous of Anyone Getting More Attention


!!6.354  Squeegee Fizzle, Cartoon Chimp
Squeegee is a time- and space-hopping chimpanzee in a universe without physical laws as we know them. Real loose rules on this one, folks! There is no death in cartoons: get your characters to a Heal-O-Ray machine and they’ll be fine.
GM limits: Three Supernormal Powers allowed, at least four faults required; otherwise: no limits — take what you want, and we’ll talk about it

Attributes
(no limit; seven levels taken, anything else at Fair)
3-D Agility: 	Good	(1)
Cheek: 	Great	(2)
Imagination: 	Superb	(3)
Nose: 	Good	(1)
Notices Things: 	Great	(2)
Patience: 	Poor	(–2)
Resistance to Alien Stuff: 	Good	(1)
Willpower: 	Mediocre	(–1)

Skills
(no limit, 37 taken)
Acrobatics: 	Good	(3)
Area Knowledge
	of the Known Universe: 	Good	(3)
Fruit Lore: 	Superb	(5)
History: 	Mediocre	(1)
Language, Most Alien: 	Fair	(2)
Make Silly Noises: 	Superb	(5)
Make the Sound of
	One Hand Clapping: 	Fair	(2)
Mechanical Skills: 	Terrible	(–1)
Move Quietly: 	Great	(4)
Pilot Space Ship: 	Mediocre	(1)
Recall of TV SitCom Episodes: 	Superb	(5)
Tell Believable Whoppers: 	Fair	(2)
Throw Things: 	Good	(3)
Tooth-and-Nail Fighting: 	Good	(3)
Zap-O-Stun Gun: 	Great	(4)

Gifts
(no limit, lots taken)
Always keeps his cool… well, usually; Never Forgets a Banana; Acrobatics skill is Superb for Swinging; no penalty to other skills while Swinging; Doesn’t value Sanity highly

Supernormal Powers
Quadridextrous; Never lost in space; Can think of a Devastating Comeback (stuns opponent five rounds), on a Superb or better Cheek (attribute) die roll

Faults
Easily Distractible; Compulsive Liar; Will do anything for a banana; Enemy out to get him: Evil Scientist, Dr. Carnage

!!6.355 Chipaway Fiddlesticks, Gatecrasher Gnome from Saturn’s Rings
by Ann Dupuis
Note: Chip was created using the Objective Character Creation system presented in Gatecrasher (2nd Edition). The term “Gatecrasher” is designated as Product Identity as defined in the Open Game License Version 1.0a, section 1. For more information on the Gatecrasher roleplaying game, please see http://www.domibia.com/.

Attributes
Awareness:	Mediocre
Constitution:	Good
Dexterity:	Great
Id:	Good
Reason:	Good
Strength:	Fair (Scale –1)
Secondary Attributes:
Magic Points:	37
Magical Effect:	–3
Move:	Good
Damage Capacity:	Fair

Skills
Area Knowledge
	(Saturn’s Rings):	Good
Body Language	Fair
Bureaucracy:	Fair
Computer Operation:	Fair
Diplomacy:	Good
Fast-Talk:	Great
Law (Commerce):	Fair
Lie:	Fair
Jury-Rigging:	Mediocre
Management:	Fair
Mathematics:	Fair
Navigation:	Great
Pilot Freighter:	Great
Pilot Shuttlecraft:	Good
Sales:	Superb
Sleight of Hand:	Fair
Streetwise:	Fair

Gifts
Homeworld: Saturn’s Rings (Low Gravity, Tech +7, Wizardry +2) (no cost); Wealth; People Owe him Favors; Dexterity +1 (racial modifier)

Faults
Scale –1 (racial modifier); Practical joker (racial fault); Fascinated by shiny things (racial fault); Kleptomania (beyond even usual for a gnome); Ugly (even for a gnome); Soft-Hearted (especially towards children and puppies).

Supernatural Talents
Create Illusion; Invisibility; Levitation; Telepathy</pre>
</div>
<div title="6.4 Class and Racial Template Examples" creator="JonasSusara" modifier="JonasSusara" created="201010230748" modified="201010231241" changecount="3">
<pre>See also Section 6.342, Seihook, as an example of a science fiction racial template.

!6.41  Ranger Template(Fantasy Character Class)
See Section 6.12, Templates, for a discussion of character class templates. This is a sample template — the GM should customize to her own game, including adding or deleting attributes, gifts, skills, etc. The GM may allow a beginning character to be a ranger apprentice, rather than full ranger. An apprentice is one or two levels less than a full ranger in any given attribute or skill.

Ranger requirements
Attributes
Dexterity: 	Good or better
Intelligence: 	Fair or better
Perception: 	Good or better
Strength: 	Good or better

Gifts
None mandatory. Recommended gifts include Animal Empathy, Absolute Direction, Combat Reflexes, Night Vision, other combat gifts.

Faults
A ranger should not be the type of person who dislikes being alone. Some rangers work for the authorities, which might imply a Duty and/or a Vow of Obedience.

Skills
Area Knowledge: 	Fair or better
Bow: 	Good or better
Climbing: 	Fair or better
Mimic Animal Sounds: 	Fair or better
Move Quietly: 	Good or better
Riding: 	Fair or better
Scouting: 	Fair or better
	(the skill of observing and remembering)
Spear or Sword: 	Good or better
Survival: 	Good or better
Woods Lore: 	Good or better

!6.42  Broad Class Templates
For a loose and easy game, the GM can assign each character class levels for the broad skill example groups listed on page 126. This makes an ideal game for teaching role-playing to beginning players, or when playing with large numbers of players.
For example, the GM decides the players can be one of seven different character classes: Fighter, Ranger, Rogue, Magician, Cleric, Diplomat/Scholar, Jack of All Trades. Each of these characters can be defined as follows:

Beginning Fighter
Physical Attributes: 	Great
Mental Attributes: 	Mediocre
Psyche Attributes: 	Poor
Animal Skills: 	Mediocre
Athletic skills: 	Great
Combat skills: 	Great
Outdoor skills: 	Fair
Social skills (Fellowship): 	Fair
All other skills: 	Poor

Beginning Ranger
Physical Attributes: 	Good
Mental Attributes: 	Fair
Psyche Attributes: 	Poor
Animal Skills: 	Good
Athletic skills: 	Fair
Combat skills: 	Good
Covert skills: 	Fair
Craft skills: 	Fair
Outdoor skills: 	Great
All other skills: 	Poor

Beginning Rogue
Physical Attributes: 	Fair
Mental Attributes: 	Good
Psyche Attributes: 	Poor
Athletic skills: 	Fair
Combat skills: 	Mediocre
Covert skills: 	Great
Manipulative skills: 	Great
Merchant skills: 	Fair
Social skills (Fellowship): 	Mediocre
Urban skills: 	Good
All other skills: 	Poor

Beginning Magician
Physical Attributes: 	Poor
Mental Attributes: 	Good
Psyche Attributes: 	Fair
Craft skills: 	Mediocre
Knowledge skills: 	Fair
Spiritual skills: 	Fair
Supernormal Power skills: 	Great
All other skills: 	Poor
Gift	Supernormal Power

Beginning Cleric
Physical Attributes: 	Poor
Mental Attributes: 	Fair
Psyche Attributes: 	Great
Animal Skills: 	Fair
Craft skills: 	Mediocre
Knowledge skills: 	Fair
Medical skills: 	Good
Social skills (Formal): 	Good
Spiritual skills: 	Great
Supernormal Power skills: 	Fair
All other skills: 	Poor
Gift: 	Divine Favor

Beginning Diplomat/Scholar
Physical Attributes: 	Poor
Mental Attributes: 	Great
Psyche Attributes: 	Mediocre
Artistic skills: 	Mediocre
Knowledge skills: 	Great
Language skills: 	Good
Manipulative skills: 	Good
Medical skills: 	Fair
Social skills (Fellowship): 	Mediocre
Social skills (Formal): 	Great
Spiritual skills: 	Mediocre
Technical skills: 	Mediocre
All other skills: 	Poor

Beginning Jack of All Trades
Physical Attributes: 	Fair
Mental Attributes: 	Fair
Psyche Attributes: 	Mediocre
Animal Skills: 	Mediocre
Artistic skills: 	Mediocre
Athletic skills: 	Mediocre
Combat skills: 	Fair
Covert skills: 	Mediocre
Craft skills: 	Mediocre
Knowledge skills: 	Mediocre
Manipulative skills: 	Mediocre
Merchant skills: 	Mediocre
Outdoor skills: 	Fair
Social skills (Fellowship):	Good
Social skills (Formal):	Mediocre
Spiritual skills:	Mediocre
Technical skills:	Mediocre
Urban skills:	Fair

These character classes are merely examples for a simple fantasy game. The GM can change or ignore any that she wishes and create new character classes. She can also create classes for other genres, such as for a science fiction setting.

Each character class has unlisted Knowledge skills appropriate to its class. For example, a fighter has Good Knowledge of tactics, determining weapon quality, judging how well-trained an army is by observing it for a while, etc. Likewise, a rogue has Good Knowledge of types of locks, how many guards a wealthy merchant might have, the value of a given material for disguising oneself, etc.

Some skills listed on page 126 as being under one heading fall under another in certain cases. For example, a rogue would be Great at climbing, even though Climbing is listed as an Athletic skill. In this case, it’s a Covert skill. The ability to move quietly is listed as a Covert skill, but a fighter would be Fair at it, and a ranger Great.

Character development in this system is handled normally. The GM must decide at some point whether to continue to use broad skill groups or to break skills down into finer divisions. Each skill must be raised separately if the GM decides to break the broad groups into finer distinctions. If the GM likes keeping the skills together as groups, then raising an entire skill group level should cost more experience points than in a system with narrowly-defined skills — perhaps as much as ten times the cost.

!6.43  Cercopes (Fantasy Race)
Cercopes (or Kerkopes) were originally a pair of brothers in early Greek mythology. By the first century BC, however, mythological writers had expanded them into their own race. It is in this later definition that they are used here.

Cercopes (singular: cercop) are a small, apish race that love to play tricks and pranks on anyone they can. Born thieves, some of them even dared to steal Heracles’ weapons! When he caught them and tied them to a pole for punishment, they amused him so with their jokes and banter that he let them go. Players should not attempt to play a cercop unless they have a roguish sense of humor.

Cercopes are small humanoids with ugly, apelike faces and a prehensile tail. A cercop stands about four feet high (120 cm), but generally stoops a bit. The face is not hairy, but both sexes tend to have long sideburns that often meet under the chin — this hair does not continue to grow, but stays the same length, as monkeys’ hair does. The bodies have some scant hair on the back, and the tail is furred except for the final six inches (15 cm). Arms, legs and chests have no more hair than the average human male does, and they wear clothing — with a tail hole. Their feet resemble monkeys’ feet, but they cannot manipulate things well with them. They are not fond of shoes, only wearing them when attempting to disguise themselves as another race. 

Cercopes stand upright most of the time, but lean forward to run, with the tail acting as a counterbalance. Their tails are strong enough to be used in combat and to aid in climbing. However, a cercop cannot do fine manipulation (such as pick a lock) with its tail. Cercopes speak their own language, and need to learn another to speak with the rest of the party.
The average cercop has a Mediocre Strength and Damage Capacity, but a Good Dexterity. Their intelligence runs the same range as humans.

Cercopes have the racial gifts of Exceptional Balance (+2 to any action requiring balance, even in difficult situations), the Ability to Land on their Feet with no harm from twice the distance a human could, and Prehensile Tail.

Their racial faults are Impulsiveness (act first, think later), Compulsive Jokers (practical and otherwise), Kleptomania, Unattractive Appearance to other races, and Bad Reputations as Thieves and Tricksters.

They have a bonus of +1 to the following skills: Acrobatics, Move Quietly, Climbing and Fast Talk. They have a –1 penalty to use any weapon of Medium size or bigger.

The net result is that it counts as a fault to be a Cercop. Since anyone playing such a character actually gets some useful bonuses if playing a thief, the GM should be sure to enforce the faults — especially the Bad Reputation. NPCs will have a hard time trusting a cercop, usually with good reason.

This racial template gives a strong incentive to creating a thief character. However, it is possible to make a cercop warrior or even cleric if desired. Certain faults can be “bought off.” That is, a character may have a gift of Not a Kleptomaniac — but it costs one gift, which would nullify the free fault level. However, the Unattractive Appearance and Bad Reputation cannot be bought off — these are inherent prejudices in others, not in one’s self.

A cercop character could take a fault: No Tail — perhaps he lost it in battle. This would give extra levels to overcome the –1 penalty to all medium and large weapons if a character wished to be a warrior cercop, for example.</pre>
</div>
<div title="6.5 Animal &amp; Creature Examples" creator="JonasSusara" modifier="JonasSusara" created="201010230748" modified="201010231238" changecount="2">
<pre>~Non-PC animals need not be built using level limits. Just define what traits are essential to the animal, and let it go at that. The Strength Scale refers to Section 2.3, Non-humans. Damage may include a “weapon deadliness” factor for teeth, claws, and, in some cases, body optimized for combat (usually carnivores).

!Dog
Perception: 	Great to Superb
	(Smell should be Scale: Dog)
Strength/Mass Scale: 	–7 to 0
Skills: 	Mediocre to Superb
	(tailor to specific training received; examples include attack, guard, guide, track, hunt, and tricks)
Melee Combat: 	Fair to Superb
Damage Capacity: 	Good to Great

!Cat
Agility: 	Great to Superb
Scale: 	–6 or –7
Skills: Survival, Hunting, Playing
Gifts: Night Vision, Nine Lives (e.g., each time a cat receives damage that would kill it in one blow, check off one life and don’t count the damage. There are other ways to play this, of course, such as a Legendary Dodge ability.)
Faults: Independent-minded, Curious, Lazy, Vain
Damage Capacity: 	Fair to Superb

!Horse
Strength: 	Scale 3 Good to Great
Endurance: 	Good
Speed: 	Scale 4 Good to Great
Skills: 	Mediocre to Superb
	(tailor to specific training received; examples include riding, driving, racing, fighting, and various tricks)
Faults: Tailor to specific animal (Runaway, bites, kicks, etc.)
Damage Capacity: 	Mediocre to Good

!Camel
Strength: 	Scale 2 Good to Great
Endurance: 	Great to Superb
Speed: 	Scale 3 Mediocre to Good
Skills: 	Mediocre to Superb 
	(tailor to specific training received; examples include riding, driving, packing)
Gifts: Desert Survival
Damage Capacity: 	Fair to Great

!Elephant
Strength: 	Scale 8 Good to Superb
Agility: 	Good to Superb
Skills: 	Mediocre to Superb 
	(tailor to specific training received; examples include riding, hauling, stacking (logs etc.), tricks)
Gifts: Exceptional animal intelligence
Faults: Males subject to Musth (annual madness)
Damage Capacity: 	Good to Superb

!Falcon
Courage: 	Fair to Superb
Agility: 	Good to Superb
Speed: 	Scale 5 Fair to Great
Strength: 	Scale –6, Fair to Superb
	(Scale may be from –8 to –4 to reflect sizes from sparrow hawk to eagle)
Skills: 	Mediocre to Superb
	(tailor to specific training received; examples include manning — a measure of the degree of taming, hunting ground mammals, hunting birds, aerial acrobatics, trained to the lure, etc.)
Gifts: Flight
Damage Capacity: 	Fair to Good

!Lion
Perception: 	Great
Melee Combat: 	Great
Stalking: 	Great
Dodge: 	Fair
Strength: 	Scale 2 Fair to Great
Fault: 	Lazy
Damage Capacity: 	Fair to Superb

!Grizzly Bear
Perception: 	Good
Melee Combat: 	Good
Dodge: 	Fair
Strength: 	Scale 3 Fair to Great
Fault: 	Berserker
Damage Capacity: 	Fair to Great

!Cobra
Perception: 	Good
Melee Combat: 	Great
Dodge: 	Good
Supernormal Power: 	Poison, +4 damage bonus
Fault: 	Bad temper
Damage Capacity: 	Poor

!Skunk
Melee Combat: 	Poor
Ranged Combat: 	Good, short range
Dodge: 	Poor
Supernormal Power: 	Noxious Fluid
	(blinds, incapacitates, renders foul)
Damage Capacity: 	Terrible

!Giant Spider
Melee Combat: 	Good
Dodge: 	Poor
Supernormal Powers: 	Poison (paralyzes)
		Web
	(Good Difficulty Level Strength roll to break)
Damage Capacity: 	Good

!Griffin
Perception: 	Great
Melee Combat: 	Great
Dodge: 	Good
Supernormal Powers: 	Flight
		Tough Hide (light armor)
Strength: 	Mediocre to Great, Scale 4
Damage Capacity: 	Good to Superb

!Dragon (customize to taste)
Melee Combat: 	Good to Great
Ranged Combat: 	Good, short range
Dodge: 	Mediocre
Supernormal Powers: 	Fire Breath (+2 damage)
		Flight
		Tough Hide (–1 to –3)
		Charm with Eyes
		Magic Potential
		(some of them)
Fault: 	Greedy
Strength: 	Scale 3 to Scale 9
		Fair to Great
Damage Capacity: 	Fair to Great</pre>
</div>
<div title="6.6 Equipment Examples" creator="JonasSusara" modifier="JonasSusara" created="201010230749" modified="201010231236" changecount="3">
<pre>It’s possible to define equipment in Fudge character terms. This is probably unnecessary, but can be done if desired.

Equipment from any technological level, stone age to science fiction, can be detailed this way. A piece of equipment can be defined by as many Fudge traits as are needed: attributes, skills, gifts or faults.

For example, ''an old, battered sword'' found in a damp dungeon has:

Attributes:
Sharpness: 	Terrible
Durability: 	Poor

Fault:
Looks Shabby.

Such a weapon is treated as a club for damage, rather than a sword (no Sharpness bonus). The GM may require a Situational roll every few combat rounds: the sword breaks on a Mediocre or worse result from parrying or being parried. And finally, some people will make fun of anyone carrying such a shoddy-looking weapon.
When the sword was new, however, it had:

Attributes:
Sharpness: 	Good
Sturdiness: 	Great

Gift:
Beautifully Made

In that case, it would indeed merit the +1 for Sharpness (perhaps any Sharpness level of Mediocre to Good gets the +1 Sharpness bonus, while duller blades get no bonus, and better blades might get an additional +1 bonus). It also would never break under ordinary circumstances, and its appearance probably earns its owner a positive reaction from many people.
A bejewelled magic sword found in a dragon’s hoard might have:

Attribute:
Appearance: 	Superb
(+3 to impress those who value wealth)

Gift:
Troll-slaying (+3 to hit when fighting Trolls; such wounds will never heal)
Fault:
Dedicated Purpose (it tries to control the wielder to hunt trolls)

Skill:
Dominate Wielder: Fair (Opposed action against a Will attribute)

''A different magic sword'':

Supernormal Power:
Flame Creation (+2 damage)

Skill:
Flame Shooting: 	Great
	(Range: 3 yards or meters)

Fault:
Flame Creation only works on a Good or better Situational roll


Of course, even if the flaming missile fails, it can still be used as a regular sword, so it’s not exactly worthless in such cases.
As a final example, consider a science fiction double-seat fighter spaceship:

Attributes:
Acceleration: 	Great
Handling: 	Superb
Speed: 	Good (Scale 15)
Size: 	Fair (Scale 8)

Skills:
Navigation: 	Good
Targeting: 	Superb
Auto-pilot: 	Fair
Food Preparation: 	Poor
Entertainment: 	Mediocre

Gifts:
Turret-mounted Laser Rifles, above and below
Bucket Seats in the bridge
Hyperdrive
Can be used in an atmosphere or in deep space

Faults:
Non-standard parts (expensive to repair)
Unattractive exterior
Cramped sleeping quarters
Airlock squeaks annoyingly

Ordinary, every-day equipment should not be detailed out in this manner. There is no need to define a canteen, for example, as anything other than “metal, 1 quart (liter) capacity.” Even for equipment that may have an impact on the game, such as weapons or thieves’ tools, you do not need to have any more information than “+2 offensive damage factor” or “adds 1 to Pick Locks skill.”

It’s best to restrict defining equipment in Fudge character terms to the truly extraordinary (such as magic items). Another use is when the equipment’s powers may be used in an opposed action: in a car race, for instance, you need to know the relative speeds and handling capabilities of the vehicles as well as the skills of the drivers. A battle between spaceships is another good example.

Equipment with personality, such as sentient magic items or advanced robots, may be treated as full-fledged Fudge characters if desired.</pre>
</div>
<div title="7. The Addenda" creator="JonasSusara" modifier="JonasSusara" created="201010201300" modified="201010230756" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="5">
<pre>The Addenda consist of a variety of supplementary material for Fudge.

Chapters 1 through 5 represent plain, vanilla Fudge — here you can find and create fancier fare. If you pass Fudge around, please add any customization to this chapter (quoting Section number and name, such as 1.33, Gifts), rather than change the original. Suggestions for a specific genre also go in the Addenda. Examples: a list of sample superpowers, or a list of guns and their damage.

Please include a date and credit (your name) for the change, and, if possible, notify Grey Ghost Press, the publisher of Fudge, via the Internet (ghostgames@fudgerpg.com) or via the Post Office (P.O. Box 838, Randolph, MA 02368).

[[7.1 Sample Magic System: Fudge Magic]]
[[7.2 Sample Miracle System: Fudge Miracles]]
[[7.3 Sample Psionic System:Fudge Psi]]
[[7.4 Alternate Rules]]</pre>
</div>
<div title="7.1 Sample Magic System: Fudge Magic" creator="JonasSusara" modifier="JonasSusara" created="201010230753" changecount="1">
<pre>Date: November, 1992 to November, 1993
By: Steffan O’Sullivan
Here is a sample magic system, based on the following premises mentioned in Section 2.5, Magic:
Who can cast: Magicians only (supernormal power needed).
Levels of Power: yes. There are two game effects: the greater the power, the easier it is to cast more powerful spells; and power levels act as a reserve in case of severe failure, which temporarily drains Power. Voluntarily draining a level of Power can also guarantee success for one spell.
Source of Power: manipulation of local area mana.
Reliability: Fair.
Time to cast spells: depends on potency of spell (one minute to days). This can be speeded up by taking a penalty to the roll.
Spells: improvised. Exact wording isn’t important, so magic books tend to be collections of effects, not formulae.
Material Components: none needed, but good use can give a +1 bonus to skill.
Drawbacks: casting non-trivial spells is fatiguing; severe failure causes distress.
Societal constraints: none — magic is rare, but not unheard of.
This system is based on the conviction that a player using magic should never be blasé: there should always be some tension and excitement when a character casts a spell, or the magic has gone out of the game. Too often in a role-playing game, the player running a magician uses tried-and-true spells so regularly that spell-casting becomes mundane. Since “mundane magic” seems a contradiction in terms, Fudge Magic attempts to instill a little excitement into spell-casting.
There are many ways to achieve this. Fudge Magic has chosen the following limitations:
1) The mana available for a specific spell result gradually becomes depleted in a given area. That is, casting two fireballs in a row is harder than casting one fireball and one lightning blast, for example.
2) Magic is an untamable force; there is a skill cap for casting spells.
3) Magic is somewhat risky to use — there are penalties for severe failure.
Options are provided to alter these limitations for GMs who dislike them. In fact, Section 7.193, Spell-Casting Skill Alternatives, is essential for Faerie races and demigods, who have much more dependable magic powers than humans. (Unless the GM is generous, such characters would have to buy higher skill levels normally if using the Objective Character Creation system. Taking some faults to balance such Powers is in keeping with the nature of demigods and Faerie races.)
See Section 6.31 for sample characters using Fudge Magic.

7.11  Magic Potential
Magic Potential is a Supernormal Power. (A suggested cost in the Objective Character Creation system is two gifts for each level of Magic Potential. This can be reduced in a magic-rich campaign.) A character with at least one level of Magic Potential (usually abbreviated to Potential, sometimes simply called Power) is referred to as a “magician” in these rules — substitute your favorite word. Only magicians may cast spells. (However, see Section 7.192, Magicians &amp; Non-Magicians, for other options.) Magic Potential may be taken more than once, but each level counts as a separate supernormal power.
Each level of Magic Potential must be bought as a specialization. Specializations can be suggested by the player or set by the GM. (In the latter case, she should make a list of acceptable magic specializations.) The categories can be as broad or as narrow as the GM wishes — the broader the terms, the more powerful the magicians.
Examples of specialized Potential: Alter Inanimate Material, Augury, Combat Magic, Communication Magic, Defensive Magic, Elemental Magic, Flying Magic, Healing Magic, Illusion, Information-Gathering Magic, Mind Control, Necromancy, Only Affects Living Beings, Only Affects Sentient Beings, Only Affects Technological Items, Shapeshifting, White Magic (cannot harm anyone, even indirectly), etc.
A character may have Power levels in more than one specialization, unless the GM disallows it for some reason. Certain disciplines may have societal constraints: in most cultures, studying Necromancy is offensive and probably illegal. Mind Control, Invisibility, Teleportation, Illusion Magic, etc., might all be limited to government-approved magicians, at best. It’s even possible that such magicians will be outlaws. Anything that can be used easily to commit a crime (especially assassination or thievery) will be difficult, if not impossible, to learn openly in most cultures. If a given culture allows such magic openly, it is sure to have powerful defenses against being damaged by it.
Narrow specializations should probably cost less than one supernormal power: perhaps each specialized Potential is worth one gift.
In order to cast a spell of a given result, the magician must have at least +1 Potential specialized in that type of magic (on the character sheet, that is: he may be temporarily reduced to 0 Potential). Someone with +1 Potential: Combat Magic and +2 Potential: Information-Gathering Magic could not cast a spell to create food in the wilderness, for example.
Failing a spell miserably causes the temporary loss of a level of Magic Potential (see Section 7.15, Resolution). When this happens, the magician faints for at least one combat round. He needs a Good Constitution roll to wake up (roll each round). When he comes to, the magician may function normally, even attempting to cast the same spell again — if he hasn’t dropped below 0 Potential.
If a magician has two or more types of Potential that are appropriate for the spell being cast, and a loss of Potential is called for, the GM decides which type of Potential is reduced. For example, a magician has one level of Combat Magic and two levels of Fire Magic, and fails miserably on a fireball spell. The GM could say that he has lost either his one level of Combat Magic or one of his Fire Magic levels, but not one of each.
If a magician drops to –1 Potential in any given specialty, he immediately falls into a coma, lasting anywhere from an hour to a day (GM’s decision). When he wakes, he must roll against his Constitution: on a Mediocre or worse roll, he takes a point of damage. He checks Constitution again at the end of every day he is active – a failed result means another point of damage. These wounds cannot be healed until he recharges his Magic Potential back up to level 0.
A magician with 0 Potential may still cast spells; a magician at –1 Magic Potential, however, cannot attempt any magic spells that would involve that specialty. He may still cast spells of another specialty. For example, a magician who falls to –1 Encyclopedic Magic can no longer cast a spell that allows him to open his blank book and read a magically-appearing encyclopedia entry on a specified topic. But he can still cast spells using his Animal Empathy Magic, allowing him to call and converse with wild animals, provided that Potential is still 0 or greater. He must still make a Constitution check for every day he his active, however, to see if his –1 Encyclopedic Magic Potential is causing him wounds.
Magic Potential may be recharged only by resting for one week per level. (GMs may alter this time to taste, of course: resting for one day is sufficient for more epic campaigns.) For example, a magician falls to –1 Potential. Resting one week will bring him up to 0 Potential (and cure any wounds incurred by being active while at –1 Potential). A second week of rest will bring him up to +1 Potential.
No character may gain Magic Potential levels beyond his starting level except through Character Development — see Chapter 5.

7.12  Spells
When a magician wishes to cast a spell, he describes the result he has in mind. The GM assesses how powerful such an effect would be, based on how prevalent magic is in her campaign. In a low-magic campaign, even a simple spell such as levitating the jail keys to an imprisoned character would be taxing. In a high-magic campaign, however, that would be a trivial spell, and even shooting forth a flash of lightning from a fingertip wouldn’t be out of the ordinary.
The potency of the spell can be modified by the magician’s appropriate Power level. An “average” magician has three levels of appropriate Power when casting a given spell. (Modify this number up or down for harder or easier magic.) That is, a spell is more difficult for a magician with less than three levels of an appropriate Power. Likewise, a magician with four or more appropriate Power levels treats a spell as more trivial than it would be for an average magician.
“Appropriate” Power does not have to be all of the same specialization so long as each Power governs the spell in question. For example, a spell to make a sword fly up and attack a foe could be governed by Flying Magic, Combat Magic, and Control Inanimate Material. If a magician had one level of each of those types of magic, the spell would be of average potency for him.
A spell is then Trivial, Average, or Potent. (It may also be Very Trivial, or Very Potent, if the GM wishes. In fact, the players will undoubtedly propose truly awesome spells, which should be labeled as Extraordinarily Potent, or with some other impressive adjective.) The GM tells the player what the potency of a proposed spell is — any magician character would have a fairly good idea of a spell’s potency.
The spell’s potency determines the Difficulty level. A spell of average potency has a Fair Difficulty level, while a Potent spell has a Difficulty level of at least Good. Likewise, a Trivial spell has a Difficulty level of Mediocre or Poor.
The GM also decides the duration of the spell if it succeeds — seconds, minutes, hours, days, etc. The character may try to adjust this, subject to GM approval. For example, the magician can voluntarily take more fatigue or reduce the scope of the effect — or accept some other penalty — to lengthen the spell’s duration. Rolling a higher relative degree can also mean the spell lasts longer. Some spells have permanent effects: healing (until wounded again), busting a hole in a wall (until repaired manually or by magic), teleporting to a distant place (until you come back), and so on. Of course, even these spell effects may be temporary in a given GM’s world: healing only lasts a day and the wound reappears, or a hole in the wall fixes itself after a few minutes, or a teleported person automatically returns after an hour in the other location….
The GM also needs to determine if there are any drawbacks to casting a spell. Fudge Magic assumes that spells are tiring to cast, and a magician reduces his Fatigue attribute when casting. The more potent the spell, the more the fatigue. (Fatigue is regained by resting, of course. If Fatigue goes below Terrible, the character passes out. The GM may have separate Fatigue attribute, or base it on Endurance, Constitution, Strength, etc.)
A GM who dislikes the idea of keeping track of fatigue can change the drawback to something else. Perhaps a magician has a limited number of spells he can cast in a day (or in an hour). In this case, he may have a Spell Point attribute, which is drained by spell casting and regained simply by the passage of time. (A trivial spell won’t drain any Spell Point levels, while an average spell drops a magician from Good Spell Points to Fair, for example, and more potent spells drain two or more levels at a time.) Draining spell points would not necessarily make the magician tired in this case, and Spell Points would regenerate whether the magician was resting or not — or they might only regenerate with sleep.
Or maybe each spell affects a magician’s Sanity attribute, and he needs to convalesce to restore it. Or, equally entertaining, a spell might affect the sanity of anyone who witnesses magic! Reduced sanity can manifest in many amusing ways….

7.13  Mana
Mana is an energy source capable of manipulating matter, time and space. It can be tapped only by those with Magic Potential.
The GM determines the availability and density of mana in a given game world, just as she does the average potency of a spell. Mana density can affect two things: how large an area is needed to fuel a given spell effect, and (optionally), how easy or hard it is to cast a spell.
When a spell of a particular effect is cast, the magician draws a specific type of mana to him to create the effect. The next time this same effect is desired, it will be harder to do: he has drained some of that mana type in the local area.
The size of the area is defined by the GM. For most fantasy worlds, assume it’s about 50 yards or meters in diameter. In a low-level magic campaign, the area is the size of a town or even city. (This would give meaning to the old line, “This town ain’t big enough for both of us” — dueling wizards!) On the other hand, a high-level magic campaign is so mana-rich that the magician can simply take a step or two and be in a new area. Note that the area governs which spells can be cast without penalty: if one magician casts a healing spell, a second magician will be at –1 to cast a healing spell in the same area within the next 24 hours. (Mana may recharge at a different rate in a given game world, of course.) Note also that a magician may be unaware of what spells were cast in an area before he arrived….
In a mana-rich area, spells may also be easier to cast: +1 or +2 to skill level. Likewise, in a mana-poor area, spells can be harder to cast: –1 or more. The GM decides if this rule is in effect.
Mana is dispersed and weak in a world such as modern Earth. The average fantasy game world will have much stronger mana, and some high-magic campaigns will simply reek of mana. In any given world, it is possible to vary the amount of mana. Some lands may be mana-rich, while neighboring areas are mana-poor. Mana may flow in currents, or in tides with the phases of the moon. There may be “rogue” mana streams that change course and invade new areas, or a mana drought may afflict a given locale. Astrological alignments can affect mana, too — thus even here on mana-poor Earth there will be places and times of the year when cultists gather to call forth unseen powers….
A PC magician would know the general mana level for at least his home area. He may or may not know whether it fluctuates periodically, or if far lands have different mana levels. In order to determine the mana level of the local area at a given time, a magician must cast a spell specifically to that end.

7.14  Skill
Spell-casting is a skill that must be learned. The default is Non-Existent, and, due to the element of uncertainty in Fudge Magic (mentioned in Section 7.1, Fudge Magic), the maximum base skill level is Fair. This cannot be raised permanently — but see Section 7.193, Spell-Casting Skill Alternatives.
One generic Spell-Casting skill is assumed, but the GM may require more if she breaks magic down into different types. It should cost one level just to get a Spell-Casting skill at Terrible.
Spell-casting skill may be modified (to a maximum of Great) by the following:
Taking an average time to cast a spell: +0. (Note: the GM assesses the average time for any given spell proposed. Potent spells might take all day, or even longer, while Trivial ones might take one to five minutes.)
Taking a long time to cast a spell carefully: +1. (Relative to each spell, of course. For a Trivial spell: taking a half an hour or more.)
Casting a spell much more quickly than normal: –1. (For a Trivial spell: one combat round of concentration.)
Using normal effort to cast a spell: +0.
Using extra effort to cast a spell (more fatigue than normal, or counts as two spells cast if there is a limit per day, or reduces Sanity more than normal, etc.): +1 or +2.
Using less effort than normal to cast a spell: –1 or more. (Reduced fatigue, or it only counts as half a spell against a daily limit, etc.)
First spell-casting of a particular effect in a given area within 24 hours: +0. (See Section 7.13, Mana, for the size of an area.)
Additional spell-castings of a particular effect in a given area within 24 hours: –1 per casting.
For using authentic magic formulae: +1. (The Law of Contagion or the Law of Similarity, for example — see James Frazer’s classic anthropological study, The Golden Bough. Both Laws require some physical component: a feather to cast a flight spell, a piece of the subject’s hair to heal or hurt her, a drop of water that becomes a water jet, a stick that becomes a staff, a bearskin to change the magician into a bear, etc. Drafting the spell in poetical form earns an additional +1, if the GM is willing.)
Multiple magicians casting a spell that they have all tried before: +1 (for 2 to X magicians) or +2 (for more than X magicians). (X is set by the GM, anywhere from two to ten, or even more for low-magic campaigns. One magician is assumed to be the primary caster: roll only once against his skill.)
Mana-rich area: +1 or +2 (optional).
Normal mana area: +0
Mana-poor area: –1 or more (optional).
Other modifiers may also apply, such as in a spell to search the mountains magically for someone you love (+1) or searching for someone you’ve never met (–1).

7.15  Resolution
Each spell is then resolved as an Unopposed action: the Difficulty level is dependent on the spell potency. Spells of average potency have a Difficulty level of Fair, while more trivial spells have difficulty levels of Mediocre or Poor. (No spell has a Difficulty level of Terrible — magic just doesn’t work at that level.) More potent spells have Difficulty levels of Good to Superb, or even beyond Superb if a truly powerful effect is desired.
If the magician surpasses the Difficulty level, the spell occurs as he described it. The better the relative degree, the better the result. The magician suffers –1 (or more) to his Fatigue attribute if the GM deems the spell is fatiguing. (If the GM has chosen some other drawback, of course, apply that instead.)
Sometimes a skill roll is then needed to do something with the end result of a spell. For example, a fireball needs to be thrown accurately: use the Throwing Skill and Ranged Weapon rules in Chapter 4.
If the magician equals the Difficulty level, then a watered-down version of the spell occurs. Either it will have a short duration, or reduced potency, or there is a time lag before the spell takes effect, etc. There may be an unexpected side effect, though it won’t be harmful to the magician. There is no penalty for the magician beyond a possible –1 or –2 to Fatigue, at worst.
If the magician rolls below the Difficulty level, however, he is adversely affected. The energy inherent in mana lashes out at the magician’s psyche instead of being focused as desired. There may (or may not) be some visible magical effect, but it will not be the desired effect, and, if he rolled poorly enough, it may even be inimical to the magician’s goals — or health….
On a failed roll, the magician is stunned for one combat round (no actions or defense) and takes at least –1 Fatigue. A Terrible result always fails.
If he rolls a result of –4, the spell automatically fails (no matter what the resulting level) and he also temporarily drains one level of his Magic Potential — see Section 7.11, Magic Potential, for effects. (This is the “riskiness” of magic mentioned in Section 7.1, Fudge Magic.)
Examples: Barney casts a spell, Create Pizza, of Average potency in a normal mana area and gets –3: a Terrible result. The spell fails and Barney is stunned for a combat round, but he does not drain a level of Magic Potential because he did not roll a –4. Later, in a mana-rich area (+1 to cast), Barney takes a long time (+1) to cast Detect Food, a very Trivial spell (Poor result or better needed for success). He has temporarily raised his skill to Great, the maximum allowed. He rolls a –4 result, which is a Poor rolled result. Although the rolled degree is good enough to cast the spell, Barney still fails because he rolled a –4 result. Barney not only doesn’t detect any food, he also exhausts one level of Magic Potential — ouch!

7.16  Personal Magic Resistance
If the spell is one which attempts to Control another being — either mentally, physically or spiritually — Opposed action rolls are also called for. First, the magician casts the spell (as above); then he has to overcome the Personal Magic Resistance of the subject. Magic Resistance may be an attribute or gift (Willpower is a good choice, if there is no specific anti-magic trait), as the GM desires. Magic Resistance may even be a different attribute for different types of spells (a mental attribute for attempts to control the mind, etc.). Note that this second roll is Opposed — the subject of the spell gets a chance to resist it, and so can influence the result.
If the GM is willing, the magician may use the result he just rolled as his skill level for the Opposed action. That is, if he rolled a Great result on the spell, he rolls the Opposed action as if his skill were Great. Otherwise, he uses the same level he rolled initially against.
“Control” can mean many things to different GMs. Personal Magic Resistance would resist an attempt to read someone’s mind to one GM, but not to another. However, Magic Resistance does not resist any spell that calls or creates physical energy to lash out at another being. If the magician successfully creates lightning to blast the subject, it is not resisted by Personal Resistance; it is treated as a physical weapon.

7.17  Certain Spell-Casting
Sometimes a magician desperately needs a certain result. In this case, he may opt not to roll the dice at all, and simply drain one level of Magic Potential for a guaranteed success. He takes the usual penalties for losing a level of Potential — see Section 7.11, Magic Potential. This means he’ll faint —  be unconscious — after casting the spell, which limits the utility for certain spells. You can’t control someone’s mind when you are unconscious, for example….
The GM may restrict this to Trivial spells, or non-Potent spells, or have no restrictions at all, beyond requiring the normal fatigue (or other) penalties. If the spell is one that could logically be resisted by the subject, however, the subject still gets a Resistance roll. In this case, the magician rolls as if his skill were Great.

7.18  Enchanting Items
Items may be permanently enchanted in this system. The magician works for a number of weeks or months (as required by the GM), depending on the number and potency of the spells desired, and the general availability of magic items in the campaign. At the end of each month (or week), the magician rolls against two skills: Spell-casting, and the appropriate Craft skill for the material being worked. The usual penalties apply on failing a spell roll. If he surpasses the Difficulty level on each roll, the spell is slowly being set into the item, one stage at a time. On a roll that only matches the Difficulty level, the work counts as only half a time period, but does progress the enchantment.
Obviously, a mana-rich area will attract magicians, especially enchanters.

7.19  Fudge Magic Options
These options offer ways to make Fudge Magic more sweeping, more reliable, less risky, and even make it available to non-magicians.

7.191  Generalized Magic Potential
Some GMs may want the players to have sweeping powers. In this case, each level of Magic Potential allows a character to try any magic effect desired. This is in keeping with certain fictional settings in which learning magic involves general principles rather than specific spell effects. This makes for a very free and open game, which may or may not be to your tastes.
This system still allows specializations. Simply use faults to limit a magician’s ability to cast certain spells. See Section 6.311, Character Examples, Brogo the Scout.

7.192  Magicians &amp; Non-Magicians
The GM may allow non-magicians to cast spells. In this case, it is risky, as there is no Magic Potential “cushion” — one severe failure is enough to devastate the character. Still, in an emergency, it may be worth the risk. Such a character would still need to have some Spell-casting skill, however. (But see Section 7.193, Spell-casting Skill Alternatives).
As a substitute for Magic Potential specialization, the GM looks over the character sheet (checking traits, personality, and character background) and decides if a proposed spell would be appropriate for the character. The character must have some aptitude in the proposed spell subject, or he may not cast such a spell. For example, a trained fighter with no knowledge of book learning or foreign languages could conceivably try a combat spell, but not a spell to translate a book written in an unknown script.
Of course, the same spell is of greater potency for a non-magician than for a magician. This probably means that a non-magician will only have a chance of casting a spell that a magician would consider trivial.

7.193  Spell-Casting Skill Alternatives
Since tastes differ, and Fudge Magic tends to be undependable (see Section 7.1, Fudge Magic), three options are provided for more reliable spell-casting:
1) Use the basic Fudge Magic system, but allow a magician to improve his chances of casting a spell beyond Fair. At a cost of one gift (or even supernormal power), this may be raised to Good. At a cost of two more gifts (or supernormal powers), casting skill may be raised from Good to Great, the maximum.
2) GMs who want magic to be a lot more reliable can simply treat Spell-casting as any other skill. That is, it costs the usual skill costs to raise it to Good or even Great. Superb Spell-casting is not recommended for any but inherently magical races, even in high-level magic campaigns.
3) Spell-Casting is equal to the Willpower attribute, or perhaps Willpower–2. (There may still be a ceiling of Great, Good, or even Fair for Spell-Casting, regardless of the level of Willpower.) This is especially appropriate for games in which non-magicians can cast spells – see Section 7.192, Magicians &amp; Non-Magicians. This is a potent option because the player doesn’t have to buy Spell-casting skill for his character.

7.194  Less Risky Spell-Casting
To make spell-casting less risky (not necessarily a good thing — see Section 7.1, Fudge Magic), make it harder to drain a level of Potential.
Examples (apply as many or as few as desired):
1) A magician cannot deplete a level of Magic Potential if he is attempting a Trivial spell. That is, if he rolls a –4 on a Trivial spell, he fails the spellcasting, but doesn’t lose a level of Magic Potential.
2) A magician cannot exhaust a level of Magic Potential if he is attempting a Trivial or Average spell.
3) A magician cannot deplete a level of Magic Potential if he takes enough time to get a +1 bonus for slow and careful spell-casting.
4) A level of Magic Potential can only be depleted on a hurried spell-casting attempt that fails badly.
5) A magician cannot drain a level of Magic Potential on the first spell cast each day, or when the moon is full, or if the mana level is low (not enough mana to backlash potently), etc.
</pre>
</div>
<div title="7.2 Sample Miracle System: Fudge Miracles" creator="JonasSusara" modifier="JonasSusara" created="201010230754" changecount="1">
<pre>Date: December, 1992
By: Steffan O’Sullivan
Here is a sample miracle system (not generic), based on the following premises mentioned in Section 2.6, Miracles:
Can miracles occur by petition: Yes.
Who can petition: Anyone. Holy persons have an advantage. (A holy person is one with the supernormal power: Divine Favor, and whose behavior is in synch with the deity’s goals – GM decision on how the player is role-playing.) Religious Investiture – a social title that may or may not coincide with Divine Favor – is not required, and, in fact, does no good if behavior is inappropriate.
Certainty of petitioned miracles: Mediocre.
Broad or specific requests: Specific requests are more likely to be granted.

7.21  Divine Favor
Divine Favor is a supernormal power that can be taken more than once. Each time Divine Favor is taken, it is dedicated to a single deity. It is possible to have Divine Favor from more than one deity in a polytheistic world, or you can have multiple steps of Divine Favor from a single deity. Each step of Divine Favor counts as two supernormal powers (recommended).
Divine Favor can be temporarily lost if the character does not act in accordance with the deity’s desires. Usually a period of atonement is required to regain Divine Favor. This may be instantaneous for a merciful deity, or it may take up to a month for stricter deities. All steps are lost and regained as a unit when this happens.

7.22  Petitioning a Miracle
A character may petition a miracle at any time. However, some deities do not like to be disturbed for trivial matters, and may ignore requests when it is obvious the character hasn’t even tried to help himself.
In Fudge Miracles, the petition should be fairly precisely worded. Rather than a simple, “Please help me,” the character should focus the plea: “We are starving, please feed us,” or, “My friend is dying, please heal him.” A holy character can petition for any miraculous result desired, however — there is no established list of miracles.
Characters without Divine Favor have a Petitioning skill of Poor (or Mediocre in a more deity-active game). Those with one or more steps of Divine Favor have a Petitioning skill of Fair. Petitioning skill cannot be raised. (In a high-level deity-active campaign, Petitioning skill can be raised to Good at the cost of one supernormal power.) Petitioning skill can be modified, however — see the next section.
To resolve a petition, make an Unopposed action roll against Petitioning skill. Each step of Divine Favor grants the holy character one extra chance to roll the dice in a petition to his deity.
On a Fair or worse result, the roll is a failure. If the character has any steps of Divine Favor from the same deity, he may roll again for each step (this does not count as a separate petition). He can stop at any point — only the last result rolled counts. This means a character with two steps of Divine Favor can try one, two, or three rolls. If he gets Good, Fair, and Mediocre results, in that order, the result of the petition is Mediocre.
On a Fair or Mediocre result, the petition isn’t answered by the deity, but the deity isn’t annoyed by the petitioner. On Poor or worse result, however, the deity is angry with the character, and there will be a –1 on the next petition attempt. If the deity is evil, a miracle may actually occur, but not one the petitioner is likely to enjoy….
On a Good or better result, the petition is granted. The better the rolled result, the better the answer to the prayer. For example, a Good result heals one wound or wound level, while a Superb result totally heals the character. A Good result could call a wolf to defend the petitioner, while three lions might answer a Superb result. And so on.

7.23  Modifiers to the Petitioning Skill Level
The GM decides if any modifiers are applicable. Suggested modifiers:
The petitioner’s behavior has been strictly in accordance with the deity’s desires: +1
The petitioner’s behavior has not been in accordance with the deity’s desires: –1 or more
The petition will further the deity’s desires: +1
The petition goes against the deity’s desires: –1 or more
The petition involves the deity’s sphere of influence: +1  (Calling for a fireball from a fire god, for example. This is not appropriate for a Supreme God, whose sphere encompasses all things.)
The petition involves an element antagonistic to the deity: –1 or more (asking the Fire deity to use water, for example.)
The petition is phrased too generally: –1 or more
The petitioner has not tried to help himself first: –1 or more.
The petition is too trivial to bother the deity with: –1 or more
The petition is a simple, but important, request: +1, provided the petitioner has exhausted his own abilities to accomplish this task. (Example: requesting a piece of chalk, which is trifling, but simply cannot be found anywhere near the character. In this case, chalk would have to be essential to the character’s state of body, mind or soul.)
The last petition was a Poor or worse result: –1
The deity feels the petitioner is calling for help too frequently: –1 or more (Optional — may be invoked by a GM annoyed at constant requests for miracles…)
</pre>
</div>
<div title="7.3 Sample Psionic System:Fudge Psi" creator="JonasSusara" modifier="JonasSusara" created="201010230755" changecount="1">
<pre>Date: February, 1993 &amp; December, 1993
By: Shawn Garbett and Steffan O’Sullivan
There are three types of Psi traits in this system: Powers, skills, and Psychic Reservoir. Only psionicists have Powers and the skills to activate them, but everyone has a Psychic Reservoir to resist psionic attacks.

7.31  Psionic Powers
The GM must decide how precisely to define Psi Powers. Since each Power must be bought separately, defining them broadly makes for more powerful characters.
The following chart (see right) shows some broad groups that include more narrowly defined Psi power groups listed with them. These in turn contain even more narrowly defined powers, which a GM may use as individual Powers if desired. This list may be regrouped, expanded, some powers disallowed, a narrowly defined group made into a broad group that includes other powers, etc. The list is not intended to be comprehensive, but merely a sample.
The GM should let the players know what depth of Psi skills she is using. Each Power costs one Supernormal Power (two gifts).
Putting one level in a Power gets it at Terrible. Powers may then be raised at the cost of two skill levels per level, if using the Objective Character Creation system. For example, raising Telekinesis Power to Poor requires two skill levels, and raising it to Mediocre would cost two more skill levels.
If a GM envisions a psi-rich campaign, of course, the costs should be much cheaper. Allowing many free levels of Supernormal Powers is a good way to do this, but be cautious about trading them for mundane traits.
Power levels define range, quantity or size of subject affected, etc. — see Section 2.7, Psi. A Fair Power can do whatever the default average is for the campaign world.
Some tasks require a minimum Power level, as set by the GM. If the character has the Power, but not at the minimum level required, he may not attempt the action unless he uses Desperation Psionics (Section 7.35). If the psi has the appropriate Power at three or more levels above the minimum required, he is at +1 for that use.
No psionic ability can be used unless the character has the Power listed on his character sheet.
A character may take a latent psi Power at the cost of one gift. He can’t use the Power (may not take any related psi skills), but later in the campaign he may spend EP equal to another gift to awaken the Power. He would then have to learn the skills to control the Power.
It is also possible to take some interesting faults that will limit the nature (and reduce the cost) of any Power. “Usable only in emergencies” is a common theme in fiction, for example.
	
Very Broad	Mildly Broad		Narrow
Groups		Groups			Groups
Antipsi		Distort
					Nullify
					Resist
ESP		Astral Projection
		Telesense		Clairaudience
					Clairvoyance
					Locate Object
					Locate Person
					Sense Aura
		Temporal Revelation	Postcognition
					Precognition
					Psychometry
Psychokinesis	Control Animate		Healing
					Levitation
					Metabolism Control
					Shapeshifting
		Control Inanimate	Force Shield
					Photokinesis
					Sonarkinesis
					Telekinesis
					Transmogrify Object
		Electrokinesis		Alter Electric Current
					Control Electrical Devices
					Cyberpsi
					Electric Blast
		Temperature Control	Cryokinesis
					Pyrokinesis
Telepathy	Empathy		Emotion Control
					Emotion Sensing
		Mind Shield
		Mental Communication	Mind Reading
					Thought Sending
		Mental Control		Alter Memory
					Persuasion
					Prevent Clear Thinking
					Send Violent Energy
					Telehypnosis
		Vampirism		Borrow Skill
					Drain Psychic Reservoir
					Drain Health
					Drain Energy
Teleportation				Teleport Self
					Teleport Other
					Teleport Object
					Planar Travel
					Open Dimension Portal

7.32  Psionic Skills
You cannot attempt any psionic action unless you have the specific skill to control the Power in question. Each Power must have an accompanying skill of corresponding broadness or narrowness (Control Telekinesis, Use Telepathy, Read Minds, etc.).
The default for psionic skills is Non-existent. Raising a skill to Terrible costs one skill level, etc. Skills may be taken as high as Fair at the beginning of a game. (The GM may allow higher levels if the campaign is centered around psionic abilities.) They may be improved through normal character development, and new ones may be added if the GM is willing. The player should have a good story concerning awakening new skills, however.

7.33  Psychic Reservoir
Psychic Reservoir is a measure of raw psi power available. Like most attributes, Psychic Reservoir is at Fair for every character unless deliberately altered. The GM may set the default lower, and there may be a ceiling on how high Psychic Reservoir can be set.
Merely having a Psychic Reservoir attribute does not mean the character is capable of actively using psi. Other psionic Powers and skills are necessary to activate the Psychic Reservoir.
A low Psychic Reservoir can negatively modify any active psi ability, while a high Reservoir can be tapped to increase your chances of success — see Section 7.36, Psi Modifiers Summary.
A psionicist taps his Psychic Reservoir when he uses a psychic skill. Ongoing use gradually drains a Reservoir, and short but heavy-duty use of a psi Power also drains a Reservoir, but normal brief use doesn’t. However, a rolled degree of Terrible or worse on a psionic skill roll always lowers Psychic Reservoir a minimum of one level.
A psionicist can also attempt to drain his Psychic Reservoir deliberately. This may be done to gain a bonus to a psionic skill (see Section 7.34, Psionic Actions), or to a Power (see Section 7.35, Desperation Psionics).
There is no immediate penalty for dropping a level of Psychic Reservoir, as long as it remains Terrible or higher. However, your next use of psi may be affected: there is a negative modifier for using a Psychic skill when your Psychic Reservoir is below Fair.
If the Psychic Reservoir is drained to below Terrible, the character immediately loses consciousness. It requires a Good roll versus a Constitution attribute to regain consciousness, which may be attempted every combat round.
Even after regaining consciousness, a character with Psychic Reservoir below Terrible is in trouble. The GM may impose any type of affliction she desires on such a character until the Psychic Reservoir reaches at least Terrible. Suggested afflictions include mild insanity (hallucinations, delusions, paranoia, etc.), physical debility (drooling, shaking, twitching, etc.), attribute reductions, and negative modifiers for even non-psi actions.
A character can regain one level of his Psychic Reservoir for each week (or day, or whatever the GM sets) of rest, up to his current maximum level.

7.34  Psionic Actions
Two kinds of psionic action are possible, Opposed and Unopposed.
An Opposed action is a psionic attack upon an unwilling subject. The attacker rolls against his specific psionic skill, and defender rolls against a Willpower attribute to resist. (A defender may have an appropriate psi skill to use instead, such as Mind Shield.) An example of an Opposed action would be an attempt to create fear in someone.
Unopposed psionic actions usually target inanimate objects. An Unopposed action could be as simple as examining an object psychically, or as complex as opening a dimensional door at one’s feet. Telekinetically hurling an object at a foe is an Unopposed action because the object, not the foe, is the subject of the psionic skill.
When a Psi wishes to use an ability, the player describes the result he wants to the GM. The GM then assigns a Difficulty level to the action. Even if a psi overcomes a defender’s Willpower roll to resist, he must still roll the Difficulty level or higher to succeed at a task.
There may also be a minimum Power level needed in order to attempt an action. For example, telekinetically lifting a pencil might only require a Terrible Telekinesis Power, but lifting a large book might require a Mediocre Telekinesis Power, and lifting a car might require a Superb Telekinesis Power. If the psi’s Power level is three or more above the minimum needed, he gets a +1 to his skill level.
Note that mentally lifting a pencil might only require a Terrible Power level, but manipulating it to sign one’s name would probably require a Superb skill result. To accurately forge another person’s signature would not only require a Superb Telekinesis skill result, but also a Fair or better Forgery skill result.
The time required to activate a psionic ability depends on the potency of the desired effect and the Power level of the character. It is set by the GM. This can range from a single combat round to hours of concentration. The individual can also vary the time concentrating (which must be uninterrupted) to speed up the results or increase the chances of success — see Section 7.36, Psi Modifiers Summary.
The Psi now applies all modifiers and rolls against the Difficulty level using the appropriate skill. In an Opposed action, both parties involved make their rolls. On tie results, the status quo is maintained, whatever that may be.
At this point, a psi (or animate target of a psionic attack) may attempt to sacrifice one or more levels of Psychic Reservoir to augment his rolled result. That is, if a psi fails in an Unopposed action, he may stress himself in an attempt to succeed. In an Opposed action, this can be considered two people locked in psionic combat, each struggling to boost their power a bit to overcome the other.
To augment a rolled result, a Psionicist rolls against the psionic skill he just used, with current modifiers still effective. If the result is Good, he may sacrifice one level of Psychic Reservoir to give him a +1 on the result of the skill attempt. On a result of Great, he may sacrifice one or two levels, gaining +1 for each level, and on a roll of Superb or better, he may sacrifice up to three levels of Psychic Reservoir. On a result of Fair, Mediocre or Poor, there is no effect: he may not sacrifice a level of Psychic Reservoir, but there is no penalty for having tried. On a result of Terrible or worse, however, he not only drains one level of Psychic Reservoir, he also loses one level of rolled result. This can intensify any negative consequences of having failed.
If one party of an Opposed action is successful in augmenting his rolled result, the other may then try to augment his. They may continue to trade sacrificing levels of Psychic Reservoir until one of them fails to change the result, or falls below Terrible Psychic Reservoir.
Someone defending with no psionic abilities rolls against Willpower–2 to augment his result.
Once augmenting — if any — is complete, the GM decides the duration of the effects — the better the roll, the better the results. Some effects will be permanent, such as Healing. Continuous concentration may be required to sustain other effects; this may slowly drain one’s Psychic Reservoir.
Psionic abilities are sometimes dangerous to use. A rolled degree of Terrible or worse will usually result in the exact opposite of the desired outcome, or some other entertaining backfire. In addition, the psi loses one level of Psychic Reservoir, as outlined in Section 7.33. It may also have a gruesome result: brain hemorrhage, loss of sanity, or a similar outcome. A Terrible result on an Opposed psionic action can mean the loser is now psychically open to his opponent. Such an open channel to another’s psyche means that if the winner has any psychic ability at all, he can automatically draw on the loser’s Psychic Reservoir to power his own abilities. The GM should determine these effects based on the situation at hand.

7.35  Desperation Psionics
Ordinarily, if the minimum Power level of a proposed psionic action is higher than the character’s Power level, the psionicist may not attempt the action at all. However, if one is desperate enough, he can try it — at a great price.
For each level of Psychic Reservoir voluntarily drained before the skill roll, a psionicist can increase his Power level by +1. Simply pushing the Power level up to match the minimum level needed is all it takes to try the skill — but he is at –2 to his skill for each level of Psychic Reservoir he drained for this attempt.
Unlike augmenting a rolled result (as described in the previous section), draining one level of Psychic Reservoir before the die roll is automatically successful.
This is obviously not for casual use: the risk of a Terrible outcome is much higher than normal, as well as the guaranteed drain on Psychic Reservoir. Nonetheless, if one were being attacked by the Spawn of The Other, a demon of tremendous power, one might try anything to survive.

7.36  Psi Modifiers Summary
Apply as many modifiers to the skill as are appropriate:

	Psychic Reservoir Level:	Psionic Skill use at:
	Mediocre		–1
	Poor			–2
	Terrible			–3
	Below Terrible		Prohibited

Skill augmented by draining Psychic Reservoir: +1 per level
Terrible or worse result on skill augmenting attempt: –1
Desperation attempts: –2 per level of Psychic Reservoir drained
Power level is 3 or more greater than necessary for the task: +1
Concentration time reduced by half: –1
Concentration time doubled: +1
Certain drugs, devices, fields, star alignments, areas, etc., can also have modifiers. As a GM-chosen option, psionics may be blocked by metal — either all metal or just certain ones.

7.37  Psi Examples
Yardmower Man wants to mow the lawn psionically — he needs the practice. He currently has a Good Psychic Reservoir and an interesting assortment of psi Powers and skills. The GM decides that to move and control the yard mower is a Great Difficulty level task on Telekinesis skill. It requires only Mediocre Telekinesis Power, however. Yardmower Man has a Good Telekinesis Power but only Fair Telekinesis skill. It may be tough to do it well, but he’s willing to try it.
Yardmower Man declares he’s going to spend twice as much time concentrating (+1) and is also under the influence of Batch-5, a psi-enhancing drug (+1). He rolls a –1 result, which means a Good Telekinesis effort due to his modifiers. He just missed the Difficulty level. Since his power is adequate to move the lawn mower, he still mows the lawn telekinetically, but doesn’t do a very good job. In fact, it looks sloppy: there are thin strips of unmowed grass here and there, and he took out half of his daisy bed with one poorly aimed swipe.
Since this is a continued use, the GM decides that for each hour spent mowing he reduces his Psychic Reservoir by one level. It takes him two hours.
The next day, Yardmower Man decides the director of the local government psionic research facility should be Molecularly Rearranged. (He’s always snooping around, and has been known to lock up psis in the past.) The GM rules that Molecularly Rearranging a human other than the Psi himself is a Superb Difficulty level task against the Shapeshift skill, and requires at least a Great Shapeshift Power. It is also a taxing thing to do: it will drain one level of Psychic Reservoir at the end of the action. It will be opposed by the director’s Presence attribute, which is as close as this campaign comes to willpower.
Fortunately for Yardmower man, he has the Shapeshift Power and skill both at Superb level. He also consumes a double dose of Batch-5, giving him a +2 in the Opposed action, but severely risking side effects. His Psychic Reservoir is down to Mediocre from activities the night before (–1 to skill). Yardmower man rolls a –1 Result. This is modified –1 for low Psychic Reservoir, and +2 for Batch-5, giving him a Superb Result.
The poor director has a Good Presence and Fair Psychic Reservoir. He gets lucky and rolls a Great Presence result trying to resist the psionic attack. But Great is not good enough (Yardmower man got a Superb result), so he tries to augment his result by sacrificing a level of Psychic Reservoir to fight the rearrangement of his molecules. His sacrifice roll (against Presence) is a Good Result, so he increases his result to Superb. He’s still holding on, but just barely. Also, his Reservoir will be Mediocre after this round of psychic combat.
Yardmower Man, not to be outdone, attempts to sacrifice his own Psychic Reservoir. He started the combat with a Mediocre Psychic Reservoir and full of Batch-5, so he still applies the +1 overall modifier to his Superb Shapeshift skill on his augmentation roll. He easily achieves a Good Result, and he therefore augments his result to Superb+1. (After this round, his Reservoir will also drop another level.)
The director desperately tries to augment his result again, but rolls a Fair result: he’s reached the limit of his ability to stave off defeat. Yardmower Man rearranges the director into a lovely bush, and stares blankly at the outcome. At this point, his Psychic Reservoir drops one more level, as required by the GM for such a taxing action.
Since he lost one level of Psychic Reservoir augmenting his skill, and another for the difficult Shapeshift action, Yardmower Man is now left with a Terrible Psychic Reservoir; he’d better not try anything this difficult for a while. Also, the GM demands a Good Difficulty level roll against Constitution to avoid any unpleasant side effects from the Batch-5 overdose. Yardmower Man gets a Mediocre result, missing by two levels. The GM smiles at the player, and secretly jots down that the next time he uses Batch-5, he’ll hallucinate that the director has returned to human form and is out to get him…. 
Yardmower Man may someday drain his Psychic Reservoir fighting someone that isn’t there.

</pre>
</div>
<div title="7.4 Alternate Rules" creator="JonasSusara" modifier="JonasSusara" created="201010230756" changecount="1">
<pre>One of Fudge’s basic premises is that people have different tastes. Here is a collection of alternate rules sections for doing things slightly differently.

7.41  Alternate Section 1.4:Character Creation
Date: December, 1992
By: Ed Heil
Instead of creating characters before starting the game, create them as the game progresses.
The GM assigns a number of skill levels available to a PC during a session. This should be based on how finely the GM defines skills: about 10 to 15 for broad skill-group games, and maybe twice that for fine skill-group games. These may be traded at the regular rate of 3 skill levels = 1 attribute level, or 6 skill levels = 1 gift. Faults may also be taken, subject to GM approval.
The players start with most of the character sheets blank — simply write out a brief sentence or two describing the character in a general way. (“Jeb is a surly dwarf, a good fighter, who is out to make a name for himself as a mean customer — and pick up some loot on the way. He likes to talk tough, and doesn’t care much for halflings.”)
As the character is confronted with challenging situations, the player must decide the level of the trait in question. For example, the PCs are confronted with a ruined castle to explore, and all the players state their characters are looking for hidden passageways. At this point, each player must set his PC’s skill in finding hidden passageways (however the GM defines such a trait: Perception attribute, or Find Hidden skill, or Architecture skill, etc.). Those who are not yet willing to set such a trait must stop searching: if you use a trait, you must define it. 
Since setting an initial skill at Fair level uses up two skill levels, and setting it at Superb uses up five levels, one must carefully weigh spending levels on skills as they are used versus saving them for emergency situations.
As usual, attributes are considered Fair unless altered, and most skills default to Poor. Taking a trait at a level below the default adds to your available skill level pool, of course. However, you may only define a trait as it is used in a game situation.
Experience points are given out as usual, but EP awarded are reduced by any unused skill levels after each session. That is, if you have two levels left after the first session, and the GM awards you three EP, you only get one more level for the next session, since you already have two levels unused. EP, in this case, can be used either to raise existing skills, as discussed in Section 5.2, Objective Character Development, or they can be used to add new skills, as discussed in this section, above. 
Note that it costs more EPs to raise an existing skill than it does to define a previously undefined skill in this on-the-fly system. EP should be slightly higher under this system than a regular character creation system, perhaps a range of up to ten per session.

7.42  Alternate Section 3.2:Diceless Action Resolution
Date: May, 1995
By: Reimer Behrends
This section handles ways of resolving conflicts without resorting to the use of dice. There are reasons to do away with dice: some people find dice mechanics too intrusive for play; others may want to get rid of randomness altogether.
However, diceless action resolution is ill-suited to simulation-based gaming, despite the fact that the game can (and should) feel just as real as one with dice. Also, diceless resolution is usually more demanding of the GM than rolling dice to select an outcome. Even more so as there is no hard-and-fast rule for resolving conflicts without dice; instead, some creativity is required of the GM to fill in certain blanks.

7.421  Basics
The basic idea behind diceless action resolution is simple: the GM decides upon an appropriate outcome, based on player input and the situation at hand. The details of this, however, can be more complicated.
The idea is to use cause and effect to convey the feeling that whatever happens to the characters is not due to whim, but occurs because of the logic of the situation and the relevant history of everyone involved. It is important that any event (with exceptions, of course) appears to a be a logical effect of the preceding events. There is usually not a single event that is the outcome. The GM has to choose between several possible outcomes — which may vary wildly in terms of success and failure.
Consequently, the two most important parts in resolving an action are the reasons for a particular outcome and the consequences of that outcome.
Reasons are numerous. Foremost among reasons for success and/or failure is of course effective skill. However, a game where a sufficiently skilled character always wins and an incompetent character always fails would be quite boring due to its predictability. So we have to diversify these results, but in a way that doesn’t feel artificial.
We do this by accounting for other factors besides effective skill. These factors can involve the environment (slipping in a puddle), equipment (a gun that jams at a critical moment), time constraints (defusing a bomb before it goes off), NPC actions (a character stepping in the way), etc. The idea is not to account for all possible factors, just to find one or two reasons that make the outcome seem logical.
Detailed description is essential to diceless action resolution — description not only of the environment, but also of the characters. Noting that a character has a Great fencing skill may often suffice, but it is better to add some details (ideally through a character history). Describe style, weaknesses, and strengths, even though they may normally not show up on the character sheet. The same is true for the description of important actions.
Sometimes a character’s perception (or lack thereof) may result in failure to notice why something happened. If, for instance, the floor suddenly gives way beneath him, he may not be certain as to what caused this to happen: did he step on a trap, or was there an outside agent involved? In this case, the GM will hide some or all of the reasons.
In addition to reasons, we have to consider consequences: what impact does a particular outcome have on the situation as a whole? The more serious the outcome, the more the reasons for it happening need to be convincing.
As an extreme example, death of player characters should only occur with ample forewarning of the risks or with really compelling reasons. Of course, jumping off a skyscraper will most likely render a character dead the instant he hits the ground. This is acceptable, because the players understand the logic of the situation. But slipping on a wet rock while crossing a stream — which can be ascribed to just plain bad luck — shouldn’t kill a character outright. While it’s true that slipping on a wet rock probably happens more often than jumping off a building, the GM needs to be careful in deciding the consequences of such an action.
There are many possible results for typical actions. So, lacking clear ideas as to which one is most appropriate — maybe even torn between clear success and catastrophic failure — how can this selection be narrowed down?
There are a few ways to approach the problem, and it is a good idea to reach an agreement with the group before play commences as to what factors will be used. The following list is far from complete, but gives some possibilities:
1) Realism: A master archer will hit the target most of the time. But sometimes even he will fail, or even have a streak of bad luck. This is important for maintaining a feeling of realism in the long run. It should also be noted that realism is relative to genre. Chandelier-swinging is likely to succeed in a swashbuckling romp, while it is at best a risky endeavour in a gritty game.
2) Drama: Sometimes certain outcomes are dramatically more appropriate than others. This unfortunately depends to a great degree upon individual gaming style and can only be handled briefly here.
3) Characterization: Sometimes, a character’s success or failure at a particular task can help to reinforce or develop his character story.
4) Theme: By assigning a certain “theme” to each scene in the game as it is encountered, actions can be resolved in a way that emphasizes that theme. An example:

[The theme is “Combat is dangerous”]

GM: “Suddenly, you hear a rustling in the underbrush, and then, out of it, a boar emerges, charging at you.”
Player: “I’m not armed! I’ll jump for the branch of the oak next to me and pull myself up to safety.”

[While the avoidance of a fight supports the theme, “Combat is dangerous,” there are other possibilities that emphasize it better.]

GM: “You get hold of the branch, but as you start to pull yourself up, you hear a loud CRACK, and all of a sudden the ground rushes upwards to meet you.”

[The situation is now much more dangerous. However, with a bit of luck and the help of the other characters in the group it is still possible to handle it without killing the PC.]

All of the above factors are meta-game issues. This is intentional. These factors contribute towards an interesting game, and one of the points of role-playing is to have an interesting game. Besides, we are already using the in-game factors as cause and effect to convey a natural flow of events so we have to resort to the meta-level here.
It may look as though there is a lot of arbitrariness on the part of the GM. This is correct to some extent. Some individual decisions will be arbitrary. In the long run it should balance out, especially if the players possess even the slightest creativity. Note also that the GM should always respect player input. If something is going to fail that should normally work, failure should still reflect player input. (For instance, the example above with the breaking branch, where the character technically succeeds, but the branch does not cooperate).

7.422  Balance Of Power
There is no need to encumber the GM with all the decisions. The easiest way to hand some power back to the players is to give them a (limited) voice in the decision making process. For this purpose we employ Fudge Points (see Section 1.36).
By spending one Fudge Point, the player (instead of the GM) can decide the outcome of an action his character is involved in, provided the action is possible and not abusive to the game. (Blowing up an entire building with a cup of gunpowder is implausible, and possibly abusive to the plot). If the action is far beyond the normal skill of the character (given the circumstances), the GM may require expenditure of two or three Fudge Points instead.
Notice that using Fudge Points also gives the GM more leeway; she need no longer worry too much whether letting a character fail is too harsh, as it is within the power of the player to help his character if need be.

7.423  Combat
Diceless combat is action resolution with two added complications: the high risk of character death and a considerable amount of action that needs to be synchronized.
The synchronization part is fairly easy: as in resolution with dice, you can divide the entire combat in rounds of appropriate duration, cycling through all participating characters each round, or use story elements as suggested in Section 4.21.
Character death is trickier because players dislike losing their characters due to bad luck (be it because of an unlucky die roll or GM whim). The key here is to “post warning signs” before dangerous situations occur. These warnings should be subtle, such as the maniacal gleam in the opponent’s eyes just before she launches a wild flurry of attacks. (Hopefully the player will say his character is on the defense, or announce some trick to counter a charge.) A description of the blood dripping from a character’s wrist should warn the player that there may be a slippery puddle on the floor. In other words, prepare reasons for outcomes in advance and — most important — announce them to the players.
If the players maintain some maneuvering space for their characters after such warnings, that should be sufficient to prevent PC death — though not necessarily PC failure.
Character death — and any other drastic result — is usually due to a series of failures, each pushing the character a step further towards the edge — but always with opportunity to find a more favourable course of action in between. Unfortunately, in some situations this entire series of failures takes no longer than a few seconds.
The details of combat interaction are now fairly easy to handle, as they are an extension of normal diceless resolution. However, particular care should be taken to describe actions fully, especially in melee combat. The statement “I attack the pirate” is infinitely less informative than saying, “I assault the pirate with all I have, even if that means taking a blow or two myself. But I have to get out of here, and that means getting by her and at least wounding her so she can’t follow quickly.”
The object is to give the GM enough data to work with, such as, “I’m going to feint towards the left, and if she goes for it, I’ll try to use the opening created to end this business quickly,” or “Now that she’s wounded, I’ll play it safe, trying to wear her down.” Statements like these help the GM decide how combat should be resolved much more than a simple, “I attack her.”
The key here is to be creative. Everything is possible, so everything should be considered, from a simple rugby tackle to complex tactical maneuvering.
Bloodshed is an unfortunate but largely unavoidable side effect of combat. Wounds are also important because they may become major factors in the future course of the combat. Thus, wounds must be described and their effects detailed. For example:
“The ball of fire explodes in the centre of the room. You feel a wave of searing heat washing over you, burning your clothes away and scorching your skin. The heat gradually abates, but you still cannot see anything, as the incredible brightness that hurts your eyes is only slowly receding.”
The player should gather from this that his character is temporarily blinded, in severe pain, needing medical attention, in a state of dishabille, and in grave danger if enemies are approaching.
(This is of course appropriate for a high fantasy game. In a more realistic game, the character is probably charred and dead.)
Another example, this time a sniper’s bullet hitting the character’s arm:
“Something very hot and painful pierces your left arm. It also jerks you around abruptly, making it hard to maintain balance. Worse, your arm feels totally numb and is probably fairly useless right now. The good news is that they (whoever they are) apparently missed your heart by a few inches.”
And so on. There is no need to be too graphic in describing wounds, though. More important is the description of how the wound affects the character.

7.424  Summing Up
Fudge is ideally suited to diceless action resolution since it’s already simple and word-based. This can set the tone for the amount of description necessary for a diceless game to succeed. Once players and GM get used to diceless Fudge, they’ll find themselves describing their characters and actions in ways they never thought of before — and the game can be richer and more entertaining for it.

7.43  Alternate Section 3.2:Rolling the Dice
Date: January, 1993
By: Andy Skinner
As a simple variation on any dice technique, allow players who roll a +4 result to roll again. If the result is positive, add it in to the +4 already rolled. If the result is negative or zero, ignore the second roll. This allows a small chance of results up to +8, which can be lifesaving in a dire situation.
Only a pitiless GM would balance this by requiring additional rolls to see how miserably a person can do on a –4 result, however.

7.44  Alternate Section 4.36:Heroic Evasion
Date: February, 1995
By: Peter Bonney &amp; Steffan O’Sullivan
If a PC is hit, he may reduce the effect of the hit by one wound level by throwing himself heroically out of the way of (at least part of) the blow. However, this heroic evasion will put the fighter at a temporary disadvantage: –2 on the next combat round in addition to any other penalties that may be accrued. This penalty disappears in subsequent rounds, as the hero is able to recover his equilibrium after a brief flurry of wild parrying. This may be repeated, but there is an additional –1 for every turn in succession that this is used.
For example, D’Artagnan would be hit by Milady for a Light Wound (Hurt result). He heroically evades, taking only a Scratch, but is at –2 on the following round. In this round, he would be Very Hurt, but again he heroically evades, taking instead a Hurt result. The next round he is at –4: –2 for evading this round, an additional –1 for evading two rounds in a row, and –1 for being Hurt. If he can avoid having to evade on the next round, he’ll only be at –1 for being Hurt. Good luck D’Artagnan!
If the penalty for an heroic evasion drops a fighter’s skill level to below Terrible, he may still take the evasion. But he automatically collapses: his weapon drops from his nerveless fingers and his throat is helplessly exposed to the enemy for an instant death blow if the foe is so minded. A plea for mercy may accompany such an evasion, but the opponent isn’t necessarily bound to honor such a plea.
Heroic Evasion can be used for major NPCs, too, of course.

7.45  Alternate Section 4.56:Recording Wounds
Date: December, 1992
By: Bernard Hsiung
Ordinary playing cards can be used to keep track of wounds. Give a player one face-down card when his character is Hurt, and another face-down card when his character is Very Hurt. He gets rid of them when the character is healed. Face-up cards represent fatigue — the character is reeling from exhaustion. He gets rid of those by resting. (A character becomes fatigued by physical or mental activity, work, stress, etc. Casting spells, using psi powers, etc., may or may not count as fatiguing mental activity.)
Each card the character has represents a –1 to traits that would logically be affected until the third, which represents incapacitation.
The cards may also describe hit location, if desired: a black card is the torso, while a red card means an extremity. The lower the red card, the lower the extremity; the higher the red card, the higher the wound on the body.

</pre>
</div>
<div title="Appendix I: Open Game License Version 1.0a" creator="JonasSusara" modifier="JonasSusara" created="201010201340" modified="201010210712" changecount="2">
<pre>The following text is the property of Wizards of the Coast, Inc. and is Copyright 2000 Wizards of the Coast, Inc (&quot;Wizards&quot;). All Rights Reserved.

1. Definitions: (a)&quot;Contributors&quot; means the copyright and/or trademark owners who have contributed Open Game Content; (b)&quot;Derivative Material&quot; means copyrighted material including derivative works and translations (including into other computer languages), potation, modification, correction, addition, extension, upgrade, improvement, compilation, abridgment or other form in which an existing work may be recast, transformed or adapted; (c) &quot;Distribute&quot; means to reproduce, license, rent, lease, sell, broadcast, publicly display, transmit or otherwise distribute; (d)&quot;Open Game Content&quot; means the game mechanic and includes the methods, procedures, processes and routines to the extent such content does not embody the Product Identity and is an enhancement over the prior art and any additional content clearly identified as Open Game Content by the Contributor, and means any work covered by this License, including translations and derivative works under copyright law, but specifically excludes Product Identity. (e) &quot;Product Identity&quot; means product and product line names, logos and identifying marks including trade dress; artifacts; creatures characters; stories, storylines, plots, thematic elements, dialogue, incidents, language, artwork, symbols, designs, depictions, likenesses, formats, poses, concepts, themes and graphic, photographic and other visual or audio representations; names and descriptions of characters, spells, enchantments, personalities, teams, personas, likenesses and special abilities; places, locations, environments, creatures, equipment, magical or supernatural abilities or effects, logos, symbols, or graphic designs; and any other trademark or registered trademark clearly identified as Product identity by the owner of the Product Identity, and which specifically excludes the Open Game Content; (f) &quot;Trademark&quot; means the logos, names, mark, sign, motto, designs that are used by a Contributor to identify itself or its products or the associated products contributed to the Open Game License by the Contributor (g) &quot;Use&quot;, &quot;Used&quot; or &quot;Using&quot; means to use, Distribute, copy, edit, format, modify, translate and otherwise create Derivative Material of Open Game Content. (h) &quot;You&quot; or &quot;Your&quot; means the licensee in terms of this agreement.

2. The License: This License applies to any Open Game Content that contains a notice indicating that the Open Game Content may only be Used under and in terms of this License. You must affix such a notice to any Open Game Content that you Use. No terms may be added to or subtracted from this License except as described by the License itself. No other terms or conditions may be applied to any Open Game Content distributed using this License.

3.Offer and Acceptance: By Using the Open Game Content You indicate Your acceptance of the terms of this License.

4. Grant and Consideration: In consideration for agreeing to use this License, the Contributors grant You a perpetual, worldwide, royalty-free, non-exclusive license with the exact terms of this License to Use, the Open Game Content.

5.Representation of Authority to Contribute: If You are contributing original material as Open Game Content, You represent that Your Contributions are Your original creation and/or You have sufficient rights to grant the rights conveyed by this License.

6.Notice of License Copyright: You must update the COPYRIGHT NOTICE portion of this License to include the exact text of the COPYRIGHT NOTICE of any Open Game Content You are copying, modifying or distributing, and You must add the title, the copyright date, and the copyright holder's name to the COPYRIGHT NOTICE of any original Open Game Content you Distribute.

7. Use of Product Identity: You agree not to Use any Product Identity, including as an indication as to compatibility, except as expressly licensed in another, independent Agreement with the owner of each element of that Product Identity. You agree not to indicate compatibility or co-adaptability with any Trademark or Registered Trademark in conjunction with a work containing Open Game Content except as expressly licensed in another, independent Agreement with the owner of such Trademark or Registered Trademark. The use of any Product Identity in Open Game Content does not constitute a challenge to the ownership of that Product Identity. The owner of any Product Identity used in Open Game Content shall retain all rights, title and interest in and to that Product Identity.

8. Identification: If you distribute Open Game Content You must clearly indicate which portions of the work that you are distributing are Open Game Content.

9. Updating the License: Wizards or its designated Agents may publish updated versions of this License. You may use any authorized version of this License to copy, modify and distribute any Open Game Content originally distributed under any version of this License.

10 Copy of this License: You MUST include a copy of this License with every copy of the Open Game Content You Distribute.

11. Use of Contributor Credits: You may not market or advertise the Open Game Content using the name of any Contributor unless You have written permission from the Contributor to do so.

12 Inability to Comply: If it is impossible for You to comply with any of the terms of this License with respect to some or all of the Open Game Content due to statute, judicial order, or governmental regulation then You may not Use any Open Game Material so affected.

13 Termination: This License will terminate automatically if You fail to comply with all terms herein and fail to cure such breach within 30 days of becoming aware of the breach. All sublicenses shall survive the termination of this License.

14 Reformation: If any provision of this License is held to be unenforceable, such provision shall be reformed only to the extent necessary to make it enforceable.

15 COPYRIGHT NOTICE
Open Game License v 1.0 Copyright 2000, Wizards of the Coast, Inc.
Fudge 10th Anniversary Edition Copyright 2005, Grey Ghost Press, Inc.; Authors Steffan O'Sullivan and Ann Dupuis, with additional material by Jonathan Benn, Peter Bonney, Deird'Re Brooks, Reimer Behrends, Don Bisdorf, Carl Cravens, Shawn Garbett, Steven Hammond, Ed Heil, Bernard Hsiung, J.M. &quot;Thijs&quot; Krijger, Sedge Lewis, Shawn Lockard, Gordon McCormick, Kent Matthewson, Peter Mikelsons, Robb Neumann, Anthony Roberson, Andy Skinner, William Stoddard, Stephan Szabo, John Ughrin, Alex Weldon, Duke York, Dmitri Zagidulin</pre>
</div>
<div title="Character Creation Terms" creator="JonasSusara" modifier="JonasSusara" created="201010210654" modified="201010210811" changecount="7">
<pre>;Trait
: Anything that describes a character. A trait can be an attribute, skill, inherited gift, fault, supernormal power, or any other feature that describes a character. The GM is the ultimate authority on what is an attribute and what is a skill, gift, etc.
;Level
: Most traits are described by one of seven adjectives. These seven descriptive words represent levels a trait may be at. In addition, the Objective Character Creation method grants the player free levels, and demands he keep track of them. In this case, one level is required to raise a trait to the next better adjective.
;Attribute
: Any trait that everyone in the game world has, in some degree or other. See Section 1.31, Attributes, for a sample list of attributes. On a scale of Terrible ... Fair ... Superb, the average human will have an attribute at Fair.
;Skill
: Any trait that isn’t an attribute, but can be improved through practice. The default for an unlisted skill is usually Poor, though that can vary up or down a little.
;Gift
: Any trait that isn’t an attribute or skill, but is something positive for the character. Some ~GMs will define a certain trait as a gift, while others will define the same trait as an attribute. In general, if the trait doesn’t easily fit the Terrible ... Fair ... Superb scale, it’s probably a gift.
;Fault
: Any trait that limits a character’s actions, or earns him a bad reaction from other people.
;Supernormal Power
: Although technically gifts, supernormal powers are treated separately in Chapter 2.

</pre>
</div>
<div title="DefaultTiddlers" modifier="JonasSusara" created="201010120249" modified="201010210739" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" server.page.revision="201010122131" changecount="5">
<pre>[[Fudge System Reference Document]]</pre>
</div>
<div title="Fantasy Fudge: A Sample Fudge Game" creator="JonasSusara" modifier="JonasSusara" created="201010201302" modified="201010231218" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="17">
<pre>!A Sample Implementation of Fudge by Ann Dupuis
Based on “Five Point Fudge” by Steffan O’Sullivan

Five-point Fudge is an alternative character creation system by Steffan O’Sullivan. It’s used here as a basis for a sample Fudge fantasy role-playing game. Five-point Fudge is suitable for any genre, but each genre requires customized skill lists, gifts, faults, and attributes. The version presented here is for a Fantasy genre only. 

These lists should not be considered as canon – everything in Fudge is fully customizable, and these lists are offered only as an easy introduction to Fudge.

Fudge itself makes no mention of “character points,” using the word “levels” instead.  The Five Point Fudge system of character creation introduces character creation points, which are different from levels.

Fantasy Fudge is an example of one way a Gamemaster may decide to customize Fudge to a fantasy campaign world. The game design choices made in Fantasy Fudge shouldn’t be considered the “best” way to play Fudge in a fantasy game, as players’ and GMs’ tastes vary.

Note: although Fudge itself may be freely copied, provided proper credit is given, Five-Point Fudge and Fantasy Fudge are fully copyrighted and may only be copied for personal use.

[[Fantasy Fudge: Character Creation]]
[[Fantasy Fudge: The Skill Groups]]
[[Fantasy Fudge: Skill Descriptions]]
[[Fantasy Fudge: Attributes]]
[[Fantasy Fudge: Gifts]]
[[Fantasy Fudge: Faults]]
[[Fantasy Fudge: Magic]]
[[Fantasy Fudge: Clerical Magic]]
[[Fantasy Fudge: Non-Human Races]]
[[Fantasy Fudge: Equipping Characters]]
[[Fantasy Fudge: Damage Factors and Equipment]]
[[Fantasy Fudge: Settings for Fantasy Fudge]]
[[Fantasy Fudge: Action Resolution]]
[[Fantasy Fudge: Rolling the Dice]]
[[Fantasy Fudge: Unopposed Actions]]
[[Fantasy Fudge: Opposed Actions]]
[[Fantasy Fudge: Combat]]
[[Fantasy Fudge: Wounds]]
[[Fantasy Fudge: Stun, Knockout, and Pulling Punches]]
[[Fantasy Fudge: Situational Rolls]]
[[Fantasy Fudge: Fudge Points]]
[[Fantasy Fudge: The Only Rule You Really Need To Know]]
[[Fantasy Fudge: Sample Characters]]
[[Fantasy Fudge: Wild Things]]
</pre>
</div>
<div title="Fantasy Fudge: Action Resolution" creator="JonasSusara" modifier="JonasSusara" created="201010231154" changecount="1">
<pre>There are two types of actions in Fantasy Fudge – Opposed Actions, and Unopposed Actions.

A fight between two creatures will most often be resolved as a series of Opposed Actions. 

An attempt to climb a cliff will most often be resolved as an Unopposed Action. The Gamemaster sets the “Difficulty Level” that must be met or surpassed for the action to succeed.

Note that very easy actions should be automatic; no need to roll. Likewise with impossible actions; the character just can’t do it, and will fail in the attempt no matter how lucky the player is with dice.

If the character doesn’t have an appropriate skill to attempt a task, the GM may allow the player to roll on the default level for that skill (usually Poor). The GM may call for a roll against an attribute instead of a skill whenever it seems appropriate (asking for an Agility check rather than a Climbing check, for example), although an unskilled character should get a negative modifier to the dice roll.</pre>
</div>
<div title="Fantasy Fudge: Attributes" creator="JonasSusara" modifier="JonasSusara" created="201010231209" changecount="1">
<pre>There are six attributes in Fantasy Fudge. The GM may customize this list as she wishes – changing the attributes included, adding or deleting them at will.
Reasoning: Thinking ability; puzzle-solving; intelligence; mental acuity.
Perception: Awareness of the environment; raw ability to notice things.
Willpower: Strength of will; psychic stamina; determination; guts.
Strength: Physical strength; lifting/ carrying capacity; ability to deal damage.
Agility: Physical dexterity; adroitness; native talent for physical skills.
Health: Fitness; resistance to disease and injury; physical stamina.

Allocating Attributes
All attributes start at Fair.  Each character may take two free attribute levels, either raising one attribute two levels, or two attributes one level each.  (The GM may allow more or fewer free attribute levels – see Campaign Power Levels in the online version of Five-point Fudge.)

In addition, players may trade levels – that is, lower an attribute to Mediocre in order to raise one other attribute one level, and so on.  Also, subject to GM approval, a character may raise an attribute by taking an additional Fault, or by foregoing one of the two free Gifts.

Conversely, a player may forego one of his free two attribute levels in order to take an extra Gift – again, subject to GM approval.

Attributes are not linked to skills in this game.  The player is encouraged to choose attribute levels which make sense, given his skill list. For example, three or more points spent between Combat, Scouting and Athletic skills means that the character would logically be above average in Strength, Agility, and/or Health. If the player decides not to raise at least one of these attributes above Fair, he should have a good story as to why they are abnormally low.

Using Attributes
Attributes are used for three things in the game:
* As very broad skills. There will be times in which no particular skill listed in the rules is appropriate for the task the character is attempting. In these cases, the GM will choose the closest attribute and have the player roll versus the attribute.
* In certain opposed actions, such as attempting to sneak by a guard (Move Quietly skill vs. Perception attribute) or a swindle attempt (Con skill vs. Reasoning attribute) or an attempt to strangle someone (Strength attribute vs. Health attribute). The GM will think of other cases readily.
* As a broad handle on who the character is. A high Reasoning, low Strength character has a different flavor from the opposite attribute levels.

</pre>
</div>
<div title="Fantasy Fudge: Character Creation" creator="JonasSusara" modifier="JonasSusara" created="201010231217" changecount="1">
<pre>Fantasy Fudge uses the standard seven-level Trait scale to describe a character’s attributes and skills (see Fudge in a Nutshell, above.) To create a character, follow these steps:

# Decide what type of character you would like to create. If you’re not sure, see the Broad Class Templates, section 6.42 of the core Fudge rules, for some ideas. See also Character Creation Tips, section .
# Spend “points” to purchase skills from two or more Skill Groups. See Character Points, right.
# Assign Attributes (see Attributes, below).
# Choose Gifts (two, unless trading; see Gifts, below).
# Choose Faults (two, unless trading; see Faults, below).
# Adjust attributes, gifts, faults, or skills by trading if desired.

You may use the sample Fudge character sheet in the Miscellaneous Charts and Information at the end of this document to record your character’s traits. With the Skills list, you should record the number of points you spend in which skill groups (see right). For example:
Combat: 2 pts
Scouting: 2 pts
Athletic: 1 pt

!Character Points
The Five Point Fudge system of character creation organizes skills into skill “groups” to help players decide which skills are best for the characters they wish to create. There are eight skill groups in Fantasy Fudge: Athletic; Combat; Covert; Knowledge; Magic; Professional; Scouting; and Social (see below).

Fantasy Fudge recommends that players be granted 5 points to purchase skills from these various skill groups. If you wish beginning characters to be more or less powerful than those presented here, please see Campaign Power Levels in the full version of Five Point Fudge, online at http://www.io.com/~sos/rpg/fudfive.html.

A player can spend his points in any of the groups that he chooses, up to four points in any one group. (He must spend points in at least two groups.) Each quantity of points spent provides a certain number of skills (of the player’s choice) from the appropriate group, at the levels shown below.

Because a character with too few skills may be weak in a given campaign, the GM may limit the number of points you can spend on narrowly focused skill groups. (Suggested limit: two points, either 1 in each of 2 Groups or 2 “narrow focus” points in a single Skill Group.)

Spending One Point on a Skill Group
Examples of point expenditure: if a player wishes his character to be a dabbler at Combat, he could spend one point on the Combat group. Using a broad focus, he could then choose any three Combat skills at Fair and any one at Mediocre. Using a narrow focus, he may choose any two Combat skills: one at Good and one at Mediocre.

Example 1: one point in Combat
One-handed Sword: Fair
Fast-draw Sword: Fair
Shield: Fair
Brawling: Mediocre

Example 2: a different way to spend one point in Combat
Spear: Fair
Throw Spear: Fair
Tactics: Fair
Knife: Mediocre

Example 3: one narrowly focused point in Combat
Bow: Good
One-handed Sword: Mediocre

Spending Two Points on a Skill Group
If a player spends two points in a skill group, he can choose two skills at Good, and four more at Fair (using a broad focus), or one at Great, one at Good, and one at Fair (using a narrow focus).

Example 4: two points in Combat
One-handed Sword: Good
Fast-draw Sword: Good
Bow: Fair
Tactics: Fair
Brawling: Fair
Read Opponent: Fair

Example 5: two narrowly focused points in Social
Fast-talk: Great
Parley/Negotiate: Good
Camaraderie: Fair

The more points a player spends in a given skill group, the more his character gains both familiarity with a number of skills and greater expertise in some of those skills. For example, a Combat specialist is a professional soldier who will be an expert with a few weapons, but will have also used many other weapons over the course of his career.

!!Tips on Point Spending
The player may choose any skills within a given skill group, up to the number listed for the points spent. The player may decide which of those skills are at the listed levels. If the GM doesn’t want a character to know a given skill, she should make sure the player understands this before character creation.

Thus there are thousands of player character types available in this system, yet all are easily customized to the player’s desires. If you want your character to be a Jack of All Trades, don’t spend more than two points in any skill group. If you want a specialist, spend at least three points in a skill group.

The possible combinations of spending five points are:

5 different skill groups:	1, 1, 1, 1, 1
4 different skill groups:	2, 1, 1, 1
3 different skill groups: 	3, 1, 1   or   2, 2, 1
2 different skill groups: 	4, 1   or 3, 2


Points Spent		Skills in that Group,	
in a Group		at which Levels		Skills at Level
(maximum 4 pts)		Broad Focus		Narrow Focus		General Skills Point:

	1		3 at Fair			1 at Good		3 at Fair, from any
			1 at Mediocre 		1 at Mediocre		two or three groups

	2		2 at Good		1 at Great
			4 at Fair			1 at Good
						1 at Fair	

	3		1 at Great
			3 at Good
			4 at Fair

	4		1 at Superb
			2 at Great
			3 at Good
			3 at Fair

Trading Allowed:
1 skill for 2 skills at one level lower
Attribute levels (lower one to raise another)
1 Attribute levels for 1 Gift (or vice versa)
1 Extra Fault = 1 Gift or 1 Attribute Level

General Skills Point
A player may spend a maximum of one point as a General Skills point. This means you may spend one point and take any* three skills at Fair. These skills can be from two or three different skill groups, if desired (there is no point in taking them all from the same group). Note that a General Skills point does not get you as many skills as a broadly focused point (four), but more than a narrowly focused point (two).
* = The GM may restrict certain skills, such as Magic skills, from being taken with a General Skills point.

!!Trading Skills
During character creation you may trade one skill for two skills of lesser value. Thus you could trade one Good skill for two Fair skills, or one Great skill for two Good skills. For example, spending two points in a skill group normally gets you 2 Good and 4 Fair skills. You could instead choose 2 Good, 3 Fair, and 2 Mediocre skills.
Skills involved in the trade must all be from the same skill group. Exception: with a General Skills point (see above), you can trade a Fair for two Mediocre skills from two different groups. Thus a character could take six Mediocre skills from six different groups with a General Skills point.
No other trading of skill levels is allowed, unless using the expanded trading option in Campaign Power Levels (see the full version of Five-point Fudge online).

Customizing Skill Points
The Gamemaster may customize skill points and character creation as desired. If narrowly focused points seem too costly  (giving up half the skills of a broadly focused point for an increase of one level in one skill), add another skill at Fair. Do skill levels seem too low for your epic campaign? After they’ve created their characters, let your players raise five skills of their choosing one level each (subject to your approval).
See Campaign Power Levels in the full version of Five-point Fudge online for more tips on customizing character creation.

Character Creation Tips
There are many ways to create a character. If you have a concept in mind, scan the skill lists that seem most likely to fit your character. A fighter will obviously need to spend some points in Combat skills, and a thief in Covert skills.
Since you must spend points in at least two skill groups, try to think of what other skills would be helpful – or perhaps simply fun – for your character to have.
Once you’ve decided which skill groups to choose from, jot down the most appealing skills in these groups. The number of skills you want from a given group will tell you how many points you need to spend in that skill group. For example, if only two or three skills appeal to you from a group, spending 1 or 2 narrowly focused points is sufficient. If you really want eight or ten skills all from the same group, you’re creating a specialist character: you’ll probably have to spend three or four points in that skill group to get that many skills. (Another way to get eight or ten skills, if you don’t mind low skill levels, is to use the “trading skills” option.) A Jack of All Trades character rarely spends more than two points in any one group, and is interested in skills from three or more different skill groups.
Once your skills are chosen, you can then set your attributes, Gifts, and Faults. At that point you’ll easily be able to see what levels your attributes should logically be, and which Gifts and Faults would go most appropriately with your character.
It’s best to consult with the Gamemaster and the other players when creating characters. This can prevent problems with characters that are unsuited for the planned campaign, or PCs that encroach on one another’s “spotlight” time because their skills and abilities compete with rather than complement those of the other characters. The Gamemaster should approve all characters before play begins.
</pre>
</div>
<div title="Fantasy Fudge: Character Development" creator="JonasSusara" modifier="JonasSusara" created="201010231158" changecount="1">
<pre>After each game session, award Fudge Points (see section 1.36) to the characters. Fantasy Fudge suggests 1-3 Fudge Points per gaming session. The GM may reward really good roleplaying and problem solving with more Fudge Points. Fudge Points may be used to “fudge” a game result, or they may be saved up and traded for Experience Points at a rate of 3 Fudge Points = 1 EP. The EPs may then be spent to raise skills or attributes, or acquire additional Gifts, etc., as outlined in Chapter 5: Character Development.
</pre>
</div>
<div title="Fantasy Fudge: Clerical Magic" creator="JonasSusara" modifier="JonasSusara" created="201010231203" changecount="1">
<pre>5-Point Fudge uses Fudge Miracles (section 7.2) as a basis for Clerical Magic.

The Gift Divine Favor is required to use Clerical Magic. It’s possible to play a priest without Divine Favor – simply choose the Professional skill Counseling/Priest and assemble an appropriate set of skills. But such a priest has no ability to use Clerical Magic. Note also that you don’t have to be an ordained priest in any religion to have Divine Favor or to use Clerical Magic.

Skills available to a character with Divine Favor include the mundane and the supernatural. The supernatural are cast strictly through the power of the God or gods served by the cleric. If the cleric’s behavior is inconsistent with the God’s desires, this ability is withdrawn, at least temporarily.

Supernatural skills in the following list are detailed – any other skill is mundane and uses the description in the Skill list. This list assumes a benign deity who grants free will and supernatural aid to its followers in times of crisis. Other skills may be appropriate for other types of clerics – plant magic for Druids, for example, and more spirit magic for shamans. Evil clerics have a different skill list – your characters should pray they never meet them….

Aid Task: by touching someone who is trying to accomplish a task that is in the deity’s interest, you can grant a +1 to their skill.
Arcane Lore
Banish Spirits: you can force spirits and demons from another plane to return to their proper plane.
Bless: you can grant a +1 (or more, if the GM is willing) defensive bonus to someone, which lasts until the next combat ends.
Counseling/Priest
Detect Lies: your ability at this is enhanced.
Exorcism: you can force a spirit or demon which has invaded a body or dwelling to leave.
First Aid
Healing: you can channel healing from the deity you serve.
Medicine
Oratory
Parley/Negotiate
Persuade
Remove Fatigue: you can restore endurance to the weary.
Repel Undead: you can ward off zombies, vampires, ghosts, etc., from your presence.
Teaching
Theology/Rituals
True Sight: you can see through illusions.
Ward: you can protect a person or all within a room-sized area from supernatural evil, either spells, spirits, undead, demons, etc.

Calling on Divine Favor
When a cleric with Divine Favor calls on his deity, make an Unopposed action roll against the specific Clerical Magic skill (see Action Resolution, above).  On a Good or better result, the cleric’s petition for divine favor is answered. For clerical skills where exact results aren’t quantified (such as Healing), the better the rolled result, the better the answer to the prayer. For example, a Good result may reduce one wound by one wound level, while a Superb result could heal an injured character entirely.

On a Fair or Mediocre result, the favor simply isn’t granted. On a Poor or worse result, the deity may be angry with the cleric. The GM should consider the character’s recent actions, especially in regard to the cleric’s religious beliefs. If there are any reasons for the cleric’s deity to be less than satisfied with service rendered, this is the time for that to become abundantly clear. If the cleric’s behavior has been exemplary (so far as the deity is concerned), a failure simply means the deity was busy with other things, or considered the favor unimportant (or counter to its own desires) for some reason.

Modifiers: The GM can apply any modifiers she thinks applicable. Suggestions may be found in Section 7.2 of the core Fudge rules, and include +1 or more if the cleric has recently been furthering the deity’s cause, or –1 if the most recent petition for Divine Favor ended in a Poor or worse result.</pre>
</div>
<div title="Fantasy Fudge: Combat" creator="JonasSusara" modifier="JonasSusara" created="201010231148" changecount="1">
<pre>Combat
In Fudge, a combat “round” can be defined as the Gamemaster wishes. Fantasy Fudge assumes one “round” (roll of the dice) equals about 3 seconds of combat action. Actions occur simultaneously.
Combat can be resolved as an Unopposed action if it involves ranged combat, a combatant being caught unawares (giving a “free attack” to the opponent), or a “cannon-fodder” type of NPC (see Special Circumstances, below). Otherwise, treat combat as a series of Opposed Actions.
The players of characters engaged in opposed actions will roll the dice once each combat round; the result determines the winner of that round. 

Special Circumstances
A Terrible hit never damages the target, even if it beats the opponent’s sub-Terrible result.

When multiple opponents attack a single target, the lone fighter is at –1 to skill for each foe beyond the first. The player rolls once; compare the result with each of the opponents’ rolls. The solo combatant has to defeat or tie all of the opponents in order to inflict a wound. If he beats all of his foes, he may hit one of his choice. Otherwise, he can only wound another whose result is at least two levels below his. The lone fighter takes multiple wounds if two or more enemies hit him.

Unlike “star” NPCs, who are treated much like PCs, “cannon fodder” opponents will always get results equal to their trait levels. You can treat this as an Unopposed Action with a Difficulty Level equal to the NPC’s combat skill.

When “cannon fodder” NPCs gang up on a player character, use the “multiple opponents” rule above, but compare the outnumbered fighter’s result with the NPCs’ combat skill levels (not “rolled degrees”).</pre>
</div>
<div title="Fantasy Fudge: Damage Factors and Equipment" creator="JonasSusara" modifier="JonasSusara" created="201010231159" changecount="1">
<pre>For weapons, armor, and other equipment likely to be used in combat situations, the player or GM should determine Offensive and Defensive Damage Factors.

Damage Factors are simply the sum of damage-related modifiers for each weapon or armor type. These factors will be used to determine damage points and wound levels in combat (see Wounds, section ).
Sample “Wound Factors” are detailed on in section 4.53. Use these to determine the “Offensive Damage Factor” for each character/weapon combination.

For example, a character with Good Strength wielding a longsword would have an Offensive Damage Factor of +4 (+1 for Strength; +2 for a large one-handed weapon; +1 for sharpness). A character with Fair Strength wielding the same weapon would have an ODF of +3 (no Strength bonus). Remember to include any bonuses or penalties due to Scale when dealing with non-human combatants.
Then determine the character’s “Defensive Damage Factor” for both “unarmored” and “armored” (if the character possesses armor). Modifiers range from +0 for no armor to +4 or more for heavy or magical armor. Scale and Gifts such as Tough Hide can also affect a character’s Defensive Damage Factor.
</pre>
</div>
<div title="Fantasy Fudge: Equipping Characters" creator="JonasSusara" modifier="JonasSusara" created="201010231200" changecount="1">
<pre>The Gamemaster may wish to define a “starting equipment” package that all characters will have (unless they took the Poor Fault or Wealthy Gift). This may include such things as clothing (perhaps one good set and an everyday set), footgear, and weapons appropriate to their Combat skills. They may also have travel or camping gear (such as wineskins or canteens, a messkit, a tinderbox, and other items common in the campaign world).

Players should be allowed to customize their characters’ equipment list a bit, adding things that make sense given their skills. Characters with Climbing skill may have rope, a grappling hook, iron spikes, or similar equipment that can aid in climbing.

Characters should also be allowed to purchase equipment – spending their hard-earned wealth for the privilege, of course. The GM may want to prepare an “equipment list” with average prices for common items available in the campaign world. Appropriate equipment lists may also be borrowed or adapted from other roleplaying games. 
</pre>
</div>
<div title="Fantasy Fudge: Faults" creator="JonasSusara" modifier="JonasSusara" created="201010231205" changecount="1">
<pre>Each character must start with two Faults from the following list, or other GM-approved Fault. In addition, each Fault chosen beyond the mandatory two allows the player to choose an additional Gift for his character, or raise an attribute one level, subject to GM approval.

Absent-Minded: your attention tends to wander if bored.
Annoying Voice: you sound terrible.
Appearance: your appearance is off-putting in some way, whether ugly or unkempt.
Bad Back: you are limited in what you can lift.
Bad Eyesight: you don’t see very well – pick one: poor distance or up-close vision.
Blunt and Tactless: you have no social skills in dealing with sensitive people.
Code of Honor: your actions are constrained by your personal behavior code.
Color Blindness: you confuse lots of colors.
Combat Paralysis: you need a Good or better Health roll in order to act in a dangerous situation. 
Compulsive Carousing: you are at –3 Willpower to resist a good time.
Compulsive Gambling: your are at –3 Willpower to resist a gambling game.
Compulsive Generosity: you are at –3 Willpower to resist giving things away to those perceived to be needier than you.
Compulsive Lying: you are at –3 Willpower to avoid lying just for fun.
Coward: you take very good care of yourself.
Curious: you are at –3 Willpower to resist exploring something new or unusual.
Delusions: the world doesn’t work the way you think it does, in some important way.
Dependent: you’re responsible for someone unable to care for themselves adequately.
Duty: you must perform active duty a certain amount of time.
Dwarfism: you are very short for your race.
Easily Distractible: did you say something?
Easy to Read: you give away your thoughts and feelings to any who care to observe you.
Enemy: there is someone who wants to kill, imprison, or otherwise trouble you.
Fanatic Patriot: your country, right or wrong.
Frightens Animals: you have an aura that animals find terrifying.
Garrulous: you won’t shut up.
Getting old: and all that implies.
Glutton: you’re hungry.
Goes Berserk if Wounded: you’re a danger to your friends, even.
Greedy: you want more.
Grouchy: you’re usually irritated and try to spread the mood.
Gullible: -3 to Reasoning to believe an unknown “fact.”
Hard of Hearing: what?
Honesty: you hate to break a law. See Truthfulness for not liking to lie.
Humanitarian: you help the needy for no pay.
Idealist: you’re not grounded in reality.
Impulsive: you act before thinking.
Intolerant: you hate a certain type of person.
Jealous of Anyone Getting More Attention: you have to be the star.
Lame: you limp, which can affect speed and agility.
Lazy: you work hard at avoiding work.
Lechery: you’re overly fond of the appropriate sex.
Loyal to Companions: you won’t abandon, cheat, hide treasure from, etc., the party members. This one may be mandatory.
Magic Susceptibility: you are at –3 Willpower to oppose hostile magic.
Melancholy: life is so sad. 
Miserliness: you hate to let it go.
Mute: you can’t speak.
Night Blindness: you see poorly in dim light.
Nosy: your neighbor’s business is yours.
Obese: you waddle.
Obsession: you must do it, or have it, or whatever.
Offensive Habits: too many to list.  Some of the other Faults listed actually fall under this category, such as Nosy, Grouchy, Garrulous, etc.
Offensive Odor: you stink.
One Eye: you lack depth vision and can be blindsided.
One Hand: it works overtime.
Outlaw: you’re wanted by the law.
Overconfident: you know you can’t fail.
Owe favors: you owe someone favors, and they’ll ask you for them sometime.
Pain Intolerant: you’re at –1 if Scratched, -2 if Hurt, and –3 if Very Hurt.
Phobias: lots of these – you’re at –3 Willpower to avoid acting out of control in certain situations: snakes, darkness, heights, cats, falling, crowds, spiders, open or closed spaces, magic, loud noises, etc. 
Poor: you start with less equipment and cash, and if you don’t buy off this Fault, will always lose any you gain.
Practical Joker: you can’t resist.  Somebody’s gonna hurt you someday.
Primitive: you’re from a pre-metal-working society.
Proud: many things are beneath your dignity.
Quick to take offense: you’re thin-skinned.
Quick-Tempered: you blow up when crossed.
Quixotic: you vigorously champion lost causes.
Reckless Bravery: you take no thought for your safety in dangerous situations.
Reputation: you’re well known as some sort of louse.
Secret: if it’s revealed, you’ll be embarrassed, arrested, or worse – maybe that warrant out for your arrest, or your second spouse?
Self-defense Pacifist: you’ll fight, but you’ll never start a fight – no preemptive strikes.
Shyness: you never want to talk to strangers.
Social Stigma: you’re obviously from some low-caste group.
Stubborn: you don’t easily admit you’re wrong.  Has nothing to do with Willpower.
Susceptibility to Poison: you’re at –3 to Health in Opposed rolls for poison.
Trickster: you regularly have to take a risk to thwart some villain, even if just a petty one.
Truthfulness: you can’t tell a believable lie.
Unlucky: if something bad happens to someone in the party, it’s you.
Vain: you’re the best-looking and/or finest person in the world. Aren’t your companions lucky?
Vow: you’re committed to some action.
Worry Wart: you wring your hands a lot.
Xenophobia: you dislike and fear people different from the folks you grew up with.
Youth: you’re so young no one takes you seriously. Also, lose one level each from three skills – you just haven’t had time to develop everything that well yet.</pre>
</div>
<div title="Fantasy Fudge: Fudge Points" creator="JonasSusara" modifier="JonasSusara" created="201010231141" changecount="1">
<pre>Fudge Points allow players to “fudge” a game result. Spending a Fudge Point will allow the player or character to: 
# Accomplish an Unopposed action automatically and with panache. The GM may veto this use for actions with a Difficulty Level beyond Superb, or greater than 3 levels higher than the character’s skill or attribute used in the roll.
# Alter a die roll one level, up or down as desired. The die roll can be one the player makes, or one the GM makes that directly concerns the player’s character.
# Declare that wounds aren’t as bad as they first looked. This reduces one wound by one level (a Hurt becomes a Scratch, etc.).
# Get an automatic +4 result.
</pre>
</div>
<div title="Fantasy Fudge: Gifts" creator="JonasSusara" modifier="JonasSusara" created="201010231207" changecount="1">
<pre>Each character may have two Gifts from the following list, or other GM-approved Gift. In addition, for each Fault chosen beyond the first two, the character may have an additional Gift. The GM may limit the number Gifts available from this method, as things can get a little out of hand…. You may also gain a Gift, with GM approval, by foregoing one of your free attribute levels.
Certain Gifts, marked with an asterisk (*), may be lost if abused. Contacts, Favors Due, and Patron depend on the goodwill of others, and it’s possible to push them too far or too frequently. Good Reputation can be eroded by inappropriate behavior, and Rank can be lost if you break the rules of the organization granting the rank.

Ambidexterity: you can use either hand equally well.  Great for those times when you’re wounded in an arm….
Attractive: you’re good looking – either handsome, beautiful, pretty, or whatever you wish. (Warning: the more attractive you are, the more power you have over susceptible people, true, but the more likely you are to be abducted, etc.)
Beautiful speaking voice: +1 to NPC reactions.  Also works for a singing voice if you take a Musical skill.
Charisma: people tend to like you, believe you, and are willing to follow your lead.
Common Sense: when you are about to do something incredibly stupid that will harm yourself or the party, the GM will warn you.
Contacts *: you know some influential or knowledgeable people who can supply you with information.
Danger Sense: the GM will make a Situational roll – on a Good or better result, you’ll be warned of some imminent danger.
Divine Favor: the ability to cast Clerical Magic – see Clerical Magic, below.
Empathy with Animals: animals trust you and domesticated ones tend to obey you. Cruelty to animals nullifies this Gift.
Empathy with Sentient Beings: see Innate Magical Ability: Second Sight, below.
Familiar: only available to characters with the Magical Talent Gift. You have a magical familiar, which may talk, aid you in spell-casting and other tasks. This is an NPC played by the GM.
Favors due *: some people owe you favors, which you may collect. Each favor you collect must be approved by the GM.
Focused: you are at +1 to any lengthy task, but don’t notice things outside this task, such as that brigand about to skewer you….
Good Memory: you have an unusually good memory.  The player may take notes during the game and act as if the character remembered them.
Good Reputation *: you’re well known as a hero, healer, leader, fighter for justice, etc.
High Status: you are of the gentry or religious class – or nobility if you take this Gift twice.
Intuition: you have a feeling about what option to take when confronted with a choice.  The GM will make a Situational roll in secret.
Lucky: once per hour (real time), you may reroll a bad dice roll, and choose the better of the two rolls.
Magic Resistance: you are resistant to direct magic: +3 to Willpower in any Opposed rolls versus magic.
Magical Talent (specify type): the ability to perform magical feats. There are three different types of Magical Talent: Innate Magic, Hedge Magic, and Scholarly Magic. You may take multiple levels of the same type of Magic Talent.  See Magic, below, for details.
Never forgets a ____: fill in the blank with name, face, or whatever the GM will allow.
Never Gets Lost: you always know which way is North, and can retrace your route with a little effort.
Night Vision: you see well in dim light, but not in absolute darkness, of course.
Pain Tolerance: ignore wound penalties at Hurt, and you are only at –1 at Very Hurt.
Patron *: someone in power likes you. This can be simply a letter of recommendation, or it can be a favor granted.
Perfect Timing: if someone says to open the gate in five minutes, you’ll do it within two seconds of that time. Also valuable in performing.
Peripheral Vision: you can see further to the sides than most people – less easily attacked from the side or rear.
Quick Reflexes: not easily surprised by any physical attack, and you adjust quickly to shifting footing.
Rank *: you have the right to command others in an organized body of soldiers or police.
Rapid Healing: you heal twice as fast from wounds – but not magically fast.
Resistant to Poison: poison has only half effect on you. 
Tough Hide: subtract 1 from each amount of damage you take. 
Veteran: you’re experienced – add one level to each of three skills that are currently at Fair or Mediocre.
Wealthy: you start with more money than the average starting character. This can be in cash and/or equipment.</pre>
</div>
<div title="Fantasy Fudge: Magic" creator="JonasSusara" modifier="JonasSusara" created="201010231204" changecount="1">
<pre>There are four types of Magical Abilities in Fantasy Fudge. The GM may use them all, choose between them, or create her own. The Magical Abilities are:
	• Innate Magic
	• Hedge Magic
	• Scholarly Magic
	• Clerical Magic
Innate Magic takes no study – it’s a Gift you’re born with. The Gamemaster may assign this as a racial gift to non-human races (such as Elves) if she wishes. All members of such a race would have the Magical Talent: Innate Gift (or a serious Fault if they don’t).
Hedge Magic and Scholarly Magic are learned techniques. Their Talents are handled differently and are not interchangeable. Not everyone has the ability to perform these types of magic — you need the Magical Talent Gift.
Clerical Magic is actually performed by a deity through the character. You need the Divine Favor Gift to use Clerical Magic.

Innate Magic
This type of magic may be appropriate for Faerie races, who have an inborn talent for magic that has nothing to do with the learned magic of human magicians. It’s also possible to have a human character with Innate Magic, if the GM permits.
Each Innate Magical power requires the Gift, Magical Talent: Innate. Each such Gift provides only one type of Innate Magic, taken from the list below. The GM may ban some of these talents, or create others — ask. Note that some types of Innate Magic have been listed as separate Gifts, such as Danger Sense, Empathy with Animals, etc.
Dowsing: you can find water in the earth.
Eagle Eyes: you can see things clearly at a great distance.
Fire-Starter: you can create fire, though not control it. That is, you can cause something flammable to burst into flames (takes three combat rounds for small items), but can’t make fireballs or direct the fire to spread in a given direction.
Fortune Telling: you can see a possible future, as through a glass, darkly. This only works on others, and never on events which are important to you — your own future is always obscured.
Green Thumb: plants respond extraordinarily well to you, with increased growth, health, and production.
Healing Hands: you can heal one level of wounds with a touch. This takes one minute and is fatiguing (see Hedge Magic, below, for fatigue effects).
Second Sight: you can see through illusions and “read” general personalities. You can’t read minds or know any details of personality, but you’ll know who to trust if you concentrate.
Shapeshifter: you can change into one GM-approved animal or plant form. It takes three combat rounds to change fully, during which you are defenseless. [Costs two Gifts]
You don’t need to spend any points on skills to have Innate Magic – you only have to buy the Gift. No skill roll is usually required – the talent is automatic, although it may take time. Should it ever be an issue, each talent is known at a Great level.
You may add to this list any innate magic abilities for non-human races in your campaign world.

Hedge Magic
Note: Hedge Magic is based on the Hedge Magic system created for GURPS® by S. John Ross. (GURPS is a registered trademark of Steve Jackson Games.) 
GURPS Hedge Magic can be found at:
http://www.io.com/~sjohn/hedge.htm
Hedge Magic is the “peasant” version of magic: hedgerow witches and village wizards concocting herbal potions, creating charms, nullifying (or, alas, casting) curses, etc.
You may spend up to four points in the Hedge Magic group, but only as many points as you have levels of the Magic Talent: Hedge Magic Gift. That is, if you take only one level of Magic Talent: Hedge Magic Gift, you may only spend one point on Hedge Magic skills.
The skill list for Hedge Magic follows, and is treated like any other skill group. That is, one point spent in Hedge Magic allows you to choose 3 skills at Fair and 1 at Mediocre, etc. Each skill is a mundane skill found in other skill groups — if you learn it in the Hedge Magic group, there is no need to learn it from another group.
You may use a mundane skill from this group without applying Hedge Magic. But if you use Hedge Magic, you can accomplish more than you could otherwise. Hedge Magic is not flashy magic — you’ll never see major magical effects from it. It’s nonetheless effective in what it tries to do.
Hedge Magic is fatiguing, however — your Health attribute drops one level, temporarily, for each use. If your Health level falls below Terrible, you are exhausted and collapse — treat as the fatigue equivalent of “Incapacitated.” A level of fatigued Health is regained simply by resting 15 minutes.
Another possible downside to Hedge Magic is that the results may be perceived as magical, which, depending on the situation, may get the caster in trouble.
The following mundane skills are the only ones which may be enhanced by Hedge Magic, unless the GM permits otherwise. Those without descriptions are simply assumed to provide enhanced results.
Animal Handling
Astrology: fortune telling for other folk — grants no inkling of your own future.
Camouflage: if you don’t want to be seen, you’re very hard to spot.
Cooking: tasty, nourishing, mildly healing.
Counseling: your sympathetic ear and wise advise can soothe troubled souls.
Craft: most of the craft skills, such as Pottery, Smithy, Tailor, etc., allow you to make superior quality items more quickly. These items are of exceptional quality, but are not really magic items… or are they?
Detect Lies
Farming: a very common use of hedge magic, you can bless or curse crops: increased yield, faster growth, etc. — or the opposite.
First aid: you can stop bleeding with a touch, and enable the severely injured to survive until appropriate care is available.
Herb Lore: the archetypal hedge magic skill: preparation of magical concoctions. While not as potent as alchemical elixirs, they are quicker to make. Common potions include healing, sleep, love, charisma, strength, endurance, etc. — ask the GM what’s possible. Use Poisons for harmful potions.
Medicine: expeditious and efficacious healing.
Move Quietly
Poisons: your poisons are more potent, faster acting, and harder to detect. Shame on you.
Storytelling: you can enthrall an audience, and even sway their mood to your purposes.
Tracking
Veterinarian: expeditious and efficacious healing. For evil hedge witches, this is also the skill used to sicken animals, a common complaint in former days.
Weather Sense: you’re remarkably accurate.

Scholarly Magic
Scholarly Magic is the “upper class” version of magic: sorcerers in towers poring over ancient tomes, wizards roaming the world seeking out spell-crafters and new sources of power, colleges of magicians teaching apprentices while debating amongst themselves the merits of this spell or that, etc.
A sample Scholarly Magic system is presented below. It’s a flexible magic system, with no preset spell list, and thus leaves a lot of decisions up to the GM. Gamemasters are welcome to substitute any other magic system of choice. The sourcebook A Magical Medley from Grey Ghost Games contains a chapter on creating Fudge magic systems, as well as six sample systems. The Gramarye is particularly recommended; you can also find it online at http://fudge.phoenyx.net/gramarye/. Also recommended: Fudge Magic (see section 7.1 of the core Fudge rules), GURPS® Magic, and Four-by-Five Magic (http://www.io.com/~sos/rpg/4by5.html).

Magical Talent: Scholarly Magic
Characters wishing to learn Scholarly Magic must have the Magical Talent: Scholarly Magic Gift. You may spend up to four points in the Scholarly Magic group, but only as many points as you have levels of the Magic Talent: Scholarly Magic Gift. If you spend only one Gift on Magic Talent: Scholarly Magic, you may only spend one point on Scholarly Magic skills. Note that Scholarly Magic skills cost more; see below.
Characters without Magical Talent may learn the Thaumatology Knowledge Skill instead. This will allow them to recognize magic spells, skills, and possibly magic items and talismans (especially if powerful or well known), but not cast magic themselves.

Skill Points and the Scholarly Magic Skill Group
The Scholarly Magic skills are difficult areas of study, covering magical incantations, rituals, arcane knowledge, and more. There is no default for these skills, so a character learning Scholarly Magic in-game (as opposed to pre-game character creation) would learn the skill at Terrible. They cost more at character creation, as well.
Note that you may trade 1 Scholarly Magic skill for 2 skills at one level lower. And remember that you can spend only as many points in Scholarly Magic as you have Gifts in Magical Talent: Scholarly Magic.

	Points Spent		Skills in that Group,
	in Scholarly Magic	at which Levels
	(Max = # Gifts)		(choose from one column or the other)
		1		1 at Fair	or		1 at Good	
				1 at Mediocre		1 Poor

		2		2 at Fair			1 at Great
				2 at Mediocre	or	2 at Fair

		3		1 at Good		1 at Great
				4 at Fair	or		1 at Good
							1 at Mediocre

		4		1 at Great		1 at Superb
				2 at Good	or	1 at Great
				3 at Fair			3 at Good

The Gamemaster should decide which of the Scholarly Magic skills presented here are allowed. The “Black Arts” (Sorcery and Necromancy) may be restricted to NPC villains, for example. Likewise, the Scholarly Magic Skill of Alchemy may be off limits. (PCs should be allowed to take the Knowledge Skill version of Alchemy, which allows them to recognize various alchemical potions and know something about the procedures and ingredients involved in making them, but not actually create magical elixirs.)
The GM may also decide that each culture in the game world knows only a few of the many “flavors” of Scholarly Magic. For example, Shamanism may be restricted to the “primitive” tribes on the jungle continent, or to the horse nomads on the great steppes. Another culture may know Mesmerism, but outlaw its use. A centuries-old university of mages may combine Conjuration and Kineticism into a single branch of study, and likewise with Extra Sensory Perception and Mesmerism. Perhaps Runes are a lost art, and no one living now understands the strange markings found on ancient obelisks and monuments and over archways leading to catacombs.

Scholarly Magic Skills
Alchemy: The art of mixing balms, draughts, elixirs, nostrums, ointments, philters, potions, powders, salves, tinctures, tonics, and more, with varying magical effects. Non-mages can have knowledge of the processes and ingredients and final products of alchemy, but are not able to create magical substances themselves; see the Alchemy (Knowledge) skill.
Magical Feats: The GM can have elixirs in the game which produce any magical effect she wants. Alchemical mixtures are used up when applied; unless provided in multiple “doses,” they only work once.
In-Game Requirements: Alchemical processes take a lot of time and materials to prepare. A fully equipped alchemical lab requires great wealth, which means either a high status or a patron to support them. Each alchemical concoction takes weeks or months to prepare, with a high rate of failure, and rare materials that render mass-production impractical. Player character alchemists are not likely to prepare many alchemical substances, simply because of the time and effort involved.
Restrictions: The Gamemaster may require an alchemist to also have a Magic or Knowledge Skill appropriate to the alchemical effect desired. For example, a potion of healing may require skill in Herb Lore, Medicine, or First Aid – or the equivalent Hedge Magic skills, hence requiring a Magical Talent: Hedge Magic Gift as well. A philter of flying may require Kineticism (see below) or collaboration with a Kineticist.

Artificing: Bestowing magical properties on items.
Magical Feats: As with alchemy, the GM may allow any enchanted items she wishes in the game. There are three categories of magic items: charms and talismans, with long-lasting but subtle magic; “One-shot” items such as scrolls that release their magical effect all at once (some may be enchanted to work more than once, but will stop working under pre-set conditions, or after a set number of magical feats are performed); and permanent magical items, such as magical swords, cloaks of flying, and the like. “Magic vessels” are permanent enchanted items that are relatively easy to create; they collect and store mana (magical power; see below) for later use, providing scholarly mages with a “magic battery’’ of sorts.
In-Game Requirements: As with alchemy, artificing requires lengthy rites. Even a simple talisman or charm takes several weeks to ritually prepare, although actually embuing it with magical power may require only a short ceremony and a GM-determined expenditure of mana. Powerful, permanent enchantments require the item to be specifically created and prepared with the enchantment in mind, and may require the item to be crafted out of rare or precious materials. It’s not enough to take any old sword and slap an ever-sharp enchantment on it; the sword must be forged in a prescribed manner, with rituals of artificing and enchantment performed on it throughout its creation. Artificing also requires much mana, which is usually expended in several stages throughout the artificing process.
Restrictions: Artificing requires the mage to also be skilled in the type of magic bestowed on the item. A wand that turns the target into a frog requires the Transmutation skill; a bag of winds requires the Elemental skill; and so on. Magical scrolls that allow the reader to cast spells require two skills; the Rune skill (for knowing the symbols to use to “write” the spell on the scroll) and the appropriate magic type skill (Mesmerism for a sleep spell, etc.). The GM may also require the artificer to be skilled in crafting the item to be enchanted. Magic swords may need an Artificer who is also a swordsmith (Smithy professional skill). If the artificer collaborates with another magician or with a skilled craftsman in creating an enchanted item, each participant must match or exceed the Difficulty Level set by the GM at each stage of the artificing in order for the final enchantment to work.
Note:The ability to create magic vessels is included in the Artificing skill, as the ability to store mana in an enchanted item is at the heart of all artificing.

Conjuration: Creating objects (even creatures!) out of “thin air” – or making objects disappear.
Magical Feats: A conjurer can produce magical energy (in the form of heat, or light, or both) or non-magical items (such as water, air, food, or anything else the GM allows), or creatures (normal animals, magical creatures, and even sentient creatures). The Gamemaster decides whether such conjurations actually create these things, or whether they’re “called” from another dimension or world. Most conjurations have a limited duration, and will disappear after a GM-set amount of time. Fairy Gold is an example; it looks and feels and tastes like real gold, but disappears when the spell has run its course.
The GM may allow conjurations to be “renewed” by expending more mana. Conjuration may also be used to banish items or creatures, including creatures and spirits called up by Elementalism,  Necromancy, Shamanism, or Sorcery. Such “banishments” are resolved as an Opposed action – the Conjuration Skill versus the original skill roll that called the creatures or items into being.
In-Game Requirements: Conjurations typically have short casting times (an hour or less), but require a lot of mana (magical power) to perform.
Restrictions: Conjuration creates or calls items and creatures – it doesn’t control them. For a conjurer to have control over his creations, he’ll need Elementalism (to control any element conjured), Kineticism (to animate items), or Mesmerism (to control conjured creatures).

Elementalism: Elementalists specialize in controlling and transforming the four elements: Earth, Air, Fire, and Water.
Magical Feats: Just about anything involving controlling or transforming Earth, Air, Fire, or Water can be done with Elementalism. Working with Earth, one could turn rock to dirt (or vice versa); cause (or calm!) an earthquake or rockslide; or turn a hard metal brittle. Air magic includes stirring a gentle breeze into a fiercer wind, or directing it to carry your words to a particular person’s ears in a whisper spell. An Elementalist’s campfire could remain bright and warm without consuming fuel; or shoot forth a spark to set some nearby flammable material alight. Water magic includes feats such as purify water and turning water to ice. Many materials have the properties of multiple elements – mud is Earth and Water; lightning is Air and Fire; a living creature is made up of all four elements; etc. The more elements a Feat involves, the more difficult it will be.
In-Game Requirements: Elemental magic is often quick to perform. Mana costs vary with the scope of the feat being performed. Parting a river to allow safe crossing will take much more mana than magically bringing a small cup of water to a boil. (Parting a river – or a larger body of water – can be done by many elementalists working in concert, or with a fabled and powerful Staff of Water Command.)
Restrictions: Creating some amount of an element (a fireball, for example) requires the Conjuration skill. Transforming one element into another requires the Transmutation skill. Calling forth an Elemental – a powerful construct imbued with the very essence of one of the four Elements — requires Shamanism or Sorcery.

Extra Sensory Perception: Perceiving things with more than the usual five senses.
Magical Feats: Examples of “Esper” magic include Empathy, Telepathy, Clairvoyance (seeing at a distance), Clairaudience (hearing at a distance), Astral Travel (moving out of body, or taking a soul journey to another plane), Divination, and Sensing Auras. An Esper mage also knows how to block Esper magic. Espers excel at detecting the presence or patterns of magic and mana.
In-Game Requirements: Esper magic requires concentration and focus. Typical rituals are relatively short (a matter of a few minutes), but may require a period of purification and meditation before beginning. Espers are vulnerable when experiencing out-of-body travel, and should arrange protection or safety for their physical bodies while their spirits roam.
Restrictions: The information received through Esper magic is not always crystal-clear, and may be subject to misinterpretation. Any distractions, even slight ones, while the Esper is attempting extra sensory perception requires a Willpower roll to ignore (Difficulty Level equal to that set for the magical feat itself).

Kineticism: The magic of motion.
Magical Feats: Levitation, Telekinesis, Teleportation, Animation of objects, and magical “Force” shields or weapons are all possible.
In-Game Requirements: Most kinetic feats require concentration, especially when they involve precisely targeted movement. Mana is expended to start something in motion, and then concentration and willpower are used to direct that motion. Teleportation requires the Kineticist to be at the originating point (although he can Teleport either himself or another), and also to have recently been to the destination point. Without a clear picture of the destination in mind, a Kineticist may “miss” during a Teleportation, with potentially dire consequences such as appearing a bit too far above (or below!) ground level….
Restrictions: In the case of magical “force” weapons (such as a magic missile of harm), the GM may require the player to roll once against the character’s Kineticism skill (to create the magic force) and again using either the character’s Kineticism skill or Willpower attribute to direct the missile. A magical “force” shield could be accomplished as one task – the creation of a magic force that moves with the target and blocks contact with anything physically harmful. If a Kineticist wishes to animate an object but also grant it some self-direction or even intelligence, the Shamanism or Sorcery skill is required to bind a spirit to the animated object.

Mesmerism: Affecting minds with magic. Mesmerism may be opposed by the Willpower attribute.
Magical Feats: This skill covers Hypnosis, Illusion, Mind-Control (of humans or animals), and other mind-affecting magic. The ubiquitous “Sleep” spell falls under this skill. “Invisibility” can also be accomplished with Mesmerism. At its simplest level, Mesmerism can confuse a creature’s senses. At its most insidious, it can completely enslave a creature’s mind, bending it to the Mesmerist’s will.
In-Game Requirements: Mesmerism works only against living creatures that also have at least a rudimentary mind. A Mesmerist must be within a certain distance of his targets to be able to affect their minds – the distance varies with the difficulty of the feat being attempted. The more complex the “confusion of the senses” being attempted, the more difficult the feat. The more creatures to be Mesmerized, the more mana is required. The same goes for intelligence, to a point. Normal animal intelligence, such as that of a dog or a horse, is the easiest for most Mesmerists. Affecting the minds of creatures that are more or less intelligent than “normal animal” requires more mana to overcome the target’s intelligence (or lack thereof).
Restrictions: The GM may rule that certain non-human creatures (especially intelligent ones) simply have minds that are too “alien” for a Mesmerist to affect. Mammals will be the easiest to affect. Insects, with their tiny and differently-wired brains, are not easy at all. Any creature with a Willpower attribute may oppose Mesmerism (resolve as an opposed action, Mesmerism skill vs. target’s Willpower attribute), plus any applicable modifiers.

Necromancy: “Death Magic.” Necromancy is a “Black Art,” although not as dangerous to wield as Sorcery.
Magical Feats: Creating (or destroying) and controlling undead creatures,  summoning spirits of the dead for divination, and driving a spirit from a living body are all possible with Necromancy. Necromancers can also cause hauntings or release ghostly spirits to the afterlife.  The most powerful Necromancers may be able to bring the dead back to life (a far more difficult feat than simply animating their corpses).
In-Game Requirements: Necromancers require access to the raw materials typically needed for their magic – dead bodies. Most cultures frown on such uses of earthly remains.
Restrictions: As Necromancy is illegal in many cultures, most Necromancers have the fault Secret (see above). The GM may require Necromancers to have the Kineticism skill to animate corpses (as zombies, skeletons, or other undead creatures), or she may substitute Shamanism as the means by which a spirit is tied to a corpse to create an undead creature. A generous GM will allow Necromancers to use their own methods to call the spirits or raise the dead. Necromancy may be restricted to non-player characters.

Runes: The use of arcane symbols (runes, sigils, hieroglyphics, and other marks) to cast spells and enchant items.
Magical Feats: Runes are symbols that are inherently pre-disposed to attracting mana and shaping magical power toward a desired end. Some runes are used to enhance other Scholarly Magic skills, aiding the mage’s concentration (lowering the Difficulty Level of a given magical feat), tapping into or focusing magical energy (decreasing the power point cost), or delaying or modifying the effects of a magical feat (triggering the actual spell when certain circumstances are met, for example). Other runes act more like spells, with the drawing of the rune in the prescribed manner being the only ritual required to perform the magical feat associated with that rune. Most Artificers are well versed in runes, as runes are used in preparing spell scrolls and in many other magical items. Artificing can also be used to make a rune and its effects more permanent. For example, a Sigil of Warding drawn above the archway to a room would repel an intruder only once, unless applied in conjunction with the Artificing skill.
In-Game Requirements: The appropriate rune must be carefully and correctly drawn. Simple runes may be traced in the air or on the ground with a finger. More complex runes may require the mage to draw them in blood on a ritually prepared skin, or painstakingly create them in colored sands on a flat, swept surface, or perform some other equally detailed ritual to create and invoke the rune. Generally, the more complex the magical feat being attempted, the more complex or numerous the runes required, hence the more time required in applying the runes. 
Restrictions: Each rune or symbol has a different purpose, and the mage must know the appropriate rune for a given magical feat. The Gamemaster may create a list of runes or other symbols the mage knows, with brief descriptions of how they may be used in the game. 
Note: When used in conjunction with other Scholarly Magic skills, the player may roll against the Rune skill even if Runes is not the lowest skill level involved – but only if the runes involved are directly related to the magical feat.

Shamanism: Spirit Magic. Shamans interact with spirits of varying powers. Spirits include ancestral spirits, anima (spirits that imbue every object; some anima are more powerful than others), and “guardian spirits.” 
Magical Feats: A Shaman can cause any magical effect the spirits he deals with are capable of creating. Shamans can also exorcise troublesome spirits and ghosts, and even creatures (or constructs or demons) called through Conjuration, Necromancy, or Sorcery.
In-Game Requirements: Shamans don’t typically need to expend much mana, as any magical feat beyond the initial contact with a spirit is performed by the spirit itself. Once contacted, a spirit may require a bribe, or bargain, or some other method of persuasion to actually perform the requested feat. Spirits must be honored, with each spirit requiring a different ritual. Dancing, sacrificing (of goods, animals, or even sentient creatures), and singing are often essential features of Shamanistic rituals.
Restrictions: The Shamanism roll made when a Shaman character wishes to perform a magic feat determines whether or not the Shaman successfully contacts the desired spirit.  An additional skill, such as Flatter, Intimidate, Parley/Negotiate or other persuasive means may be needed to convince the spirit to actually perform the magic feat requested of it. Shamans who fail to uphold their part of any spirit bargain tend not to be able to practice Shamanism well for long. The Gamemaster may require a Shaman to use the Extra Sensory Perception skill for communicating with the spirits through trances and out-of-body experiences. Artificing is required to create shamanistic objects (charms, talismans, and the like) imbued with spirits that perform magic for the wielder. 

Sorcery: The “Black Arts.” Sorcery relies on summoning demons and other powerful, evil beings to trick or bribe or force them into doing the sorcerer’s bidding.
Magical Feats: Anything that can be done by a demon, devil, or evil spirit can be accomplished with Sorcery – provided the sorcerer is powerful enough to summon the required entity and crafty enough to convince it to do his bidding. Sorcerers may gain innate magical gifts and other magical powers, either permanently or temporarily, through their dealings with powerful evil beings.
In-Game Requirements: There are three facets to sorcerous dealings – summoning the evil being; controlling the evil being (by holding it within a circle of power, for example); and persuading it to do the summoner’s bidding. The summoned being  will seek to twist or distort or otherwise alter any deal struck with the sorcerer, so sorcerers must take care to protect themselves and negotiate their deals carefully.
Restrictions: Penalties of failure are severe, and often gruesome. Evil beings do not take kindly to being summoned against their will, and even less kindly to forced servitude.  Should a sorcerer’s control slip, even for an instant, the demon or spirit will do its best to harm its captor. Few cultures welcome sorcerers, so the Secret Fault may be required. The Gamemaster may (and probably should) restrict Sorcery to non-player characters, or to PCs with specifically crafted backgrounds (such as a sorcerer-hunter who was once a practicing sorcerer himself).

Transmutation: Turning things into other things. Living creatures may oppose such transformations with Willpower.
Magical Feats: The more unalike the original object and the transmutated object are, the harder the feat. Turning living objects into inanimate objects (such as statues) or vice versa is especially difficult. Turning water to wine, or a glutton into a hog, are easier. Such transformations are usually of short duration; it takes much skill and power to affect a permanent transformation.
In-Game Requirements: Transmutation is a difficult art, often requiring much mana. Affecting a permanent transformation usually requires the use of a powerful enchanted item, such as a staff of transmutation or wand of frog princes.
Restrictions: If the magician’s target has a Willpower attribute, it may resist the magical change. Resolve as an Opposed Action, the mage’s Transmutation skill versus the target’s Willpower attribute, plus or minus any modifiers the GM sets.

Wizardry: The “Wise Arts.” The most scholarly of scholarly magic, Wizardry concerns itself with the laws of magic, the flow of mana, and the underlying structures of spells, incantations, and enchantments. Wizards know many ways to gather mana, and how to use it efficiently.
Magical Feats: Wizardry can detect or analyze magic and magic items, dispel magic, alter mana flows, and perform similar feats that directly affect the forces that make magic possible. Wizardry can also lower the cost in power points of a given feat (see Mana, below).
In-Game Requirements: When applying Wizardry, the Wizard must take time to consider applicable magical laws, mana flows in the area, and any circumstances present at the time of casting that could affect the outcome.
Restrictions: The GM may require the player to refer to “laws of magic” (Similarity, Contagion, or whatever “laws” are appropriate for the game world) , create rhyming “incantations,” or otherwise embellish the description of what the mage is doing when using Wizardry in a magical feat.
Note: When used in conjunction with other Scholarly Magic skills, Wizardry may provide a +1 bonus to the character’s skill roll. This occurs only if the character’s Wizardry skill is higher than one or more of the other Scholarly Magic skills involved (see below).

Magical Power (Mana)
Casting scholarly magic requires mana, or power points. Truly trivial magic (with effects similar to those attainable with Hedge Magic) uses negligible amounts of mana, but most scholarly magic requires one or more power points.
Each level of the Magical Talent: Scholarly Gift grants the character 5 power points to use in performing magic.
The number of Gifts used to purchase Magical Talent also affects how much mana the character can channel and control. One Magical Talent Gift allows the character to perform trivial magic, and magical feats costing 1 power point. Two Magical Talent Gifts increase that to 2 power points, and so on.
Attempting to channel more power than the character can normally handle requires a Willpower roll, Difficulty Level equal to Fair plus 1 per power point over the character’s usual limit. Thus, a character with 2 Magical Talent Gifts attempting to channel 4 power points to perform a magical feat must roll Willpower against a Difficulty Level of Great (Fair +2). Failure results in the loss of one level of Health by each level the Difficulty Level is missed. (A Mediocre result with a Great Difficulty Level would result in the loss of 3 Health levels; see Fatigue, below.)
Power points may be regained at the rate of 1 point per 2 hours of sleep or 1 hour of undisturbed meditation, up to the number allowed by the magician’s Magical Talent Gifts.

Fatigue
In addition to requiring mana, Scholarly Magic is fatiguing (much like Hedge Magic). The character’s Health attribute drops one level for each use. If Health level falls below Terrible, the character is exhausted and collapses — treat as the fatigue equivalent of “Incapacitated.” A level of fatigued Health is regained simply by resting 15 minutes.

Performing Magical Feats
When a character wishes to perform magic, the player should describe to the Gamemaster the magical results the character wishes to achieve. The more detail included in the description, the better. Scholarly magic depends heavily on the magician’s concentration and clarity of thought, and if the player isn’t paying much attention to what the character wishes to accomplish, the GM may assume the character isn’t, either.
The player may also describe the magician character’s actions, and aspects of the ritual being used to perform the magic feat, if desired. Including poetic incantations (especially if it’s good poetry) and other “flavor” in the description of the ritual may be worth bonuses to the character’s skill.
There are several aspects that should be considered for each magical feat:
• Skill required (Difficulty Level)
• Mana required (power points that will be used)
• Time to perform (from an instant to years)
• Materials required (if any)
• Optional modifying circumstances (lots possible)
Skill: The more complex the desired results, the higher the Difficulty Level the GM should set for a magical feat. Difficulty Levels start at Fair for simple magic, such as creating – but not controlling – fire, or speaking with a spirit that’s already “awake” and interested in communicating. Difficulty can range up to Legendary or even beyond, for god-like magical feats. Some “trivial”magic may have Difficulty Levels of Mediocre, but any magic requiring power points should be of at least Fair Difficulty.
Once the Difficulty Level is set, the player rolls against the magician’s Scholarly Magic skill. Use the lowest skill if the feat requires more than one Scholarly Magic skill.
Example: Enchanting a Staff of Dragon Summoning and Control requires skill in Artificing, Conjuration, and Mesmerism. An enchanter with Artificing: Mediocre, Conjuration: Fair, and Mesmerism: Good would roll on a skill level of Mediocre.
Mana: The more powerful or all-encompassing the desired results, the more power points will be required. “Trivial” magic may require so little mana that power point use isn’t even tracked. This doesn’t mean a mage can go around popping off trivial spells all day, though, since even trivial spells requiring no power points will fatigue the mage.
Note that the Difficulty Level and the mana required are not related; one measures complexity, the other power. Creating a small colored flame that dances in a pattern that recreates an ancient battle between wizards may be of Legendary Difficulty, but require only one power point.
Note also that some magical feats require more power points than any but the most Legendary Wizards have access to. Such feats are possible, either through pooling the power points of more than one magician, or drawing on “mana vessels” containing stored power points (see Artificing, above). Some rare materials are natural “mana vessels.” 
Time: Generally speaking, the more complex the magical feat desired, the greater the time required in preparing. This is usually true of powerful spells as well. Complex, powerful spells should take a lot of time to prepare. You can trade Time for Difficulty Level, if you wish. The less time you take in preparing the magical incantation, enchantment, or other feat, the greater the Difficulty Level. Likewise, increasing the preparation and casting time may, at the GM’s option, lower the Difficulty Level.
Materials: If the GM wishes, magical feats may require the use of materials related to the effects desired; sulphur or coal for fire, a feather for a flying spell, and so on. Some magical feats may be performed with nothing more than the magician’s concentration or some words of power; others may require rare and precious materials.
Modifiers: The GM may apply any modifiers desired. Examples include bonuses for using special materials (or using materials at all if not normally required); for performing magic in naturally magical surroundings; for applying any “laws of magic” the GM allows (if they have the Wizardry skill). Penalties may be applied for distracting circumstances, or the GM may require a Willpower roll for the mage to avoid becoming distracted and possibly losing control of the magic he’s wielding.

Determining Results
The GM judges whether a feat is within the character’s capabilities – if not, she should warn the player that attempting greater magics than the character is ready for is dangerous. The GM also determines what the actual result will be. Magic in Fantasy Fudge is an art, not a science; and the same “spell” cast in the same way may have varying results.
In general, the greater the success in performing a magical feat, the closer to the desired effects the results will be. Spectacular successes may carry unexpected benefits, such as less time required to cast, lower power point cost, and the like. Abysmal failures should be spectacular, as well. Use your imagination, but don’t allow the results to outright kill the character (unless he’s a sorcerer)! Less abysmal failures will produce unexpected and possibly unwanted results, including greater power point cost with little or nothing to show for it.

Spell Lists
It’s a good idea to take some time before play to work out some “standard” spells a scholarly mage is likely to use. Ask the player what spells the character is likely to have sought out, and work out some sample Difficulty Levels, Mana costs,  and required time and materials for those spells. Feel free to “steal” spells from other games to help build a spell list. Consider the spell’s desired affect rather than the actual game mechanics used in the game it was designed for, and base the difficulty and power levels on that.
Spell descriptions should be considered guidelines rather than strict definitions of spell effects and costs. Magical feats and their results are meant to be improvised by the Gamemaster as well as by the character.

Sample Spells
“Skinwalker.” Skill: Transmutation.  Feat: Temporarily shapechanges caster into a wolf. Difficulty Level: Good. Power Points: 2. Time: 20 minutes. Materials: Ritually prepared wolfskin (may be reused).
“Targeted Fireball.” Skills: Conjuration, Elementalism, Kineticism. Feat: Fireball moves to target and explodes. Difficulty Level: Fair. Power Points: 1 (more for larger fireball). Time: 1 combat round. Materials: Red garnet (destroyed).</pre>
</div>
<div title="Fantasy Fudge: Non-Human Races" creator="JonasSusara" modifier="JonasSusara" created="201010231201" changecount="1">
<pre>For each non-human race in the game world, create a “racial package” that includes such things as racial gifts, faults, any special powers (see Chapter 2: Supernormal Powers in the basic Fudge rules) and modifiers, including Scale and Attribute and Skill modifiers.
Determine how many “Gifts” the racial package is worth, and require that many Gifts be spent (or attribute levels reduced, or extra Faults incurred). Some racial packages will balance out, not requiring the use of a Gift slot. Some racial packages may actually qualify as Faults, allowing the character to compensate with higher Attributes or additional Gifts.
Some Skills, Gifts, Faults, Supernormal Powers, etc. may be unique to members of particular races.

Sample Racial Package: Elves
Attribute Modifiers: +1 Agility, +1 Perception. Gifts: Magical Talent: Innate Gifts, Eagle Eyes; Very Long Lifespan. Faults: Elven Code of Honor; Honesty; Truthfulness. Cost: 1 Gift.

Sample Racial Package: Halflings
Attribute Modifiers: Scale –2, Health +1. Faults: Social Stigma in non-halfling lands. Cost: 2 Faults.</pre>
</div>
<div title="Fantasy Fudge: Opposed Actions" creator="JonasSusara" modifier="JonasSusara" created="201010231150" changecount="1">
<pre>When characters engage in opposed actions (including hand-to-hand combat), the players of each contestant roll the dice, add the indicated modifiers to the appropriate skill level, and compare the results. The GM rolls for all NPCs.

Relative Degree measures the difference between the results. If one character has a Good success in an Opposed Action, and the second character has a Mediocre success, the Relative Degree is +2 from the winner’s perspective, and –2 from the loser’s perspective. In combat, the winner adds the Relative Degree to his Offensive Damage Factor to determine the number of damage points inflicted.

If it helps, you can convert the characters’ combat skills to their numerical equivalents before adding all modifiers (including the random dice roll). Alternatively, put your finger on the Terrible - Superb Trait Scale list, and move up one line for every +1 or down one line for every –1.</pre>
</div>
<div title="Fantasy Fudge: Rolling the Dice" creator="JonasSusara" modifier="JonasSusara" created="201010231153" changecount="1">
<pre>Rolling the Dice 
When a character attempts an action, roll percentiles (or use 100ths of a second on a stopwatch) and consult this table:
{{{
Rolled:   1	2-6	7-18	19-38	39-62	63-82	83-94	95-99	00
Result:  –4	–3	–2	–1	+0	+1	+2	+3	+4
}}}

If you have Fudge dice, roll four of them instead.

The result (from –4 to +4) is used as a modifier to a skill or character trait.

</pre>
</div>
<div title="Fantasy Fudge: Sample Characters" creator="JonasSusara" modifier="JonasSusara" created="201010231109" modified="201010231114" changecount="5">
<pre>!Azrath (Mage)
Reasoning	Good
Perception	Fair
Willpower	Good
Strength	Fair
Agility	Fair
Health	Fair
Knowledge Skills (1 point)
	Literacy	Fair
	Thaumatology	Fair
	Arcane Lore	Fair
	History	Mediocre
Combat Skills (1 point, Narrow Focus)
	Long Knife	Good
	Brawling	Mediocre
Outdoor Skills (1 point)
	Navigation	Fair
	Map Sketching	Fair
	Observation	Fair
	Survival	Mediocre
Magic Skills (2 Points)
	Elementalism	Good
	Wizardry	Fair
	Artificing	Mediocre
Gifts: Magic Talent: Scholarly Magic ¥ 2 (10 power points, 2 points maximum per spell); Familiar (dog) (GM approval); Wealthy
Faults: Curious; Loyal to Companions; Quixotic; Humanitarian; Code of Honor (never allow innocent people to be hurt by magic)
Equipment: Lots (due to Wealthy Gift), including: Long Knife (ODF +1); miscellaneous odds and ends to aid in spellcasting; travel gear.

!Hans (Warrior)
Reasoning	Mediocre
Perception	Fair
Willpower	Fair
Strength	Great
Agility	Good
Health	Fair
Combat Skills (3 points)
	2-Handed Sword	Great
	1-Handed Sword	Good
	Crossbow	Fair
	Fast-Draw Sword	Fair
	Brawling	Fair
	Knife	Fair
	Knife Throwing	Fair
	Read Opponent	Fair
	2-Handed Sword  Throwing	Fair
	  (GM-allowed skill)
Athletic Skills (1 point)
	Balance	Fair
	Climbing	Fair
	Running	Fair
	Swimming	Mediocre
Covert Skills (1 point)
	Tailing	Fair
	Move Quietly	Fair
	Infiltrate	Fair
	Disarm Traps	Mediocre
Gifts: Combat reflexes; Reputation as Hero
Faults: Overconfident; Violent when enraged
Equipment: Backpack with rope, waterskin, wineskin, whetstone; 2-handed sword (ODF +6); 1-handed sword (ODF +5); crossbow with 30 quarrels (ODF +4); knife (ODF +3); jewelled greaves; loincloth; fur cloak; ringmail shirt (DDF +2).

!Lena (Rogue)
Reasoning	Fair
Perception	Fair
Willpower	Mediocre
Strength	Fair
Agility	Good
Health	Great
Athletic Skills (1 point)
	Move Quietly	Fair
	Sleight of Hand	Fair
	Acrobatics	Fair
	Climbing	Fair
Combat Skills (1 point)
	Knife	Good
	Knife Throwing	Mediocre
Covert Skills (2 points Narrow Focus)
	Find Hidden	Great
	Pick Locks	Good
	Find Traps	Mediocre
	Disarm Traps	Mediocre
Hedge Magic (1 point)
	Camouflage	Fair
	Detect Lies	Fair
	Move Quietly	Fair
	Herb Lore	Mediocre
Gifts: Lucky; Magical Talent: Hedge Magic
Faults: Curious; Trickster
Equipment: Knife (one in each boot) (ODF +1); lockpicks (+1 to Pick Locks skill); various herbs &amp; things; leather armor/clothing (DDF +1); Travel gear; soft leather gloves.

!Tomas (Priest)
Reasoning	Good
Perception	Fair
Willpower	Great
Strength	Fair
Agility	Mediocre
Health	Fair
Clerical Magic (3 points)
	Ward	Good
	Healing	Good
	Theology/Rituals	Good
	Bless	Great
	Counseling	Fair
	True Sight	Fair
	Exorcism	Fair
	Banish Spirits	Fair
Knowledge Skills (1 point)
	Legends/Stories	Fair
	Literacy	Fair
	Language	Fair
	Other fields of knowledge (book sense only)	Mediocre
Combat Skills (1 point)
	Staff	Fair
	Knife	Fair
	Knife Throwing	Fair
	Tactics	Mediocre
Gifts: Divine Favor; Lucky
Faults: Self-defense Pacifist; Code of Honor
Equipment: Staff (ODF +2); knife (ODF +1); prayerbook; holy symbol; travel gear; clothing and cloak; first aid kit; formal religious garb.</pre>
</div>
<div title="Fantasy Fudge: Settings for Fantasy Fudge" creator="JonasSusara" modifier="JonasSusara" created="201010231157" changecount="1">
<pre>Where would a fantasy roleplaying game be without a setting? Wherever you want it to be!

Use Fantasy Fudge with your favorite fantasy world, whether that’s one of your own creation, a fictional world brought to life by your favorite fantasy author, a published fantasy game world, or any of a number of game worlds created by other gamers. The Grey Ghost website (http://www.fudgerpg.com) has links to many game settings created for Fudge.
</pre>
</div>
<div title="Fantasy Fudge: Situational Rolls" creator="JonasSusara" modifier="JonasSusara" created="201010231142" modified="201010231143" changecount="2">
<pre>A Situational Roll is used to show luck, outside events, or the overall situation. It isn’t based on any character traits. Simply roll the dice. A Situational Roll of –2 gives a Poor result; the situation is not good.
The GM can use a Situational Roll to determine anything from the weather to a non-player character’s attitude. 
A Situational Roll can also be used to check a creature’s “morale” during combat, especially when the creature is first wounded, and again if it becomes Very Hurt. A –1 or worse Situational Roll in the midst of combat may mean that the NPC will try to surrender or run away. You may add the NPC’s current modifiers due to wounds to the “morale” roll. A Hurt creature with a –1 Situational Roll would actually be experiencing a Poor reaction to the combat, and would probably be doing whatever it could to get out of the fight….
</pre>
</div>
<div title="Fantasy Fudge: Skill Descriptions" creator="JonasSusara" modifier="JonasSusara" created="201010231210" changecount="1">
<pre>This section contains an alphabetical list of skills, including a brief description and which groups the skills appear in. Magic skills are listed separately – see Magic,below.

Defaults: Most skills default to Poor, so if a skill isn’t listed on your character sheet, your character probably knows it at Poor. Certain skills, such as Magic, are an exception to this – they’re not known at all if not listed on the character sheet. Other skills may have a default of Terrible or Mediocre. Skills which have a default other than Poor have the default listed in [brackets].

Acrobatics/Tumbling: moving your body gracefully and successfully through difficult maneuvers, such as rolls, tumbles, leaps, springing to your feet, etc. (Athletic)
Aerial Acrobatics: swinging from ropes, chandeliers, vines, trapezes, rigging, etc., safely and accurately. (Athletic)
Alchemy: knowledge of the processes and ingredients used to create elixirs and talismans of magical power. See Magic, below, for the Scholarly Magic version, which allows you to create alchemical mixtures as well as recognize them. [No default] (Knowledge, Magic)
Animal Handling: managing animals in many situations. (Professional)
Animal Training: training animals for specific tasks. (Professional)
Arcane Lore: knowledge of occult things – otherworldly stories, legends, etc. (Knowledge)
Area Knowledge: knowledge of a given area.  The larger the area, the more shallow the knowledge. (Knowledge)
Armorer: making, altering, and repairing armor. [Terrible] (Professional)
Artist: creating aesthetically pleasing art in a given medium.  Each medium is a separate skill. (Professional)
Astrology: this is either simple astronomy or an actual potent forecasting and divination tool – ask the GM. (Knowledge)
Balance: keeping one’s equilibrium in awkward physical situations, such as tightrope walking, beam walking, crossing a stream on a log, etc. (Athletic)
Barroom Savvy: like Urban Survival, but very specific to barrooms. (Social, Covert)
Barter/Haggle: raising or reducing prices, depending on whether you’re selling or buying.  Opposed by the other person’s Barter/Haggle skill. (Social)
Basketry: making baskets and other woven products from bark, grasses, and other plant materials.  Includes a knowledge of materials, market prices, etc. (Professional)
Bluff: misleading people into thinking you will perform an action you have no intention of performing.  Opposed by Reasoning. (Social)
Boating: small boat handling. (Athletic, Scouting)
Bookkeeping: knowledge of accounting practices – requires Literacy and some math ability. (Professional)
Botany: broad knowledge of plants – their habitats, growing needs, uses, dangers, etc.  See Herb Lore, Farming, Basketry, Poisons, etc., for more specific skills. (Knowledge)
Bow: using and caring for a bow and arrows, either longbow or short bow. [Terrible] (Combat)
Bowyer/Fletcher: making bows and arrows, including harvesting the appropriate material. [Terrible] (Professional)
Brawling: fighting without weapons. (Combat)
Camaraderie: being entertaining in social settings, such as at a bar, at a party, around a campfire, etc., which can gain someone’s confidence and approval. (Social)
Camouflage: blending in with your surroundings so you don’t stand out. Primarily used in natural settings – use Disguise in urban settings. (However, a case could be made for using Camouflage skill to hide in an alley, for example.) (Scouting)
Camping: similar to Survival, but requires some tools, such as blankets, pots, an axe, a tent, etc.  In return, it allows greater comfort and quality of life in the wild. (Scouting)
Carpentry: working with wood, to make anything from houses to furniture to cabinets. (Professional)
Climbing: climbing, either natural formations such as cliffs and trees, or man-made ones such as stone, brick, etc., (but not sheer) walls. (Athletic, Covert)
Club/Mace: using a club or mace as a combat weapon. (Combat)
Con: making people believe in some plan or product you are pushing. (Social)
Cooking: preparing tasty and nourishing food. (Professional)
Counseling/Priest: comforting the afflicted, restoring good emotional health, helping people through grief, etc. (Professional)
Courtesan: professional pleasure giving. (Professional)
Crossbow: using a crossbow effectively in combat. [Mediocre] (Combat)
Dancing: dancing aesthetically. (Professional)
Detect Lies: telling when someone is lying.  Opposed by Lies/Pretense. (Covert)
Detect Traps: determining if a given area has a trap of some sort set, and what type. (Covert)
Diplomacy: not a separate skill – see Parley/Negotiate
Disarm Traps: deactivating a trap without harm.  This may or may not cause noise, however….(Covert)
Disguise: passing for someone else under visual inspection.  There is a penalty for serious inspection, of course.  Opposed by Reasoning, though no roll is needed if the observer has no reason to be suspicious. (Covert)
Engineer: designing and making tools, structures, sewer systems, etc. (Professional)
Equestrian Acrobatics: performing acrobatic mounts, dismounts, trick riding, etc.  This skill cannot be higher than your Riding skill. (Athletic)
Etiquette: knowledge of good manners in any society, and the ability to carry them out.  Not as specific as Savoir-Faire, but gives a broader base for knowledge. (Social)
Evaluate Goods: a general skill to assess the value of something.  It won’t be as accurate as a specific Professional skill (for example, a Potter will be a better judge of Pottery than someone with this skill), but as a broad skill allows a good general knowledge. (Knowledge)
Falconry: training and controlling a raptor for sport and hunting. (Professional)
Farming: raising crops and/or livestock, and everything associated with that: soil preparation, planting, weeding, tending, harvest, drying, storage, markets, etc. (Professional)
Fast-draw: readying a weapon for combat use effectively instantly. A different skill for each weapon, and some weapons cannot be fast-drawn. (Combat)
Fast-talk: convincing someone of something, which, upon reflection, they may realize isn’t true. Fast-talk doesn’t create lasting belief – see the Con skill for that.  Opposed by Reasoning. (Social)
Find Hidden: locating concealed doors, compartments, catches, etc. (Covert)
First aid: administering emergency medical treatment knowledgeably. (Knowledge)
Fishing: catching fish for food, sale, barter, or sport. (Scouting)
Flail: using a flail as a weapon. (Combat)
Flatter: making people like you by complimenting them to the point they begin to trust your judgement. Opposed by Willpower. (Social)
Flirt/Vamp: arousing sexual interest in an appropriate subject, for whatever reason. Opposed by Willpower. (Social)
Forgery: making fake documents and/or signatures that look authentic. (Covert)
Gambling: gaming for money. Note that some gambling includes games of skill, and others games of chance – this skill helps largely with the former, and knowledge of the latter, including a good estimate of the odds. Also the ability to cheat at games, and spot cheaters. (Professional)
Geography: broader than Area Knowledge, Geography is the knowledge of general topography, terrain nature, biomes, etc. (Knowledge)
Heraldry/Court Rituals: knowledge of signs, symbols, and devices used to denote rank and family of the nobility.  Also knowledge of court rituals, such as how many trumpet calls to announce a king as opposed to a duke, etc. (Knowledge)
Herb Lore: knowledge of, preparation of, dosage of, and dangers of using herbs as medicinal agents. While it may tell you which herbs to avoid, this skill does not go into specific poisons – see Poisons for that skill. See Botany for a broader knowledge of plants. (Scouting, Knowledge)
Hide Traces: hiding any traces that people or animals used an area. This includes hiding tracks as well as camping areas. (Scouting)
History: knowledge of historical figures and events. This can be a broad and shallow skill, such as World History, or a narrower and deeper skill, such as history of a specific state. (Knowledge)
Hunting: hunting and killing animals for food, hides, sport, or whatever. (Scouting)
Infiltrate: slipping into a guarded camp, either by pretending to have a right to be there or simply by avoiding all contact. (Covert)
Inn Keeping: the knowledge of running a hotel or inn: includes kitchen, bar-keeping, maid service, stable, etc. (Professional)
Interrogate: extracting information from an unwilling subject. There are two basic types of interrogators: those who get their subjects to trust them, and those who psychologically abuse them. Chose one type. Opposed by Willpower. (Social) 
Intimidate: psychologically brow beating someone else into doing your will. Does not involve any physical component. Opposed by Willpower. (Social)
Jeweler: making and evaluating jewelry. Includes assessment of gems, gold, silver, etc. (Professional)
Juggling: juggling anything you can lift. See also Performing. (Athletic)
Jumping: jumping for distance and accuracy. (Athletic)
Knife: using a knife in combat, but not necessarily to throw it. (Combat)
Knife Throwing: throwing a knife accurately and with force. (Combat)
Knot-tying: tying functional and/or ornamental knots for various purposes. [Mediocre] (Athletic)
Lance: using a lance (a type of hand-held spear used from horseback). Does not include the Riding skill. (Combat)
Language: speaking and understanding a language.  Every character knows their native language well at no cost – take this skill to learn foreign languages. Each language learned is a separate skill. [No default, or may default to similar language] (Knowledge)
Leatherwork: working with leather – includes tanning, preparation, tooling, sewing, etc. (Professional)
Legal Process: knowledge of legal matters. [Terrible] (Knowledge)
Legends/Stories: knowledge of legends and stories, either as a source for entertainment, wisdom, or clues to treasure hunting, etc. (Knowledge)
Lie/Pretense: dissembling your true intentions, origins, or role from others. Opposed by Detect Lies. (Social)
Lip reading: seeing what people are saying by watching their lips move. (Covert)
Literacy: reading and writing. (Knowledge)
Map Sketching: creating reasonably accurate and readable maps from observation. (Scouting)
Masonry: working with stone. (Professional)
Medicine: diagnosing and treating injuries and diseases in humans and other sentient beings. (Knowledge)
Merchant: broad knowledge of what it takes to be in the business of selling or trading, either retail or wholesale. (Professional)
Mimic Animal Noises: making a noise which sounds like a specific animal. (Scouting)
Move Quietly: moving without attracting attention. Opposed by Perception. (Athletic, Covert, Scouting)
Musician (each instrument separate): mastery of an instrument (which may be voice). See Performing. (Professional)
Navigation: finding your way based on the stars, position of the sun, map-reading, etc. (Scouting)
Observation: trained ability to notice and remember things – conscious application of Perception and memory. The player’s notes are the character’s memory. (Scouting)
One-handed Axe: using small axes as combat weapons. (Combat)
One-handed Sword: using any sword designed to be used with one hand. (Combat)
Oratory: keeping the focus of a group of people through speaking, and attempting to sway them to your point of view. Opposed by group’s average Reasoning-1. (Social)
Parley/Negotiate: reaching a compromise solution. (Social)
Performing: stage presence – actively entertaining people. You’ll need another skill to actually entertain with, such as Juggler, Storyteller, Musician, etc. A musician without the Performing skill may be skilled at producing music, but lacks “audience connection” and won’t be as popular as a musician with good Performing skill. (Professional)
Persuade: convincing an individual of your point of view. Opposed by Reasoning. (Social)
Pick Locks: opening locks without the correct key.  Penalty of –1 with improvised lockpicks. Difficult locks may have an additional penalty. (Covert)
Pick Pockets: removing items from an individual’s pockets, belt, purse, etc., without them noticing it.  Opposed by Perception. [Terrible] (Covert)
Pike: using a very long hand-held spear as a weapon – most useful in formations, especially against cavalry. (Combat)
Poisons: knowledge, use, preparation, and dosage of various poisons. (Covert)
Politics/International: knowledge of the international situation in a given area, and of the internal politics of states within that area. May be for a broad area, such the entire known world, or a more focused area, such as Europe. In the latter case, the knowledge is more detailed. (Knowledge)
Pottery: making pots, plates, bowls, etc., from clay. Includes the ability to assess the value of other potters’ work, knowledge of good clay sources, etc. (Professional)
Read Opponent: roughly estimating a given opponent’s skill level in combat. An exceptionally good result may even reveal a particular combat “style,” if appropriate for the setting. (Combat)
Repartee: delivering witty sayings, usually double entendres, which cannot be construed as libelous but carry hidden insults or stings. (Social)
Riding: riding and controlling a horse (or other riding animal – specify) comfortably, safely, and with precision. (Athletic)
Running: you practice a lot – better speed than non-runners, as well as distance. (Athletic)
Salesmanship: selling someone something. Opposed by Willpower. (Social)
Savoir-Faire: functioning smoothly, without social blunders, in any upper or middle class setting. (Social)
Seamanship: assisting in any task on a large sailing vessel. (Professional)
Shady Contacts: knowledge of the underworld, or, in a strange city, at least general underworld habits and likeliest places to contact fences, etc., without offending them. (Covert)
Shield: using a shield or buckler in combat, both on offense and defense. [Mediocre] (Combat)
Shiphandling: directing seamen to correctly handle a large sailing ship.  Includes piloting and navigation skills.  [Terrible] (Professional)
Shopkeeping: running a shop of some sort – knowledge of basic bookkeeping, sources of materials, rotation of stock, general prices, sales techniques, etc. (Professional)
Sleight of Hand: manipulating small objects cleverly in your hands so as to conceal what you are actually doing with them. (Athletic)
Sling: using a sling in combat. [Terrible] (Combat)
Smithy: working metal into tools, weapons, ornaments, etc. [Terrible] (Professional)
Spear: using a spear in combat, but not including throwing it accurately or powerfully. (Combat)
Spear Throwing: throwing a spear powerfully and accurately. (Combat)
Sports, Various: Each sport is a separate skill – Camp-ball (similar to football), Hurling, Pole-Throwing (Caber-Tossing and the like), Stickball (lacrosse), Stone (similar to Horseshoes), etc. Other popular “sports” are covered by other skills; Bow (for archery contests), Falconry, Hunting, Riding, etc.. (Athletic)
Staff: using a staff as a weapon. (Combat)
Storytelling: entertaining by recounting stories, either from your past or from other sources. Storytelling without the Performing skill is more likely to be successful in a bar or other personal setting than in a professional setting. (Social)
Streetwise: Savoir-Faire for the lower classes. (Covert)
Survival: surviving in the wilds.  Includes basic fire making, food procurement, and shelter construction. Won’t be fancy, but you’ll be alive. (Scouting)
Swimming: moving yourself in water without danger of drowning. (Athletic)
Tactics: knowledge of the best way to arrange a group of warriors so as to take best advantage of the situation, terrain, their skills, etc. Also reading an opposing group’s tactical sophistication level. (Combat)
Tailing: following someone without their noticing. Opposed by Perception. (Covert)
Tailor: turning cloth into clothes, as well as mending clothing. Can also make other items out of cloth, such as tents. (Professional)
Teaching: imparting knowledge or skills to others. (Professional)
Team Acrobatics: working with others trained in this skill to perform acrobatic maneuvers such as stacking, vaulting, trapeze work, etc. (Athletic)
Teamster: handling an animal or team of animals pulling a wagon, carriage, coach, etc. (Professional)
Thaumatology: the knowledge of magic spells, results, abilities, etc. Does not require any Magical Ability, nor is it required to perform magic. [No Default] (Knowledge)
Theater: the skills and knowledge associated with the theater: acting, directing, management of props, sets, the house, the stage, etc. Not the same as pretending to be someone else offstage – see Lie/Pretense for that skill. (Professional)
Theology/Myths/Rituals: knowledge of a specific religion’s beliefs, dogma, and rituals. It may also be Comparative Theology, in which case the knowledge is broader – covers more than one religion – but shallower. (Knowledge)
Throwing: throwing things accurately, but not specifically optimized to do damage. That is, it’s not a combat skill, though it could be used as one, with –1 to damage-dealing ability. (Athletic)
Tracking: following animals or sentient beings in terrain where they might leave traces. Of limited use in urban areas, it is more a nature skill. (Scouting)
Trail Blazing: finding an optimum route through wilderness, and marking your trail, either obviously or subtly. (Scouting)
Two-handed Axe: using any two-handed axe designed as a weapon. (Combat)
Two-handed Sword: using any two-handed sword as a weapon. (Combat)
Urban Survival: the skill of the urban poor: where to find free or cheap food, shelter and clothing; what parts of the city to avoid, who not to offend, etc. (Covert)
Ventriloquism: “throwing your voice” so as to make it sound as if it comes from somewhere else.  Also disguising your voice. (Covert)
Veterinarian: diagnosing and treating animal injuries and diseases. (Knowledge)
Weather Sense: predicting the weather for the near future. (Knowledge)
Weaving: spinning yarn from wool or plants, then making cloth from yarn. (Professional)
Whittling: carving wood into useful or aesthetic shapes. (Athletic)
Woods Lore: knowledge of woodland animals, plants, cycles, etc. (Scouting)
Zoology: knowledge of animal behavior, habits, diets, capabilities, etc. (Knowledge)</pre>
</div>
<div title="Fantasy Fudge: Stun, Knockout, and Pulling Punches" creator="JonasSusara" modifier="JonasSusara" created="201010231144" changecount="1">
<pre>A character may try to stun or knock out his opponent rather than wound her, in which case a Hurt result is called a “Stun” and the –1 penalty associated with being “Hurt” lasts for one combat round only. A Very Hurt result would be “Very Stunned” and the –2 penalty lasts 2 combat rounds. An “Incapacitated” result indicates the opponent has been knocked out.
A character may also pull his punches. The player simply announces the maximum wound level his character will inflict if he wins the combat round. See section 4.62 for more information.
</pre>
</div>
<div title="Fantasy Fudge: The Only Rule You Really Need To Know" creator="JonasSusara" modifier="JonasSusara" created="201010231113" modified="201010231114" changecount="2">
<pre>When in doubt, just fudge it! Simply have things happen in a way that will let the players have fun. If you don’t see a rule that covers a particular in-game situation, just use your best judgment.
</pre>
</div>
<div title="Fantasy Fudge: The Skill Groups" creator="JonasSusara" modifier="JonasSusara" created="201010231212" changecount="1">
<pre>Each genre has its own skill groups. Listed here are eight skill groups for a Fantasy setting. The GM may customize these lists, of course, and may even add or delete an entire skill group if desired.

Following the lists is an alphabetical list of the skills, with descriptions and which skill group they appear in.

Note: although four of the skill groups have multiple titles, such as Athletic/Manual Dexterity Skills, for simplicity they are referred to outside this list by the first part of the title, such as Athletic Skills.

Skills marked with an asterisk (*) appear in more than one skill group. These may be learned by spending points in either skill group – there is no reason to learn the same skill from two different groups.

Athletic/Manual Dexterity Skills
Acrobatics/Tumbling
Aerial Acrobatics
Balance
Boating *(Scouting)
Climbing *(Covert)
Equestrian Acrobatics
Juggling
Jumping
Knot-tying
Move Quietly *(Covert, Scouting)
Riding
Running
Sleight of Hand
Swimming
Team Acrobatics
Throwing
Whittling
Various Sports

Combat Skills
Bow
Brawling
Club/Mace
Crossbow
Fast-draw
Flail
Knife
Knife Throwing
Lance
One-handed Axe
One-handed Sword
Pike
Read Opponent
Shield
Sling
Spear
Spear Throwing
Staff
Tactics
Two-handed Axe
Two-handed Sword
Other weapon skill if GM permits

Covert/Urban Skills
Barroom Savvy *(Social)
Climbing *(Athletic)
Detect Lies
Detect Traps
Disarm Traps
Disguise
Find Hidden
Forgery
Infiltrate
Lip reading
Move Quietly *(Athletic, Scouting)
Pick Locks
Pick Pockets
Poisons
Shady Contacts
Streetwise
Tailing
Urban Survival
Ventriloquism

Knowledge Skills
Alchemy *(Scholarly Magic)
Arcane Lore
Area Knowledge
Astrology
Botany
Evaluate Goods
First aid
Geography
Heraldry/Court Rituals
Herb Lore *(Hedge Magic, Scouting)
History
Language (each is a separate skill)
Legal Process
Legends/Stories
Literacy
Medicine
Politics/International
Thaumatology
Theology/Myths/Rituals
Veterinarian
Weather Sense
Zoology
Other fields of knowledge if GM permits

!Magic Skills
See Magic, below. Note: Scholarly Magic skills cost more than normal skills (or other Magic skills); see below.

!Professional Skills 
Note: If a player spends 3 or 4 points in Professional Skills, he may take skills from any skill group as part of his Professional skills, provided he can make a case for their inclusion in his profession and the GM accepts this.  Not all skills will qualify! A 3-point Animal Handler can make a strong claim that Riding (an Athletic skill) should be in his Professional skill group, but he’ll have to spend at least one point in Combat to get any combat skills.

Animal Handling
Animal Training
Armorer
Artist (each medium separate)
Basketry
Bookkeeping
Bowyer/Fletcher
Carpentry
Cooking
Counseling/Priest
Courtesan
Dancing 
Engineer
Falconry
Farming
Gambling
Inn Keeping
Jeweler
Leatherwork
Masonry
Merchant
Musician (each instrument separate)
Performing
Pottery
Seamanship
Shiphandling
Shopkeeping
Smithy
Tailor
Teaching
Teamster
Theater
Weaving
Many others possible….

Scouting/Outdoor Skills
Boating *(Athletic)
Camouflage
Camping
Fishing
Herb Lore *(Knowledge, Herb Magic)
Hide Traces
Hunting
Map Sketching
Mimic Animal Noises
Move Quietly *(Athletic, Covert)
Navigation
Observation
Survival
Tracking
Trail Blazing
Woods Lore

Social/Manipulative Skills
Barroom Savvy *(Covert)
Barter/Haggle
Bluff
Camaraderie
Con
Etiquette
Fast-talk
Flatter
Flirt/Vamp
Interrogate
Intimidate
Lie/Pretense
Oratory
Parley/Negotiate
Persuade
Repartee
Salesmanship
Savoir-Faire
Storytelling</pre>
</div>
<div title="Fantasy Fudge: Unopposed Actions" creator="JonasSusara" modifier="JonasSusara" created="201010231151" changecount="1">
<pre>The Gamemaster sets a Difficulty Level for any unopposed action. This includes most ranged weapon combat — it’s difficult for a character to actually hinder someone’s attempt to fire at him, although if he has Quick Reflexes he could attempt to dodge out of the line of fire.

The Difficulty Level should take into account everything but the character’s skill (and modifiers to that skill provided by equipment or character condition, including injuries). A task with a Difficulty Level of Poor is very easy, while something with a Difficulty Level of Superb is very hard. For legendary feats, set the Difficulty Level even higher (Superb +2, for example). When in doubt, set the Difficulty Level to Fair. That will give a character with a Fair skill a 62% chance of succeeding.
</pre>
</div>
<div title="Fantasy Fudge: Wild Things" creator="JonasSusara" modifier="JonasSusara" created="201010231106" modified="201010231222" changecount="6">
<pre>(Fantasy Fudge Bestiary)
Here are some sample creatures for use with Fantasy Fudge. Feel free to taylor their descriptions and traits to fit your campaign world.
See Section 6.5, Animal &amp; Creature Examples, for more sample creatures and tips on creating your own beasts for Fudge. Monster descriptions from other roleplaying games are usually easily converted to Fudge.

Basilisk
Attributes (individuals may vary):
	Reasoning:	Fair (animal)
	Perception:	Fair
	Willpower:	Fair
	Strength:	Poor
	Agility:	Fair
	Health:	Poor
Supernatural Powers:
	Venomous Breath
Scale:	–10
Combat Skill:	Poor
Attacks:	Bite, Breath (special attack)
Damage Factors (including Scale):
	Offensive:	–10 (melee)
	Defensive:	–10 (melee)
The basilisk, sometimes called the cockatrice by peasants, is a grayish serpent that grows to no more than two feet in length. It has white markings on its head that resemble a crown. Popular legend holds that the basilisk can kill with a mere glance, but this is untrue. The basilisk’s danger lies in its venom. The venomous breath of a basilisk withers plants, scorches the earth and can kill any creature up to the size of an elephant.
In combat, a basilisk breathes a nearly invisible, cone-shaped cloud of venom that affects foes up to fifteen feet away. Any living creature caught in the cloud must make a Health roll at Great Difficulty or be immediately slain.
Basilisks are also dangerous in melee combat. Any blow that successfully damages the creature can cause the creature’s foul venom to pass up through the weapon and affect the wielder. Any time a Basilisk is struck with a melee weapon, the GM should roll a dF. On a roll of –1, the victim must make a Health roll as above or die.
A basilisk is created from an egg that is laid by a cockerel and then incubated by a toad in a dung heap.
by Anthony Roberson

Dragon
Attributes (individuals may vary):
	Reasoning:	Fair
	Perception:	Fair
	Willpower:	Fair
	Strength:	Fair (Scale +4)
	Agility:	Fair
	Health:	Fair
Gifts:
	Tough Hide (+2 Defensive Damage Factor)
	Wings
	Fiery Breath
Supernatural Powers (optional):
	Magical Talent: Innate
	Magical Talent: Scholarly Magic
Skills:
	Varies with individual; most Athletic, Knowledge, Magic, Scouting, and Social skills are possible.
Scale:	+4
Combat Skill:	Good
Attacks:	Bite, Fiery Breath, Claws
Damage Factors (including Scale):
	Offensive:	+6 (Claws); +5 (Bite); +6 Breath (on a Situational Roll of Mediocre or worse, the target of Fiery Breath catches on fire for an additional +2 damage per combat round until extinguished). Add Strength bonuses to Claws and Bite.
	Defensive:	–6 (Scale and Tough Hide)
Dragons are large intelligent reptiloids. Many are known for their vanity.
The GM should feel free to customize dragons to taste.
by John Ughrin

Ghost
Attributes:
	Not Applicable
Faults:
	Unholy (optional)
Supernatural Powers:
Insubstantial (no physical attacks, can float through walls)
Cause Fear (may force characters to make Great Willpower checks to avoid being scared off.)
Scale:	n/a
Combat Skill:	n/a
Attacks:	n/a
Damage Factors (including Scale): n/a
Ghosts are the leftover psychic residue of someone who has perished. Generally speaking, there is no physical method of removing or harming them. Some ghosts can be put to rest if a special task is completed. Usually the completion of the task is what makes the spirit hang around after its original owner perished. Ghosts are generally resentful creatures and their deep emotional disturbance puts animals at unease.
Ghosts may be influenced, confined, banished, or released by various applications of Clerical Magic or Scholarly Magic (especially Shamanism or Necromancy).
by John Ughrin

Ghoul
Attributes (individuals may vary):
	Reasoning:	Poor
	Perception:	Good
	Willpower:	Fair
	Strength:	Good
	Agility:	Good
	Health:	Mediocre
Gifts:
	Tough Hide (+2 Defensive Damage Factor)
	Damage Capacity Good (+1 Defensive Damage Factor)
	Claws (+1 Offensive Damage Factor, Poisonous)
Skills:
	Ghouls retain the skills they had when human, but at a –1 penalty.
Scale:	0
Combat Skill:	Good
Attacks:	Bite, Claws
Damage Factors (including Scale):
	Offensive:	+2 (Bite), +2 (Claws) plus poison (see below)
	Defensive:	–3 (Tough Hide, Damage Capacity)
Ghouls (also know as Ghûls and Raveners) are once-human creatures whose minds have been destroyed. They have grey, jellylike flesh, yellow fangs, and filthy, broken nails which infect their victims with a sinister toxin.
Ghouls usually inhabit underground lairs near graveyards and similar places, where a supply of their noxious “food” may be found. Ghouls usually travel in packs of 3-12, with the most powerful and intelligent member as a leader. Their usual prey is carrion, but they will attack living humans if driven to it by hunger or by a powerful master. 
Ghouls attack with their claws and teeth in a mindless frenzy. The poison in their claws drains vitality. The victim must make a Health roll, difficulty level Fair, or lose one level of health per combat round. Victims reduced to below Terrible Health become stiff and helpless.
Any human succumbing to a ghoul attack will be taken to their lair and buried. This live internment, in addition to the ghoulish poison, deranges the mind and causes physical changes that result in the victim becoming a ghoul. If sufficiently hungry, the ghouls may simply devour the victim.
Ghouls can be turned by the Repel Undead Clerical Magic skill, difficulty level Good. The clerical Ward ability keeps ghouls completely at bay.  A clerical Healing can neutralize the poison if a victim has not entirely become a ghoul.
by Kent Matthewson

Giant Worm
Attributes (individuals may vary):
	Perception:	Good
	Strength:	Good
Gifts:
	Tough Hide (+2 Defensive Damage Factor)
	Tail Stinger (+2 Offensive Damage Factor)
	Magic Resistance: Good
Skills: 
	Not Applicable
Scale:	+10 or more
Combat Skill:	Mediocre
Attacks:	Swallow, or Stinging Tail
Damage Factors (including Scale):
	Offensive:	+12 or more (stinging tail)
	Defensive:	+12 or more (Tough Hide)
		+1 if attacking from inside, see below
These giant, carnivorous worms grow to be 150’ long. They can bore through solid rock and are a menace to explorers in deep caverns.
A worm’s favorite attack is to stick its head out of a hole and swallow any creature of Scale 6 or less. Victims may attempt to dodge (Opposed Action, Victim’s Agility versus the worm’s Combat Skill). If the worm wins, the victim is swallowed.
A creature may attempt to attack a worm from the inside., difficulty level Terrible (any attack of Terrible or better has a chance of doing damage) and DDF +1. There is little room to swing weapons. 15 points of cumulative damage done to the same area within the worm allows a victim to cut an escape hole, or might cause the worm to regurgitate. 
Meanwhile, the victim is being digested. He or she takes a Scratch each combat round after being swallowed. If the victim has no Scratch boxes left, the Scratch will be a Hurt; if there are no Hurt boxes left on the victim’s wound track, the result will be Very Hurt, and so on until death.
If attacked from the rear, a giant worm will lash out with a bone-like stinger on its tail. It can do this the same round as attempting to swallow. 
by Peter Mikelsons

Goblin
Attributes (individuals may vary):
	Reasoning:	Mediocre
	Perception:	Fair
	Willpower:	Mediocre
	Strength:	Fair
	Agility:	Fair
	Health:	Fair
Gifts:
	Dark Vision
	Toughness (+1 Defensive Damage Factor)
Scale:	–1
Combat Skill:	Fair
Attacks:	By weapon
Damage Factors (including Scale):
	Offensive:	+1 (shortsword)
	Defensive:	+1 (leather armor)
Goblins are short (4’ tall), evil humanoids that are found in wild forests or mountainous areas. Goblins are tribal and matriarchal. A tribe will normally consist of between 50 and 200 individuals. The leader of the tribe is usually a female of prodigious size and foul temperament.
Goblins are not particularly fearsome opponents in battle unless they are backed by overwhelming numbers or led by a charismatic general. Goblin tribes go through periods of very high birth rates every 5-10 years. This results in periodic invasions of surrounding lands by hordes of goblins on the move due to overpopulation and starvation.
Goblins fear and hate dwarves, since dwarves often enslave them and put them to work in their mines. The average goblin is armed with a wicked-looking serrated short sword and protected by a patchwork of leather armor.
by Anthony Roberson

Great Weasel
Attributes (individuals may vary):
	Reasoning:	Fair (animal)
	Perception:	Good
	Agility:	Great
	Speed:	Superb
Skills:
	Move Quietly	Great
Scale:	–5
Combat Skill:	Superb
Attacks:	Bite and Claws
Damage Factors (including Scale):
	Offensive:	–3 (bite or claws)
	Defensive:	–5
Great weasels are 3’ long with razor-sharp claws, needle-like teeth, lightning reflexes and a bad attitude. Giant rats are their preferred prey. Great Weasels may be tamed.
With their speed and ability to move quietly, great weasels can attack their prey without warning, gaining an Unopposed attack, Difficulty Fair in the first combat round. If a great weasel wins an attack with a relative degree of +4 or more, it has bitten a major blood vessel. The victim will bleed to death in several minutes, unless first aid or healing is applied. The victim must make a Health roll (Difficulty Fair) every minute or bleed to death. GMs who allow NPCs to have Fudge points should give great weasels one point.
by Peter Mikelsons

Hydra
Attributes (individuals may vary):
	Reasoning:	Fair
	Perception:	Great
	Strength:	Great
	Agility:	Good
	Health:	Fair
Supernatural Powers:
	Many Heads (usually 5)
	Head Regeneration (see below)
Scale:	+8 (each head Scale +2)
Combat Skill:	Good
Attacks:	Bite (1 from each head)
Damage Factors (including Scale):
	Offensive:	+5 (bite)
	Defensive:	+2 (each head) or +8 (body)
Its origins shrouded in mystery, the hydra is one of the most feared creatures. It appears as a large reptile, with many heads. Its regeneration makes it nearly unstoppable and its appetite is insatiable.
Each of a hydra’s head can attack independently. For combat purposes, treat each head as a scale +2 creature whose teeth do +5 damage due to sharpness and strength.
Any wound of Incapacitated or Near Death inflicted on a head severs it from its neck. A new head will regenerate to replace the lost one. If the hydra makes a Superb Health check, two heads are regenerated. The regeneration process takes 4 combat rounds. A Hurt or worse wound inflicted by fire will prevent regeneration. Magic weapons may have similar effects.
by Steven Hammond

Hyeena
Attributes (individuals may vary):
	Reasoning:	Good (animal)
	Perception:	Good
	Willpower:	Fair
	Strength:	Good
	Agility:	Good
	Health:	Good
Gifts:
	Magical Defense (see below)
	Toughness (+1 Defensive Damage Factor)
Skills:
	Mimicry	Great (see below)
Scale:	+0
Combat Skill:	Good
Attacks:	Bite
Damage Factors (including Scale):
	Offensive:	+2 (sharp teeth)
	Defensive:	+1 (toughness)
The hyeena is a horrible beast that resembles a large hound with a spiny ridge running along its back. It lives in tombs or catacombs and feeds on the dead. It will also dig up graves in the search for bodies. Some hyeenas stalk rural areas by night and prey on shepherds or late travelers.
The hyeena has an unusual magical defense. Any creature that treads on a hyeena’s shadow is immediately struck dumb and unable to speak. The effect lasts until the hyeena is killed or an hour has passed.
The hyeena also has an uncanny talent for imitating the human voice, and uses this trick to lure its prey into an ambush.
Alchemists prize the hyeena’s eyes because they can be distilled into small stones that can be used to foretell the future.  An alchemist will pay a good fee for a pair of hyeena eyes if they are fresh or have been properly preserved in salt or strong alcohol.
by Anthony Roberson

Imp
Attributes (individuals may vary):
	Reasoning:	Good
	Perception:	Fair
	Willpower:	Mediocre
	Strength:	Mediocre to Good
	Agility:	Mediocre to Great
	Health:	Fair
Supernormal Powers:
	Magical Talent (Demonic Magic; see below)
	Magical Toughness (+3 Defensive Damage Factor)
Skills:
	Demonic Magic	Great
	GM may choose  other skills appropriate to individual.
Scale:	–3 or smaller
Combat Skill:	Fair
Attacks:	Magic or bite
Damage Factors (including Scale):
	Offensive:	–2 (sharp teeth)
	Defensive:	+0 (magical toughness)
(adjust Damage Factors for Scale if less than –3)
Imps are small demonic entities, which are either summoned or sent to this plane to aid a sorcerer or priest in some evil scheme. Imps come in many shapes, from man-like to grotesque.
Imps are skilled in Demonic Magic, which works the same way Scholarly Magic does. Demonic Magic excels at magical feats that cause confusion and misery. Most imps have 5 magical power points, and can channel 1- or 2-point spells.
by John Ughrin

Medusa
Attributes (individuals may vary):
	Reasoning:	Fair
	Perception:	Fair
	Willpower:	Fair
	Strength:	Fair
	Agility:	Fair
	Health:	Fair
Supernormal Powers:
	Petrification (see below)
Skills:
	Assassination	Good
Scale:	+0
Combat Skill:	Good
Attacks:	Bow
Damage Factors (including Scale):
	Offensive:	+2 (bow; add Strength bonus if any)
	Defensive:	+0
Medusae are cursed by gods. In ages past, the mother of all medusae compared her own beauty with that of the gods. For this, she and all her descendants were made so hideous, that any who saw them were turned to stone. (Any character who sees a medusa’s face must make a Willpower check at a Great Difficulty level, or turn to stone.)
A medusa may attempt to take residence in an old villa or abandoned home. There, slowly but surely, a statue garden will begin to grow. The services of a hero may be needed to find a way of killing the poor creature. It has been rumored that when a medusa is slain, her victims return to the flesh.
by John Ughrin

Rathent
Attributes (individuals may vary):
	Reasoning:	Fair
	Perception:	Good
	Willpower:	Mediocre
	Strength:	Fair
	Agility:	Good
	Health:	Good
Gifts:
	Keen Senses (especially eyesight)
	Quick Reflexes
	1 in 10 Rathent possess a Magical Talent Gift (see below)
Faults:
	Cowardly
	Damage Capacity Mediocre (–1 to DDF)
	Jerk (Few Rathent have any regard for anything but themselves. This can translate in several ways.)
Skills:
	Setting Traps	Good
	Ambush	Good
	Move Quietly	Great
	Athletic Skills	Fair
	Outdoor Skills	Fair
	Other skills as appropriate for individual
Scale:	–1 to +0
Combat Skill:	Fair to Great
Attacks:	Claws or Weapon
Damage Factors (including Scale):
	Offensive:	+0 (claws)
		+1 to +3 (scavenged weapons)
	(adjust Offensive Damage Factors for Strength if needed)
	Defensive:	+0 (cobbled together armor)
Rathent are odd creatures, most likely the result of some magical hybridization gone awry. They resemble humanoid birds, with large, curved beaks and offset eyes. Feathers cover their head, upper torso and arms. Their plumage is generally dark or mottled and unkempt and greasy. Many Rathent have hands ending talon-like claws. Most Rathent have human-like leg structure. Rare individuals will have bird-like legs or vestigial wings, and are generally regarded as gruk (retard or throwback). This is a reflection of cultural bias rather than actual ability or intelligence.
The structure of Rathent society is loosely tribal with the strongest or most cunning being the skwarka (chieftain). The skwarka leads the tribe in battle and receives the most prestige and breeding privileges.
Rathent are extremely protective of their females, as they have a relatively low birthrate. Only one in five members of a typical Rathent tribe are female.
Rathent males serve as hunters and generally engage in banditry, thievery, and murder to eke out an existence. They are cowardly scavengers by nature and will feed on carrion with glee when there is nothing better.
Most Rathent provide only for themselves, but offer tribute to the skwarka and his harem. Warriors that do not pay tribute regularly to the skwarka are either exiled or more likely killed.
Rathent may be encountered in semi-civilized areas on the outskirts of forests and mountains. Their villages are clusters of rude tree houses similar to nests in structure. The skwarka’s nest is the largest and centrally located, and is built into the largest tree available.
Rathent have fair craftsmanship skills, but rarely produce anything of exceptional quality. Most of their weaponry is scavenged or stolen. When left to their own means they will produce javelins, war darts, and spears. Rathent armor is usually cobbled together from bits and pieces scavenged in their raids.
Some Rathent have an innate talent for simple magic. Clerical Magic and Hedge Magic is most common. Scholarly Magic (Elementalism or Necromancy) is also possible, but no Rathent will have more than one level of the Magical Talent: Scholarly Magic Gift. Rathents with Magical Talent are known as kuzkwa. Most are female. All magically talented Rathent are sterile and considered sexless. Many are also albino. These Rathent serve as shamans and spiritual advisors.
Rathent spirituality is a grim affair centered around the malevolent figure Kzukwa-skwark (Old Lord Dread). Homage is paid to this fearsome entity by murdering as many non-Rathent as possible. This ensures that the afterlife will be only moderately painful, rather than an eternity of anguish and torture.
Rathent have an irrational attraction to shiny objects, and will often quarrel over relatively useless objects that glitter.
by Sedge Lewis

Ratlings
Attributes (individuals may vary):
	Reasoning:	Mediocre
	Perception:	Fair
	Willpower:	Mediocre
	Strength:	Fair
	Agility:	Good
	Health:	Mediocre
Scale:	–1 (or less)
Combat Skill:	Fair
Attacks:	Claws or Bite
Damage Factors (including Scale):
	Offensive:	+0 (claws), +1 (bite)
	Defensive:	–1
Ratlings are small humanoid creatures whose head, claws and tail look like those of a rat. Their legs are also more ratlike than human. Ratlings have a low life expectancy due to disease resulting from poor living conditions. Ratlings can speak as well as humans, and usually speak the local dominant language. Their claws are dexterous enough to allow a Ratling to use equipment made for humans.
Ratlings were created by a Grand Mage who later allowed his experiments to leave his laboratory. In the few years since their creation, the Ratlings have established themselves amid the slums and backways of the city.
The GM may involve Ratlings in the city’s political scene if desired. Examples: The local ruler has placed a bounty on Ratling skins; Ratlings are active in the Thieves’ or Beggars’ Guilds; etc.
The GM may adjust Ratlings to be smaller and more ratlike, if she likes. Suggested Scale: –5 or less (remember to adjust Offensive and Defensive Damage Factors).
by Gordon McCormick

Restless Dead
Attributes (individuals may vary):
	Reasoning:	Poor
	Perception:	Fair
	Willpower:	n/a (mindless)
	Strength:	Fair
	Agility:	Good
	Health:	n/a (not alive)
Gifts:
	Immune to Mind Magic
	Skeletal (Half damage from slashing weapons; piercing weapon damage is reduced to 1)
	Unaffected by Sunlight (unlike many Undead)
Faults:
	Susceptible to Fire
	Destroyed by running water (dispels animating magic)
	Undead (can be banished, etc.)
Scale:	–2 to +2 (as when alive)
Combat Skill:	Fair
Attacks:	Weapon
Damage Factors (including Scale):
	Offensive:	by weapon
	Defensive:	+2 (Light Armor and Shield)
Time and time again, necromancers turn to dead humanoids when trying to inexpensively create tireless, fearless guardians. Corpses are versatile, readily available, and the once-living bones lend themselves well to enchantment. A lesser nether-spirit is bound to the dead bones, animating them and providing a rudimentary, malevolent intelligence. The resulting creatures need no sustenance, are infinitely patient, and obey the commands of their creators without question. They are often set to guard tombs, fortresses, and hiding places of all sorts.
The Restless Dead appear as piles of old bones scattered around the places they guard. They have no odor (prior to enchantment, the corpses are usually stripped of all flesh by being placed onto anthills or in maggot pits). It takes a Perception roll of Great or above to detect the thin webwork of sigils covering the bones from any distance.
When anyone or anything comes near, the bones reassemble into malevolent, skeletal forms and spring into action.
Though not terribly strong, the Restless Dead are agile and tenacious. They are often equipped with rusty, patchwork armor (+1), shields (+1), and various weapons such as maces, swords, axes, and spears (+1 to +3).
by Dmitri Zagidulin

Soldier, Professional
Attributes (individuals may vary):
	Reasoning:	Mediocre
	Perception:	Fair
	Willpower:	Fair
	Strength:	Good
	Agility:	Good
	Health:	Fair
Skills: (choose as appropriate to the individual)
	Athletic Skills	Fair - Good
	Social Skills	Mediocre - Good
Gifts: (choose as appropriate to the individual)
	Common soldierly Gifts include Danger Sense, Pain Tolerance, Quick Reflexes, Tough Hide, or Veteran.
Faults: (choose as appropriate to the individual)
	Common soldierly Faults include Code of Honor, Compulsive Gambling, Duty, One Eye.
Scale:	+0
Combat Skill:	Good - Great
Attacks:	by weapon
Damage Factors (including Scale):
	Offensive:	by weapon
		(add Strength bonus if applicable)
	Defensive:	by armor
		(add Tough Hide bonus if applicable)
A professional soldier is a trained, well-equipped warrior. This template may be used for town guards.
Soldiers usually have at least Good morale and discipline. However, many only have Mediocre mental attributes. A squad of soldiers is usually led by an officer with Good or better Combat and mental attributes.
by Peter Mikelsons

Thug
Attributes (individuals may vary):
	Reasoning:	Mediocre
	Perception:	Fair
	Willpower:	Fair
	Strength:	Fair
	Agility:	Fair
	Health:	Fair
Skills: (choose as appropriate to the individual)
	Athletic Skills	Mediocre - Good
	Social Skills	Poor - Fair
Gifts: (choose as appropriate to the individual)
	Common Gifts for Thugs include Pain Tolerance, Resistant to Poison, and Tough Hide.
Faults: (choose as appropriate to the individual)
	Common Faults for Thugs include Appearance, Outlaw, or Quick Tempered.
Scale:	+0
Combat Skill:	Mediocre - Fair
Attacks:	by weapon
Damage Factors (including Scale):
	Offensive:	–1 (fist), or by weapon
		(add Strength bonus if applicable)
	Defensive:	+1 (leather, or partial heavier armor)
		(add Tough Hide bonus if applicable)
A Thug is an untrained, none-too-bright, poorly equipped person who may start trouble with PCs because of alcohol, testosterone, or commands from an arch-villain.
In any crowd of Thugs, there is at least one with an additional +1 or +2 Offensive Damage Factor due to unusual strength.
by Peter Mikelsons

Troll
Attributes (individuals may vary):
	Reasoning:	Poor
	Perception:	Fair
	Willpower:	Fair
	Strength:	Great
	Agility:	Fair
	Health:	Great
Gifts:
	Toughness (+3 DDF)
	Stench (–2 to opponents combat skills; see below)
Scale:	+3
Combat Skill:	Good
Attacks:	weapon or claws
Damage Factors (including Scale):
	Offensive:	+5 (claws), +8 (massive club)
	Defensive:	+8
Trolls are huge, loathsome creatures. Many are identified by the areas where they live. There are Hill Trolls, Swamp Trolls, Wood Trolls, and countless others.
The average troll stands well over 9’ tall and usually wields a massive club. A troll’s presence is easily identified by the horrible stench that always accompanies them.  They are carnivores and most are not terribly bright.
Anyone facing a Troll in melee combat must make a Good difficulty Willpower roll or suffer a –2 penalty to all combat skills for the duration of the combat, due to the creature’s overwhelming smell.
by Anthony Roberson

Wall Crawler
Attributes (individuals may vary):
	Reasoning:	Poor (animal)
	Perception:	Fair
	Willpower:	Poor
	Strength:	Poor
	Agility:	Good
	Health:	Poor
Gifts:
	Toxic Spines (see below)
Scale:	–6
Combat Skill:	Mediocre
Attacks:	bite
Damage Factors (including Scale):
	Offensive:	–6
	Defensive:	–6
The wall crawler resembles nothing so much as a nightmarish cross between a giant centipede and a black, furry caterpillar. A wall crawler is usually 1’ to 1’ 6” long and, except for its head, is completely covered with 6” long black spines. The crawler skitters along on sixteen feet that are equipped with an array of tiny hook-like protrusions. These allow the creature to travel over almost any surface. It can traverse a cave ceiling or dungeon wall as easily as it does the ground.
Wall crawlers are found in dark places and fill the role of scavengers, devouring the dead and sometimes the dying.  Wall crawlers rarely attack living creatures unless in defense or if the creature is badly injured. They are usually encountered in groups of 7-12 individuals.
In combat, a wall crawler can deliver a painful bite that sometimes becomes infected. Its real danger, however, lies in the spines that cover its body. These spines are sharp and can easily pierce cloth or the leather sole of a boot.  The hollow spines contain a toxin that causes confusion and hallucinations. If an adventurer contacts a spine, he must make a Fair difficulty Health Roll. If he fails the roll, he will become confused and disoriented within minutes.  For the next 2-4 hours he will be effectively incapacitated by hallucinations, unable to fight or find his way without assistance.
by Anthony Roberson

Zombie
Attributes (individuals may vary):
	Reasoning:	n/a (mindless)
	Perception:	Mediocre
	Willpower:	n/a (mindless)
	Strength:	Great
	Agility:	Poor
	Health:	Great
Supernatural Powers:
	Immune to Pain (no penalties due to wounds)
	Immune to Fear
	Tough (+2 to Defensive Damage Factor)
Faults:
	VileStench
	Horrid Appearance
	Disease Carriers (optional; see below)
Scale:	0
Combat Skill:	Poor
Attacks:	arm swing or drag down
Damage Factors (including Scale):
	Offensive:	+1 (unarmed, Strength bonus)
	Defensive:	+2
Zombies are walking corpses, with shreds of flesh still attached. They are animated through evil magics (Necromancy, Sorcery, or some evil Clerical Magic) and obey the instructions of their creators. Zombies continue to decay, giving them a vile stench and a horrifying appearance. They may also be disease carriers. The GM may require characters exposed to zombies to make a Health Roll (Difficulty Level Mediocre) to avoid contracting some suitably noxious disease.
Zombies have no initiative, relying on their master for instructions. Feeling no fear or pain, they make excellent shock troops. They are almost indestructible, requiring a Near Death result to “kill” them.
Zombies are unable to wield weapons. They attack with their hands and nails, pummeling their opponents with mindless intensity. They will attempt to surround and overwhelm difficult opponents.
Zombies are unintelligent (mindless), and so have no speech, skills, etc., although they may moan while attacking. They may be repelled with the Repel Undead Clerical Magic skill (Difficulty Level Mediocre).
Zombies usually inhabit cemeteries, abandoned churches, necromancers’ strongholds, or temples to evil gods.
by blended from submissions by Steven Hammond, Kent Matthewson, and Peter Mikelsons

Zuvembie
Attributes (individuals may vary):
	Reasoning:	Mediocre
	Perception:	Fair
	Willpower:	Fair
	Strength:	Great
	Agility:	Mediocre
	Health:	Mediocre
Skills:
	As when alive, but 2 levels lower
Supernatural Powers:
	Immune to Pain (no penalties due to wounds)
	Immune to Fear
	Tough (+2 to Defensive Damage Factor)
Faults:
	Horrid Appearance
Scale:	0
Combat Skill:	Good
Attacks:	Bony hands, or weapon
Damage Factors (including Scale):
	Offensive:	+2 (unarmed) or by weapon
	Defensive:	+2
An evil priest, sorcerer, or necromancer can create a Zuvembie by draining the life force from a man-sized humanoid creature via arcane magics and poisons. A Zuvembie’s flesh becomes hard and its skin leathery as a result of the process, and Zuvembie bodies do not show the decay of true zombies. They retain some intelligence, unlike zombies, and can understand relatively complex instructions. They wield weapons (albeit clumsily), and may retain some of the skills they maintained in life, but reduced by 2 levels.
As with zombies, Zuvembies are immune to pain and require a Near Death result to “kill” them.
Zuvembies usually inhabit their creators’ residence. They may be Repelled with Great difficulty.
by Kent Matthewson</pre>
</div>
<div title="Fantasy Fudge: Wounds" creator="JonasSusara" modifier="JonasSusara" created="201010231145" changecount="1">
<pre>When a character wins a combat round, use the following formula to determine the damage done:

Winner’s Offensive Damage Factor (including Scale)
		plus
Relative Degree (number of levels won by)
		minus
Loser’s Defensive Damage Factor (including Scale)
	equals Damage Points Inflicted

If the result is 0 or less, no damage is inflicted. If the result is positive, look at the table below to determine the severity of the particular wound. 

	1,2	3,4	5,6	7,8	9+
	Scratch	Hurt	Very Hurt	Incapacitated	Near Death
					

The boxes below the wound levels represent how many of each wound type a character can take. The player checks off one box for each wound received. A 6-point wound requires the “Very Hurt” box to be checked, and so on. If there is no open box for a given wound result, the character takes the next highest wound for which there is an open box.
A wounded character suffers penalties to most actions:
Scratch: no penalty
Hurt: –1 to most actions
Very Hurt: –2 to most actions
Incapacitated: incapable of any but the most basic, painfully slow actions
Near Death: unconscious, will die in less than an hour unless helped
Penalties are not cumulative. Only the penalty for the highest recorded wound level counts. Scratches go away after a battle, provided the character has five or ten minutes to attend to them. See section 4.8 for rules for healing wounds.</pre>
</div>
<div title="Fudge System Reference Document" creator="JonasSusara" modifier="JonasSusara" created="201010201228" modified="201010220429" changecount="13">
<pre>This document contains information on the Fudge roleplaying game system, and presents the core body of the Fudge RPG material available for use under the Open Game License.

!Copyrights, Trademarks, and Licenses
Fudge System Reference Document Copyright 2005, Grey Ghost Press, Inc.; Authors Steffan O’Sullivan, Ann Dupuis, with additional material by other authors as indicated within the text. Available for use under the Open Game License ([[see Appendix I|Appendix I: Open Game License Version 1.0a]])

There are official Fudge logos available for use under a separate agreement, the Fudge System Trademark License (FSTL). For more information please see http://www.fudgerpg.com/publishers.

The 1995 version of the Fudge core rules and Addenda remains available free online (see http://www.fudgerpg.com), and may be used under the 2000 Fudge Legal Notice for those who prefer that rather than the Open Game License.

Please ensure that you understand the license you choose to use for creating Fudge derivative works, and follow the requirements of the license you’re using. The following resources may help you understand the intricacies of copyrights, trademark law, and the Open Game License and Fudge “Legal Notice.”

10 Big Myths about copyright explained: http://www.templetons.com/brad/copymyths.html

United States Government Copyright Office FAQ page: http://www.copyright.gov/help/faq/

Open Game License FAQ page: http://www.wizards.com/default.asp?x=d20/article/20040121a

Open Gaming Foundation’s email list (Ogf-l) for discussion of the Open Game License:
http://mail.opengamingfoundation.org/mailman/listinfo/ogf-l

If after reviewing all of the above you still have questions about creating Fudge materials under either license, please contact Ann Dupuis at ghostgames@fudgerpg.com, and/or consult with an attorney practicing in intellectual property law.

!Open Game Content
With the exception of material specifically marked as Product Identity (PI) and terms that are indicated as trademarks, the following material is Open Game Content, and is licensed for public use under the terms of the Open Game License v1.0a.

Permission to copy, modify and distribute the contents of this document is granted solely through the use of the Open Gaming License, Version 1.0a ([[see Appendix I|Appendix I: Open Game License Version 1.0a]]). This material is being released using the Open Gaming License Version 1.0a and you should read and understand the terms of that license before using this material.
</pre>
</div>
<div title="Fudge Trait Levels" creator="JonasSusara" modifier="JonasSusara" created="201010210700" modified="201010210811" changecount="2">
<pre>Fudge uses ordinary words to describe various traits of a character. The following terms of a seven-level sequence are suggested (from best to worst):
* Superb
* Great
* Good
* Fair
* Mediocre
* Poor
* Terrible
These levels should be written on each character sheet for easy reference.

A GM may alter this list in any way she desires, including expanding or shrinking it. For example, if Superb doesn’t sound right to you, use Awesome — or even Way Cool. If the words Mediocre and Fair don’t make sense to you, change them. These seven terms will be used in the rules, however, for clarity.

To remember the order, compare adjacent words. If, as a beginner, your eventual goal is to become an excellent game player, for example, ask yourself if you’d rather be called a Fair game player or a Mediocre game player.

There is an additional level that can be used in Fudge, but is not listed above: Legendary, which is beyond Superb. Those with Legendary Strength, for example, are in the 99.9th percentile, and their names can be found in any book of world records.

Important Note: not every GM will allow PCs to become Legendary. Even in games that do include the Legendary level, it is not recommended that any character be allowed to start the game as Legendary. Superb represents the 98th to 99.9th percentile of any given trait, which should be enough for any beginning PC. Of course, if a player character gets a bit overconfident, meeting an NPC Legendary swordswoman can be a grounding experience…
If someone really has to begin play as a Legendary swordsman, strong man, etc., doing the GM’s laundry for half a year or so (in advance) should be a sufficient bribe to be allowed to start at that level. Of course, working towards Legendary makes a great campaign goal, and so PCs may rise to that height, given enough playing time and a generous GM.</pre>
</div>
<div title="Fudge in a Nutshell" creator="JonasSusara" modifier="JonasSusara" created="201010201237" modified="201010230833" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="15">
<pre>Although Fudge is designed to be customized by each Gamemaster, there are some game design decisions at the core of Fudge that are used by most Fudge Gamemasters.

!Characters and Character Traits
Fudge characters are described by “traits,” including attributes (any trait that everyone in the game world has), skills (any trait that isn’t an attribute and can be improved through practice), gifts (any trait that isn’t an attribute or skill but is something positive for the character), and faults (any trait that limits a character’s actions or earns him a bad reaction from other people). Supernormal powers are treated as potent gifts.

Fudge uses ordinary words to describe some traits, especially attributes and skills. The following terms of a seven-level sequence are the words suggested by the Fudge author and used in Grey Ghost Games products:
* Superb
* Great
* Good
* Fair
* Mediocre
* Poor
* Terrible
There is an additional level not listed above: Legendary, which is beyond Superb. ~GMs may restrict Legendary traits to non-player characters.

!Character Creation
Fudge provides two basic means of creating characters: the “subjective” and “objective” systems. 
In the subjective system, the player and GM work together to describe the character in Fudge terms, building from a strong character concept.

In the objective system, a character’s traits start at a default level (Fair for attributes; Poor for most skills) and the GM grants each player a number of “free” levels to allocate. She may also grant “free” gifts, or require one or more faults. The player can then spend two free levels to raise an attribute from Fair to Great, for instance; or sacrifice a number of levels to gain a gift, or give his character a fault in return for levels to apply somewhere else. 

The trading “values” of various traits and trait levels are:
1 attribute level = 3 skill levels
1 gift = 6 skill levels
1 gift = 2 attribute levels
1 gift = 1 fault

!Scale — Strength and Mass
Some characters or creatures have certain attributes that are way beyond the human norm. Prime examples include Strength, Mass, and Speed. Such attributes are rated in Scale, which acts as a modifier in interactions between creatures or items of different Scale.
In a human-based game, Human Scale is 0. A race of greater-than-human average strength would be Scale +1 Strength or more, while a race of lesser average strength would be Scale –1 Strength or less. Individuals are then of Fair or Good Strength, etc., relative to those of their own Scale. 

In a “Bunnies” game, where the player characters are rabbits, Rabbit Scale would be 0, while Human Scale would likely be +7. In a “Mecha” game, where the player characters were giant robots, Mecha Scale would be 0, while Human Scale would depend on the actual size difference between the Mechs and humans; a Human Scale of –15 relative to the Mecha Scale of 0 would not be unreasonable.

To calculate appropriate Strength/Mass Scale values, figure that each level of Strength Scale represents an increase of about 1.5 times the Strength and Mass of the previous Scale level. This is because the Fudge core rules define each level of Strength (from Terrible to Superb) to be 1.5 times stronger than the previous level. (This progression isn’t necessarily true for other attributes. Superb Dexterity is only about twice as good as Fair Dexterity, and each level of Speed is 1.2 times faster than the previous level.) Strength Scale increases at the same rate: a Scale 1, Fair Strength individual is 1.5 times stronger than a Scale 0, Fair Strength individual.

Note that Scale 1 Fair Strength is not exactly equal to a Scale 0 Good Strength — Scale really measures Mass, or Density, and affects how easily a creature may be hurt. A Scale 1 Fair Strength fighter has an advantage over a Scale 0 Good Strength fighter, even though their Strengths are equal. The Scale 1 fighter is less affected by the other’s damage due to his greater mass.

!Action Resolution
For any action the player character wishes to perform, the GM must determine which trait is tested. (This will usually be a skill or an attribute.) If the action is Unopposed, the GM determines the Difficulty Level. Some actions are so easy that the character succeeds automatically; others are impossible (no rolls needed).

!Unopposed Actions
When a character performs an action that isn’t influenced by anyone else, it is referred to as an Unopposed action. Examples include jumping a wide chasm, climbing a cliff, etc.

Difficulty Level: The GM will set a Difficulty Level when a character tries an Unopposed Action. Usually the Difficulty Level will be Fair, but some tasks are easier or harder. 

Rolled Degree: This refers to how well a character does at a particular task. If someone is Good at Climbing in general, but the die-roll shows a +1 to the character’s skill, then the rolled degree is one level higher than the character’s skill level — Great, in this case. Rolled degrees from Superb +1 to Superb +4 are possible; a GM may thus set a Difficulty Level beyond Superb for nearly impossible actions. Likewise, there are rolled degrees from Terrible –1 down to Terrible –4. The GM should use her imagination in determining the consequences of such abysmal failures.

!Opposed Actions
Actions are Opposed when other people (or animals, etc.) may have an effect on the outcome of the action. In this case, the player of each contestant rolls some dice, and the results are compared to determine the outcome.

Relative Degree: This refers to how well a character did compared to another participant in an Opposed Action. The relative degree is expressed as a number of levels. If a PC gets a rolled degree result of Good in a fight, and his NPC foe gets a rolled degree result of Mediocre, the PC beat his foe by two levels — the relative degree is +2 from his perspective, –2 from hers.

!Fudge Dice and Other Random Generators
Fudge dice are six-sided dice with two sides marked + (+1), two sides marked – (–1), and two sides left blank (+/–0). Rolling four Fudge dice (4dF) gives results from –4 (sub-Terrible) to +4 (trans-Superb). To determine the result of an action, roll the dice; use the result to modify the trait level being tested. For example, a +3 dice result added to a Fair trait is a Superb rolled degree; a –1 result added to a Fair trait indicates a Mediocre result.

Alternative 3d6 dice method: Roll 3 six-sided dice. Add the numbers and compare to the following table:

{{{
Rolled:	3-4	5	6-7	8-9	10-11	12-13	14-15	16	17-18
Result:	–4	–3	–2	–1	+0	+1	+2	+3	+4
}}}

When setting Difficulty Levels, it may help to keep the statistical results of rolling four Fudge dice in mind:
{{{
        Odds of rolling	       Odds of Rolling
        exactly on 4dF:        Target or Higher
+4	1.2%	               1.2%
+3	4.9%	               6.2%
+2	12.3%	               18.5%
+1	19.8%	               38.3%
0	23.5%	               61.7%
–1	19.8%	               81.5%
–2	12.3%	               93.8%
–3	4.9%	               98.8%
–4	1.2%	               100.0%
}}}

!Wounds
Combat damage to a character can be described as being at one of seven stages of severity:
* Undamaged (no wounds at all)
* Just a Scratch (no real game effect)
* Hurt (–1 to traits)
* Very Hurt (–2 to traits)
* Incapacitated (only the most basic actions allowed)
* Near Death (unconscious; death without medical help)
* Dead

Determining Wound Levels: Fudge offers many ways to track combat damage. The Objective Damage System assumes each character will have an Offensive Damage Factor (the total of modifiers, including any applicable Strength and Scale bonuses, that reflects the deadliness of the weapon used) and a Defensive Damage Factor (the total of modifiers, including Scale and armor, that reflects the character’s ability to withstand or avoid damage). To determine how much damage is done in a given combat round, the following formula may be used:

Winner’s Relative Degree + Offensive Damage Factor – Loser’s Defensive Damage Factor

{{{
Damage:	1-2      3-4	5-6	    7-8	     9+
Wounds:	Scratch  Hurt   Very Hurt   Incap.   Nr. Death
}}}

Most characters can withstand three Scratches, one Hurt, and one Very Hurt. Further Scratches are marked as Hurts, further Hurts are marked as Very Hurt, etc. For more cinematic games, ~GMs may adjust the wound boxes, allowing two Hurts instead of one, for example.
Fudge games will vary, of course, but many have these simple character creation and action resolution rules at their core. See Fantasy Fudge, later in this document, as an example.</pre>
</div>
<div title="Introduction" creator="JonasSusara" modifier="JonasSusara" created="201010201226" modified="201010201227" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="2">
<pre>Fudge was originally written 1992 - 1995 by Steffan O’Sullivan with help and feedback from many gamers on the Usenet newsgroup rec.games.design. It was published online in 1993 with a “Legal Notice” allowing for free distribution and creation of derivative works under a limited, royalty-free license. (As far as we’re aware, Fudge was the first roleplaying game system to be published under an “open content” license.)

In 1994, Ann Dupuis, doing business as “Wild Mule Games,” published the first Fudge book under a commercial publishing license from Steffan O’Sullivan. The “Wild Mule” Fudge book contained the 1993 version of the rules. In July 1995, Grey Ghost Press, Inc. (Wild Mule Games’ successor) published the first widely distributed Fudge book, containing the June 1995 version of the rules (the version that Steffan was satisfied enough with to stop tinkering ).

Six years later, Grey Ghost Press published a new Fudge book – the Expanded Edition. The Expanded Edition had everything from the 1995 edition, plus additional material including Fantasy Fudge, a pre-customized version of Fudge for use in a fantasy setting. This Fudge System Reference Document contains the text from the 2000 Fudge Expanded Edition.

Now in 2005, in celebration of the company’s 10th anniversary, Grey Ghost Press is releasing a hardcover edition of Fudge. In addition to most of the material in the Expanded Edition (and in this Fudge System Reference Document), the 10th Anniversary edition of Fudge has extensive lists of gifts, faults, skills, and attributes, alternative rules, advice on “fudging” Fudge games, and more – more than twice as much material as in the Expanded Edition. Much of that new material will also be released under the Open Game License (although not as part of the core Fudge System Reference Document).

For more information on the history of the Fudge roleplaying game, please visit Steffan’s Fudge Designer Notes webpage at http://www.panix.com/~sos/rpg/fud-des.html.

For more information on Grey Ghost Press and commercial Fudge publishing, please visit http://www.fudgerpg.com</pre>
</div>
<div title="JonasSusara" creator="JonasSusara" modifier="JonasSusara" created="201010220417" modified="201010220418" changecount="2">
<pre>* is also known as &quot;fudgebob dicepants&quot;...
* is a fellow Fudge RPG fan...
* is part of the Fudge Community Yahoo Group...
* is a member of the Unofficial Fudge Forum...
* is an op of the Official Fudge IRC Channel...
* ... and more (to be continued)</pre>
</div>
<div title="LoadRemoteFileThroughProxy" modifier="YourName" created="200703202229" modified="201010150116" tags="systemConfig">
<pre>/***
|''Name:''|LoadRemoteFileThroughProxy (previous LoadRemoteFileHijack)|
|''Description:''|When the TiddlyWiki file is located on the web (view over http) the content of [[SiteProxy]] tiddler is added in front of the file url. If [[SiteProxy]] does not exist &quot;/proxy/&quot; is added. |
|''Version:''|1.1.0|
|''Date:''|mar 17, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#LoadRemoteFileHijack|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
***/
//{{{
version.extensions.LoadRemoteFileThroughProxy = {
 major: 1, minor: 1, revision: 0, 
 date: new Date(&quot;mar 17, 2007&quot;), 
 source: &quot;http://tiddlywiki.bidix.info/#LoadRemoteFileThroughProxy&quot;};

if (!window.bidix) window.bidix = {}; // bidix namespace
if (!bidix.core) bidix.core = {};

bidix.core.loadRemoteFile = loadRemoteFile;
loadRemoteFile = function(url,callback,params)
{
 if ((document.location.toString().substr(0,4) == &quot;http&quot;) &amp;&amp; (url.substr(0,4) == &quot;http&quot;)){ 
 url = store.getTiddlerText(&quot;SiteProxy&quot;, &quot;/proxy/&quot;) + url;
 }
 return bidix.core.loadRemoteFile(url,callback,params);
}
//}}}
</pre>
</div>
<div title="MainMenu" modifier="JonasSusara" created="201010120247" modified="201010210803" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" server.page.revision="201010150108" changecount="36">
<pre>[[Fudge SRD|Fudge System Reference Document]]
[[Introduction]]
[[What is Fudge?]]
[[Terminology]]
[[Fudge in a Nutshell]]
[[1. Character Creation]]
[[2. Supernormal Powers]]
[[3. Action Resolution]]
[[4. Combat|4. Combat, Wounds &amp; Healing]]
[[5. Character Development]]
[[6. Tips and Examples]]
[[7. The Addenda]]
[[Fantasy Fudge|Fantasy Fudge: A Sample Fudge Game]]
[[Miscellaneous|Miscellaneous Charts and Information]]
[[Appendix I:OGL|Appendix I: Open Game License Version 1.0a]]</pre>
</div>
<div title="Miscellaneous Charts and Information" creator="JonasSusara" modifier="JonasSusara" created="201010201303" modified="201010231012" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="5">
<pre>''Fudge Combat Tables''

Sample Wound Factors
Add all applicable Offensive Factors to determine the Offensive Damage Factor; add all applicable Defensive Factors to determine the Defensive Damage Factor.
Offensive factors:
For Character’s Strength
(muscle-powered weapons only):
Trait modifier (+3 for Superb, –1 for Mediocre, etc.)

For Attacker’s Scale:
Plus the attacker’s Strength Scale
(see Section 4.68, Non-human Scale in Combat).

For Weapon’s Strength
(Guns, Crossbows, Beam weapons, etc.):
+/– Strength of weapon
(see Section 4.4, Ranged Combat).

For ~Muscle-Powered Weapon:
–1 for no weapon, not using a Martial Art skill.
+0 Martial Art skill, or for small weapons
+1 for medium-weight one-handed weapons
+2 for large one-handed weapons
+3 for most two-handed weapons
+1 for sharpness

Defensive factors:
For Character’s Damage Capacity Attribute:
Note: Optional — see Section 4.52, Damage Capacity.
Trait modifier (+2 for Great, –2 for Poor, etc.)

For Armor:
+1 for light, pliable non-metal armor.
+2 for heavy, rigid non-metal armor
+2 for light metal armor.
+3 for medium metal armor.
+4 for heavy metal armor.
+5 or more for science fiction advanced armor.
+ ~GM-set modifiers for magical armor
Note: the value of a shield may be subtracted from the opponent’s skill — see Section 4.31, Melee Modifiers.

For Defender’s Mass Scale:
Plus the defender’s Mass Scale
(see Section 4.58, Non-human Scale in Combat).
(If the defender has Mass other than Fair, or a gift of Tough Hide, it should also be figured in.)
Offensive/Defensive Tactic Modifiers
+2 to Offense, –2 to Defense
+1 to Offense, –1 to Defense
Normal Offense and Defense
–1 to Offense, +1 to Defense
–2 to Offense, +2 to Defense

3d6 Dice Technique
Rolled:  3-4	5	6-7	8-9	10-11	12-13	14-15	16	17-18
Result:   –4	–3	–2	–1	+0	+1	+2	+3	+4

d% Dice Technique
Rolled:   1	2-6	7-18	19-38	39-62	63-82	83-94	95-99	00
Result:  –4	–3	–2	–1	+0	+1	+2	+3	+4

Optional Damage Rolls
See Section 4.61, Damage Die Roll, p. 44.
See also Section 4.63, Min-Mid-Max Die Roll, p. 45, for an alternative wound determination method.

Sample Graze Severity Table
	Damage
	Factor	Result
	&lt;0	Undamaged
	0-4	Scratch
	 5+	Hurt

Sample Scale Table
	Scale	Mass (US)	Mass (Metric)	Example
	–6	13 lb		6 kg		Large house cat
	–5	20 lb		9 kg		Fox
	–4	30 lb		13 kg		Badger
	–3	45 lb		20 kg		Coyote
	–2	68 lb		30 kg		Medium Dog
	–1	100 lb		45 kg		Cheetah
	0	150 lb		68 kg		Human
	+1	225 lb		100 kg		Leopard
	+2	333 lb		150 kg		Black Bear
	+3	500 lb		225 kg		Utahraptor
	+4	750 lb		333 kg		Grizzly Bear
	+5	1125 lb		500 kg		Alligator
	+6	1687 lb		750 kg		Bison
	+7	1.25 tn		1.1 t		Great White Shark
	+8	2 tn		1.7 t		Killer Whale
	+9	3 tn		2.6 t		Allosaurus

Sample Skills
Here are some sample skills to consider for your own Fudge games.
Animal Skills: Animal Care, Animal Lore, Animal Training, Bee-keeping, Herding, Riding, Teamster, Veterinarian, etc.
Artistic skills: Aesthetics, Cosmetology, Culinary Arts, Literary Arts, Performing Arts (music, theater, storytelling, jester, dance, etc., and such skills as Choreography, Composition, Costuming, etc.), Visual Arts (painting, drawing, sculpting, etc.), and so on.
Athletic skills: Acrobatics, Aerial Acrobatics, Balance Skills, Boating, Climbing, Jumping, Pole-vaulting, Running, Swimming, Throwing, Various Sports, Zero-G Maneuvering, etc.
Combat skills: Ambush, Demolitions, Dodge, Punmanship, Quick-Draw, Shield, Tactics, Throwing, numerous Weapon and Unarmed Combat skills.
Covert skills: Acting, Breaking &amp; Entering, Detect Traps, Deactivate Traps, Disguise, Forgery, Infiltrate, Intrigue, Lockpicking, Pickpocketing, Poisoning, Shadowing, Shady Contacts, Sleight of Hand, Stealth, etc.
Craft skills: Armory, Basket Making, Bowyer/Fletcher, Carpenter, Cooking, Knots, Leatherworking, Masonry, Pottery, Smith, Tailor, Weaving Ñ many others.
Dungeon-delving skills: Avoid Traps, Fight, Find Secret Passages, Pick Locks, Move Quietly, Run, Tell Believable Whoppers.
Knowledge skills (a skill can represent knowledge of a subject as broad or narrow as the GM will allow): Alchemy, Alien Customs, Arcane Lore, Criminology, Cultures, Detective Fiction, Folklore, Geography, History, Literature, Occultism, Political Situations, Psychology, TV SitCom Episodes, Sciences (lots of these), etc.
Language skills: Each individual language, Pantomime, Pick Up Languages, etc.
Manipulative skills: Bamboozle, Bluff, Boot-licking, Bribery, Con, Exhort, Fast-talk, Flattery, Interrogate, Intimidate, Lying, Oratory, Persuade, Seduction, Street Gossip, etc.
Medical skills: Anatomy, Antidotes, Diagnosis, Doctoring, First Aid, Herb Preparation, Medicine, Nursing, Surgery, etc.
Merchant skills: Bargain, Barter, Business Sense, Evaluate Goods, Haggle, Innkeeping, Marketing, Salesmanship, Shopkeeping, etc.
Outdoor skills: Camouflage, Camping, Fishing, Forage, Herb Lore, Hide Traces, Hunting, Mimic Animal Noises, Nature Lore, Navigation, Survival, Tracking, Wildcraft, Woodcraft, etc.
Professional skills: Accounting, Begging, Bureaucracy, Farming, Gambling, Law, Photography, Seamanship Ñ many others.
Social skills (Fellowship): Bar Etiquette, Camaraderie, Carouse, Choosing just the right gift, Control Libido, Flirting, Game Playing, Hold your liquor, Make Amusing Faces or Noises, Matrix Etiquette, Tall Tales, Uplift Spirits, Witty Insults, etc.
Social skills (Formal): Courtly Ways, Detect Lies, Diplomacy, Etiquette, Interviewing, Parley, Repartee, Rituals, Savoir-Faire, Servant, etc.
Spiritual skills: Communing with nature, Fasting, Giving comfort, Listening deeply, Meditation, Patience, Theology, etc.
Supernormal Power skills: Fortune Telling, Levitate, Spell Casting, Use Mind Control, Use Superpower, Use Telekinesis, etc.
Technical skills: Computer Build/Repair, Computer Programming, Computer Use, Driving, Electronics, Engineer, Mechanic, Piloting, Repair Scoutship Systems, Research, Shiphandling, etc.
Urban skills: Barroom Savvy, Street Etiquette, Streetwise, Urban Survival, etc.

Cost of Skills in Objective Character Creation
				Very
	Easy	Most	Hard	Hard
Terrible	Ð2	Ð1	0	1
Poor	Ð1	0	1	2
Mediocre	0	1	2	3
Fair	1	2	3	4
Good	2	3	4	5
Great	3	4	5	6
Superb	4	5	6	7

Easy = Cost of GM-Determined Easy Skills
Most = Cost of Average Skill
Hard = Cost of GM-Determined Hard Skills
VH = Cost of GM-Determined Very Hard Skills
(usually related to Supernormal Powers)</pre>
</div>
<div title="OpenTopPlugin" modifier="YourName" created="200809080033" modified="200809090419" tags="systemConfig includeNew" server.type="file" server.host="file:///C:/Users/Jonas/Downloads/FiddlyWiki.html" server.page.revision="200809090419">
<pre>/***
|Name|OpenTopPlugin|
|Created by|SaqImtiaz|
|Location|http://tw.lewcid.org/#OpenTopPlugin|
|Version|0.1|
|Requires|~TW2.x|
!!!Description:
Open new tiddlers at the top of the screen.

!!!Code
***/
//{{{
Story.prototype.coreLewcidDisplayTiddler=Story.prototype.displayTiddler ;
Story.prototype.displayTiddler =
function(srcElement,title,template,unused1,unused2,animate,slowly)
{
       var srcElement=null;
       if (document.getElementById(this.idPrefix + title))
          {story.closeTiddler(title);}
       this.coreLewcidDisplayTiddler(srcElement,title,template,unused1,unused2,animate,slowly);
       window.scrollTo(0,0);
}
//}}}</pre>
</div>
<div title="PasswordOptionsPlugin" modifier="YourName" created="200704220851" modified="201010150116" tags="systemConfig">
<pre>/***
|''Name:''|PasswordOptionPlugin|
|''Description:''|Extends TiddlyWiki options with non encrypted password option.|
|''Version:''|1.0.2|
|''Date:''|Apr 19, 2007|
|''Source:''|http://tiddlywiki.bidix.info/#PasswordOptionPlugin|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0 (Beta 5)|
***/
//{{{
version.extensions.PasswordOptionPlugin = {
	major: 1, minor: 0, revision: 2, 
	date: new Date(&quot;Apr 19, 2007&quot;),
	source: 'http://tiddlywiki.bidix.info/#PasswordOptionPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',
	coreVersion: '2.2.0 (Beta 5)'
};

config.macros.option.passwordCheckboxLabel = &quot;Save this password on this computer&quot;;
config.macros.option.passwordInputType = &quot;password&quot;; // password | text
setStylesheet(&quot;.pasOptionInput {width: 11em;}\n&quot;,&quot;passwordInputTypeStyle&quot;);

merge(config.macros.option.types, {
	'pas': {
		elementType: &quot;input&quot;,
		valueField: &quot;value&quot;,
		eventName: &quot;onkeyup&quot;,
		className: &quot;pasOptionInput&quot;,
		typeValue: config.macros.option.passwordInputType,
		create: function(place,type,opt,className,desc) {
			// password field
			config.macros.option.genericCreate(place,'pas',opt,className,desc);
			// checkbox linked with this password &quot;save this password on this computer&quot;
			config.macros.option.genericCreate(place,'chk','chk'+opt,className,desc);			
			// text savePasswordCheckboxLabel
			place.appendChild(document.createTextNode(config.macros.option.passwordCheckboxLabel));
		},
		onChange: config.macros.option.genericOnChange
	}
});

merge(config.optionHandlers['chk'], {
	get: function(name) {
		// is there an option linked with this chk ?
		var opt = name.substr(3);
		if (config.options[opt]) 
			saveOptionCookie(opt);
		return config.options[name] ? &quot;true&quot; : &quot;false&quot;;
	}
});

merge(config.optionHandlers, {
	'pas': {
 		get: function(name) {
			if (config.options[&quot;chk&quot;+name]) {
				return encodeCookie(config.options[name].toString());
			} else {
				return &quot;&quot;;
			}
		},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	}
});

// need to reload options to load passwordOptions
loadOptionsCookie();

/*
if (!config.options['pasPassword'])
	config.options['pasPassword'] = '';

merge(config.optionsDesc,{
		pasPassword: &quot;Test password&quot;
	});
*/
//}}}</pre>
</div>
<div title="SiteSubtitle" modifier="JonasSusara" created="201010120247" modified="201010201344" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" server.page.revision="201010180145" changecount="4">
<pre>A portable, reusable, and personal System Reference Document for Fudge, the Role Playing Game!</pre>
</div>
<div title="SiteTitle" creator="JonasSusara" modifier="JonasSusara" created="201010150117" changecount="1">
<pre>Fudge RPG TiddlyWiki</pre>
</div>
<div title="Table of Contents" modifier="JonasSusara" created="201010201406" modified="201010231234" changecount="6">
<pre>![[Introduction]]
![[What is Fudge?]]
![[Terminology]]
![[Fudge in a Nutshell]]
![[1. Character Creation]]
	!![[1.1 Character Creation Terms]]
	!![[1.2 Fudge Trait Levels]]
	!![[1.3 Character Traits]]
		!!![[1.31 Attributes]]
		!!![[1.32 Skills]]
		!!![[1.33 Gifts]]
		!!![[1.34 Faults]]
		!!![[1.35 Personality]]
		!!![[1.36 Fudge Points]]
	!![[1.4 Allocating Traits]]
	!![[1.5 Subjective Character Creation]]
	!![[1.6 Objective Character Creation]]
		!!![[1.61 Attributes]]
		!!![[1.62 Skills]]
		!!![[1.63 Gifts &amp; Faults]]
		!!![[1.64 Trading Traits]]
	!![[1.7 Uncommitted Traits]]
	!![[1.8 Random Character Creation]]
	!![[1.9 Minimizing Abuse]]

![[2. Supernormal Powers]]
	2.1  Supernormal Power Terms
	2.2  Powers at Character Creation
 		2.21  Powers Available
 		2.22  Associated Skills
		2.23  Combat Powers
	2.3  Non-humans
		2.31  Strength and Mass
		2.32  Speed
		2.33  Scale Correlations
 		2.34  Cost of Scale
		2.35  Racial Bonuses and Penalties
	2.4  Legendary Heroes
	2.5  Magic
	2.6  Miracles
	2.7  Psi
	2.8  Superpowers
	2.9  Cybernetic Enhancements

3  Action Resolution
	3.1  Action Resolution Terms
	3.2  Rolling the Dice
		3.21  Reading the Dice
		3.22  Other Dice Techniques
		3.23  Success Rates
	3.3  Action Modifiers
	3.4  Unopposed Actions
	3.5  Opposed Actions
	3.6  Critical Results
	3.7  NPC Reactions

4  Combat, Wounds &amp; Healing
	4.1  Combat Terms
	4.2  Melee Combat
		4.21  Story Elements
		4.22  Simultaneous Combat Rounds
		4.23  Alternating Combat Turns
	4.3  Melee Combat Options
		4.31  Melee Modifiers
		4.32  Offensive/Defensive Tactics
		4.33  PCs vs. NPCs
		4.34  Multiple Combatants in Melee
		4.35  Hit Location
		4.36  Fancy Stuff
	4.4  Ranged Combat
	4.5  Wounds
		4.51  Wound Levels
		4.52  Damage Capacity
		4.53  Wound Factors
		4.54  Sample Wound Factors List
		4.55  Determining Wound Level
		4.56  Grazing
		4.57  Recording Wounds
		4.58  Non-human Scale in Combat
	4.6  Wound Options
		4.61  Damage Die Roll
		4.62  Stun, Knockout, and Pulling Punches
		4.63  Min-Mid-Max Die Roll
		4.64  PC Death
		4.65  Technological Levels as Scale
	4.7  Combat and Wounding Example
	4.8  Healing

5  Character Development
	5.1  Subjective Character Development
	5.2  Objective Character Development
	5.3  Development through Training
	5.4	Alternative Experience System

6  Tips and Examples
	6.1  GM Tips and Conversion
		6.11  Conversion Hints
		6.12  Templates
	6.2  Character Sheet Example
	6.3  Character Examples
		6.31  Fantasy Characters
		6.32  Historical Fiction Characters
		6.33  Modern Characters
		6.34  Science Fiction Characters
		6.35  Miscellaneous Characters
	6.4  Class and Racial Template Examples
	6.5  Animal &amp; Creature Examples
	6.6  Equipment Examples

7  The Addenda
	7.1  Fudge Magic
	7.2  Fudge Miracles
	7.3  Fudge Psi
	7.4  Alternate Rules

Fantasy Fudge: A Sample Fudge Game
	Fantasy Fudge
	Character Creation
		Character Points
		General SkillsPoint
		Trading Skills
		Customizing Skill Points
		Character Creation Tips
		The Skill Groups
		Skill Descriptions
		Attributes
		Gifts
		Faults
	Magic
		Innate Magic
		Hedge Magic
		Scholarly Magic
		Clerical Magic
	Non-Human Races
	Equipping Characters
	Character Development
	Settings for Fantasy Fudge
	Action Resolution
	Sample Characters
	Wild Things (Bestiary)

Miscellaneous Charts and Information
	Fudge Combat Tables
	Sample Scale Table
	Sample Skills
	Cost of Skills in Objective Character Creation
</pre>
</div>
<div title="Terminology" creator="JonasSusara" modifier="JonasSusara" created="201010201238" modified="201010201246" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="2">
<pre>To avoid confusion, “he,” “him,” etc., are used to describe a player and PC, and “she,” “her,” etc., are used to describe a Gamemaster and NPC.

The core rules of Fudge are divided into six Chapters plus the Addenda, each of which is divided into Sections. The decimal point in Section numbers is a true decimal. For example, Section 1.35 comes between Section 1.3 and Section 1.4. Additional material has no section numbering.</pre>
</div>
<div title="TspotSetupPlugin" modifier="YourName" created="200808081041" modified="200808081041" tags="systemConfig">
<pre>/***
Description: Contains the stuff you need to use Tiddlyspot
Note, you also need UploadPlugin, PasswordOptionPlugin and LoadRemoteFileThroughProxy
from http://tiddlywiki.bidix.info for a complete working Tiddlyspot site.
***/
//{{{

// edit this if you are migrating sites or retrofitting an existing TW
config.tiddlyspotSiteId = 'fudgerpg';

// make it so you can by default see edit controls via http
config.options.chkHttpReadOnly = false;
window.readOnly = false; // make sure of it (for tw 2.2)
window.showBackstage = true; // show backstage too

// disable autosave in d3
if (window.location.protocol != &quot;file:&quot;)
	config.options.chkGTDLazyAutoSave = false;

// tweak shadow tiddlers to add upload button, password entry box etc
with (config.shadowTiddlers) {
	SiteUrl = 'http://'+config.tiddlyspotSiteId+'.tiddlyspot.com';
	SideBarOptions = SideBarOptions.replace(/(&lt;&lt;saveChanges&gt;&gt;)/,&quot;$1&lt;&lt;tiddler TspotSidebar&gt;&gt;&quot;);
	OptionsPanel = OptionsPanel.replace(/^/,&quot;&lt;&lt;tiddler TspotOptions&gt;&gt;&quot;);
	DefaultTiddlers = DefaultTiddlers.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
	MainMenu = MainMenu.replace(/^/,&quot;[[WelcomeToTiddlyspot]] &quot;);
}

// create some shadow tiddler content
merge(config.shadowTiddlers,{

'TspotOptions':[
 &quot;tiddlyspot password:&quot;,
 &quot;&lt;&lt;option pasUploadPassword&gt;&gt;&quot;,
 &quot;&quot;
].join(&quot;\n&quot;),

'TspotControls':[
 &quot;| tiddlyspot password:|&lt;&lt;option pasUploadPassword&gt;&gt;|&quot;,
 &quot;| site management:|&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;//(requires tiddlyspot password)//&lt;br&gt;[[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]], [[download (go offline)|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download]]|&quot;,
 &quot;| links:|[[tiddlyspot.com|http://tiddlyspot.com/]], [[FAQs|http://faq.tiddlyspot.com/]], [[blog|http://tiddlyspot.blogspot.com/]], email [[support|mailto:support@tiddlyspot.com]] &amp; [[feedback|mailto:feedback@tiddlyspot.com]], [[donate|http://tiddlyspot.com/?page=donate]]|&quot;
].join(&quot;\n&quot;),

'WelcomeToTiddlyspot':[
 &quot;This document is a ~TiddlyWiki from tiddlyspot.com.  A ~TiddlyWiki is an electronic notebook that is great for managing todo lists, personal information, and all sorts of things.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //What now?// &amp;nbsp;&amp;nbsp;@@ Before you can save any changes, you need to enter your password in the form below.  Then configure privacy and other site settings at your [[control panel|http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/controlpanel]] (your control panel username is //&quot; + config.tiddlyspotSiteId + &quot;//).&quot;,
 &quot;&lt;&lt;tiddler TspotControls&gt;&gt;&quot;,
 &quot;See also GettingStarted.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working online// &amp;nbsp;&amp;nbsp;@@ You can edit this ~TiddlyWiki right now, and save your changes using the \&quot;save to web\&quot; button in the column on the right.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Working offline// &amp;nbsp;&amp;nbsp;@@ A fully functioning copy of this ~TiddlyWiki can be saved onto your hard drive or USB stick.  You can make changes and save them locally without being connected to the Internet.  When you're ready to sync up again, just click \&quot;upload\&quot; and your ~TiddlyWiki will be saved back to tiddlyspot.com.&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Help!// &amp;nbsp;&amp;nbsp;@@ Find out more about ~TiddlyWiki at [[TiddlyWiki.com|http://tiddlywiki.com]].  Also visit [[TiddlyWiki.org|http://tiddlywiki.org]] for documentation on learning and using ~TiddlyWiki. New users are especially welcome on the [[TiddlyWiki mailing list|http://groups.google.com/group/TiddlyWiki]], which is an excellent place to ask questions and get help.  If you have a tiddlyspot related problem email [[tiddlyspot support|mailto:support@tiddlyspot.com]].&quot;,
 &quot;&quot;,
 &quot;@@font-weight:bold;font-size:1.3em;color:#444; //Enjoy :)// &amp;nbsp;&amp;nbsp;@@ We hope you like using your tiddlyspot.com site.  Please email [[feedback@tiddlyspot.com|mailto:feedback@tiddlyspot.com]] with any comments or suggestions.&quot;
].join(&quot;\n&quot;),

'TspotSidebar':[
 &quot;&lt;&lt;upload http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/store.cgi index.html . .  &quot; + config.tiddlyspotSiteId + &quot;&gt;&gt;&lt;html&gt;&lt;a href='http://&quot; + config.tiddlyspotSiteId + &quot;.tiddlyspot.com/download' class='button'&gt;download&lt;/a&gt;&lt;/html&gt;&quot;
].join(&quot;\n&quot;)

});
//}}}
</pre>
</div>
<div title="UploadLog" modifier="YourName" created="201010150116" modified="201208160657">
<pre>| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |
| 21/10/2010 16:18:58 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 22/10/2010 11:25:24 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | failed |
| 22/10/2010 11:26:44 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 22/10/2010 12:19:06 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 23/10/2010 15:06:02 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 23/10/2010 15:25:30 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 23/10/2010 16:08:07 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 23/10/2010 18:13:54 | JonasSusara | [[fudgerpg.html|file:///C:/Users/Jonas/Downloads/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . | ok |
| 27/10/2010 11:34:03 | JonasSusara | [[fudgerpg.html|file:///D:/misc/DOCS/JonasTW/fudgerpg.html]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . |
| 16/08/2012 14:57:52 | YourName | [[/|http://fudgerpg.tiddlyspot.com/]] | [[store.cgi|http://fudgerpg.tiddlyspot.com/store.cgi]] | . | [[index.html | http://fudgerpg.tiddlyspot.com/index.html]] | . |</pre>
</div>
<div title="UploadPlugin" modifier="YourName" created="200808080918" modified="201010150116" tags="systemConfig">
<pre>/***
|''Name:''|UploadPlugin|
|''Description:''|Save to web a TiddlyWiki|
|''Version:''|4.1.3|
|''Date:''|Feb 24, 2008|
|''Source:''|http://tiddlywiki.bidix.info/#UploadPlugin|
|''Documentation:''|http://tiddlywiki.bidix.info/#UploadPluginDoc|
|''Author:''|BidiX (BidiX (at) bidix (dot) info)|
|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|
|''~CoreVersion:''|2.2.0|
|''Requires:''|PasswordOptionPlugin|
***/
//{{{
version.extensions.UploadPlugin = {
	major: 4, minor: 1, revision: 3,
	date: new Date(&quot;Feb 24, 2008&quot;),
	source: 'http://tiddlywiki.bidix.info/#UploadPlugin',
	author: 'BidiX (BidiX (at) bidix (dot) info',
	coreVersion: '2.2.0'
};

//
// Environment
//

if (!window.bidix) window.bidix = {}; // bidix namespace
bidix.debugMode = false;	// true to activate both in Plugin and UploadService
	
//
// Upload Macro
//

config.macros.upload = {
// default values
	defaultBackupDir: '',	//no backup
	defaultStoreScript: &quot;store.php&quot;,
	defaultToFilename: &quot;index.html&quot;,
	defaultUploadDir: &quot;.&quot;,
	authenticateUser: true	// UploadService Authenticate User
};
	
config.macros.upload.label = {
	promptOption: &quot;Save and Upload this TiddlyWiki with UploadOptions&quot;,
	promptParamMacro: &quot;Save and Upload this TiddlyWiki in %0&quot;,
	saveLabel: &quot;save to web&quot;, 
	saveToDisk: &quot;save to disk&quot;,
	uploadLabel: &quot;upload&quot;	
};

config.macros.upload.messages = {
	noStoreUrl: &quot;No store URL in parmeters or options&quot;,
	usernameOrPasswordMissing: &quot;Username or password missing&quot;
};

config.macros.upload.handler = function(place,macroName,params) {
	if (readOnly)
		return;
	var label;
	if (document.location.toString().substr(0,4) == &quot;http&quot;) 
		label = this.label.saveLabel;
	else
		label = this.label.uploadLabel;
	var prompt;
	if (params[0]) {
		prompt = this.label.promptParamMacro.toString().format([this.destFile(params[0], 
			(params[1] ? params[1]:bidix.basename(window.location.toString())), params[3])]);
	} else {
		prompt = this.label.promptOption;
	}
	createTiddlyButton(place, label, prompt, function() {config.macros.upload.action(params);}, null, null, this.accessKey);
};

config.macros.upload.action = function(params)
{
		// for missing macro parameter set value from options
		if (!params) params = {};
		var storeUrl = params[0] ? params[0] : config.options.txtUploadStoreUrl;
		var toFilename = params[1] ? params[1] : config.options.txtUploadFilename;
		var backupDir = params[2] ? params[2] : config.options.txtUploadBackupDir;
		var uploadDir = params[3] ? params[3] : config.options.txtUploadDir;
		var username = params[4] ? params[4] : config.options.txtUploadUserName;
		var password = config.options.pasUploadPassword; // for security reason no password as macro parameter	
		// for still missing parameter set default value
		if ((!storeUrl) &amp;&amp; (document.location.toString().substr(0,4) == &quot;http&quot;)) 
			storeUrl = bidix.dirname(document.location.toString())+'/'+config.macros.upload.defaultStoreScript;
		if (storeUrl.substr(0,4) != &quot;http&quot;)
			storeUrl = bidix.dirname(document.location.toString()) +'/'+ storeUrl;
		if (!toFilename)
			toFilename = bidix.basename(window.location.toString());
		if (!toFilename)
			toFilename = config.macros.upload.defaultToFilename;
		if (!uploadDir)
			uploadDir = config.macros.upload.defaultUploadDir;
		if (!backupDir)
			backupDir = config.macros.upload.defaultBackupDir;
		// report error if still missing
		if (!storeUrl) {
			alert(config.macros.upload.messages.noStoreUrl);
			clearMessage();
			return false;
		}
		if (config.macros.upload.authenticateUser &amp;&amp; (!username || !password)) {
			alert(config.macros.upload.messages.usernameOrPasswordMissing);
			clearMessage();
			return false;
		}
		bidix.upload.uploadChanges(false,null,storeUrl, toFilename, uploadDir, backupDir, username, password); 
		return false; 
};

config.macros.upload.destFile = function(storeUrl, toFilename, uploadDir) 
{
	if (!storeUrl)
		return null;
		var dest = bidix.dirname(storeUrl);
		if (uploadDir &amp;&amp; uploadDir != '.')
			dest = dest + '/' + uploadDir;
		dest = dest + '/' + toFilename;
	return dest;
};

//
// uploadOptions Macro
//

config.macros.uploadOptions = {
	handler: function(place,macroName,params) {
		var wizard = new Wizard();
		wizard.createWizard(place,this.wizardTitle);
		wizard.addStep(this.step1Title,this.step1Html);
		var markList = wizard.getElement(&quot;markList&quot;);
		var listWrapper = document.createElement(&quot;div&quot;);
		markList.parentNode.insertBefore(listWrapper,markList);
		wizard.setValue(&quot;listWrapper&quot;,listWrapper);
		this.refreshOptions(listWrapper,false);
		var uploadCaption;
		if (document.location.toString().substr(0,4) == &quot;http&quot;) 
			uploadCaption = config.macros.upload.label.saveLabel;
		else
			uploadCaption = config.macros.upload.label.uploadLabel;
		
		wizard.setButtons([
				{caption: uploadCaption, tooltip: config.macros.upload.label.promptOption, 
					onClick: config.macros.upload.action},
				{caption: this.cancelButton, tooltip: this.cancelButtonPrompt, onClick: this.onCancel}
				
			]);
	},
	options: [
		&quot;txtUploadUserName&quot;,
		&quot;pasUploadPassword&quot;,
		&quot;txtUploadStoreUrl&quot;,
		&quot;txtUploadDir&quot;,
		&quot;txtUploadFilename&quot;,
		&quot;txtUploadBackupDir&quot;,
		&quot;chkUploadLog&quot;,
		&quot;txtUploadLogMaxLine&quot;		
	],
	refreshOptions: function(listWrapper) {
		var opts = [];
		for(i=0; i&lt;this.options.length; i++) {
			var opt = {};
			opts.push();
			opt.option = &quot;&quot;;
			n = this.options[i];
			opt.name = n;
			opt.lowlight = !config.optionsDesc[n];
			opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
			opts.push(opt);
		}
		var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
		for(n=0; n&lt;opts.length; n++) {
			var type = opts[n].name.substr(0,3);
			var h = config.macros.option.types[type];
			if (h &amp;&amp; h.create) {
				h.create(opts[n].colElements['option'],type,opts[n].name,opts[n].name,&quot;no&quot;);
			}
		}
		
	},
	onCancel: function(e)
	{
		backstage.switchTab(null);
		return false;
	},
	
	wizardTitle: &quot;Upload with options&quot;,
	step1Title: &quot;These options are saved in cookies in your browser&quot;,
	step1Html: &quot;&lt;input type='hidden' name='markList'&gt;&lt;/input&gt;&lt;br&gt;&quot;,
	cancelButton: &quot;Cancel&quot;,
	cancelButtonPrompt: &quot;Cancel prompt&quot;,
	listViewTemplate: {
		columns: [
			{name: 'Description', field: 'description', title: &quot;Description&quot;, type: 'WikiText'},
			{name: 'Option', field: 'option', title: &quot;Option&quot;, type: 'String'},
			{name: 'Name', field: 'name', title: &quot;Name&quot;, type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'} 
			]}
};

//
// upload functions
//

if (!bidix.upload) bidix.upload = {};

if (!bidix.upload.messages) bidix.upload.messages = {
	//from saving
	invalidFileError: &quot;The original file '%0' does not appear to be a valid TiddlyWiki&quot;,
	backupSaved: &quot;Backup saved&quot;,
	backupFailed: &quot;Failed to upload backup file&quot;,
	rssSaved: &quot;RSS feed uploaded&quot;,
	rssFailed: &quot;Failed to upload RSS feed file&quot;,
	emptySaved: &quot;Empty template uploaded&quot;,
	emptyFailed: &quot;Failed to upload empty template file&quot;,
	mainSaved: &quot;Main TiddlyWiki file uploaded&quot;,
	mainFailed: &quot;Failed to upload main TiddlyWiki file. Your changes have not been saved&quot;,
	//specific upload
	loadOriginalHttpPostError: &quot;Can't get original file&quot;,
	aboutToSaveOnHttpPost: 'About to upload on %0 ...',
	storePhpNotFound: &quot;The store script '%0' was not found.&quot;
};

bidix.upload.uploadChanges = function(onlyIfDirty,tiddlers,storeUrl,toFilename,uploadDir,backupDir,username,password)
{
	var callback = function(status,uploadParams,original,url,xhr) {
		if (!status) {
			displayMessage(bidix.upload.messages.loadOriginalHttpPostError);
			return;
		}
		if (bidix.debugMode) 
			alert(original.substr(0,500)+&quot;\n...&quot;);
		// Locate the storeArea div's 
		var posDiv = locateStoreArea(original);
		if((posDiv[0] == -1) || (posDiv[1] == -1)) {
			alert(config.messages.invalidFileError.format([localPath]));
			return;
		}
		bidix.upload.uploadRss(uploadParams,original,posDiv);
	};
	
	if(onlyIfDirty &amp;&amp; !store.isDirty())
		return;
	clearMessage();
	// save on localdisk ?
	if (document.location.toString().substr(0,4) == &quot;file&quot;) {
		var path = document.location.toString();
		var localPath = getLocalPath(path);
		saveChanges();
	}
	// get original
	var uploadParams = new Array(storeUrl,toFilename,uploadDir,backupDir,username,password);
	var originalPath = document.location.toString();
	// If url is a directory : add index.html
	if (originalPath.charAt(originalPath.length-1) == &quot;/&quot;)
		originalPath = originalPath + &quot;index.html&quot;;
	var dest = config.macros.upload.destFile(storeUrl,toFilename,uploadDir);
	var log = new bidix.UploadLog();
	log.startUpload(storeUrl, dest, uploadDir,  backupDir);
	displayMessage(bidix.upload.messages.aboutToSaveOnHttpPost.format([dest]));
	if (bidix.debugMode) 
		alert(&quot;about to execute Http - GET on &quot;+originalPath);
	var r = doHttp(&quot;GET&quot;,originalPath,null,null,username,password,callback,uploadParams,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

bidix.upload.uploadRss = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		if(status) {
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.rssSaved,bidix.dirname(url)+'/'+destfile);
			bidix.upload.uploadMain(params[0],params[1],params[2]);
		} else {
			displayMessage(bidix.upload.messages.rssFailed);			
		}
	};
	// do uploadRss
	if(config.options.chkGenerateAnRssFeed) {
		var rssPath = uploadParams[1].substr(0,uploadParams[1].lastIndexOf(&quot;.&quot;)) + &quot;.xml&quot;;
		var rssUploadParams = new Array(uploadParams[0],rssPath,uploadParams[2],'',uploadParams[4],uploadParams[5]);
		var rssString = generateRss();
		// no UnicodeToUTF8 conversion needed when location is &quot;file&quot; !!!
		if (document.location.toString().substr(0,4) != &quot;file&quot;)
			rssString = convertUnicodeToUTF8(rssString);	
		bidix.upload.httpUpload(rssUploadParams,rssString,callback,Array(uploadParams,original,posDiv));
	} else {
		bidix.upload.uploadMain(uploadParams,original,posDiv);
	}
};

bidix.upload.uploadMain = function(uploadParams,original,posDiv) 
{
	var callback = function(status,params,responseText,url,xhr) {
		var log = new bidix.UploadLog();
		if(status) {
			// if backupDir specified
			if ((params[3]) &amp;&amp; (responseText.indexOf(&quot;backupfile:&quot;) &gt; -1))  {
				var backupfile = responseText.substring(responseText.indexOf(&quot;backupfile:&quot;)+11,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;backupfile:&quot;)));
				displayMessage(bidix.upload.messages.backupSaved,bidix.dirname(url)+'/'+backupfile);
			}
			var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9,responseText.indexOf(&quot;\n&quot;, responseText.indexOf(&quot;destfile:&quot;)));
			displayMessage(bidix.upload.messages.mainSaved,bidix.dirname(url)+'/'+destfile);
			store.setDirty(false);
			log.endUpload(&quot;ok&quot;);
		} else {
			alert(bidix.upload.messages.mainFailed);
			displayMessage(bidix.upload.messages.mainFailed);
			log.endUpload(&quot;failed&quot;);			
		}
	};
	// do uploadMain
	var revised = bidix.upload.updateOriginal(original,posDiv);
	bidix.upload.httpUpload(uploadParams,revised,callback,uploadParams);
};

bidix.upload.httpUpload = function(uploadParams,data,callback,params)
{
	var localCallback = function(status,params,responseText,url,xhr) {
		url = (url.indexOf(&quot;nocache=&quot;) &lt; 0 ? url : url.substring(0,url.indexOf(&quot;nocache=&quot;)-1));
		if (xhr.status == 404)
			alert(bidix.upload.messages.storePhpNotFound.format([url]));
		if ((bidix.debugMode) || (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )) {
			alert(responseText);
			if (responseText.indexOf(&quot;Debug mode&quot;) &gt;= 0 )
				responseText = responseText.substring(responseText.indexOf(&quot;\n\n&quot;)+2);
		} else if (responseText.charAt(0) != '0') 
			alert(responseText);
		if (responseText.charAt(0) != '0')
			status = null;
		callback(status,params,responseText,url,xhr);
	};
	// do httpUpload
	var boundary = &quot;---------------------------&quot;+&quot;AaB03x&quot;;	
	var uploadFormName = &quot;UploadPlugin&quot;;
	// compose headers data
	var sheader = &quot;&quot;;
	sheader += &quot;--&quot; + boundary + &quot;\r\nContent-disposition: form-data; name=\&quot;&quot;;
	sheader += uploadFormName +&quot;\&quot;\r\n\r\n&quot;;
	sheader += &quot;backupDir=&quot;+uploadParams[3] +
				&quot;;user=&quot; + uploadParams[4] +
				&quot;;password=&quot; + uploadParams[5] +
				&quot;;uploaddir=&quot; + uploadParams[2];
	if (bidix.debugMode)
		sheader += &quot;;debug=1&quot;;
	sheader += &quot;;;\r\n&quot;; 
	sheader += &quot;\r\n&quot; + &quot;--&quot; + boundary + &quot;\r\n&quot;;
	sheader += &quot;Content-disposition: form-data; name=\&quot;userfile\&quot;; filename=\&quot;&quot;+uploadParams[1]+&quot;\&quot;\r\n&quot;;
	sheader += &quot;Content-Type: text/html;charset=UTF-8&quot; + &quot;\r\n&quot;;
	sheader += &quot;Content-Length: &quot; + data.length + &quot;\r\n\r\n&quot;;
	// compose trailer data
	var strailer = new String();
	strailer = &quot;\r\n--&quot; + boundary + &quot;--\r\n&quot;;
	data = sheader + data + strailer;
	if (bidix.debugMode) alert(&quot;about to execute Http - POST on &quot;+uploadParams[0]+&quot;\n with \n&quot;+data.substr(0,500)+ &quot; ... &quot;);
	var r = doHttp(&quot;POST&quot;,uploadParams[0],data,&quot;multipart/form-data; ;charset=UTF-8; boundary=&quot;+boundary,uploadParams[4],uploadParams[5],localCallback,params,null);
	if (typeof r == &quot;string&quot;)
		displayMessage(r);
	return r;
};

// same as Saving's updateOriginal but without convertUnicodeToUTF8 calls
bidix.upload.updateOriginal = function(original, posDiv)
{
	if (!posDiv)
		posDiv = locateStoreArea(original);
	if((posDiv[0] == -1) || (posDiv[1] == -1)) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + &quot;\n&quot; +
				store.allTiddlersAsHtml() + &quot;\n&quot; +
				original.substr(posDiv[1]);
	var newSiteTitle = getPageTitle().htmlEncode();
	revised = revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-HEAD&quot;,&quot;MarkupPreHead&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-HEAD&quot;,&quot;MarkupPostHead&quot;);
	revised = updateMarkupBlock(revised,&quot;PRE-BODY&quot;,&quot;MarkupPreBody&quot;);
	revised = updateMarkupBlock(revised,&quot;POST-SCRIPT&quot;,&quot;MarkupPostBody&quot;);
	return revised;
};

//
// UploadLog
// 
// config.options.chkUploadLog :
//		false : no logging
//		true : logging
// config.options.txtUploadLogMaxLine :
//		-1 : no limit
//      0 :  no Log lines but UploadLog is still in place
//		n :  the last n lines are only kept
//		NaN : no limit (-1)

bidix.UploadLog = function() {
	if (!config.options.chkUploadLog) 
		return; // this.tiddler = null
	this.tiddler = store.getTiddler(&quot;UploadLog&quot;);
	if (!this.tiddler) {
		this.tiddler = new Tiddler();
		this.tiddler.title = &quot;UploadLog&quot;;
		this.tiddler.text = &quot;| !date | !user | !location | !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |&quot;;
		this.tiddler.created = new Date();
		this.tiddler.modifier = config.options.txtUserName;
		this.tiddler.modified = new Date();
		store.addTiddler(this.tiddler);
	}
	return this;
};

bidix.UploadLog.prototype.addText = function(text) {
	if (!this.tiddler)
		return;
	// retrieve maxLine when we need it
	var maxLine = parseInt(config.options.txtUploadLogMaxLine,10);
	if (isNaN(maxLine))
		maxLine = -1;
	// add text
	if (maxLine != 0) 
		this.tiddler.text = this.tiddler.text + text;
	// Trunck to maxLine
	if (maxLine &gt;= 0) {
		var textArray = this.tiddler.text.split('\n');
		if (textArray.length &gt; maxLine + 1)
			textArray.splice(1,textArray.length-1-maxLine);
			this.tiddler.text = textArray.join('\n');		
	}
	// update tiddler fields
	this.tiddler.modifier = config.options.txtUserName;
	this.tiddler.modified = new Date();
	store.addTiddler(this.tiddler);
	// refresh and notifiy for immediate update
	story.refreshTiddler(this.tiddler.title);
	store.notify(this.tiddler.title, true);
};

bidix.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {
	if (!this.tiddler)
		return;
	var now = new Date();
	var text = &quot;\n| &quot;;
	var filename = bidix.basename(document.location.toString());
	if (!filename) filename = '/';
	text += now.formatString(&quot;0DD/0MM/YYYY 0hh:0mm:0ss&quot;) +&quot; | &quot;;
	text += config.options.txtUserName + &quot; | &quot;;
	text += &quot;[[&quot;+filename+&quot;|&quot;+location + &quot;]] |&quot;;
	text += &quot; [[&quot; + bidix.basename(storeUrl) + &quot;|&quot; + storeUrl + &quot;]] | &quot;;
	text += uploadDir + &quot; | &quot;;
	text += &quot;[[&quot; + bidix.basename(toFilename) + &quot; | &quot; +toFilename + &quot;]] | &quot;;
	text += backupDir + &quot; |&quot;;
	this.addText(text);
};

bidix.UploadLog.prototype.endUpload = function(status) {
	if (!this.tiddler)
		return;
	this.addText(&quot; &quot;+status+&quot; |&quot;);
};

//
// Utilities
// 

bidix.checkPlugin = function(plugin, major, minor, revision) {
	var ext = version.extensions[plugin];
	if (!
		(ext  &amp;&amp; 
			((ext.major &gt; major) || 
			((ext.major == major) &amp;&amp; (ext.minor &gt; minor))  ||
			((ext.major == major) &amp;&amp; (ext.minor == minor) &amp;&amp; (ext.revision &gt;= revision))))) {
			// write error in PluginManager
			if (pluginInfo)
				pluginInfo.log.push(&quot;Requires &quot; + plugin + &quot; &quot; + major + &quot;.&quot; + minor + &quot;.&quot; + revision);
			eval(plugin); // generate an error : &quot;Error: ReferenceError: xxxx is not defined&quot;
	}
};

bidix.dirname = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(0, lastpos);
	} else {
		return filePath.substring(0, filePath.lastIndexOf(&quot;\\&quot;));
	}
};

bidix.basename = function(filePath) {
	if (!filePath) 
		return;
	var lastpos;
	if ((lastpos = filePath.lastIndexOf(&quot;#&quot;)) != -1) 
		filePath = filePath.substring(0, lastpos);
	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {
		return filePath.substring(lastpos + 1);
	} else
		return filePath.substring(filePath.lastIndexOf(&quot;\\&quot;)+1);
};

bidix.initOption = function(name,value) {
	if (!config.options[name])
		config.options[name] = value;
};

//
// Initializations
//

// require PasswordOptionPlugin 1.0.1 or better
bidix.checkPlugin(&quot;PasswordOptionPlugin&quot;, 1, 0, 1);

// styleSheet
setStylesheet('.txtUploadStoreUrl, .txtUploadBackupDir, .txtUploadDir {width: 22em;}',&quot;uploadPluginStyles&quot;);

//optionsDesc
merge(config.optionsDesc,{
	txtUploadStoreUrl: &quot;Url of the UploadService script (default: store.php)&quot;,
	txtUploadFilename: &quot;Filename of the uploaded file (default: in index.html)&quot;,
	txtUploadDir: &quot;Relative Directory where to store the file (default: . (downloadService directory))&quot;,
	txtUploadBackupDir: &quot;Relative Directory where to backup the file. If empty no backup. (default: ''(empty))&quot;,
	txtUploadUserName: &quot;Upload Username&quot;,
	pasUploadPassword: &quot;Upload Password&quot;,
	chkUploadLog: &quot;do Logging in UploadLog (default: true)&quot;,
	txtUploadLogMaxLine: &quot;Maximum of lines in UploadLog (default: 10)&quot;
});

// Options Initializations
bidix.initOption('txtUploadStoreUrl','');
bidix.initOption('txtUploadFilename','');
bidix.initOption('txtUploadDir','');
bidix.initOption('txtUploadBackupDir','');
bidix.initOption('txtUploadUserName','');
bidix.initOption('pasUploadPassword','');
bidix.initOption('chkUploadLog',true);
bidix.initOption('txtUploadLogMaxLine','10');


// Backstage
merge(config.tasks,{
	uploadOptions: {text: &quot;upload&quot;, tooltip: &quot;Change UploadOptions and Upload&quot;, content: '&lt;&lt;uploadOptions&gt;&gt;'}
});
config.backstageTasks.push(&quot;uploadOptions&quot;);


//}}}

</pre>
</div>
<div title="Welcome!" creator="JonasSusara" modifier="JonasSusara" created="201010201333" modified="201010210722" changecount="9">
<pre>Greetings, Fellow Fudge Fans!

This is the (beta) version of the Fudge RPG ~TiddlyWiki.

Download your copy now!

//Jonas &quot;fudgebob dicepants&quot; Susara//

</pre>
</div>
<div title="What is Fudge?" creator="JonasSusara" modifier="JonasSusara" created="201010201231" modified="201010201246" server.type="file" server.host="file:///D:/misc/JonasTW/jonastw.html" changecount="5">
<pre>Fudge is a rules-light roleplaying game (RPG), concentrating on role-playing rather than endless dice rolls and tables and similar detailed game mechanics. It also uses words rather than numbers to describe character traits. For example, a character might be a Great swordsman rather than a &quot;14th level fighter.&quot; Combined with simple action resolution, Fudge's descriptive nature makes ideal it for novice players. Fudge is also flexible enough to satisfy experienced role-players. There are no artificial limits placed on character creation; any character the player can imagine can be described in Fudge terms. (The GM has final say over whether or not a character is acceptable in a given game.)

The basic Fudge rules contain no campaign world information (except for a few examples). But the game's flexibility allows it to be easily used with nearly any other role-playing game's campaign world - and, of course, with Gamemasters' own personal creations.

''Some Highlights of Fudge''
* No Fixed Attributes. The GM chooses attributes that match the genre played and suit individual taste. A GM designing a simple Fudge game may choose only two attributes (Body and Mind, for instance), or may dispense with attributes entirely and have a character's abilities entirely defined by skills, gifts, and faults. Another Gamemaster may choose 6 attributes, or 10, or more. There are a lot of attributes to choose from.
* Skill-driven system. The GM selects the skills, whether they are broadly defined skill groups or finely defined individual skills. You can even mix broad definitions with narrow ones without any loss of playability.
* Simple action resolution. Players use normal six-sided dice - or, optionally, special Fudge dice - to determine how well their characters perform any action. Results describe degrees of success (or failure!) in words - from Superb down to Terrible. Alternative dice methods allow for 20-sided or percentile dice to be used.
* Painless translation. The word-based system lets you easily translate any campaign world or adventure written in Fudge into any other system - and vice versa! Fudge thus works as a &quot;universal translator&quot; of gaming systems.
* Design your own. If you are thinking of designing your own home rules role-playing game, simply reading Fudge can provide an excellent introduction to everything you need consider as a game designer!
* Goodies Galore. The Fudge game was first published on the Internet, and alternative rules and supplementary materials are freely available at various on-line sites. The Grey Ghost Games website includes links to many of these Fudge-related sites. There is also an active Fudge e-mail list.</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://www.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:null, className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(var i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
					theRow.onmouseover = function() {addClass(this,"hoverRow");};
					theRow.onmouseout = function() {removeClass(this,"hoverRow");};
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] || "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		for(var t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] || "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] || this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var ul = document.createElement("ul");
			addClass(ul,"timeline");
			place.appendChild(ul);
			createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		for(var i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	for(var t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev || window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	for(var t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(names[nameIndex] in root) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			addClass(e,"readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	for(var t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	if(params[0])
		txt.value = params[0];
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",params[1] || this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout)
					clearTimeout(me.timeout);
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout)
				clearTimeout(me.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
			case "popup":
				cmd = this.onClickPopup;
				break;
			case "command":
			default:
				cmd = this.onClickCommand;
				break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			addClass(btn,"command_" + commandName);
			if(className)
				addClass(btn,className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			var btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			addClass(btn,"lessCommand");
			break;
		case ">":
			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			addClass(btn,"moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(c in config.commands) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
}

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,config.options.txtEditorFocus||"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var me = config.commands.syncing;
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields["server.host"];
	var serverWorkspace = tiddler.fields["server.workspace"];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = me.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",me.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",me.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = me.currServerMarker + caption;
		} else {
			caption = me.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,me.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/\<nowiki\>((?:.|\n)*?)\<\/nowiki\>/g,"").
		replace(/\<html\>((?:.|\n)*?)\<\/html\>/g,"").
		replace(/\<script((?:.|\n)*?)\<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown;
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return this.getShadowTiddlerText(title);
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created || tiddler.created; // Preserve created date
		creator = creator || tiddler.creator;
		this.deleteTiddler(title);
	} else {
		created = created || modified;
		tiddler = new Tiddler();
	}
	fields = merge({},fields);
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var results = [];
	if(filter) {
		var tiddler;
		var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
		var match = re.exec(filter);
		while(match) {
			if(match[1] || match[4]) {
				var title = match[1] || match[4];
				tiddler = this.fetchTiddler(title);
				if(tiddler) {
					results.pushUnique(tiddler);
				} else if(this.isShadowTiddler(title)) {
					tiddler = new Tiddler();
					tiddler.set(title,this.getTiddlerText(title));
					results.pushUnique(tiddler);
				} else {
					results.pushUnique(new Tiddler(title));
				}
			} else if(match[2]) {
				switch(match[2]) {
					case "tag":
						var matched = this.getTaggedTiddlers(match[3]);
						for(var m = 0; m < matched.length; m++)
							results.pushUnique(matched[m]);
						break;
					case "sort":
						results = this.sortTiddlers(results,match[3]);
						break;
				}
			}
			match = re.exec(filter);
		}
	}
	return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		// Note: this fall-through is intentional
		/*jsl:fallthru*/
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field])
		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
	else
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		delete context.adaptor;
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return;
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType];
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(store.tiddlerExists(title)) {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			} else {
				addClass(tiddlerElem, store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	addClass(this, "selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem ) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler")) {
		e = hasClass(e,"popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
			for(var n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOptionCookie("txtTheme");
	}
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content, "backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			removeClass(this.currTabElem, "backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			removeClass(backstage.currTabElem, "backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
		} catch (ex) {
			showException(ex);
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var ret = adaptor.openHost(url,null,wizard,me.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		var ret = context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		if(ret !== true)
			displayMessage(ret);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	var ret = adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var load = loadRemoteFile(me.source,me.onLoadCore,w);
	if(typeof load == "string") {
		w.setButtons([],me.errorLoadingCore);
		alert(me.errorLoadingCore);
		return false;
	}
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.adaptor = new config.adaptors[syncItem.serverType];
			syncItem.serverHost = syncItem.adaptor.fullHostName(syncItem.serverHost);
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var syncTasks = [];
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var r = null;
		for(var j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];

	var openWorkspaceCallback = function(context,syncItems) {
		if(context.status) {
			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
			return true;
		}
		displayMessage(context.statusText);
		return false;
	};

	var getTiddlerListCallback = function(context,sycnItems) {
		var me = config.macros.sync;
		if(!context.status) {
			displayMessage(context.statusText);
			return false;
		}
		syncItems = context.userParams;
		var tiddlers = context.tiddlers;
		for(var i=0; i<syncItems.length; i++) {
			var si = syncItems[i];
			var f = tiddlers.findByField("title",si.title);
			if(f !== null) {
				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
					si.syncStatus = me.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
				}
			} else {
				si.syncStatus = me.syncStatusList.notFound;
			}
			me.updateSyncStatus(si);
		}
		return true;
	};
	var context = {host:st.serverHost,workspace:st.serverWorkspace};
	syncItem.adaptor.openHost(st.serverHost);
	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	if(syncItem.syncStatus.display)
		syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var me = config.macros.sync;
	var getTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			var tiddler = context.tiddler;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			syncItem.syncStatus = me.syncStatusList.gotFromServer;
			me.updateSyncStatus(syncItem);
		}
	};
	var putTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			store.resetTiddler(context.title);
			syncItem.syncStatus = me.syncStatusList.putToServer;
			me.updateSyncStatus(syncItem);
		}
	};

	var rowNames = ListView.getSelectedRows(currSync.listView);
	var sl = me.syncStatusList;
	for(var i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var errorMsg = "Error in doSync: ";
			try {
				var r = true;
				switch(si.syncStatus) {
				case sl.changedServer:
					r = si.adaptor.getTiddler(si.title,null,si,getTiddlerCallback);
					break;
				case sl.notFound:
				case sl.changedLocally:
				case sl.changedBoth:
					r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
					break;
				default:
					break;
				}
				if(!r)
					displayMessage(errorMsg + r);
			} catch(ex) {
				if(ex.name == "TypeError")
					displayMessage("sync operation unsupported: " + ex.message);
				else
					displayMessage(errorMsg + ex.message);
			}
		}
	}
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlain("WindowTitle");
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			var handlers = config.optionHandlers;
			if(handlers[optType] && handlers[optType].set)
				handlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, "_")) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	var c = name + "=";
	var optType = name.substr(0,3);
	var handlers = config.optionHandlers;
	if(handlers[optType] && handlers[optType].get)
		c += handlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function removeCookie(name)
{
	document.cookie = name + "=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onchange",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	for(var i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(var i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

function copyFile(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}

function saveFile(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	return r;
}

function loadFile(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,00004,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

function javaSaveFile(filePath,content)
{
	try {
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
	} catch(ex) {
	}
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	try {
		if(document.applets["TiddlySaver"])
			return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
	} catch(ex) {
	}
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
	} catch(ex) {
		return null;
	}
	return content.join("\n");
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		var ret = context.complete(context,context.userParams);
	} else {
		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
		if(typeof ret != "string")
			ret = true;
	}
	return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		for(var i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	return context.adaptor.store ?
		context.complete(context,context.userParams) :
		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(args);
}

//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var a = ["major","minor","revision"];
	for(var i = 0; i<a.length; i++) {
		var x1 = v1[a[i]] || 0;
		var x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var btn = document.createElement("a");
	if(action) {
		btn.onclick = action;
		btn.setAttribute("href","javascript:;");
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(var i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	link.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	addClass(popup,"taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(var i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

if(!window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {removeNode(element);};
			break;
		case "children":
			c = function(element,properties) {removeChildren(element);};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		var offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var pos = -1;
	for (var t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) var pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				addClass(c,columnTemplate.className);
		}
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					addClass(c,columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var a = [];
	for(var i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):""; 
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):""; 
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(var n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}


// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
		setTimeout(function() {setStylesheet("","forceReflow");},1);
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated DOM utilities
//--

// @Deprecated: Use jQuery.stylesheet instead
function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{ id: id, doc: doc });
}

// @Deprecated: Use jQuery.stylesheet.remove instead
function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({ id: id });
}
//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:!!allowCache,
		beforeSend: function(xhr) {
			for(var i in headers)
				xhr.setRequestHeader(i,headers[i]);
			xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(jQuery.httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(options);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*!
 * jQuery JavaScript Library v1.4.2
 * http://jquery.com/
 *
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 * Copyright 2010, The Dojo Foundation
 * Released under the MIT, BSD, and GPL Licenses.
 *
 * Date: Sat Feb 13 22:33:48 2010 -0500
 */
(function(A,w){function ma(){if(!c.isReady){try{s.documentElement.doScroll("left")}catch(a){setTimeout(ma,1);return}c.ready()}}function Qa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function X(a,b,d,f,e,j){var i=a.length;if(typeof b==="object"){for(var o in b)X(a,o,b[o],f,e,d);return a}if(d!==w){f=!j&&f&&c.isFunction(d);for(o=0;o<i;o++)e(a[o],b,f?d.call(a[o],o,e(a[o],b)):d,j);return a}return i?
e(a[0],b):w}function J(){return(new Date).getTime()}function Y(){return false}function Z(){return true}function na(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function oa(a){var b,d=[],f=[],e=arguments,j,i,o,k,n,r;i=c.data(this,"events");if(!(a.liveFired===this||!i||!i.live||a.button&&a.type==="click")){a.liveFired=this;var u=i.live.slice(0);for(k=0;k<u.length;k++){i=u[k];i.origType.replace(O,"")===a.type?f.push(i.selector):u.splice(k--,1)}j=c(a.target).closest(f,a.currentTarget);n=0;for(r=
j.length;n<r;n++)for(k=0;k<u.length;k++){i=u[k];if(j[n].selector===i.selector){o=j[n].elem;f=null;if(i.preType==="mouseenter"||i.preType==="mouseleave")f=c(a.relatedTarget).closest(i.selector)[0];if(!f||f!==o)d.push({elem:o,handleObj:i})}}n=0;for(r=d.length;n<r;n++){j=d[n];a.currentTarget=j.elem;a.data=j.handleObj.data;a.handleObj=j.handleObj;if(j.handleObj.origHandler.apply(j.elem,e)===false){b=false;break}}return b}}function pa(a,b){return"live."+(a&&a!=="*"?a+".":"")+b.replace(/\./g,"`").replace(/ /g,
"&")}function qa(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function ra(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var f=c.data(a[d++]),e=c.data(this,f);if(f=f&&f.events){delete e.handle;e.events={};for(var j in f)for(var i in f[j])c.event.add(this,j,f[j][i],f[j][i].data)}}})}function sa(a,b,d){var f,e,j;b=b&&b[0]?b[0].ownerDocument||b[0]:s;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===s&&!ta.test(a[0])&&(c.support.checkClone||!ua.test(a[0]))){e=
true;if(j=c.fragments[a[0]])if(j!==1)f=j}if(!f){f=b.createDocumentFragment();c.clean(a,b,f,d)}if(e)c.fragments[a[0]]=j?f:1;return{fragment:f,cacheable:e}}function K(a,b){var d={};c.each(va.concat.apply([],va.slice(0,b)),function(){d[this]=a});return d}function wa(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var c=function(a,b){return new c.fn.init(a,b)},Ra=A.jQuery,Sa=A.$,s=A.document,T,Ta=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,Ua=/^.[^:#\[\.,]*$/,Va=/\S/,
Wa=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,Xa=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,P=navigator.userAgent,xa=false,Q=[],L,$=Object.prototype.toString,aa=Object.prototype.hasOwnProperty,ba=Array.prototype.push,R=Array.prototype.slice,ya=Array.prototype.indexOf;c.fn=c.prototype={init:function(a,b){var d,f;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!b){this.context=s;this[0]=s.body;this.selector="body";this.length=1;return this}if(typeof a==="string")if((d=Ta.exec(a))&&
(d[1]||!b))if(d[1]){f=b?b.ownerDocument||b:s;if(a=Xa.exec(a))if(c.isPlainObject(b)){a=[s.createElement(a[1])];c.fn.attr.call(a,b,true)}else a=[f.createElement(a[1])];else{a=sa([d[1]],[f]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return c.merge(this,a)}else{if(b=s.getElementById(d[2])){if(b.id!==d[2])return T.find(a);this.length=1;this[0]=b}this.context=s;this.selector=a;return this}else if(!b&&/^\w+$/.test(a)){this.selector=a;this.context=s;a=s.getElementsByTagName(a);return c.merge(this,
a)}else return!b||b.jquery?(b||T).find(a):c(b).find(a);else if(c.isFunction(a))return T.ready(a);if(a.selector!==w){this.selector=a.selector;this.context=a.context}return c.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return R.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,b,d){var f=c();c.isArray(a)?ba.apply(f,a):c.merge(f,a);f.prevObject=this;f.context=this.context;if(b===
"find")f.selector=this.selector+(this.selector?" ":"")+d;else if(b)f.selector=this.selector+"."+b+"("+d+")";return f},each:function(a,b){return c.each(this,a,b)},ready:function(a){c.bindReady();if(c.isReady)a.call(s,c);else Q&&Q.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(R.apply(this,arguments),"slice",R.call(arguments).join(","))},map:function(a){return this.pushStack(c.map(this,
function(b,d){return a.call(b,d,b)}))},end:function(){return this.prevObject||c(null)},push:ba,sort:[].sort,splice:[].splice};c.fn.init.prototype=c.fn;c.extend=c.fn.extend=function(){var a=arguments[0]||{},b=1,d=arguments.length,f=false,e,j,i,o;if(typeof a==="boolean"){f=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!c.isFunction(a))a={};if(d===b){a=this;--b}for(;b<d;b++)if((e=arguments[b])!=null)for(j in e){i=a[j];o=e[j];if(a!==o)if(f&&o&&(c.isPlainObject(o)||c.isArray(o))){i=i&&(c.isPlainObject(i)||
c.isArray(i))?i:c.isArray(o)?[]:{};a[j]=c.extend(f,i,o)}else if(o!==w)a[j]=o}return a};c.extend({noConflict:function(a){A.$=Sa;if(a)A.jQuery=Ra;return c},isReady:false,ready:function(){if(!c.isReady){if(!s.body)return setTimeout(c.ready,13);c.isReady=true;if(Q){for(var a,b=0;a=Q[b++];)a.call(s,c);Q=null}c.fn.triggerHandler&&c(s).triggerHandler("ready")}},bindReady:function(){if(!xa){xa=true;if(s.readyState==="complete")return c.ready();if(s.addEventListener){s.addEventListener("DOMContentLoaded",
L,false);A.addEventListener("load",c.ready,false)}else if(s.attachEvent){s.attachEvent("onreadystatechange",L);A.attachEvent("onload",c.ready);var a=false;try{a=A.frameElement==null}catch(b){}s.documentElement.doScroll&&a&&ma()}}},isFunction:function(a){return $.call(a)==="[object Function]"},isArray:function(a){return $.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||$.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!aa.call(a,"constructor")&&!aa.call(a.constructor.prototype,
"isPrototypeOf"))return false;var b;for(b in a);return b===w||aa.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=c.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return A.JSON&&A.JSON.parse?A.JSON.parse(a):(new Function("return "+
a))();else c.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&Va.test(a)){var b=s.getElementsByTagName("head")[0]||s.documentElement,d=s.createElement("script");d.type="text/javascript";if(c.support.scriptEval)d.appendChild(s.createTextNode(a));else d.text=a;b.insertBefore(d,b.firstChild);b.removeChild(d)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,d){var f,e=0,j=a.length,i=j===w||c.isFunction(a);if(d)if(i)for(f in a){if(b.apply(a[f],
d)===false)break}else for(;e<j;){if(b.apply(a[e++],d)===false)break}else if(i)for(f in a){if(b.call(a[f],f,a[f])===false)break}else for(d=a[0];e<j&&b.call(d,e,d)!==false;d=a[++e]);return a},trim:function(a){return(a||"").replace(Wa,"")},makeArray:function(a,b){b=b||[];if(a!=null)a.length==null||typeof a==="string"||c.isFunction(a)||typeof a!=="function"&&a.setInterval?ba.call(b,a):c.merge(b,a);return b},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,f=b.length;d<f;d++)if(b[d]===
a)return d;return-1},merge:function(a,b){var d=a.length,f=0;if(typeof b.length==="number")for(var e=b.length;f<e;f++)a[d++]=b[f];else for(;b[f]!==w;)a[d++]=b[f++];a.length=d;return a},grep:function(a,b,d){for(var f=[],e=0,j=a.length;e<j;e++)!d!==!b(a[e],e)&&f.push(a[e]);return f},map:function(a,b,d){for(var f=[],e,j=0,i=a.length;j<i;j++){e=b(a[j],j,d);if(e!=null)f[f.length]=e}return f.concat.apply([],f)},guid:1,proxy:function(a,b,d){if(arguments.length===2)if(typeof b==="string"){d=a;a=d[b];b=w}else if(b&&
!c.isFunction(b)){d=b;b=w}if(!b&&a)b=function(){return a.apply(d||this,arguments)};if(a)b.guid=a.guid=a.guid||b.guid||c.guid++;return b},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});P=c.uaMatch(P);if(P.browser){c.browser[P.browser]=true;c.browser.version=P.version}if(c.browser.webkit)c.browser.safari=
true;if(ya)c.inArray=function(a,b){return ya.call(b,a)};T=c(s);if(s.addEventListener)L=function(){s.removeEventListener("DOMContentLoaded",L,false);c.ready()};else if(s.attachEvent)L=function(){if(s.readyState==="complete"){s.detachEvent("onreadystatechange",L);c.ready()}};(function(){c.support={};var a=s.documentElement,b=s.createElement("script"),d=s.createElement("div"),f="script"+J();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";
var e=d.getElementsByTagName("*"),j=d.getElementsByTagName("a")[0];if(!(!e||!e.length||!j)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(j.getAttribute("style")),hrefNormalized:j.getAttribute("href")==="/a",opacity:/^0.55$/.test(j.style.opacity),cssFloat:!!j.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:s.createElement("select").appendChild(s.createElement("option")).selected,
parentNode:d.removeChild(d.appendChild(s.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};b.type="text/javascript";try{b.appendChild(s.createTextNode("window."+f+"=1;"))}catch(i){}a.insertBefore(b,a.firstChild);if(A[f]){c.support.scriptEval=true;delete A[f]}try{delete b.test}catch(o){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function k(){c.support.noCloneEvent=
false;d.detachEvent("onclick",k)});d.cloneNode(true).fireEvent("onclick")}d=s.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=s.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var k=s.createElement("div");k.style.width=k.style.paddingLeft="1px";s.body.appendChild(k);c.boxModel=c.support.boxModel=k.offsetWidth===2;s.body.removeChild(k).style.display="none"});a=function(k){var n=
s.createElement("div");k="on"+k;var r=k in n;if(!r){n.setAttribute(k,"return;");r=typeof n[k]==="function"}return r};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=e=j=null}})();c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var G="jQuery"+J(),Ya=0,za={};c.extend({cache:{},expando:G,noData:{embed:true,object:true,
applet:true},data:function(a,b,d){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var f=a[G],e=c.cache;if(!f&&typeof b==="string"&&d===w)return null;f||(f=++Ya);if(typeof b==="object"){a[G]=f;e[f]=c.extend(true,{},b)}else if(!e[f]){a[G]=f;e[f]={}}a=e[f];if(d!==w)a[b]=d;return typeof b==="string"?a[b]:a}},removeData:function(a,b){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var d=a[G],f=c.cache,e=f[d];if(b){if(e){delete e[b];c.isEmptyObject(e)&&c.removeData(a)}}else{if(c.support.deleteExpando)delete a[c.expando];
else a.removeAttribute&&a.removeAttribute(c.expando);delete f[d]}}}});c.fn.extend({data:function(a,b){if(typeof a==="undefined"&&this.length)return c.data(this[0]);else if(typeof a==="object")return this.each(function(){c.data(this,a)});var d=a.split(".");d[1]=d[1]?"."+d[1]:"";if(b===w){var f=this.triggerHandler("getData"+d[1]+"!",[d[0]]);if(f===w&&this.length)f=c.data(this[0],a);return f===w&&d[1]?this.data(d[0]):f}else return this.trigger("setData"+d[1]+"!",[d[0],b]).each(function(){c.data(this,
a,b)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var f=c.data(a,b);if(!d)return f||[];if(!f||c.isArray(d))f=c.data(a,b,c.makeArray(d));else f.push(d);return f}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),f=d.shift();if(f==="inprogress")f=d.shift();if(f){b==="fx"&&d.unshift("inprogress");f.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===
w)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)})},dequeue:function(a){return this.each(function(){c.dequeue(this,a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var Aa=/[\n\t]/g,ca=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,
cb=/^(a|area)$/i,Ba=/radio|checkbox/;c.fn.extend({attr:function(a,b){return X(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(n){var r=c(this);r.addClass(a.call(this,n,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1)if(e.className){for(var j=" "+e.className+" ",
i=e.className,o=0,k=b.length;o<k;o++)if(j.indexOf(" "+b[o]+" ")<0)i+=" "+b[o];e.className=c.trim(i)}else e.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(k){var n=c(this);n.removeClass(a.call(this,k,n.attr("class")))});if(a&&typeof a==="string"||a===w)for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1&&e.className)if(a){for(var j=(" "+e.className+" ").replace(Aa," "),i=0,o=b.length;i<o;i++)j=j.replace(" "+b[i]+" ",
" ");e.className=c.trim(j)}else e.className=""}return this},toggleClass:function(a,b){var d=typeof a,f=typeof b==="boolean";if(c.isFunction(a))return this.each(function(e){var j=c(this);j.toggleClass(a.call(this,e,j.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var e,j=0,i=c(this),o=b,k=a.split(ca);e=k[j++];){o=f?o:!i.hasClass(e);i[o?"addClass":"removeClass"](e)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,"__className__",this.className);this.className=
this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(Aa," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===w){var b=this[0];if(b){if(c.nodeName(b,"option"))return(b.attributes.value||{}).specified?b.value:b.text;if(c.nodeName(b,"select")){var d=b.selectedIndex,f=[],e=b.options;b=b.type==="select-one";if(d<0)return null;var j=b?d:0;for(d=b?d+1:e.length;j<d;j++){var i=
e[j];if(i.selected){a=c(i).val();if(b)return a;f.push(a)}}return f}if(Ba.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Za,"")}return w}var o=c.isFunction(a);return this.each(function(k){var n=c(this),r=a;if(this.nodeType===1){if(o)r=a.call(this,k,n.val());if(typeof r==="number")r+="";if(c.isArray(r)&&Ba.test(this.type))this.checked=c.inArray(n.val(),r)>=0;else if(c.nodeName(this,"select")){var u=c.makeArray(r);c("option",this).each(function(){this.selected=
c.inArray(c(this).val(),u)>=0});if(!u.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,b,d,f){if(!a||a.nodeType===3||a.nodeType===8)return w;if(f&&b in c.attrFn)return c(a)[b](d);f=a.nodeType!==1||!c.isXMLDoc(a);var e=d!==w;b=f&&c.props[b]||b;if(a.nodeType===1){var j=$a.test(b);if(b in a&&f&&!j){if(e){b==="type"&&ab.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");
a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&b.specified?b.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:w;return a[b]}if(!c.support.style&&f&&b==="style"){if(e)a.style.cssText=""+d;return a.style.cssText}e&&a.setAttribute(b,""+d);a=!c.support.hrefNormalized&&f&&j?a.getAttribute(b,2):a.getAttribute(b);return a===null?w:a}return c.style(a,b,d)}});var O=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,
function(b){return"\\"+b})};c.event={add:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==A&&!a.frameElement)a=A;var e,j;if(d.handler){e=d;d=e.handler}if(!d.guid)d.guid=c.guid++;if(j=c.data(a)){var i=j.events=j.events||{},o=j.handle;if(!o)j.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,arguments):w};o.elem=a;b=b.split(" ");for(var k,n=0,r;k=b[n++];){j=e?c.extend({},e):{handler:d,data:f};if(k.indexOf(".")>-1){r=k.split(".");
k=r.shift();j.namespace=r.slice(0).sort().join(".")}else{r=[];j.namespace=""}j.type=k;j.guid=d.guid;var u=i[k],z=c.event.special[k]||{};if(!u){u=i[k]=[];if(!z.setup||z.setup.call(a,f,r,o)===false)if(a.addEventListener)a.addEventListener(k,o,false);else a.attachEvent&&a.attachEvent("on"+k,o)}if(z.add){z.add.call(a,j);if(!j.handler.guid)j.handler.guid=d.guid}u.push(j);c.event.global[k]=true}a=null}}},global:{},remove:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){var e,j=0,i,o,k,n,r,u,z=c.data(a),
C=z&&z.events;if(z&&C){if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(e in C)c.event.remove(a,e+b)}else{for(b=b.split(" ");e=b[j++];){n=e;i=e.indexOf(".")<0;o=[];if(!i){o=e.split(".");e=o.shift();k=new RegExp("(^|\\.)"+c.map(o.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(r=C[e])if(d){n=c.event.special[e]||{};for(B=f||0;B<r.length;B++){u=r[B];if(d.guid===u.guid){if(i||k.test(u.namespace)){f==null&&r.splice(B--,1);n.remove&&n.remove.call(a,u)}if(f!=
null)break}}if(r.length===0||f!=null&&r.length===1){if(!n.teardown||n.teardown.call(a,o)===false)Ca(a,e,z.handle);delete C[e]}}else for(var B=0;B<r.length;B++){u=r[B];if(i||k.test(u.namespace)){c.event.remove(a,n,u.handler,B);r.splice(B--,1)}}}if(c.isEmptyObject(C)){if(b=z.handle)b.elem=null;delete z.events;delete z.handle;c.isEmptyObject(z)&&c.removeData(a)}}}}},trigger:function(a,b,d,f){var e=a.type||a;if(!f){a=typeof a==="object"?a[G]?a:c.extend(c.Event(e),a):c.Event(e);if(e.indexOf("!")>=0){a.type=
e=e.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[e]&&c.each(c.cache,function(){this.events&&this.events[e]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===8)return w;a.result=w;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(f=c.data(d,"handle"))&&f.apply(d,b);f=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+e]&&d["on"+e].apply(d,b)===false)a.result=false}catch(j){}if(!a.isPropagationStopped()&&
f)c.event.trigger(a,b,f,true);else if(!a.isDefaultPrevented()){f=a.target;var i,o=c.nodeName(f,"a")&&e==="click",k=c.event.special[e]||{};if((!k._default||k._default.call(d,a)===false)&&!o&&!(f&&f.nodeName&&c.noData[f.nodeName.toLowerCase()])){try{if(f[e]){if(i=f["on"+e])f["on"+e]=null;c.event.triggered=true;f[e]()}}catch(n){}if(i)f["on"+e]=i;c.event.triggered=false}}},handle:function(a){var b,d,f,e;a=arguments[0]=c.event.fix(a||A.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;
if(!b){d=a.type.split(".");a.type=d.shift();f=new RegExp("(^|\\.)"+d.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}e=c.data(this,"events");d=e[a.type];if(e&&d){d=d.slice(0);e=0;for(var j=d.length;e<j;e++){var i=d[e];if(b||f.test(i.namespace)){a.handler=i.handler;a.data=i.data;a.handleObj=i;i=i.handler.apply(this,arguments);if(i!==w){a.result=i;if(i===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[G])return a;var b=a;a=c.Event(b);for(var d=this.props.length,f;d;){f=this.props[--d];a[f]=b[f]}if(!a.target)a.target=a.srcElement||s;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=s.documentElement;d=s.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||
d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==w)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,a.origType,c.extend({},a,{handler:oa}))},remove:function(a){var b=true,d=a.origType.replace(O,"");c.each(c.data(this,
"events").live||[],function(){if(d===this.origType.replace(O,""))return b=false});b&&c.event.remove(this,a.origType,oa)}},beforeunload:{setup:function(a,b,d){if(this.setInterval)this.onbeforeunload=d;return false},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};var Ca=s.removeEventListener?function(a,b,d){a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=J();this[G]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Z;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=Z;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z;this.stopPropagation()},isDefaultPrevented:Y,isPropagationStopped:Y,
isImmediatePropagationStopped:Y};var Da=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},Ea=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?Ea:Da,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?Ea:Da)}}});if(!c.support.submitBubbles)c.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length)return na("submit",this,arguments)});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13)return na("submit",this,arguments)})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};
if(!c.support.changeBubbles){var da=/textarea|input|select/i,ea,Fa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(f){return f.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},fa=function(a,b){var d=a.target,f,e;if(!(!da.test(d.nodeName)||d.readOnly)){f=c.data(d,"_change_data");e=Fa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",
e);if(!(f===w||e===f))if(f!=null||e){a.type="change";return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:fa,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return fa.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return fa.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,
"_change_data",Fa(a))}},setup:function(){if(this.type==="file")return false;for(var a in ea)c.event.add(this,a+".specialChange",ea[a]);return da.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return da.test(this.nodeName)}};ea=c.event.special.change.filters}s.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(f){f=c.event.fix(f);f.type=b;return c.event.handle.call(this,f)}c.event.special[b]={setup:function(){this.addEventListener(a,
d,true)},teardown:function(){this.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,f,e){if(typeof d==="object"){for(var j in d)this[b](j,f,d[j],e);return this}if(c.isFunction(f)){e=f;f=w}var i=b==="one"?c.proxy(e,function(k){c(this).unbind(k,i);return e.apply(this,arguments)}):e;if(d==="unload"&&b!=="one")this.one(d,f,e);else{j=0;for(var o=this.length;j<o;j++)c.event.add(this[j],d,i,f)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&
!a.preventDefault)for(var d in a)this.unbind(d,a[d]);else{d=0;for(var f=this.length;d<f;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,f){return this.live(b,d,f,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){a=c.Event(a);a.preventDefault();a.stopPropagation();c.event.trigger(a,b,this[0]);return a.result}},
toggle:function(a){for(var b=arguments,d=1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(f){var e=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,e+1);f.preventDefault();return b[e].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Ga={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,f,e,j){var i,o=0,k,n,r=j||this.selector,
u=j?this:c(this.context);if(c.isFunction(f)){e=f;f=w}for(d=(d||"").split(" ");(i=d[o++])!=null;){j=O.exec(i);k="";if(j){k=j[0];i=i.replace(O,"")}if(i==="hover")d.push("mouseenter"+k,"mouseleave"+k);else{n=i;if(i==="focus"||i==="blur"){d.push(Ga[i]+k);i+=k}else i=(Ga[i]||i)+k;b==="live"?u.each(function(){c.event.add(this,pa(i,r),{data:f,selector:r,handler:e,origType:i,origHandler:e,preType:n})}):u.unbind(pa(i,r),e)}}return this}});c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,b){c.fn[b]=function(d){return d?this.bind(b,d):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});A.attachEvent&&!A.addEventListener&&A.attachEvent("onunload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});(function(){function a(g){for(var h="",l,m=0;g[m];m++){l=g[m];if(l.nodeType===3||l.nodeType===4)h+=l.nodeValue;else if(l.nodeType!==8)h+=a(l.childNodes)}return h}function b(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];
if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1&&!p){t.sizcache=l;t.sizset=q}if(t.nodeName.toLowerCase()===h){y=t;break}t=t[g]}m[q]=y}}}function d(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1){if(!p){t.sizcache=l;t.sizset=q}if(typeof h!=="string"){if(t===h){y=true;break}}else if(k.filter(h,[t]).length>0){y=t;break}}t=t[g]}m[q]=y}}}var f=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
e=0,j=Object.prototype.toString,i=false,o=true;[0,0].sort(function(){o=false;return 0});var k=function(g,h,l,m){l=l||[];var q=h=h||s;if(h.nodeType!==1&&h.nodeType!==9)return[];if(!g||typeof g!=="string")return l;for(var p=[],v,t,y,S,H=true,M=x(h),I=g;(f.exec(""),v=f.exec(I))!==null;){I=v[3];p.push(v[1]);if(v[2]){S=v[3];break}}if(p.length>1&&r.exec(g))if(p.length===2&&n.relative[p[0]])t=ga(p[0]+p[1],h);else for(t=n.relative[p[0]]?[h]:k(p.shift(),h);p.length;){g=p.shift();if(n.relative[g])g+=p.shift();
t=ga(g,t)}else{if(!m&&p.length>1&&h.nodeType===9&&!M&&n.match.ID.test(p[0])&&!n.match.ID.test(p[p.length-1])){v=k.find(p.shift(),h,M);h=v.expr?k.filter(v.expr,v.set)[0]:v.set[0]}if(h){v=m?{expr:p.pop(),set:z(m)}:k.find(p.pop(),p.length===1&&(p[0]==="~"||p[0]==="+")&&h.parentNode?h.parentNode:h,M);t=v.expr?k.filter(v.expr,v.set):v.set;if(p.length>0)y=z(t);else H=false;for(;p.length;){var D=p.pop();v=D;if(n.relative[D])v=p.pop();else D="";if(v==null)v=h;n.relative[D](y,v,M)}}else y=[]}y||(y=t);y||k.error(D||
g);if(j.call(y)==="[object Array]")if(H)if(h&&h.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&E(h,y[g])))l.push(t[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&l.push(t[g]);else l.push.apply(l,y);else z(y,l);if(S){k(S,q,l,m);k.uniqueSort(l)}return l};k.uniqueSort=function(g){if(B){i=o;g.sort(B);if(i)for(var h=1;h<g.length;h++)g[h]===g[h-1]&&g.splice(h--,1)}return g};k.matches=function(g,h){return k(g,null,null,h)};k.find=function(g,h,l){var m,q;if(!g)return[];
for(var p=0,v=n.order.length;p<v;p++){var t=n.order[p];if(q=n.leftMatch[t].exec(g)){var y=q[1];q.splice(1,1);if(y.substr(y.length-1)!=="\\"){q[1]=(q[1]||"").replace(/\\/g,"");m=n.find[t](q,h,l);if(m!=null){g=g.replace(n.match[t],"");break}}}}m||(m=h.getElementsByTagName("*"));return{set:m,expr:g}};k.filter=function(g,h,l,m){for(var q=g,p=[],v=h,t,y,S=h&&h[0]&&x(h[0]);g&&h.length;){for(var H in n.filter)if((t=n.leftMatch[H].exec(g))!=null&&t[2]){var M=n.filter[H],I,D;D=t[1];y=false;t.splice(1,1);if(D.substr(D.length-
1)!=="\\"){if(v===p)p=[];if(n.preFilter[H])if(t=n.preFilter[H](t,v,l,p,m,S)){if(t===true)continue}else y=I=true;if(t)for(var U=0;(D=v[U])!=null;U++)if(D){I=M(D,t,U,v);var Ha=m^!!I;if(l&&I!=null)if(Ha)y=true;else v[U]=false;else if(Ha){p.push(D);y=true}}if(I!==w){l||(v=p);g=g.replace(n.match[H],"");if(!y)return[];break}}}if(g===q)if(y==null)k.error(g);else break;q=g}return v};k.error=function(g){throw"Syntax error, unrecognized expression: "+g;};var n=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},
relative:{"+":function(g,h){var l=typeof h==="string",m=l&&!/\W/.test(h);l=l&&!m;if(m)h=h.toLowerCase();m=0;for(var q=g.length,p;m<q;m++)if(p=g[m]){for(;(p=p.previousSibling)&&p.nodeType!==1;);g[m]=l||p&&p.nodeName.toLowerCase()===h?p||false:p===h}l&&k.filter(h,g,true)},">":function(g,h){var l=typeof h==="string";if(l&&!/\W/.test(h)){h=h.toLowerCase();for(var m=0,q=g.length;m<q;m++){var p=g[m];if(p){l=p.parentNode;g[m]=l.nodeName.toLowerCase()===h?l:false}}}else{m=0;for(q=g.length;m<q;m++)if(p=g[m])g[m]=
l?p.parentNode:p.parentNode===h;l&&k.filter(h,g,true)}},"":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("parentNode",h,m,g,p,l)},"~":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("previousSibling",h,m,g,p,l)}},find:{ID:function(g,h,l){if(typeof h.getElementById!=="undefined"&&!l)return(g=h.getElementById(g[1]))?[g]:[]},NAME:function(g,h){if(typeof h.getElementsByName!=="undefined"){var l=[];
h=h.getElementsByName(g[1]);for(var m=0,q=h.length;m<q;m++)h[m].getAttribute("name")===g[1]&&l.push(h[m]);return l.length===0?null:l}},TAG:function(g,h){return h.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,h,l,m,q,p){g=" "+g[1].replace(/\\/g,"")+" ";if(p)return g;p=0;for(var v;(v=h[p])!=null;p++)if(v)if(q^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))l||m.push(v);else if(l)h[p]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},
CHILD:function(g){if(g[1]==="nth"){var h=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=h[1]+(h[2]||1)-0;g[3]=h[3]-0}g[0]=e++;return g},ATTR:function(g,h,l,m,q,p){h=g[1].replace(/\\/g,"");if(!p&&n.attrMap[h])g[1]=n.attrMap[h];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,h,l,m,q){if(g[1]==="not")if((f.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,h);else{g=k.filter(g[3],h,l,true^q);l||m.push.apply(m,
g);return false}else if(n.match.POS.test(g[0])||n.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,h,l){return!!k(l[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},
text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},
setFilters:{first:function(g,h){return h===0},last:function(g,h,l,m){return h===m.length-1},even:function(g,h){return h%2===0},odd:function(g,h){return h%2===1},lt:function(g,h,l){return h<l[3]-0},gt:function(g,h,l){return h>l[3]-0},nth:function(g,h,l){return l[3]-0===h},eq:function(g,h,l){return l[3]-0===h}},filter:{PSEUDO:function(g,h,l,m){var q=h[1],p=n.filters[q];if(p)return p(g,l,h,m);else if(q==="contains")return(g.textContent||g.innerText||a([g])||"").indexOf(h[3])>=0;else if(q==="not"){h=
h[3];l=0;for(m=h.length;l<m;l++)if(h[l]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+q)},CHILD:function(g,h){var l=h[1],m=g;switch(l){case "only":case "first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(l==="first")return true;m=g;case "last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case "nth":l=h[2];var q=h[3];if(l===1&&q===0)return true;h=h[0];var p=g.parentNode;if(p&&(p.sizcache!==h||!g.nodeIndex)){var v=0;for(m=p.firstChild;m;m=
m.nextSibling)if(m.nodeType===1)m.nodeIndex=++v;p.sizcache=h}g=g.nodeIndex-q;return l===0?g===0:g%l===0&&g/l>=0}},ID:function(g,h){return g.nodeType===1&&g.getAttribute("id")===h},TAG:function(g,h){return h==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===h},CLASS:function(g,h){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(h)>-1},ATTR:function(g,h){var l=h[1];g=n.attrHandle[l]?n.attrHandle[l](g):g[l]!=null?g[l]:g.getAttribute(l);l=g+"";var m=h[2];h=h[4];return g==null?m==="!=":m===
"="?l===h:m==="*="?l.indexOf(h)>=0:m==="~="?(" "+l+" ").indexOf(h)>=0:!h?l&&g!==false:m==="!="?l!==h:m==="^="?l.indexOf(h)===0:m==="$="?l.substr(l.length-h.length)===h:m==="|="?l===h||l.substr(0,h.length+1)===h+"-":false},POS:function(g,h,l,m){var q=n.setFilters[h[2]];if(q)return q(g,l,h,m)}}},r=n.match.POS;for(var u in n.match){n.match[u]=new RegExp(n.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source);n.leftMatch[u]=new RegExp(/(^(?:.|\r|\n)*?)/.source+n.match[u].source.replace(/\\(\d+)/g,function(g,
h){return"\\"+(h-0+1)}))}var z=function(g,h){g=Array.prototype.slice.call(g,0);if(h){h.push.apply(h,g);return h}return g};try{Array.prototype.slice.call(s.documentElement.childNodes,0)}catch(C){z=function(g,h){h=h||[];if(j.call(g)==="[object Array]")Array.prototype.push.apply(h,g);else if(typeof g.length==="number")for(var l=0,m=g.length;l<m;l++)h.push(g[l]);else for(l=0;g[l];l++)h.push(g[l]);return h}}var B;if(s.documentElement.compareDocumentPosition)B=function(g,h){if(!g.compareDocumentPosition||
!h.compareDocumentPosition){if(g==h)i=true;return g.compareDocumentPosition?-1:1}g=g.compareDocumentPosition(h)&4?-1:g===h?0:1;if(g===0)i=true;return g};else if("sourceIndex"in s.documentElement)B=function(g,h){if(!g.sourceIndex||!h.sourceIndex){if(g==h)i=true;return g.sourceIndex?-1:1}g=g.sourceIndex-h.sourceIndex;if(g===0)i=true;return g};else if(s.createRange)B=function(g,h){if(!g.ownerDocument||!h.ownerDocument){if(g==h)i=true;return g.ownerDocument?-1:1}var l=g.ownerDocument.createRange(),m=
h.ownerDocument.createRange();l.setStart(g,0);l.setEnd(g,0);m.setStart(h,0);m.setEnd(h,0);g=l.compareBoundaryPoints(Range.START_TO_END,m);if(g===0)i=true;return g};(function(){var g=s.createElement("div"),h="script"+(new Date).getTime();g.innerHTML="<a name='"+h+"'/>";var l=s.documentElement;l.insertBefore(g,l.firstChild);if(s.getElementById(h)){n.find.ID=function(m,q,p){if(typeof q.getElementById!=="undefined"&&!p)return(q=q.getElementById(m[1]))?q.id===m[1]||typeof q.getAttributeNode!=="undefined"&&
q.getAttributeNode("id").nodeValue===m[1]?[q]:w:[]};n.filter.ID=function(m,q){var p=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&p&&p.nodeValue===q}}l.removeChild(g);l=g=null})();(function(){var g=s.createElement("div");g.appendChild(s.createComment(""));if(g.getElementsByTagName("*").length>0)n.find.TAG=function(h,l){l=l.getElementsByTagName(h[1]);if(h[1]==="*"){h=[];for(var m=0;l[m];m++)l[m].nodeType===1&&h.push(l[m]);l=h}return l};g.innerHTML="<a href='#'></a>";
if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")n.attrHandle.href=function(h){return h.getAttribute("href",2)};g=null})();s.querySelectorAll&&function(){var g=k,h=s.createElement("div");h.innerHTML="<p class='TEST'></p>";if(!(h.querySelectorAll&&h.querySelectorAll(".TEST").length===0)){k=function(m,q,p,v){q=q||s;if(!v&&q.nodeType===9&&!x(q))try{return z(q.querySelectorAll(m),p)}catch(t){}return g(m,q,p,v)};for(var l in g)k[l]=g[l];h=null}}();
(function(){var g=s.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){n.order.splice(1,0,"CLASS");n.find.CLASS=function(h,l,m){if(typeof l.getElementsByClassName!=="undefined"&&!m)return l.getElementsByClassName(h[1])};g=null}}})();var E=s.compareDocumentPosition?function(g,h){return!!(g.compareDocumentPosition(h)&16)}:
function(g,h){return g!==h&&(g.contains?g.contains(h):true)},x=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false},ga=function(g,h){var l=[],m="",q;for(h=h.nodeType?[h]:h;q=n.match.PSEUDO.exec(g);){m+=q[0];g=g.replace(n.match.PSEUDO,"")}g=n.relative[g]?g+"*":g;q=0;for(var p=h.length;q<p;q++)k(g,h[q],l);return k.filter(m,l)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=a;c.isXMLDoc=x;c.contains=E})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,
gb=/,/;R=Array.prototype.slice;var Ia=function(a,b,d){if(c.isFunction(b))return c.grep(a,function(e,j){return!!b.call(e,j,e)===d});else if(b.nodeType)return c.grep(a,function(e){return e===b===d});else if(typeof b==="string"){var f=c.grep(a,function(e){return e.nodeType===1});if(Ua.test(b))return c.filter(b,f,!d);else b=c.filter(b,f)}return c.grep(a,function(e){return c.inArray(e,b)>=0===d})};c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,f=0,e=this.length;f<e;f++){d=b.length;
c.find(a,this[f],b);if(f>0)for(var j=d;j<b.length;j++)for(var i=0;i<d;i++)if(b[i]===b[j]){b.splice(j--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,f=b.length;d<f;d++)if(c.contains(this,b[d]))return true})},not:function(a){return this.pushStack(Ia(this,a,false),"not",a)},filter:function(a){return this.pushStack(Ia(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){if(c.isArray(a)){var d=[],f=this[0],e,j=
{},i;if(f&&a.length){e=0;for(var o=a.length;e<o;e++){i=a[e];j[i]||(j[i]=c.expr.match.POS.test(i)?c(i,b||this.context):i)}for(;f&&f.ownerDocument&&f!==b;){for(i in j){e=j[i];if(e.jquery?e.index(f)>-1:c(f).is(e)){d.push({selector:i,elem:f});delete j[i]}}f=f.parentNode}}return d}var k=c.expr.match.POS.test(a)?c(a,b||this.context):null;return this.map(function(n,r){for(;r&&r.ownerDocument&&r!==b;){if(k?k.index(r)>-1:c(r).is(a))return r;r=r.parentNode}return null})},index:function(a){if(!a||typeof a===
"string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){a=typeof a==="string"?c(a,b||this.context):c.makeArray(a);b=c.merge(this.get(),a);return this.pushStack(qa(a[0])||qa(b[0])?b:c.unique(b))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",
d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?
a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,b){c.fn[a]=function(d,f){var e=c.map(this,b,d);eb.test(a)||(f=d);if(f&&typeof f==="string")e=c.filter(f,e);e=this.length>1?c.unique(e):e;if((this.length>1||gb.test(f))&&fb.test(a))e=e.reverse();return this.pushStack(e,a,R.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return c.find.matches(a,b)},dir:function(a,b,d){var f=[];for(a=a[b];a&&a.nodeType!==9&&(d===w||a.nodeType!==1||!c(a).is(d));){a.nodeType===
1&&f.push(a);a=a[b]}return f},nth:function(a,b,d){b=b||1;for(var f=0;a;a=a[d])if(a.nodeType===1&&++f===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var Ja=/ jQuery\d+="(?:\d+|null)"/g,V=/^\s+/,Ka=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,La=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,ta=/<script|<object|<embed|<option|<style/i,ua=/checked\s*(?:[^=]|=\s*.checked.)/i,Ma=function(a,b,d){return hb.test(d)?
a:b+"></"+d+">"},F={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};F.optgroup=F.option;F.tbody=F.tfoot=F.colgroup=F.caption=F.thead;F.th=F.td;if(!c.support.htmlSerialize)F._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=
c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==w)return this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},
wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},
prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,
this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,f;(f=this[d])!=null;d++)if(!a||c.filter(a,[f]).length){if(!b&&f.nodeType===1){c.cleanData(f.getElementsByTagName("*"));c.cleanData([f])}f.parentNode&&f.parentNode.removeChild(f)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);
return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,f=this.ownerDocument;if(!d){d=f.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(Ja,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(V,"")],f)[0]}else return this.cloneNode(true)});if(a===true){ra(this,b);ra(this.find("*"),b.find("*"))}return b},html:function(a){if(a===w)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ja,
""):null;else if(typeof a==="string"&&!ta.test(a)&&(c.support.leadingWhitespace||!V.test(a))&&!F[(La.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ka,Ma);try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(f){this.empty().append(a)}}else c.isFunction(a)?this.each(function(e){var j=c(this),i=j.html();j.empty().append(function(){return a.call(this,e,i)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&
this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=c(this),f=d.html();d.replaceWith(a.call(this,b,f))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){function f(u){return c.nodeName(u,"table")?u.getElementsByTagName("tbody")[0]||
u.appendChild(u.ownerDocument.createElement("tbody")):u}var e,j,i=a[0],o=[],k;if(!c.support.checkClone&&arguments.length===3&&typeof i==="string"&&ua.test(i))return this.each(function(){c(this).domManip(a,b,d,true)});if(c.isFunction(i))return this.each(function(u){var z=c(this);a[0]=i.call(this,u,b?z.html():w);z.domManip(a,b,d)});if(this[0]){e=i&&i.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:sa(a,this,o);k=e.fragment;if(j=k.childNodes.length===
1?(k=k.firstChild):k.firstChild){b=b&&c.nodeName(j,"tr");for(var n=0,r=this.length;n<r;n++)d.call(b?f(this[n],j):this[n],n>0||e.cacheable||this.length>1?k.cloneNode(true):k)}o.length&&c.each(o,Qa)}return this}});c.fragments={};c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var f=[];d=c(d);var e=this.length===1&&this[0].parentNode;if(e&&e.nodeType===11&&e.childNodes.length===1&&d.length===1){d[b](this[0]);
return this}else{e=0;for(var j=d.length;e<j;e++){var i=(e>0?this.clone(true):this).get();c.fn[b].apply(c(d[e]),i);f=f.concat(i)}return this.pushStack(f,a,d.selector)}}});c.extend({clean:function(a,b,d,f){b=b||s;if(typeof b.createElement==="undefined")b=b.ownerDocument||b[0]&&b[0].ownerDocument||s;for(var e=[],j=0,i;(i=a[j])!=null;j++){if(typeof i==="number")i+="";if(i){if(typeof i==="string"&&!jb.test(i))i=b.createTextNode(i);else if(typeof i==="string"){i=i.replace(Ka,Ma);var o=(La.exec(i)||["",
""])[1].toLowerCase(),k=F[o]||F._default,n=k[0],r=b.createElement("div");for(r.innerHTML=k[1]+i+k[2];n--;)r=r.lastChild;if(!c.support.tbody){n=ib.test(i);o=o==="table"&&!n?r.firstChild&&r.firstChild.childNodes:k[1]==="<table>"&&!n?r.childNodes:[];for(k=o.length-1;k>=0;--k)c.nodeName(o[k],"tbody")&&!o[k].childNodes.length&&o[k].parentNode.removeChild(o[k])}!c.support.leadingWhitespace&&V.test(i)&&r.insertBefore(b.createTextNode(V.exec(i)[0]),r.firstChild);i=r.childNodes}if(i.nodeType)e.push(i);else e=
c.merge(e,i)}}if(d)for(j=0;e[j];j++)if(f&&c.nodeName(e[j],"script")&&(!e[j].type||e[j].type.toLowerCase()==="text/javascript"))f.push(e[j].parentNode?e[j].parentNode.removeChild(e[j]):e[j]);else{e[j].nodeType===1&&e.splice.apply(e,[j+1,0].concat(c.makeArray(e[j].getElementsByTagName("script"))));d.appendChild(e[j])}return e},cleanData:function(a){for(var b,d,f=c.cache,e=c.event.special,j=c.support.deleteExpando,i=0,o;(o=a[i])!=null;i++)if(d=o[c.expando]){b=f[d];if(b.events)for(var k in b.events)e[k]?
c.event.remove(o,k):Ca(o,k,b.handle);if(j)delete o[c.expando];else o.removeAttribute&&o.removeAttribute(c.expando);delete f[d]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Na=/alpha\([^)]*\)/,Oa=/opacity=([^)]*)/,ha=/float/i,ia=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=s.defaultView&&s.defaultView.getComputedStyle,Pa=c.support.cssFloat?"cssFloat":"styleFloat",ja=
function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){return X(this,a,b,true,function(d,f,e){if(e===w)return c.curCSS(d,f);if(typeof e==="number"&&!kb.test(f))e+="px";c.style(d,f,e)})};c.extend({style:function(a,b,d){if(!a||a.nodeType===3||a.nodeType===8)return w;if((b==="width"||b==="height")&&parseFloat(d)<0)d=w;var f=a.style||a,e=d!==w;if(!c.support.opacity&&b==="opacity"){if(e){f.zoom=1;b=parseInt(d,10)+""==="NaN"?"":"alpha(opacity="+d*100+")";a=f.filter||c.curCSS(a,"filter")||"";f.filter=
Na.test(a)?a.replace(Na,b):b}return f.filter&&f.filter.indexOf("opacity=")>=0?parseFloat(Oa.exec(f.filter)[1])/100+"":""}if(ha.test(b))b=Pa;b=b.replace(ia,ja);if(e)f[b]=d;return f[b]},css:function(a,b,d,f){if(b==="width"||b==="height"){var e,j=b==="width"?pb:qb;function i(){e=b==="width"?a.offsetWidth:a.offsetHeight;f!=="border"&&c.each(j,function(){f||(e-=parseFloat(c.curCSS(a,"padding"+this,true))||0);if(f==="margin")e+=parseFloat(c.curCSS(a,"margin"+this,true))||0;else e-=parseFloat(c.curCSS(a,
"border"+this+"Width",true))||0})}a.offsetWidth!==0?i():c.swap(a,ob,i);return Math.max(0,Math.round(e))}return c.curCSS(a,b,d)},curCSS:function(a,b,d){var f,e=a.style;if(!c.support.opacity&&b==="opacity"&&a.currentStyle){f=Oa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return f===""?"1":f}if(ha.test(b))b=Pa;if(!d&&e&&e[b])f=e[b];else if(rb){if(ha.test(b))b="float";b=b.replace(lb,"-$1").toLowerCase();e=a.ownerDocument.defaultView;if(!e)return null;if(a=e.getComputedStyle(a,null))f=
a.getPropertyValue(b);if(b==="opacity"&&f==="")f="1"}else if(a.currentStyle){d=b.replace(ia,ja);f=a.currentStyle[b]||a.currentStyle[d];if(!mb.test(f)&&nb.test(f)){b=e.left;var j=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;e.left=d==="fontSize"?"1em":f||0;f=e.pixelLeft+"px";e.left=b;a.runtimeStyle.left=j}}return f},swap:function(a,b,d){var f={};for(var e in b){f[e]=a.style[e];a.style[e]=b[e]}d.call(a);for(e in b)a.style[e]=f[e]}});if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=
a.offsetWidth,d=a.offsetHeight,f=a.nodeName.toLowerCase()==="tr";return b===0&&d===0&&!f?true:b>0&&d>0&&!f?false:c.curCSS(a,"display")==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var sb=J(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,N=/=\?(&|$)/,ka=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!==
"string")return zb.call(this,a);else if(!this.length)return this;var f=a.indexOf(" ");if(f>=0){var e=a.slice(f,a.length);a=a.slice(0,f)}f="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b==="object"){b=c.param(b,c.ajaxSettings.traditional);f="POST"}var j=this;c.ajax({url:a,type:f,dataType:"html",data:b,complete:function(i,o){if(o==="success"||o==="notmodified")j.html(e?c("<div />").append(i.responseText.replace(tb,"")).find(e):i.responseText);d&&j.each(d,[i.responseText,o,i])}});return this},
serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,b){a=c(this).val();return a==null?null:c.isArray(a)?c.map(a,function(d){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),
function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:f})},getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:f})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,
global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:A.XMLHttpRequest&&(A.location.protocol!=="file:"||!A.ActiveXObject)?function(){return new A.XMLHttpRequest}:function(){try{return new A.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function b(){e.success&&
e.success.call(k,o,i,x);e.global&&f("ajaxSuccess",[x,e])}function d(){e.complete&&e.complete.call(k,x,i);e.global&&f("ajaxComplete",[x,e]);e.global&&!--c.active&&c.event.trigger("ajaxStop")}function f(q,p){(e.context?c(e.context):c.event).trigger(q,p)}var e=c.extend(true,{},c.ajaxSettings,a),j,i,o,k=a&&a.context||e,n=e.type.toUpperCase();if(e.data&&e.processData&&typeof e.data!=="string")e.data=c.param(e.data,e.traditional);if(e.dataType==="jsonp"){if(n==="GET")N.test(e.url)||(e.url+=(ka.test(e.url)?
"&":"?")+(e.jsonp||"callback")+"=?");else if(!e.data||!N.test(e.data))e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?";e.dataType="json"}if(e.dataType==="json"&&(e.data&&N.test(e.data)||N.test(e.url))){j=e.jsonpCallback||"jsonp"+sb++;if(e.data)e.data=(e.data+"").replace(N,"="+j+"$1");e.url=e.url.replace(N,"="+j+"$1");e.dataType="script";A[j]=A[j]||function(q){o=q;b();d();A[j]=w;try{delete A[j]}catch(p){}z&&z.removeChild(C)}}if(e.dataType==="script"&&e.cache===null)e.cache=false;if(e.cache===
false&&n==="GET"){var r=J(),u=e.url.replace(wb,"$1_="+r+"$2");e.url=u+(u===e.url?(ka.test(e.url)?"&":"?")+"_="+r:"")}if(e.data&&n==="GET")e.url+=(ka.test(e.url)?"&":"?")+e.data;e.global&&!c.active++&&c.event.trigger("ajaxStart");r=(r=xb.exec(e.url))&&(r[1]&&r[1]!==location.protocol||r[2]!==location.host);if(e.dataType==="script"&&n==="GET"&&r){var z=s.getElementsByTagName("head")[0]||s.documentElement,C=s.createElement("script");C.src=e.url;if(e.scriptCharset)C.charset=e.scriptCharset;if(!j){var B=
false;C.onload=C.onreadystatechange=function(){if(!B&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B=true;b();d();C.onload=C.onreadystatechange=null;z&&C.parentNode&&z.removeChild(C)}}}z.insertBefore(C,z.firstChild);return w}var E=false,x=e.xhr();if(x){e.username?x.open(n,e.url,e.async,e.username,e.password):x.open(n,e.url,e.async);try{if(e.data||a&&a.contentType)x.setRequestHeader("Content-Type",e.contentType);if(e.ifModified){c.lastModified[e.url]&&x.setRequestHeader("If-Modified-Since",
c.lastModified[e.url]);c.etag[e.url]&&x.setRequestHeader("If-None-Match",c.etag[e.url])}r||x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Accept",e.dataType&&e.accepts[e.dataType]?e.accepts[e.dataType]+", */*":e.accepts._default)}catch(ga){}if(e.beforeSend&&e.beforeSend.call(k,x,e)===false){e.global&&!--c.active&&c.event.trigger("ajaxStop");x.abort();return false}e.global&&f("ajaxSend",[x,e]);var g=x.onreadystatechange=function(q){if(!x||x.readyState===0||q==="abort"){E||
d();E=true;if(x)x.onreadystatechange=c.noop}else if(!E&&x&&(x.readyState===4||q==="timeout")){E=true;x.onreadystatechange=c.noop;i=q==="timeout"?"timeout":!c.httpSuccess(x)?"error":e.ifModified&&c.httpNotModified(x,e.url)?"notmodified":"success";var p;if(i==="success")try{o=c.httpData(x,e.dataType,e)}catch(v){i="parsererror";p=v}if(i==="success"||i==="notmodified")j||b();else c.handleError(e,x,i,p);d();q==="timeout"&&x.abort();if(e.async)x=null}};try{var h=x.abort;x.abort=function(){x&&h.call(x);
g("abort")}}catch(l){}e.async&&e.timeout>0&&setTimeout(function(){x&&!E&&g("timeout")},e.timeout);try{x.send(n==="POST"||n==="PUT"||n==="DELETE"?e.data:null)}catch(m){c.handleError(e,x,null,m);d()}e.async||g();return x}},handleError:function(a,b,d,f){if(a.error)a.error.call(a.context||a,b,d,f);if(a.global)(a.context?c(a.context):c.event).trigger("ajaxError",[b,a,f])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===
1223||a.status===0}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),f=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(f)c.etag[b]=f;return a.status===304||a.status===0},httpData:function(a,b,d){var f=a.getResponseHeader("content-type")||"",e=b==="xml"||!b&&f.indexOf("xml")>=0;a=e?a.responseXML:a.responseText;e&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b===
"json"||!b&&f.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&f.indexOf("javascript")>=0)c.globalEval(a);return a},param:function(a,b){function d(i,o){if(c.isArray(o))c.each(o,function(k,n){b||/\[\]$/.test(i)?f(i,n):d(i+"["+(typeof n==="object"||c.isArray(n)?k:"")+"]",n)});else!b&&o!=null&&typeof o==="object"?c.each(o,function(k,n){d(i+"["+k+"]",n)}):f(i,o)}function f(i,o){o=c.isFunction(o)?o():o;e[e.length]=encodeURIComponent(i)+"="+encodeURIComponent(o)}var e=[];if(b===w)b=c.ajaxSettings.traditional;
if(c.isArray(a)||a.jquery)c.each(a,function(){f(this.name,this.value)});else for(var j in a)d(j,a[j]);return e.join("&").replace(yb,"+")}});var la={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,W,va=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b){if(a||a===0)return this.animate(K("show",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");
this[a].style.display=d||"";if(c.css(this[a],"display")==="none"){d=this[a].nodeName;var f;if(la[d])f=la[d];else{var e=c("<"+d+" />").appendTo("body");f=e.css("display");if(f==="none")f="block";e.remove();la[d]=f}c.data(this[a],"olddisplay",f)}}a=0;for(b=this.length;a<b;a++)this[a].style.display=c.data(this[a],"olddisplay")||"";return this}},hide:function(a,b){if(a||a===0)return this.animate(K("hide",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");!d&&d!=="none"&&c.data(this[a],
"olddisplay",c.css(this[a],"display"))}a=0;for(b=this.length;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b){var d=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||d?this.each(function(){var f=d?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(K("toggle",3),a,b);return this},fadeTo:function(a,b,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d)},
animate:function(a,b,d,f){var e=c.speed(b,d,f);if(c.isEmptyObject(a))return this.each(e.complete);return this[e.queue===false?"each":"queue"](function(){var j=c.extend({},e),i,o=this.nodeType===1&&c(this).is(":hidden"),k=this;for(i in a){var n=i.replace(ia,ja);if(i!==n){a[n]=a[i];delete a[i];i=n}if(a[i]==="hide"&&o||a[i]==="show"&&!o)return j.complete.call(this);if((i==="height"||i==="width")&&this.style){j.display=c.css(this,"display");j.overflow=this.style.overflow}if(c.isArray(a[i])){(j.specialEasing=
j.specialEasing||{})[i]=a[i][1];a[i]=a[i][0]}}if(j.overflow!=null)this.style.overflow="hidden";j.curAnim=c.extend({},a);c.each(a,function(r,u){var z=new c.fx(k,j,r);if(Ab.test(u))z[u==="toggle"?o?"show":"hide":u](a);else{var C=Bb.exec(u),B=z.cur(true)||0;if(C){u=parseFloat(C[2]);var E=C[3]||"px";if(E!=="px"){k.style[r]=(u||1)+E;B=(u||1)/z.cur(true)*B;k.style[r]=B+E}if(C[1])u=(C[1]==="-="?-1:1)*u+B;z.custom(B,u,E)}else z.custom(B,u,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);
this.each(function(){for(var f=d.length-1;f>=0;f--)if(d[f].elem===this){b&&d[f](true);d.splice(f,1)}});b||this.dequeue();return this}});c.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,b){c.fn[a]=function(d,f){return this.animate(b,d,f)}});c.extend({speed:function(a,b,d){var f=a&&typeof a==="object"?a:{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};f.duration=c.fx.off?0:typeof f.duration===
"number"?f.duration:c.fx.speeds[f.duration]||c.fx.speeds._default;f.old=f.complete;f.complete=function(){f.queue!==false&&c(this).dequeue();c.isFunction(f.old)&&f.old.call(this)};return f},easing:{linear:function(a,b,d,f){return d+f*a},swing:function(a,b,d,f){return(-Math.cos(a*Math.PI)/2+0.5)*f+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||
c.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(c.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(c.curCSS(this.elem,this.prop))||0},custom:function(a,b,d){function f(j){return e.step(j)}this.startTime=J();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;
this.pos=this.state=0;var e=this;f.elem=this.elem;if(f()&&c.timers.push(f)&&!W)W=setInterval(c.fx.tick,13)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var b=J(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=
this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var f in this.options.curAnim)if(this.options.curAnim[f]!==true)d=false;if(d){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=c.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(c.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&c(this.elem).hide();if(this.options.hide||this.options.show)for(var e in this.options.curAnim)c.style(this.elem,
e,this.options.orig[e]);this.options.complete.call(this.elem)}return false}else{e=b-this.startTime;this.state=e/this.options.duration;a=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,e,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||
c.fx.stop()},stop:function(){clearInterval(W);W=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===b.elem}).length};c.fn.offset="getBoundingClientRect"in s.documentElement?
function(a){var b=this[0];if(a)return this.each(function(e){c.offset.setOffset(this,a,e)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);var d=b.getBoundingClientRect(),f=b.ownerDocument;b=f.body;f=f.documentElement;return{top:d.top+(self.pageYOffset||c.support.boxModel&&f.scrollTop||b.scrollTop)-(f.clientTop||b.clientTop||0),left:d.left+(self.pageXOffset||c.support.boxModel&&f.scrollLeft||b.scrollLeft)-(f.clientLeft||b.clientLeft||0)}}:function(a){var b=
this[0];if(a)return this.each(function(r){c.offset.setOffset(this,a,r)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d=b.offsetParent,f=b,e=b.ownerDocument,j,i=e.documentElement,o=e.body;f=(e=e.defaultView)?e.getComputedStyle(b,null):b.currentStyle;for(var k=b.offsetTop,n=b.offsetLeft;(b=b.parentNode)&&b!==o&&b!==i;){if(c.offset.supportsFixedPosition&&f.position==="fixed")break;j=e?e.getComputedStyle(b,null):b.currentStyle;
k-=b.scrollTop;n-=b.scrollLeft;if(b===d){k+=b.offsetTop;n+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(b.nodeName))){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=d;d=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&j.overflow!=="visible"){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=j}if(f.position==="relative"||f.position==="static"){k+=o.offsetTop;n+=o.offsetLeft}if(c.offset.supportsFixedPosition&&
f.position==="fixed"){k+=Math.max(i.scrollTop,o.scrollTop);n+=Math.max(i.scrollLeft,o.scrollLeft)}return{top:k,left:n}};c.offset={initialize:function(){var a=s.body,b=s.createElement("div"),d,f,e,j=parseFloat(c.curCSS(a,"marginTop",true))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";
a.insertBefore(b,a.firstChild);d=b.firstChild;f=d.firstChild;e=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=f.offsetTop!==5;this.doesAddBorderForTableAndCells=e.offsetTop===5;f.style.position="fixed";f.style.top="20px";this.supportsFixedPosition=f.offsetTop===20||f.offsetTop===15;f.style.position=f.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==j;a.removeChild(b);
c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.curCSS(a,"marginTop",true))||0;d+=parseFloat(c.curCSS(a,"marginLeft",true))||0}return{top:b,left:d}},setOffset:function(a,b,d){if(/static/.test(c.curCSS(a,"position")))a.style.position="relative";var f=c(a),e=f.offset(),j=parseInt(c.curCSS(a,"top",true),10)||0,i=parseInt(c.curCSS(a,"left",true),10)||0;if(c.isFunction(b))b=b.call(a,
d,e);d={top:b.top-e.top+j,left:b.left-e.left+i};"using"in b?b.using.call(a,d):f.css(d)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),f=/^body|html$/i.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.curCSS(a,"marginTop",true))||0;d.left-=parseFloat(c.curCSS(a,"marginLeft",true))||0;f.top+=parseFloat(c.curCSS(b[0],"borderTopWidth",true))||0;f.left+=parseFloat(c.curCSS(b[0],"borderLeftWidth",true))||0;return{top:d.top-
f.top,left:d.left-f.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||s.body;a&&!/^body|html$/i.test(a.nodeName)&&c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(f){var e=this[0],j;if(!e)return null;if(f!==w)return this.each(function(){if(j=wa(this))j.scrollTo(!a?f:c(j).scrollLeft(),a?f:c(j).scrollTop());else this[d]=f});else return(j=wa(e))?"pageXOffset"in j?j[a?"pageYOffset":
"pageXOffset"]:c.support.boxModel&&j.document.documentElement[d]||j.document.body[d]:e[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();c.fn["inner"+b]=function(){return this[0]?c.css(this[0],d,false,"padding"):null};c.fn["outer"+b]=function(f){return this[0]?c.css(this[0],d,false,f?"margin":"border"):null};c.fn[d]=function(f){var e=this[0];if(!e)return f==null?null:this;if(c.isFunction(f))return this.each(function(j){var i=c(this);i[d](f.call(this,j,i[d]()))});return"scrollTo"in
e&&e.document?e.document.compatMode==="CSS1Compat"&&e.document.documentElement["client"+b]||e.document.body["client"+b]:e.nodeType===9?Math.max(e.documentElement["client"+b],e.body["scroll"+b],e.documentElement["scroll"+b],e.body["offset"+b],e.documentElement["offset"+b]):f===w?c.css(e,d):this.css(d,typeof f==="string"?f:f+"px")}});A.jQuery=A.$=c})(window);

//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.cssText = css;
		} else {
			doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
				'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
		}
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);
//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
