function main(){window.originalHTML=recreateOriginal();var e,t,i,n,r,o,a,s,l,d,c=new Date;startingUp=!0;var u=jQuery(document);jQuery.noConflict(),window.onbeforeunload=function(e){return window.confirmExit?confirmExit():void 0},params=getParameters(),params&&(params=params.parseParams("open",null,!1)),store=new TiddlyWiki({config:config}),invokeParamifier(params,"oninit"),story=new Story("tiddlerDisplay","tiddler"),addEvent(document,"click",Popup.onDocumentClick),saveTest();var f;for(f=0;f<config.notifyTiddlers.length;f++)store.addNotification(config.notifyTiddlers[f].name,config.notifyTiddlers[f].notify);d=new Date,loadShadowTiddlers(),u.trigger("loadShadows"),l=new Date,store.loadFromDiv("storeArea","store",!0),u.trigger("loadTiddlers"),loadOptions(),s=new Date,invokeParamifier(params,"onload"),a=new Date,readOnly=window.isLocal()?!1:config.options.chkHttpReadOnly;var p=loadPlugins("systemConfig");u.trigger("loadPlugins"),o=new Date,formatter=new Formatter(config.formatters),invokeParamifier(params,"onconfig"),story.switchTheme(config.options.txtTheme),showBackstage=void 0!==showBackstage?showBackstage:!readOnly,r=new Date;var h;for(h in config.macros)config.macros[h].init&&config.macros[h].init();n=new Date,store.notifyAll(),i=new Date,restart(),refreshDisplay(),t=new Date,p&&(story.displayTiddler(null,"PluginManager"),displayMessage(config.messages.customConfigError)),showBackstage&&backstage.init(),e=new Date,config.options.chkDisplayInstrumentation&&(displayMessage("LoadShadows "+(l-d)+" ms"),displayMessage("LoadFromDiv "+(s-l)+" ms"),displayMessage("LoadPlugins "+(o-a)+" ms"),displayMessage("Macro init "+(n-r)+" ms"),displayMessage("Notify "+(i-n)+" ms"),displayMessage("Restart "+(t-i)+" ms"),displayMessage("Total: "+(e-c)+" ms")),startingUp=!1,u.trigger("startup")}function unload(){window.checkUnsavedChanges&&checkUnsavedChanges(),window.scrubNodes&&scrubNodes(document.body)}function restart(){invokeParamifier(params,"onstart"),story.isEmpty()&&story.displayDefaultTiddlers(),window.scrollTo(0,0)}function saveTest(){var e=document.getElementById("saveTest");e.hasChildNodes()&&alert(config.messages.savedSnapshotError),e.appendChild(document.createTextNode("savetest"))}function loadShadowTiddlers(){var e=new TiddlyWiki;e.loadFromDiv("shadowArea","shadows",!0),e.forEachTiddler(function(e,t){config.shadowTiddlers[e]=t.text})}function loadPlugins(e){if(safeMode)return!1;var t=store.getTaggedTiddlers(e);t.sort(function(e,t){return e.title<t.title?-1:e.title==t.title?0:1});var i=[],n=0,r={},o=t.length;installedPlugins=[];var a;for(a=0;o>a;a++){var s=getPluginInfo(t[a]);installedPlugins[a]=s;var l=s.Name||s.title;l&&(r[l]=s),l=s.Source,l&&(r[l]=s)}var d=function(e){if(e&&!e.done){e.done=1;var t=e.Requires;if(t){t=t.readBracketedList();var n;for(n=0;n<t.length;n++)d(r[t[n]])}i.push(e)}};for(a=0;o>a;a++)d(installedPlugins[a]);for(a=0;a<i.length;a++)if(s=i[a],pluginInfo=s,tiddler=s.tiddler,isPluginExecutable(s))if(isPluginEnabled(s)){s.executed=!0;var c=new Date;try{tiddler.text&&window.eval(tiddler.text),n++}catch(u){s.log.push(config.messages.pluginError.format([exceptionText(u)])),s.error=!0,console.tiddlywiki||console.log("error evaluating "+tiddler.title,u)}pluginInfo.startupTime=String(new Date-c)+"ms"}else o--;else s.warning=!0;return n!=o}function getPluginInfo(e){var t=store.getTiddlerSlices(e.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);return t.tiddler=e,t.title=e.title,t.log=[],t}function isPluginExecutable(e){if(e.tiddler.isTagged("systemConfigForce"))return e.log.push(config.messages.pluginForced),!0;if(e.CoreVersion){var t=e.CoreVersion.split("."),i=parseInt(t[0],10)-version.major;if(0==i&&t[1]&&(i=parseInt(t[1],10)-version.minor),0==i&&t[2]&&(i=parseInt(t[2],10)-version.revision),i>0)return e.log.push(config.messages.pluginVersionError),!1}return!0}function isPluginEnabled(e){return e.tiddler.isTagged("systemConfigDisable")?(e.log.push(config.messages.pluginDisabled),!1):!0}function getParameters(){var e=null;return window.location.hash&&(e=decodeURIComponent(window.location.hash.substr(1)),null!=config.browser.firefoxDate&&config.browser.firefoxDate[1]<"20051111"&&(e=convertUTF8ToUnicode(e))),e}function invokeParamifier(e,t){if(e&&void 0!=e.length&&!(e.length<=1)){var i;for(i=1;i<e.length;i++){var n=config.paramifiers[e[i].name];if(n&&n[t]instanceof Function)n[t](e[i].value);else{var r=config.optionHandlers[e[i].name.substr(0,3)];r&&r.set instanceof Function&&r.set(e[i].name,e[i].value)}}}}function Formatter(e){var t;this.formatters=[];var i=[];for(t=0;t<e.length;t++)i.push("("+e[t].match+")"),this.formatters.push(e[t]);this.formatterRegExp=new RegExp(i.join("|"),"mg")}function getParser(e,t){if(e){t||(t=e.fields.wikiformat);var i;if(t){for(i in config.parsers)if(t==config.parsers[i].format)return config.parsers[i]}else for(i in config.parsers)if(e.isTagged(config.parsers[i].formatTag))return config.parsers[i]}return formatter}function Wikifier(e,t,i,n){this.source=e,this.output=null,this.formatter=t,this.nextMatch=0,this.autoLinkWikiWords=n&&0==n.autoLinkWikiWords()?!1:!0,this.highlightRegExp=i,this.highlightMatch=null,this.isStatic=!1,i&&(i.lastIndex=0,this.highlightMatch=i.exec(e)),this.tiddler=n}function wikify(e,t,i,n){if(e){var r=new Wikifier(e,getParser(n),i,n),o=new Date;r.subWikify(t),n&&config.options.chkDisplayInstrumentation&&displayMessage("wikify:"+n.title+" in "+(new Date-o)+" ms")}}function wikifyStatic(e,t,i,n){var r=createTiddlyElement(document.body,"pre");r.style.display="none";var o="";if(e&&""!=e){i||(i=new Tiddler("temp"));var a=new Wikifier(e,getParser(i,n),t,i);a.isStatic=!0,a.subWikify(r),o=r.innerHTML,jQuery(r).remove()}return o}function wikifyPlainText(e,t,i){t>0&&(e=e.substr(0,t));var n=new Wikifier(e,formatter,null,i);return n.wikifyPlain()}function highlightify(e,t,i,n){if(e){var r=new Wikifier(e,formatter,i,n);r.outputText(t,0,e.length)}}function invokeMacro(e,t,i,n,r){try{var o=config.macros[t];if(o&&o.handler){var a=story.findContainingTiddler(e);window.tiddler=a?store.getTiddler(a.getAttribute("tiddler")):null,window.place=e;var s=!0;"system"==config.evaluateMacroParameters&&(r&&-1!=r.tags.indexOf("systemAllowEval")||(s=!1)),o.handler(e,t,o.noPreParse?null:i.readMacroParams(!s),n,i,r)}else createTiddlyError(e,config.messages.macroError.format([t]),config.messages.macroErrorDetails.format([t,config.messages.missingMacro]))}catch(l){createTiddlyError(e,config.messages.macroError.format([t]),config.messages.macroErrorDetails.format([t,l.toString()]))}}function Tiddler(e){return this.title=e,this.text="",this.creator=null,this.modifier=null,this.created=new Date,this.modified=this.created,this.links=[],this.linksUpdated=!1,this.tags=[],this.fields={},this}function TiddlyWiki(e){var t={};e&&e.config&&(this.config=config),this.tiddlersUpdated=!1,this.namedNotifications=[],this.notificationLevel=0,this.slices={},this.clear=function(){t={},this.setDirty(!1)},this.fetchTiddler=function(e){var i=t[e];return i instanceof Tiddler?i:null},this.deleteTiddler=function(e){delete this.slices[e],delete t[e]},this.addTiddler=function(e){delete this.slices[e.title],t[e.title]=e},this.forEachTiddler=function(e){var i;for(i in t){var n=t[i];n instanceof Tiddler&&e.call(this,i,n)}}}function StringFieldAccess(e,t){this.set=t?function(t,i){if(i!=t[e])throw config.messages.fieldCannotBeChanged.format([e])}:function(t,i){return i!=t[e]?(t[e]=i,!0):void 0},this.get=function(t){return t[e]}}function DateFieldAccess(e){this.set=function(t,i){var n=i instanceof Date?i:Date.convertFromYYYYMMDDHHMM(i);return n!=t[e]?(t[e]=n,!0):void 0},this.get=function(t){return t[e].convertToYYYYMMDDHHMM()}}function LinksFieldAccess(e){this.set=function(t,i){var n="string"==typeof i?i.readBracketedList():i;return n.toString()!=t[e].toString()?(t[e]=n,!0):void 0},this.get=function(t){return String.encodeTiddlyLinkList(t[e])}}function Story(e,t){this.container=e,this.idPrefix=t,this.highlightRegExp=null,this.tiddlerId=function(e){e=e.replace(/_/g,"__").replace(/ /g,"_");var t=this.idPrefix+e;return t==this.container?this.idPrefix+"_"+e:t},this.containerId=function(){return this.container}}function upgradeFrom(e){var t=new TiddlyWiki,i=loadFile(e);void 0!==window.netscape&&(i=convertUTF8ToUnicode(i)),t.importTiddlyWiki(i),t.forEachTiddler(function(e,t){store.getTiddler(e)||store.addTiddler(t)}),refreshDisplay(),saveChanges(),alert(config.messages.upgradeDone.format([formatVersion()])),window.location=window.location.toString().substr(0,window.location.toString().lastIndexOf("?"))}function getMessageDiv(){var e=document.getElementById("messageArea");return e?(e.hasChildNodes()||createTiddlyButton(createTiddlyElement(e,"div",null,"messageToolbar"),config.messages.messageClose.text,config.messages.messageClose.tooltip,clearMessage),e.style.display="block",createTiddlyElement(e,"div")):null}function displayMessage(e,t){var i=getMessageDiv();if(!i)return void alert(e);if(t){var n=createTiddlyElement(i,"a",null,null,e);n.href=t,n.target="_blank"}else i.appendChild(document.createTextNode(e))}function clearMessage(){var e=document.getElementById("messageArea");return e&&(jQuery(e).empty(),e.style.display="none"),!1}function refreshElements(e,t){var i,n=e.childNodes;for(i=0;i<n.length;i++){var r=n[i],o=null;r.getAttribute&&(r.tagName?"IFRAME"!=r.tagName:!0)&&(o=r.getAttribute("refresh"));var a=config.refreshers[o],s=!1;void 0!=a&&(s=a(r,t)),r.hasChildNodes()&&!s&&refreshElements(r,t)}}function applyHtmlMacros(e,t){for(var i=e.firstChild;i;){var n=i.nextSibling;if(i.getAttribute){var r=i.getAttribute("macro");if(r){i.removeAttribute("macro");var o="",a=r.indexOf(" ");-1!=a&&(o=r.substr(a+1),r=r.substr(0,a)),invokeMacro(i,r,o,null,t)}}i.hasChildNodes()&&applyHtmlMacros(i,t),i=n}}function refreshPageTemplate(e){var t,i,n=jQuery("<div/>").appendTo("body").hide()[0],r=story.getContainer();if(r)for(t=r.childNodes,i=t.length-1;i>=0;i--)n.appendChild(t[i]);var o=document.getElementById("contentWrapper");for(e&&store.isAvailable(e)||(e=config.refresherData.pageTemplate),store.isAvailable(e)||(e=config.refresherData.defaultPageTemplate),o.innerHTML=store.getRecursiveTiddlerText(e,null,10),applyHtmlMacros(o),refreshElements(o),r=story.getContainer(),jQuery(r).empty(),r||(r=createTiddlyElement(o,"div",story.containerId())),t=n.childNodes,i=t.length-1;i>=0;i--)r.appendChild(t[i]);jQuery(n).remove()}function refreshDisplay(e){"string"==typeof e&&(e=[e]);var t=document.getElementById("contentWrapper");refreshElements(t,e),backstage.isPanelVisible()&&(t=document.getElementById("backstage"),refreshElements(t,e))}function refreshPageTitle(){document.title=getPageTitle()}function getPageTitle(){return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler)}function refreshStyles(e,t){setStylesheet(null==e?"":store.getRecursiveTiddlerText(e,"",10),e,t||document)}function refreshColorPalette(e){startingUp||refreshAll()}function refreshAll(){refreshPageTemplate(),refreshDisplay(),refreshStyles("StyleSheetLayout"),refreshStyles("StyleSheetColors"),refreshStyles(config.refresherData.styleSheet),refreshStyles("StyleSheetPrint")}function setOption(e,t){var i=e.substr(0,3);config.optionHandlers[i]&&config.optionHandlers[i].set&&config.optionHandlers[i].set(e,t)}function getOption(e){var t=e.substr(0,3);return config.optionHandlers[t]&&config.optionHandlers[t].get?config.optionHandlers[t].get(e):null}function loadOptions(){safeMode||(loadCookies(),loadSystemSettings())}function getCookies(){var e,t=document.cookie.split(";"),i={};for(e=0;e<t.length;e++){var n=t[e].indexOf("=");if(-1!=n){var r=t[e].substr(0,n).trim(),o=t[e].substr(n+1).trim();i[r]=o}}return i}function loadCookies(){var e,t=getCookies();t.TiddlyWiki&&(t=t.TiddlyWiki.decodeHashMap());for(e in t)"setting"!=config.optionsSource[e]&&setOption(e,t[e])}function loadSystemSettings(){var e,t=store.calcAllSlices("SystemSettings");config.optionsSource={};for(e in t)setOption(e,t[e]),config.optionsSource[e]="setting"}function onSystemSettingsChange(){startingUp||loadSystemSettings()}function saveOption(e){if(!safeMode){if(e.match(/[()\s]/g,"_"))return void alert(config.messages.invalidCookie.format([e]));saveCookie(e),"setting"==config.optionsSource[e]&&saveSystemSetting(e,!0)}}function removeCookie(e){document.cookie=e+"=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;"}function saveCookie(e){var t,i={};for(t in config.options){var n=getOption(t);n=null==n?"false":n,i[t]=n}document.cookie="TiddlyWiki="+String.encodeHashMap(i)+"; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/",i=getCookies();var r;for(r in i){var o=r.substr(0,3);config.optionHandlers[o]&&removeCookie(r)}}function commitSystemSettings(e){systemSettingSave&&window.clearTimeout(systemSettingSave),systemSettingSave=window.setTimeout(function(){var e=store.getTiddler("SystemSettings");autoSaveChanges(null,[e])},1e3)}function saveSystemSetting(e,t){var i="SystemSettings",n=store.getTiddlerSlice(i,e);if(!readOnly&&n!==getOption(e)){var r,o=store.calcAllSlices(i);for(r in config.optionsSource){var a=getOption(r)||"";o[r]!==a&&(o[r]=a)}var s=[];for(r in o)s.push("%0: %1".format([r,o[r]]));s=s.sort().join("\n");var l=store.isDirty(),d=store.getTiddler(i);d?(d.text=s,d=store.saveTiddler(d)):d=store.saveTiddler(i,i,s,"System",new Date,["excludeLists"],config.defaultCustomFields),t&&commitSystemSettings(l)}}function encodeCookie(e){return escape(convertUnicodeToHtmlEntities(e))}function decodeCookie(s){s=unescape(s);var re=/&#[0-9]{1,5};/g;return s.replace(re,function($0){return String.fromCharCode(eval($0.replace(/[&#;]/g,"")))})}function confirmExit(){return hadConfirmExit=!0,store&&store.isDirty&&store.isDirty()||story&&story.areAnyDirty&&story.areAnyDirty()?config.messages.confirmExit:void 0}function checkUnsavedChanges(){store&&store.isDirty&&store.isDirty()&&window.hadConfirmExit===!1&&confirm(config.messages.unsavedChangesWarning)&&saveChanges()}function updateLanguageAttribute(e){if(config.locale){var t=/(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/,i=t.exec(e);if(i){var n=i[1];i[2]&&(n+=' xml:lang="'+config.locale+'"'),i[3]&&(n+=' lang="'+config.locale+'"'),n+=">",e=e.substr(0,i.index)+n+e.substr(i.index+i[0].length)}}return e}function updateMarkupBlock(e,t,i){return e.replaceChunk("<!--%0-START-->".format([t]),"<!--%0-END-->".format([t]),"\n"+convertUnicodeToFileFormat(store.getRecursiveTiddlerText(i,""))+"\n")}function updateOriginal(e,t,i){if(t||(t=locateStoreArea(e)),!t)return alert(config.messages.invalidFileError.format([i])),null;var n=e.substr(0,t[0]+startSaveArea.length)+"\n"+convertUnicodeToFileFormat(store.allTiddlersAsHtml())+"\n"+e.substr(t[1]),r=convertUnicodeToFileFormat(getPageTitle()).htmlEncode();return n=n.replaceChunk("<title>","</title>"," "+r+" "),n=updateLanguageAttribute(n),n=updateMarkupBlock(n,"PRE-HEAD","MarkupPreHead"),n=updateMarkupBlock(n,"POST-HEAD","MarkupPostHead"),n=updateMarkupBlock(n,"PRE-BODY","MarkupPreBody"),n=updateMarkupBlock(n,"POST-SCRIPT","MarkupPostBody")}function locateStoreArea(e){if(!e)return null;var t=e.search(startSaveAreaRE),i=e.indexOf("<!--POST-STOREAREA-->");-1==i&&(i=e.indexOf("<!--POST-BODY-START-->"));var n=-1==i?e.length:i,r=e.lastIndexOf(endSaveArea,n);return-1==r&&(r=e.lastIndexOf(endSaveAreaCaps,n)),-1!=t&&-1!=r?[t,r]:null}function autoSaveChanges(e,t){config.options.chkAutoSave&&saveChanges(e,t)}function loadOriginal(e){var t=loadFile(e);return t||(t=window.originalHTML||recreateOriginal()),t}function recreateOriginal(){var e="<!DOCTYPE ",t=document.doctype;return t?(e+=t.name,t.publicId?e+=' PUBLIC "'+t.publicId+'"':t.systemId&&(e+=' SYSTEM "'+t.systemId+'"')):e+="html",e+=' "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"',e+=">\n",e+=document.documentElement.outerHTML,e=e.replace(/<div id="saveTest">savetest<\/div>/,'<div id="saveTest"></div>'),e=e.replace(/script><applet [^\>]*><\/applet>/g,"script>"),e=e.replace(/><head>/,">\n<head>"),e=e.replace(/\n\n<\/body><\/html>$/,"</body>\n</html>\n"),e=e.replace(/(<(meta) [^\>]*[^\/])>/g,"$1 />"),e=e.replace(/<noscript>[^\<]*<\/noscript>/,function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">")}),e=e.replace(/<div id="copyright">[^\<]*<\/div>/,function(e){return e.replace(/\xA9/g,"&copy;")})}function saveChanges(e,t){if(!e||store.isDirty()){clearMessage();var i=new Date,n=config.messages,r=document.location.toString();if(!window.allowSave())return alert(n.notFileUrlError),void(store.tiddlerExists(n.saveInstructions)&&story.displayTiddler(null,n.saveInstructions));var o=getLocalPath(r),a=loadOriginal(o);if(null==a)return alert(n.cantSaveError),void(store.tiddlerExists(n.saveInstructions)&&story.displayTiddler(null,n.saveInstructions));var s=locateStoreArea(a);if(!s)return void alert(n.invalidFileError.format([o]));var l=config.options;config.saveByDownload=!1,config.saveByManualDownload=!1,saveMain(o,a,s),config.saveByDownload||config.saveByManualDownload||(l.chkSaveBackups&&saveBackup(o,a),l.chkSaveEmptyTemplate&&saveEmpty(o,a,s),l.chkGenerateAnRssFeed&&saveRss instanceof Function&&saveRss(o)),l.chkDisplayInstrumentation&&displayMessage("saveChanges "+(new Date-i)+" ms")}}function saveMain(e,t,i){var n;try{var r=updateOriginal(t,i,e);n=saveFile(e,r)}catch(o){showException(o)}if(n){if(!config.saveByManualDownload){if(config.saveByDownload)var a=getDataURI(r),s=config.messages.mainDownload;else var a="file://"+e,s=config.messages.mainSaved;displayMessage(s,a)}store.setDirty(!1)}else alert(config.messages.mainFailed)}function saveBackup(e,t){var i=getBackupPath(e),n=copyFile(i,e);n||(n=saveFile(i,t)),n?displayMessage(config.messages.backupSaved,"file://"+i):alert(config.messages.backupFailed)}function saveEmpty(e,t,i){var n,r;n=-1!=(r=e.lastIndexOf("/"))?e.substr(0,r)+"/":-1!=(r=e.lastIndexOf("\\"))?e.substr(0,r)+"\\":e+".",n+="empty.html";var o=t.substr(0,i[0]+startSaveArea.length)+t.substr(i[1]),a=saveFile(n,o);a?displayMessage(config.messages.emptySaved,"file://"+n):alert(config.messages.emptyFailed)}function getBackupPath(e,t,i){var n="\\",r=e.lastIndexOf("\\");-1==r&&(r=e.lastIndexOf("/"),n="/");var o=config.options.txtBackupFolder;o&&""!=o||(o=".");var a=e.substr(0,r)+n+o+e.substr(r);return a=a.substr(0,a.lastIndexOf("."))+".",t&&(a+=t.replace(/[\\\/\*\?\":<> ]/g,"_")+"."),a+=(new Date).convertToYYYYMMDDHHMMSSMMM()+"."+(i||"html")}function saveRss(e){var t=e.substr(0,e.lastIndexOf("."))+".xml";saveFile(t,convertUnicodeToFileFormat(generateRss()))?displayMessage(config.messages.rssSaved,"file://"+t):alert(config.messages.rssFailed)}function generateRss(){var e=[],t=new Date,i=store.getTiddlerText("SiteUrl");e.push('<?xml version="1.0"?>'),e.push('<rss version="2.0">'),e.push("<channel>"),e.push("<title>"+wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode()+"</title>"),i&&e.push("<link>"+i.htmlEncode()+"</link>"),e.push("<description>"+wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode()+"</description>"),e.push("<language>"+config.locale+"</language>"),e.push("<copyright>Copyright "+t.getFullYear()+" "+config.options.txtUserName.htmlEncode()+"</copyright>"),e.push("<pubDate>"+t.toGMTString()+"</pubDate>"),e.push("<lastBuildDate>"+t.toGMTString()+"</lastBuildDate>"),e.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>"),e.push("<generator>TiddlyWiki "+formatVersion()+"</generator>");var n,r=store.getTiddlers("modified","excludeLists"),o=config.numRssItems>r.length?0:r.length-config.numRssItems;for(n=r.length-1;n>=o;n--)e.push("<item>\n"+tiddlerToRssItem(r[n],i)+"\n</item>");return e.push("</channel>"),e.push("</rss>"),e.join("\n")}function ieCreatePath(e){try{var t=new ActiveXObject("Scripting.FileSystemObject")}catch(n){return null}var r=e.lastIndexOf("\\");-1==r&&(r=e.lastIndexOf("/")),-1!=r&&(e=e.substring(0,r+1));for(var o=[e],a=t.GetParentFolderName(e);a&&!t.FolderExists(a);)o.push(a),a=t.GetParentFolderName(a);for(i=o.length-1;i>=0;i--)t.FolderExists(o[i])||t.CreateFolder(o[i]);return!0}function ieSaveFile(e,t){ieCreatePath(e);try{var i=new ActiveXObject("Scripting.FileSystemObject")}catch(n){return null}var r=i.OpenTextFile(e,2,-1,0);return r.Write(t),r.Close(),!0}function ieLoadFile(e){try{var t=new ActiveXObject("Scripting.FileSystemObject"),i=t.OpenTextFile(e,1),n=i.ReadAll();i.Close()}catch(r){return null}return n}function ieCopyFile(e,t){ieCreatePath(e);try{var i=new ActiveXObject("Scripting.FileSystemObject");i.GetFile(t).Copy(e)}catch(n){return!1}return!0}function mozillaSaveFile(e,t){if(window.Components)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var i=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);i.initWithPath(e),i.exists()||i.create(0,436);var n=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);return n.init(i,34,4,null),n.write(t,t.length),n.flush(),n.close(),!0}catch(r){return!1}return null}function mozillaLoadFile(e){if(window.Components)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var t=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(t.initWithPath(e),!t.exists())return null;var i=Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);i.init(t,1,4,null);var n=Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);n.init(i);var r=n.read(n.available());return n.close(),i.close(),r}catch(o){return!1}return null}function javaUrlToFilename(e){var t="//localhost";if(0==e.indexOf(t))return e.substring(t.length);var i=e.indexOf(":");return i>0?e.substring(i-1):e}function logTiddlySaverException(e,t){var i=document.applets.TiddlySaver;if(console.log(e+": "+t),LOG_TIDDLYSAVER&&i)try{console.log(e+": "+i.getLastErrorMsg()),console.log(e+": "+i.getLastErrorStackTrace())}catch(t){}}function javaDebugInformation(){function e(e,i){try{result=String(i.call(t))}catch(n){result=String(n)}return e+": "+result}var t=document.applets.TiddlySaver,i=[["Java Version",t.getJavaVersion],["Last Exception",t.getLastErrorMessage],["Last Exception Stack Trace",t.getLastErrorStackTrace],["System Properties",t.getSystemProperties]];return jQuery.map(i,function(t){return e.apply(this,t)}).join("\n\n")}function javaSaveFile(e,t){var i=document.applets.TiddlySaver;try{if(i&&e)return i.saveFile(javaUrlToFilename(e),"UTF-8",t)}catch(n){logTiddlySaverException("javaSaveFile",n)}try{var r=new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(e)));r.print(t),r.close()}catch(o){return null}return!0}function javaLoadFile(e){var t=document.applets.TiddlySaver;try{if(t&&e){var i=t.loadFile(javaUrlToFilename(e),"UTF-8");return i?String(i):null}}catch(n){logTiddlySaverException("javaLoadFile",n)}var r=[];try{for(var o,a=new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(e)));null!=(o=a.readLine());)r.push(String(o));a.close()}catch(s){return null}return r.join("\n")}function HTML5DownloadSaveFile(e,t){if(void 0!==document.createElement("a").download){config.saveByDownload=!0;var i=e.lastIndexOf("/");-1==i&&(i=e.lastIndexOf("\\"));var n=e.substr(i+1),r=getDataURI(t),o=document.createElement("a");return o.setAttribute("target","_blank"),o.setAttribute("href",r),o.setAttribute("download",n),document.body.appendChild(o),o.click(),document.body.removeChild(o),!0}return null}function manualSaveFile(e,t){config.saveByManualDownload=!0;var i=e.lastIndexOf("/");-1==i&&(i=e.lastIndexOf("\\"));var n=(e.substr(i+1),getDataURI(t));return displayMessage(config.messages.mainDownloadManual,n),!0}function getDataURI(e){return config.browser.isIE?"data:text/html,"+encodeURIComponent(e):"data:text/html;base64,"+encodeBase64(e)}function encodeBase64(e){if(!e)return"";for(var t,i,n,r,o,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",l="",d="",c=0;c<e.length;)t=e.charCodeAt(c++),i=e.charCodeAt(c++),l=e.charCodeAt(c++),n=t>>2,r=(3&t)<<4|i>>4,o=(15&i)<<2|l>>6,d=63&l,isNaN(i)?o=d=64:isNaN(l)&&(d=64),s+=a.charAt(n)+a.charAt(r)+a.charAt(o)+a.charAt(d),t=i=l=n=r=o=d="";return s}function convertUTF8ToUnicode(e){return config.browser.isOpera||!window.netscape?manualConvertUTF8ToUnicode(e):mozConvertUTF8ToUnicode(e)}function manualConvertUTF8ToUnicode(e){for(var t,i,n,r,o=e,a=0,s=0;a<e.length;)t=e.charCodeAt(a++),128>t?s++:224>t?(i=e.charCodeAt(a++),r=String.fromCharCode((31&t)<<6|63&i),o=o.substring(0,s++).concat(r,e.substr(a))):(i=e.charCodeAt(a++),n=e.charCodeAt(a++),r=String.fromCharCode((15&t)<<12|(63&i)<<6|63&n),o=o.substring(0,s++).concat(r,e.substr(a)));return o}function mozConvertUTF8ToUnicode(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var t=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);t.charset="UTF-8"}catch(i){return manualConvertUTF8ToUnicode(e)}var n=t.ConvertToUnicode(e),r=t.Finish();return r.length>0?n+r:n}function convertUnicodeToFileFormat(e){return config.browser.isOpera||!window.netscape?config.browser.isIE?convertUnicodeToHtmlEntities(e):e:mozConvertUnicodeToUTF8(e)}function convertUnicodeToHtmlEntities(e){var t=/[^\u0000-\u007F]/g;return e.replace(t,function(e){return"&#"+e.charCodeAt(0).toString()+";"})}function convertUnicodeToUTF8(e){return convertUnicodeToFileFormat(e)}function manualConvertUnicodeToUTF8(e){return unescape(encodeURIComponent(e))}function mozConvertUnicodeToUTF8(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var t=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);t.charset="UTF-8"}catch(i){return manualConvertUnicodeToUTF8(e)}var n=t.ConvertFromUnicode(e),r=t.Finish();return r.length>0?n+r:n}function convertUriToUTF8(e,t){if(void 0==window.netscape||void 0==t||""==t)return e;try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var i=Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService)}catch(n){return e}return i.convertURISpecToUTF8(e,t)}function AdaptorBase(){return this.host=null,this.store=null,this}function FileAdaptor(){}function ajaxReq(e){return e.file||e.url.startsWith("file")?localAjax(e):jQuery.ajax(e)}function localAjax(e){var t=function(t){e.success(t,"success",{responseText:t})},i=function(t){e.error({message:t+": cannot read local file"},"error",0)};if(e.file)try{var n=new FileReader;return n.onload=function(e){t(e.target.result)},n.onerror=function(e){i("FileReader")},n.readAsText(e.file),!0}catch(r){}try{var o=loadFile(getLocalPath(e.url));return o?t(o):i("loadFile"),!0}catch(r){}return!0}function httpReq(e,t,i,n,r,o,a,s,l,d){var c=function(e){try{return!e.status&&"file:"===location.protocol||e.status>=200&&e.status<300||304===e.status||1223===e.status}catch(t){}return!1},u={type:e,url:t,processData:!1,data:o,cache:!!d,beforeSend:function(e){var t;for(t in r)e.setRequestHeader(t,r[t])}};i&&(u.complete=function(e,r){c(e)?i(!0,n,e.responseText,t,e):i(!1,n,null,t,e)}),a&&(u.contentType=a),s&&(u.username=s),l&&(u.password=l);try{window.Components&&window.netscape&&window.netscape.security&&-1==document.location.protocol.indexOf("http")&&window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead")}catch(f){}return jQuery.ajax(u)}function formatVersion(e){return e=e||version,e.major+"."+e.minor+"."+e.revision+(e.alpha?" (alpha "+e.alpha+")":"")+(e.beta?" (beta "+e.beta+")":"")}function compareVersions(e,t){var i,n,r,o=["major","minor","revision"];for(r=0;r<o.length;r++){if(i=e[o[r]]||0,n=t[o[r]]||0,n>i)return 1;if(i>n)return-1}return i=e.beta||9999,n=t.beta||9999,n>i?1:i>n?-1:0}function merge(e,t,i){var n;for(n in t)i&&void 0!==e[n]||(e[n]=t[n]);return e}function resolveTarget(e){var t;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t}function exceptionText(e,t){var i=e.description||e.toString();return t?"%0:\n%1".format([t,i]):i}function showException(e,t){alert(exceptionText(e,t))}function alertAndThrow(e){throw alert(e),e}function glyph(e){var t=config.glyphs,i=t.currBrowser;if(null==i){for(i=0;i<t.browsers.length-1&&!t.browsers[i]();)i++;t.currBrowser=i}return t.codes[e]?t.codes[e][i]:""}function createTiddlyText(e,t){return e.appendChild(document.createTextNode(t))}function createTiddlyCheckbox(e,t,i,n){var r=document.createElement("input");return r.setAttribute("type","checkbox"),r.onclick=n,e.appendChild(r),r.checked=i,r.className="chkOptionInput",t&&wikify(t,e),r}function createTiddlyElement(e,t,i,n,r,o){var a,s=document.createElement(t);if(null!=n&&(s.className=n),null!=i&&s.setAttribute("id",i),null!=r&&s.appendChild(document.createTextNode(r)),o)for(a in o)s.setAttribute(a,o[a]);return null!=e&&e.appendChild(s),s}function createTiddlyButton(e,t,i,n,r,o,a,s){var l,d=document.createElement("a");if(d.setAttribute("href","javascript:;"),n&&(d.onclick=n),i&&d.setAttribute("title",i),t&&d.appendChild(document.createTextNode(t)),d.className=r||"button",o&&(d.id=o),s)for(l in s)d.setAttribute(l,s[l]);return e&&e.appendChild(d),a&&d.setAttribute("accessKey",a),d}function createExternalLink(e,t,i){var n=document.createElement("a");n.className="externalLink",n.href=t;var r=config.messages.externalLinkTooltip;return n.title=r?r.format([t]):t,config.options.chkOpenInNewWindow&&(n.target="_blank"),e.appendChild(n),i&&createTiddlyText(n,i),n}function getTiddlyLinkInfo(e,t){var i=t?t.split(" "):[];i.pushUnique("tiddlyLink");var n,r=store.fetchTiddler(e);if(r)n=r.getSubtitle(),i.pushUnique("tiddlyLinkExisting"),i.remove("tiddlyLinkNonExisting"),i.remove("shadow");else{var o;i.remove("tiddlyLinkExisting"),i.pushUnique("tiddlyLinkNonExisting"),store.isShadowTiddler(e)?(o=config.messages.shadowedTiddlerToolTip,i.pushUnique("shadow")):(o=config.messages.undefinedTiddlerToolTip,i.remove("shadow")),n=o?o.format([e]):""}return"string"==typeof config.annotations[e]&&(n=config.annotations[e]),{classes:i.join(" "),subTitle:n}}function onClickTiddlerLink(e){var t=e||window.event,i=resolveTarget(t),n=i,r=null,o=null,a=null;do r=n.getAttribute("tiddlyLink"),o=n.getAttribute("tiddlyFields"),a=n.getAttribute("noToggle"),n=n.parentNode;while(null==r&&null!=n);if(!store.isShadowTiddler(r)){var s=o?o.decodeHashMap():{};o=String.encodeHashMap(merge(s,config.defaultCustomFields,!0))}if(r){var l=t.metaKey||t.ctrlKey;config.options.chkToggleLinks&&(l=!l),a&&(l=!1),store.getTiddler(r)&&(o=null),story.displayTiddler(i,r,null,!0,null,o,l)}return clearMessage(),!1}function createTiddlyLink(e,t,i,n,r,o,a){var t=jQuery.trim(t),s=i?t:null,l=getTiddlyLinkInfo(t,n),d=r?createExternalLink(e,store.getTiddlerText("SiteUrl",null)+"#"+t):createTiddlyButton(e,s,l.subTitle,onClickTiddlerLink,l.classes);if(r&&(d.className+=" "+n),d.setAttribute("refresh","link"),d.setAttribute("tiddlyLink",t),a&&d.setAttribute("noToggle","true"),o){var c=o.getInheritedFields();c&&d.setAttribute("tiddlyFields",c)}return d}function refreshTiddlyLink(e,t){var i=getTiddlyLinkInfo(t,e.className);e.className=i.classes,e.title=i.subTitle}function createTiddlyDropDown(e,t,i,n){var r=createTiddlyElement(e,"select");r.onchange=t;var o;for(o=0;o<i.length;o++){var a=createTiddlyElement(r,"option",null,null,i[o].caption);a.value=i[o].name,i[o].name==n&&(a.selected=!0)}return r}function onClickTagOpenAll(e){var t=store.getTaggedTiddlers(this.getAttribute("tag")),i=this.getAttribute("sortby");return i&&i.length&&store.sortTiddlers(t,i),story.displayTiddlers(this,t),!1}function onClickTag(e){var t=e||window.event,i=Popup.create(this);jQuery(i).addClass("taggedTiddlerList");var n=this.getAttribute("tag"),r=this.getAttribute("tiddler");if(i&&n){var o=-1==n.indexOf("[")?store.getTaggedTiddlers(n):store.filterTiddlers(n),a=this.getAttribute("sortby");
a&&a.length&&store.sortTiddlers(o,a);var s,l=[];for(s=0;s<o.length;s++)o[s].title!=r&&l.push(o[s].title);var d=config.views.wikified.tag;if(l.length>0){var c=createTiddlyButton(createTiddlyElement(i,"li"),d.openAllText.format([n]),d.openAllTooltip,onClickTagOpenAll);for(c.setAttribute("tag",n),c.setAttribute("sortby",a),createTiddlyElement(createTiddlyElement(i,"li",null,"listBreak"),"div"),s=0;s<l.length;s++)createTiddlyLink(createTiddlyElement(i,"li"),l[s],!0)}else createTiddlyElement(i,"li",null,"disabled",d.popupNone.format([n]));createTiddlyElement(createTiddlyElement(i,"li",null,"listBreak"),"div");var u=createTiddlyLink(createTiddlyElement(i,"li"),n,!1);createTiddlyText(u,d.openTag.format([n]))}return Popup.show(),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1}function createTagButton(e,t,i,n,r){var o=createTiddlyButton(e,n||t,(r||config.views.wikified.tag.tooltip).format([t]),onClickTag);return o.setAttribute("tag",t),i&&o.setAttribute("tiddler",i),o}function onClickTiddlyPopup(e){var t=e||window.event,i=this.tiddler;if(i.text){var n=Popup.create(this,"div","popupTiddler");wikify(i.text,n,null,i),Popup.show()}return t&&(t.cancelBubble=!0),t&&t.stopPropagation&&t.stopPropagation(),!1}function createTiddlyPopup(e,t,i,n){if(n.text){createTiddlyLink(e,t,!0);var r=createTiddlyButton(e,glyph("downArrow"),i,onClickTiddlyPopup,"tiddlerPopupButton");r.tiddler=n}else createTiddlyText(e,t)}function onClickError(e){var t,i=e||window.event,n=Popup.create(this),r=this.getAttribute("errorText").split("\n");for(t=0;t<r.length;t++)createTiddlyElement(n,"li",null,null,r[t]);return Popup.show(),i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation(),!1}function createTiddlyError(e,t,i){var n=createTiddlyButton(e,t,null,onClickError,"errorButton");i&&n.setAttribute("errorText",i)}function Animator(){return this.running=0,this.timerID=0,this.animations=[],this}function Morpher(e,t,i,n){return this.element=e,this.duration=t,this.properties=i,this.startTime=new Date,this.endTime=Number(this.startTime)+t,this.callback=n,this.tick(),this}function Zoomer(e,t,i,n){var r=createTiddlyElement(document.body,"div",null,"zoomer");createTiddlyElement(r,"div",null,null,e);var o=findWindowWidth(),a=findWindowHeight(),s=[{style:"left",start:findPosX(t),end:findPosX(i),template:"%0px"},{style:"top",start:findPosY(t),end:findPosY(i),template:"%0px"},{style:"width",start:Math.min(t.scrollWidth,o),end:Math.min(i.scrollWidth,o),template:"%0px",atEnd:"auto"},{style:"height",start:Math.min(t.scrollHeight,a),end:Math.min(i.scrollHeight,a),template:"%0px",atEnd:"auto"},{style:"fontSize",start:8,end:24,template:"%0pt"}],l=function(e,t){jQuery(e).remove()};return new Morpher(r,config.animDuration,s,l)}function Scroller(e){var t=[{style:"-tw-vertScroll",start:findScrollY(),end:ensureVisible(e)}];return new Morpher(e,config.animDuration,t)}function Slider(e,t,i,n){e.style.overflow="hidden",t&&(e.style.height="0px"),e.style.display="block";var r=e.scrollHeight,o=[],a=null;if(t)o.push({style:"height",start:0,end:r,template:"%0px",atEnd:"auto"}),o.push({style:"opacity",start:0,end:1,template:"%0"}),o.push({style:"filter",start:0,end:100,template:"alpha(opacity:%0)"});else switch(o.push({style:"height",start:r,end:0,template:"%0px"}),o.push({style:"display",atEnd:"none"}),o.push({style:"opacity",start:1,end:0,template:"%0"}),o.push({style:"filter",start:100,end:0,template:"alpha(opacity:%0)"}),n){case"all":a=function(e,t){jQuery(e).remove()};break;case"children":a=function(e,t){jQuery(e).empty()}}return new Morpher(e,config.animDuration,o,a)}function Wizard(e){e?(this.formElem=findRelated(e,"wizard","className"),this.bodyElem=findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling"),this.footElem=findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling")):(this.formElem=null,this.bodyElem=null,this.footElem=null)}function getParam(e,t,i){if(!e)return i;var n=e[0][t];return n?n[0]:i}function getFlag(e,t,i){return!!getParam(e,t,i)}function RGB(e,t,i){if(this.r=0,this.g=0,this.b=0,"string"==typeof e)if("#"==e.substr(0,1))7==e.length?(this.r=parseInt(e.substr(1,2),16)/255,this.g=parseInt(e.substr(3,2),16)/255,this.b=parseInt(e.substr(5,2),16)/255):(this.r=parseInt(e.substr(1,1),16)/15,this.g=parseInt(e.substr(2,1),16)/15,this.b=parseInt(e.substr(3,1),16)/15);else{var n=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,r=e.match(n);r&&(this.r=parseInt(r[1],10)/255,this.g=parseInt(r[2],10)/255,this.b=parseInt(r[3],10)/255)}else this.r=e,this.g=t,this.b=i;return this}function drawGradient(e,t,i,n){n||(n=i);var r;for(r=0;100>=r;r+=2){var o=document.createElement("div");e.appendChild(o),o.style.position="absolute",o.style.left=t?r+"%":0,o.style.top=t?0:r+"%",o.style.width=t?101-r+"%":"100%",o.style.height=t?"100%":101-r+"%",o.style.zIndex=-1;var a=r/100*(i.length-1),s=n[Math.floor(a)];"string"==typeof s&&(s=new RGB(s));var l=i[Math.ceil(a)];"string"==typeof l&&(l=new RGB(l)),o.style.backgroundColor=s.mix(l,a-Math.floor(a)).toString()}}function addEvent(e,t,i){e.attachEvent?(e["e"+t+i]=i,e[t+i]=function(){e["e"+t+i](window.event)},e.attachEvent("on"+t,e[t+i])):e.addEventListener(t,i,!1)}function removeEvent(e,t,i){e.detachEvent?(e.detachEvent("on"+t,e[t+i]),e[t+i]=null):e.removeEventListener(t,i,!1)}function findRelated(e,t,i,n){if(i=i||"tagName",n=n||"parentNode","className"==i)for(;e&&!jQuery(e).hasClass(t);)e=e[n];else for(;e&&e[i]!=t;)e=e[n];return e}function ensureVisible(e){var t=findPosY(e),i=t+e.offsetHeight,n=findScrollY(),r=findWindowHeight(),o=n+r;return n>t?t:i>o?e.offsetHeight<r?t-(r-e.offsetHeight):t:n}function findWindowWidth(){return window.innerWidth||document.documentElement.clientWidth}function findWindowHeight(){return window.innerHeight||document.documentElement.clientHeight}function findDocHeight(){var e=document;return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function findScrollX(){return window.scrollX||document.documentElement.scrollLeft}function findScrollY(){return window.scrollY||document.documentElement.scrollTop}function findPosX(e){for(var t=0;e.offsetParent;)t+=e.offsetLeft,e=e.offsetParent;return t}function findPosY(e){for(var t=0;e.offsetParent;)t+=e.offsetTop,e=e.offsetParent;return t}function blurElement(e){e&&e.focus&&e.blur&&(e.focus(),e.blur())}function insertSpacer(e){var t=document.createTextNode(String.fromCharCode(160));return e&&e.appendChild(t),t}function replaceSelection(e,t){if(e.setSelectionRange){var i=e.selectionStart,n=e.selectionEnd>e.selectionStart;e.value=e.value.substr(0,e.selectionStart)+t+e.value.substr(e.selectionEnd),e.setSelectionRange(n?i:i+t.length,i+t.length);var r=e.value.split("\n").length,o=e.value.substr(0,e.selectionStart).split("\n").length-1;e.scrollTop=Math.floor((o-e.rows/2)*e.scrollHeight/r)}else if(document.selection){var a=document.selection.createRange();if(a.parentElement()==e){var s=""==a.text;a.text=t,s||(a.moveStart("character",-t.length),a.select())}}}function setCaretPosition(e,t){if(e.selectionStart||"0"==e.selectionStart)e.selectionStart=t,e.selectionEnd=t,e.focus();else if(document.selection){e.focus();var i=document.selection.createRange();i.moveStart("character",-e.value.length),i.moveStart("character",t),i.moveEnd("character",0),i.select()}}function getNodeText(e){for(var t="";e&&"#text"==e.nodeName;)t+=e.nodeValue,e=e.nextSibling;return t}function isDescendant(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function stopEvent(e){var t=e||window.event;return t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1}function scrubNode(e){if(config.browser.isIE){var t=e.attributes;if(t){var i;for(i=0;i<t.length;i++){var n=t[i].name;if("style"!==n&&("function"==typeof e[n]||"object"==typeof e[n]&&null!=e[n]))try{e[n]=null}catch(r){}}}for(var o=e.firstChild;o;)scrubNode(o),o=o.nextSibling}}function setStylesheet(e,t,i){jQuery.twStylesheet(e,{id:t,doc:i})}function removeStyleSheet(e){jQuery.twStylesheet.remove({id:e})}function LoaderBase(){}function SaverBase(){}function TW21Loader(){}function TW21Saver(){}function Crypto(){}function allTiddlersAsHtml(){return store.allTiddlersAsHtml()}function applyPageTemplate(e){refreshPageTemplate(e)}function displayTiddlers(e,t,i,n,r,o,a){story.displayTiddlers(e,t,i,o)}function displayTiddler(e,t,i,n,r,o,a){story.displayTiddler(e,t,i,o)}function loadRemoteFile(e,t,i){return httpReq("GET",e,t,i)}function doHttp(e,t,i,n,r,o,a,s,l,d){return httpReq(e,t,a,s,l,i,n,r,o,d)}function removeChildren(e){jQuery(e).empty()}function removeNode(e){jQuery(e).remove()}function getPlainText(e){return jQuery(e).text()}function addClass(e,t){jQuery(e).addClass(t)}function removeClass(e,t){jQuery(e).removeClass(t)}function hasClass(e,t){return jQuery(e).hasClass(t)}function wikifyPlain(e,t,i){return t||(t=store),t.tiddlerExists(e)||t.isShadowTiddler(e)?wikifyPlainText(t.getTiddlerText(e),i,tiddler):""}var config={numRssItems:20,animDuration:400,cascadeFast:20,cascadeSlow:60,cascadeDepth:5,locale:"en"};config.parsers={},config.adaptors={},config.defaultAdaptor=null,config.tasks={},config.annotations={},config.defaultCustomFields={},config.messages={messageClose:{},dates:{},tiddlerPopup:{}},config.options={chkRegExpSearch:!1,chkCaseSensitiveSearch:!1,chkIncrementalSearch:!0,chkAnimate:!0,chkSaveBackups:!0,chkAutoSave:!1,chkGenerateAnRssFeed:!1,chkSaveEmptyTemplate:!1,chkOpenInNewWindow:!0,chkToggleLinks:!1,chkHttpReadOnly:!0,chkForceMinorUpdate:!1,chkConfirmDelete:!0,chkInsertTabs:!1,chkUsePreForStorage:!0,chkDisplayInstrumentation:!1,txtBackupFolder:"",txtEditorFocus:"text",txtMainTab:"tabTimeline",txtMoreTab:"moreTabAll",txtMaxEditRows:"30",txtFileSystemCharSet:"UTF-8",txtTheme:""},config.optionsDesc={},config.optionsSource={};var DEFAULT_VIEW_TEMPLATE=1,DEFAULT_EDIT_TEMPLATE=2;config.tiddlerTemplates={1:"ViewTemplate",2:"EditTemplate"},config.views={wikified:{tag:{}},editor:{tagChooser:{}}},config.backstageTasks=["save","importTask","tweak","upgrade","plugins"],config.extensions={},config.macros={today:{},version:{},search:{sizeTextbox:15},tiddler:{},tag:{},tags:{},tagging:{},timeline:{},allTags:{},list:{all:{},missing:{},orphans:{},shadowed:{},touched:{},filter:{}},closeAll:{},permaview:{},saveChanges:{},slider:{},option:{},options:{},newTiddler:{},newJournal:{},tabs:{},gradient:{},message:{},view:{defaultView:"text"},edit:{},tagChooser:{},toolbar:{},plugins:{},refreshDisplay:{},importTiddlers:{},upgrade:{source:"http://tiddlywiki-releases.tiddlyspace.com/upgrade",backupExtension:"pre.core.upgrade"},sync:{},annotations:{}},config.commands={closeTiddler:{},closeOthers:{},editTiddler:{},saveTiddler:{hideReadOnly:!0},cancelTiddler:{},deleteTiddler:{hideReadOnly:!0},permalink:{},references:{type:"popup"},jump:{type:"popup"},syncing:{type:"popup"},fields:{type:"popup"}},config.evaluateMacroParameters="all",config.textPrimitives={upperLetter:"[A-ZÀ-ÞŐŰ]",lowerLetter:"[a-z0-9_\\-ß-ÿőű]",anyLetter:"[A-Za-z0-9_\\-À-Þß-ÿŐŰőű]",anyLetterStrict:"[A-Za-z0-9À-Þß-ÿŐŰőű]"},new RegExp("[ŐŰ]","g").test("Ő")||(config.textPrimitives={upperLetter:"[A-ZÀ-Þ]",lowerLetter:"[a-z0-9_\\-ß-ÿ]",anyLetter:"[A-Za-z0-9_\\-À-Þß-ÿ]",anyLetterStrict:"[A-Za-z0-9À-Þß-ÿ]"}),config.textPrimitives.sliceSeparator="::",config.textPrimitives.sectionSeparator="##",config.textPrimitives.urlPattern="(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)",config.textPrimitives.unWikiLink="~",config.textPrimitives.wikiLink="(?:(?:"+config.textPrimitives.upperLetter+"+"+config.textPrimitives.lowerLetter+"+"+config.textPrimitives.upperLetter+config.textPrimitives.anyLetter+"*)|(?:"+config.textPrimitives.upperLetter+"{2,}"+config.textPrimitives.lowerLetter+"+))",config.textPrimitives.cssLookahead="(?:("+config.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+config.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)",config.textPrimitives.cssLookaheadRegExp=new RegExp(config.textPrimitives.cssLookahead,"mg"),config.textPrimitives.brackettedLink="\\[\\[([^\\]]+)\\]\\]",config.textPrimitives.titledBrackettedLink="\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]",config.textPrimitives.tiddlerForcedLinkRegExp=new RegExp("(?:"+config.textPrimitives.titledBrackettedLink+")|(?:"+config.textPrimitives.brackettedLink+")|(?:"+config.textPrimitives.urlPattern+")","mg"),config.textPrimitives.tiddlerAnyLinkRegExp=new RegExp("("+config.textPrimitives.wikiLink+")|(?:"+config.textPrimitives.titledBrackettedLink+")|(?:"+config.textPrimitives.brackettedLink+")|(?:"+config.textPrimitives.urlPattern+")","mg"),config.glyphs={currBrowser:null,browsers:[],codes:{}},config.shadowTiddlers={StyleSheet:"",MarkupPreHead:"",MarkupPostHead:"",MarkupPreBody:"",MarkupPostBody:"",TabTimeline:"<<timeline>>",TabAll:"<<list all>>",TabTags:"<<allTags excludeLists>>",TabMoreMissing:"<<list missing>>",TabMoreOrphans:"<<list orphans>>",TabMoreShadowed:"<<list shadowed>>",AdvancedOptions:"<<options>>",PluginManager:"<<plugins>>",SystemSettings:"",ToolbarCommands:"|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|",WindowTitle:"<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>"},config.userAgent=navigator.userAgent.toLowerCase(),config.browser={isIE:-1!=config.userAgent.indexOf("msie")&&-1==config.userAgent.indexOf("opera"),isGecko:"Gecko"==navigator.product&&-1==config.userAgent.indexOf("WebKit"),ieVersion:/MSIE (\d{1,2}.\d)/i.exec(config.userAgent),isSafari:-1!=config.userAgent.indexOf("applewebkit"),isBadSafari:!new RegExp("[ŐŰ]","g").test("Ő"),firefoxDate:/gecko\/(\d{8})/i.exec(config.userAgent),isOpera:-1!=config.userAgent.indexOf("opera"),isChrome:config.userAgent.indexOf("chrome")>-1,isLinux:-1!=config.userAgent.indexOf("linux"),isUnix:-1!=config.userAgent.indexOf("x11"),isMac:-1!=config.userAgent.indexOf("mac"),isWindows:-1!=config.userAgent.indexOf("win")},merge(config.glyphs,{browsers:[function(){return config.browser.isIE},function(){return!0}],codes:{downTriangle:["▼","▾"],downArrow:["↓","↓"],bentArrowLeft:["←","↩"],bentArrowRight:["→","↪"]}}),merge(config.options,{txtUserName:"YourName"}),merge(config.tasks,{save:{text:"save",tooltip:"Save your changes to this TiddlyWiki"},importTask:{text:"import",tooltip:"Import tiddlers and plugins from other TiddlyWiki files and servers",content:"<<importTiddlers>>"},tweak:{text:"tweak",tooltip:"Tweak the appearance and behaviour of TiddlyWiki",content:"<<options>>"},upgrade:{text:"upgrade",tooltip:"Upgrade TiddlyWiki core code",content:"<<upgrade>>"},plugins:{text:"plugins",tooltip:"Manage installed plugins",content:"<<plugins>>"}}),merge(config.optionsDesc,{txtUserName:"Username for signing your edits",chkRegExpSearch:"Enable regular expressions for searches",chkCaseSensitiveSearch:"Case-sensitive searching",chkIncrementalSearch:"Incremental key-by-key searching",chkAnimate:"Enable animations",chkSaveBackups:"Keep backup file when saving changes",chkAutoSave:"Automatically save changes",chkGenerateAnRssFeed:"Generate an RSS feed when saving changes",chkSaveEmptyTemplate:"Generate an empty template when saving changes",chkOpenInNewWindow:"Open external links in a new window",chkToggleLinks:"Clicking on links to open tiddlers causes them to close",chkHttpReadOnly:"Hide editing features when viewed over HTTP",chkForceMinorUpdate:"Don't update modifier username and date when editing tiddlers",chkConfirmDelete:"Require confirmation before deleting tiddlers",chkInsertTabs:"Use the tab key to insert tab characters instead of moving between fields",txtBackupFolder:"Name of folder to use for backups",txtMaxEditRows:"Maximum number of rows in edit boxes",txtTheme:"Name of the theme to use",txtFileSystemCharSet:"Default character set for saving changes (Firefox/Mozilla only)"}),merge(config.messages,{customConfigError:"Problems were encountered loading plugins. See PluginManager for details",pluginError:"Error: %0",pluginDisabled:"Not executed because disabled via 'systemConfigDisable' tag",pluginForced:"Executed because forced via 'systemConfigForce' tag",pluginVersionError:"Not executed because this plugin needs a newer version of TiddlyWiki",nothingSelected:"Nothing is selected. You must select one or more items first",savedSnapshotError:"It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",subtitleUnknown:"(unknown)",undefinedTiddlerToolTip:"The tiddler '%0' doesn't yet exist",shadowedTiddlerToolTip:"The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",tiddlerLinkTooltip:"%0 - %1, %2",externalLinkTooltip:"External link to %0",noTags:"There are no tagged tiddlers",notFileUrlError:"You need to save this TiddlyWiki to a file before you can save changes",cantSaveError:"It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",invalidFileError:"The original file '%0' does not appear to be a valid TiddlyWiki",backupSaved:"Backup saved",backupFailed:"Failed to save backup file",rssSaved:"RSS feed saved",rssFailed:"Failed to save RSS feed file",emptySaved:"Empty template saved",emptyFailed:"Failed to save empty template file",mainSaved:"Main TiddlyWiki file saved",mainDownload:"Downloading/saving main TiddlyWiki file",mainDownloadManual:"RIGHT CLICK HERE to download/save main TiddlyWiki file",mainFailed:"Failed to save main TiddlyWiki file. Your changes have not been saved",macroError:"Error in macro <<%0>>",macroErrorDetails:"Error while executing macro <<%0>>:\n%1",missingMacro:"No such macro",overwriteWarning:"A tiddler named '%0' already exists. Choose OK to overwrite it",unsavedChangesWarning:"WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",confirmExit:"--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",saveInstructions:"SaveChanges",unsupportedTWFormat:"Unsupported TiddlyWiki format '%0'",tiddlerSaveError:"Error when saving tiddler '%0'",tiddlerLoadError:"Error when loading tiddler '%0'",wrongSaveFormat:"Cannot save with storage format '%0'. Using standard format for save.",invalidFieldName:"Invalid field name %0",fieldCannotBeChanged:"Field '%0' cannot be changed",loadingMissingTiddler:"Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",upgradeDone:"The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",invalidCookie:"Invalid cookie '%0'"}),merge(config.messages.messageClose,{text:"close",tooltip:"close this message area"}),config.messages.backstage={open:{text:"backstage",tooltip:"Open the backstage area to perform authoring and editing tasks"},close:{text:"close",tooltip:"Close the backstage area"},prompt:"backstage: ",decal:{edit:{text:"edit",tooltip:"Edit the tiddler '%0'"}}},config.messages.listView={tiddlerTooltip:"Click for the full text of this tiddler",previewUnavailable:"(preview not available)"},config.messages.dates.months=["January","February","March","April","May","June","July","August","September","October","November","December"],config.messages.dates.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],config.messages.dates.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],config.messages.dates.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],config.messages.dates.daySuffixes=["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],config.messages.dates.am="am",config.messages.dates.pm="pm",merge(config.messages.tiddlerPopup,{}),merge(config.views.wikified.tag,{labelNoTags:"no tags",labelTags:"tags: ",openTag:"Open tag '%0'",tooltip:"Show tiddlers tagged with '%0'",openAllText:"Open all",openAllTooltip:"Open all of these tiddlers",popupNone:"No other tiddlers tagged with '%0'"}),merge(config.views.wikified,{defaultText:"The tiddler '%0' doesn't yet exist. Double-click to create it",defaultModifier:"(missing)",shadowModifier:"(built-in shadow tiddler)",dateFormat:"DD MMM YYYY",createdPrompt:"created"}),merge(config.views.editor,{tagPrompt:"Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",defaultText:"Type the text for '%0'"}),merge(config.views.editor.tagChooser,{text:"tags",tooltip:"Choose existing tags to add to this tiddler",popupNone:"There are no tags defined",tagTooltip:"Add the tag '%0'"}),merge(config.messages,{sizeTemplates:[{unit:1073741824,template:"%0 GB"},{unit:1048576,template:"%0 MB"},{unit:1024,template:"%0 KB"},{unit:1,template:"%0 B"}]}),merge(config.macros.search,{label:"search",prompt:"Search this TiddlyWiki",placeholder:"",accessKey:"F",successMsg:"%0 tiddlers found matching %1",failureMsg:"No tiddlers found matching %0"}),merge(config.macros.tagging,{label:"tagging: ",labelNotTag:"not tagging",tooltip:"List of tiddlers tagged with '%0'"}),merge(config.macros.timeline,{dateFormat:"DD MMM YYYY"}),merge(config.macros.allTags,{tooltip:"Show tiddlers tagged with '%0'",noTags:"There are no tagged tiddlers"}),config.macros.list.all.prompt="All tiddlers in alphabetical order",config.macros.list.missing.prompt="Tiddlers that have links to them but are not defined",config.macros.list.orphans.prompt="Tiddlers that are not linked to from any other tiddlers",config.macros.list.shadowed.prompt="Tiddlers shadowed with default contents",config.macros.list.touched.prompt="Tiddlers that have been modified locally",merge(config.macros.closeAll,{label:"close all",prompt:"Close all displayed tiddlers (except any that are being edited)"}),merge(config.macros.permaview,{label:"permaview",prompt:"Link to an URL that retrieves all the currently displayed tiddlers"}),merge(config.macros.saveChanges,{label:"save changes",prompt:"Save all tiddlers to create a new TiddlyWiki",accessKey:"S"}),merge(config.macros.newTiddler,{label:"new tiddler",prompt:"Create a new tiddler",title:"New Tiddler",accessKey:"N"}),merge(config.macros.newJournal,{label:"new journal",prompt:"Create a new tiddler from the current date and time",accessKey:"J"}),merge(config.macros.options,{wizardTitle:"Tweak advanced options",step1Title:"These options are saved in cookies in your browser",step1Html:"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",unknownDescription:"//(unknown)//",listViewTemplate:{columns:[{name:"Option",field:"option",title:"Option",type:"String"},{name:"Description",field:"description",title:"Description",type:"WikiText"},{name:"Name",field:"name",title:"Name",type:"String"}],rowClasses:[{className:"lowlight",field:"lowlight"}]}}),merge(config.macros.plugins,{wizardTitle:"Manage plugins",step1Title:"Currently loaded plugins",step1Html:"<input type='hidden' name='markList'></input>",skippedText:"(This plugin has not been executed because it was added since startup)",noPluginText:"There are no plugins installed",confirmDeleteText:"Are you sure you want to delete these plugins:\n\n%0",removeLabel:"remove systemConfig tag",removePrompt:"Remove systemConfig tag",deleteLabel:"delete",deletePrompt:"Delete these tiddlers forever",listViewTemplate:{columns:[{name:"Selected",field:"Selected",rowName:"title",type:"Selector"},{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Description",field:"Description",title:"Description",type:"String"},{name:"Version",field:"Version",title:"Version",type:"String"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Forced",field:"forced",title:"Forced",tag:"systemConfigForce",type:"TagCheckbox"},{name:"Disabled",field:"disabled",title:"Disabled",tag:"systemConfigDisable",type:"TagCheckbox"},{name:"Executed",field:"executed",title:"Loaded",type:"Boolean",trueText:"Yes",falseText:"No"},{name:"Startup Time",field:"startupTime",title:"Startup Time",type:"String"},{name:"Error",field:"error",title:"Status",type:"Boolean",trueText:"Error",falseText:"OK"},{name:"Log",field:"log",title:"Log",type:"StringList"}],rowClasses:[{className:"error",field:"error"},{className:"warning",field:"warning"}]},listViewTemplateReadOnly:{columns:[{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Description",field:"Description",title:"Description",type:"String"},{name:"Version",field:"Version",title:"Version",type:"String"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Executed",field:"executed",title:"Loaded",type:"Boolean",trueText:"Yes",falseText:"No"},{name:"Startup Time",field:"startupTime",title:"Startup Time",type:"String"},{name:"Error",field:"error",title:"Status",type:"Boolean",trueText:"Error",falseText:"OK"},{name:"Log",field:"log",title:"Log",type:"StringList"}],rowClasses:[{className:"error",field:"error"},{className:"warning",field:"warning"}]}}),merge(config.macros.toolbar,{moreLabel:"more",morePrompt:"Show additional commands",lessLabel:"less",lessPrompt:"Hide additional commands",separator:"|"}),merge(config.macros.refreshDisplay,{label:"refresh",prompt:"Redraw the entire TiddlyWiki display"}),merge(config.macros.importTiddlers,{readOnlyWarning:"You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",wizardTitle:"Import tiddlers from another file or server",step1Title:"Step 1: Locate the server or TiddlyWiki file",step1Html:"Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",openLabel:"open",openPrompt:"Open the connection to this file or server",statusOpenHost:"Opening the host",statusGetWorkspaceList:"Getting the list of available workspaces",step2Title:"Step 2: Choose the workspace",step2Html:"Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",cancelLabel:"cancel",cancelPrompt:"Cancel this import",statusOpenWorkspace:"Opening the workspace",statusGetTiddlerList:"Getting the list of available tiddlers",errorGettingTiddlerList:"Error getting list of tiddlers, click Cancel to try again",errorGettingTiddlerListHttp404:"Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",errorGettingTiddlerListHttp:"Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",errorGettingTiddlerListFile:"Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",step3Title:"Step 3: Choose the tiddlers to import",step3Html:"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",importLabel:"import",importPrompt:"Import these tiddlers",confirmOverwriteText:"Are you sure you want to overwrite these tiddlers:\n\n%0",step4Title:"Step 4: Importing %0 tiddler(s)",step4Html:"<input type='hidden' name='markReport'></input>",doneLabel:"done",donePrompt:"Close this wizard",statusDoingImport:"Importing tiddlers",statusDoneImport:"All tiddlers imported",systemServerNamePattern:"%2 on %1",systemServerNamePatternNoWorkspace:"%1",confirmOverwriteSaveTiddler:"The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",serverSaveTemplate:"|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",serverSaveModifier:"(System)",listViewTemplate:{columns:[{name:"Selected",field:"Selected",rowName:"title",type:"Selector"},{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Tags",field:"tags",title:"Tags",type:"Tags"}],rowClasses:[]}}),merge(config.macros.upgrade,{wizardTitle:"Upgrade TiddlyWiki core code",step1Title:"Update or repair this TiddlyWiki to the latest release",step1Html:"You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",errorCantUpgrade:"Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",errorNotSaved:"You must save changes before you can perform an upgrade",step2Title:"Confirm the upgrade details",step2Html_downgrade:"You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",step2Html_restore:"This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",step2Html_upgrade:"You are about to upgrade to TiddlyWiki version %0 from %1",upgradeLabel:"upgrade",upgradePrompt:"Prepare for the upgrade process",statusPreparingBackup:"Preparing backup",statusSavingBackup:"Saving backup file",errorSavingBackup:"There was a problem saving the backup file",statusLoadingCore:"Loading core code",errorLoadingCore:"Error loading the core code",errorCoreFormat:"Error with the new core code",statusSavingCore:"Saving the new core code",statusReloadingCore:"Reloading the new core code",startLabel:"start",startPrompt:"Start the upgrade process",cancelLabel:"cancel",cancelPrompt:"Cancel the upgrade process",step3Title:"Upgrade cancelled",step3Html:"You have cancelled the upgrade process"}),merge(config.macros.annotations,{}),merge(config.commands.closeTiddler,{text:"close",tooltip:"Close this tiddler"}),merge(config.commands.closeOthers,{text:"close others",tooltip:"Close all other tiddlers"}),merge(config.commands.editTiddler,{text:"edit",tooltip:"Edit this tiddler",readOnlyText:"view",readOnlyTooltip:"View the source of this tiddler"}),merge(config.commands.saveTiddler,{text:"done",tooltip:"Save changes to this tiddler"}),merge(config.commands.cancelTiddler,{text:"cancel",tooltip:"Undo changes to this tiddler",warning:"Are you sure you want to abandon your changes to '%0'?",readOnlyText:"done",readOnlyTooltip:"View this tiddler normally"}),merge(config.commands.deleteTiddler,{text:"delete",tooltip:"Delete this tiddler",warning:"Are you sure you want to delete '%0'?"}),merge(config.commands.permalink,{text:"permalink",tooltip:"Permalink for this tiddler"}),merge(config.commands.references,{text:"references",tooltip:"Show tiddlers that link to this one",popupNone:"No references"}),merge(config.commands.jump,{text:"jump",tooltip:"Jump to another open tiddler"}),merge(config.commands.fields,{text:"fields",tooltip:"Show the extended fields of this tiddler",emptyText:"There are no extended fields for this tiddler",
listViewTemplate:{columns:[{name:"Field",field:"field",title:"Field",type:"String"},{name:"Value",field:"value",title:"Value",type:"String"}],rowClasses:[],buttons:[]}}),merge(config.shadowTiddlers,{DefaultTiddlers:"[[GettingStarted]]",MainMenu:"[[GettingStarted]]",SiteTitle:"My TiddlyWiki",SiteSubtitle:"a reusable non-linear personal web notebook",SiteUrl:"",SideBarOptions:'<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options »" "Change TiddlyWiki advanced options">>',SideBarTabs:'<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',TabMore:'<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'}),merge(config.annotations,{AdvancedOptions:"This shadow tiddler provides access to several advanced options",ColorPalette:"These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",DefaultTiddlers:"The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",EditTemplate:"The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",GettingStarted:"This shadow tiddler provides basic usage instructions",ImportTiddlers:"This shadow tiddler provides access to importing tiddlers",MainMenu:"This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",MarkupPreHead:"This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",MarkupPostHead:"This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",MarkupPreBody:"This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",MarkupPostBody:"This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",OptionsPanel:"This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",PageTemplate:"The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",PluginManager:"This shadow tiddler provides access to the plugin manager",SideBarOptions:"This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",SideBarTabs:"This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",SiteSubtitle:"This shadow tiddler is used as the second part of the page title",SiteTitle:"This shadow tiddler is used as the first part of the page title",SiteUrl:"This shadow tiddler should be set to the full target URL for publication",StyleSheetColors:"This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",StyleSheet:"This tiddler can contain custom CSS definitions",StyleSheetLayout:"This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",StyleSheetLocale:"This shadow tiddler contains CSS definitions related to the translation locale",StyleSheetPrint:"This shadow tiddler contains CSS definitions for printing",SystemSettings:"This tiddler is used to store configuration options for this TiddlyWiki document",TabAll:"This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",TabMore:"This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",TabMoreMissing:"This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",TabMoreOrphans:"This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",TabMoreShadowed:"This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",TabTags:"This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",TabTimeline:"This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",ToolbarCommands:"This shadow tiddler determines which commands are shown in tiddler toolbars",ViewTemplate:"The HTML template in this shadow tiddler determines how tiddlers look"});var params=null,store=null,story=null,formatter=null,anim="function"==typeof Animator?new Animator:null,readOnly=!1,highlightHack=null,hadConfirmExit=!1,safeMode=!1,showBackstage,installedPlugins=[],startingUp=!1,pluginInfo,tiddler;window.allowSave=window.allowSave||function(e){return!0},window.isLocal=function(){return"file:"==document.location.protocol};var useJavaSaver=window.isLocal()&&(config.browser.isSafari||config.browser.isOpera);window.tweakConfig&&window.tweakConfig(),window&&window.console||(console={tiddlywiki:!0,log:function(e){displayMessage(e)}}),config.paramifiers={},config.paramifiers.start={oninit:function(e){safeMode="safe"==e.toLowerCase()}},config.paramifiers.open={onstart:function(e){(!readOnly||store.tiddlerExists(e)||store.isShadowTiddler(e))&&story.displayTiddler("bottom",e,null,!1,null)}},config.paramifiers.story={onstart:function(e){var t=store.getTiddlerText(e,"").parseParams("open",null,!1);invokeParamifier(t,"onstart")}},config.paramifiers.search={onstart:function(e){story.search(e,!1,!1)}},config.paramifiers.searchRegExp={onstart:function(e){story.prototype.search(e,!1,!0)}},config.paramifiers.tag={onstart:function(e){story.displayTiddlers(null,store.filterTiddlers("[tag["+e+"]]"),null,!1,null)}},config.paramifiers.newTiddler={onstart:function(e){var t=e.parseParams("anon",null,null)[0],i=t.title?t.title[0]:e,n=t.fields?t.fields[0]:null;if(!readOnly){story.displayTiddler(null,i,DEFAULT_EDIT_TEMPLATE,!1,null,n),story.focusTiddler(i,"text");var r,o=t.tag||[];for(r=0;r<o.length;r++)story.setTiddlerTag(i,o[r],1)}}},config.paramifiers.newJournal={onstart:function(e){if(!readOnly){var t=new Date,i=t.formatString(e.trim());story.displayTiddler(null,i,DEFAULT_EDIT_TEMPLATE),story.focusTiddler(i,"text")}}},config.paramifiers.readOnly={onconfig:function(e){var t=e.toLowerCase();readOnly="yes"==t?!0:"no"==t?!1:readOnly}},config.paramifiers.theme={onconfig:function(e){story.switchTheme(e)}},config.paramifiers.upgrade={onstart:function(e){upgradeFrom(e)}},config.paramifiers.recent={onstart:function(e){var t,i=[],n=store.getTiddlers("modified","excludeLists").reverse();for(t=0;e>t&&t<n.length;t++)i.push(n[t].title);story.displayTiddlers(null,i)}},config.paramifiers.filter={onstart:function(e){story.displayTiddlers(null,store.filterTiddlers(e),null,!1)}},config.formatterHelpers={createElementAndWikify:function(e){e.subWikifyTerm(createTiddlyElement(e.output,this.element),this.termRegExp)},inlineCssHelper:function(e){var t=[];config.textPrimitives.cssLookaheadRegExp.lastIndex=e.nextMatch;for(var i=config.textPrimitives.cssLookaheadRegExp.exec(e.source);i&&i.index==e.nextMatch;){var n,r;i[1]?(n=i[1].unDash(),r=i[2]):(n=i[3].unDash(),r=i[4]),"bgcolor"==n&&(n="backgroundColor"),"float"==n&&(n="cssFloat"),t.push({style:n,value:r}),e.nextMatch=i.index+i[0].length,config.textPrimitives.cssLookaheadRegExp.lastIndex=e.nextMatch,i=config.textPrimitives.cssLookaheadRegExp.exec(e.source)}return t},applyCssHelper:function(e,t){var i;for(i=0;i<t.length;i++)try{e.style[t[i].style]=t[i].value}catch(n){}},enclosedTextHelper:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);if(t&&t.index==e.matchStart){var i=t[1];config.browser.isIE&&config.browser.ieVersion[1]<10&&(i=i.replace(/\n/g,"\r")),createTiddlyElement(e.output,this.element,null,null,i),e.nextMatch=t.index+t[0].length}},isExternalLink:function(e){if(store.tiddlerExists(e)||store.isShadowTiddler(e))return!1;var t=new RegExp(config.textPrimitives.urlPattern,"mg");return t.exec(e)?!0:-1!=e.indexOf(".")||-1!=e.indexOf("\\")||-1!=e.indexOf("/")||-1!=e.indexOf("#")?!0:!1}},config.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookaheadRegExp:/^\|([^\n]*)\|([fhck]?)$/gm,rowTermRegExp:/(\|(?:[fhck]?)$\n?)/gm,cellRegExp:/(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/gm,cellTermRegExp:/((?:\x20*)\|)/gm,rowTypes:{c:"caption",h:"thead","":"tbody",f:"tfoot"},handler:function(e){var t,i=createTiddlyElement(e.output,"table",null,"twtable"),n=[],r=null,o=0,a=function(){jQuery(this).addClass("hoverRow")},s=function(){jQuery(this).removeClass("hoverRow")};e.nextMatch=e.matchStart,this.lookaheadRegExp.lastIndex=e.nextMatch;for(var l=this.lookaheadRegExp.exec(e.source);l&&l.index==e.nextMatch;){var d=l[2];if("k"==d)i.className=l[1],e.nextMatch+=l[0].length+1;else if(d!=r&&(t=createTiddlyElement(i,this.rowTypes[d]),r=d),"c"==r)e.nextMatch++,t!=i.firstChild&&i.insertBefore(t,i.firstChild),t.setAttribute("align",0==o?"top":"bottom"),e.subWikifyTerm(t,this.rowTermRegExp);else{var c=createTiddlyElement(t,"tr",null,o%2?"oddRow":"evenRow");c.onmouseover=a,c.onmouseout=s,this.rowHandler(e,c,n),o++}this.lookaheadRegExp.lastIndex=e.nextMatch,l=this.lookaheadRegExp.exec(e.source)}},rowHandler:function(e,t,i){var n=0,r=1,o=null;this.cellRegExp.lastIndex=e.nextMatch;for(var a=this.cellRegExp.exec(e.source);a&&a.index==e.nextMatch;){if("~"==a[1]){var s=i[n];s&&(s.rowSpanCount++,s.element.setAttribute("rowspan",s.rowSpanCount),s.element.setAttribute("rowSpan",s.rowSpanCount),s.element.valign="center",r>1&&(s.element.setAttribute("colspan",r),s.element.setAttribute("colSpan",r),r=1)),e.nextMatch=this.cellRegExp.lastIndex-1}else if(">"==a[1])r++,e.nextMatch=this.cellRegExp.lastIndex-1;else{if(a[2]){o&&r>1&&(o.setAttribute("colspan",r),o.setAttribute("colSpan",r)),e.nextMatch=this.cellRegExp.lastIndex;break}e.nextMatch++;for(var l=config.formatterHelpers.inlineCssHelper(e),d=!1,c=e.source.substr(e.nextMatch,1);" "==c;)d=!0,e.nextMatch++,c=e.source.substr(e.nextMatch,1);var u;"!"==c?(u=createTiddlyElement(t,"th"),e.nextMatch++):u=createTiddlyElement(t,"td"),o=u,i[n]={rowSpanCount:1,element:u},r>1&&(u.setAttribute("colspan",r),u.setAttribute("colSpan",r),r=1),config.formatterHelpers.applyCssHelper(u,l),e.subWikifyTerm(u,this.cellTermRegExp)," "==e.matchText.substr(e.matchText.length-2,1)?u.align=d?"center":"left":d&&(u.align="right"),e.nextMatch--}n++,this.cellRegExp.lastIndex=e.nextMatch,a=this.cellRegExp.exec(e.source)}}},{name:"heading",match:"^!{1,6}",termRegExp:/(\n)/gm,handler:function(e){e.subWikifyTerm(createTiddlyElement(e.output,"h"+e.matchLength),this.termRegExp)}},{name:"list",match:"^(?:[\\*#;:]+)",lookaheadRegExp:/^(?:(?:(\*)|(#)|(;)|(:))+)/gm,termRegExp:/(\n)/gm,handler:function(e){var t,i,n,r,o=[e.output],a=0,s=null;e.nextMatch=e.matchStart,this.lookaheadRegExp.lastIndex=e.nextMatch;for(var l=this.lookaheadRegExp.exec(e.source);l&&l.index==e.nextMatch;){l[1]?(i="ul",n="li"):l[2]?(i="ol",n="li"):l[3]?(i="dl",n="dt"):l[4]&&(i="dl",n="dd"),r||(r=i),t=l[0].length,e.nextMatch+=l[0].length;var d;if(t>a)for(d=a;t>d;d++){var c=0==a?o[o.length-1]:o[o.length-1].lastChild;o.push(createTiddlyElement(c,i))}else{if(i!=r&&1==t)return void(e.nextMatch-=l[0].length);if(a>t)for(d=a;d>t;d--)o.pop();else t==a&&i!=s&&(o.pop(),o.push(createTiddlyElement(o[o.length-1].lastChild,i)))}a=t,s=i;var u=createTiddlyElement(o[o.length-1],n);e.subWikifyTerm(u,this.termRegExp),this.lookaheadRegExp.lastIndex=e.nextMatch,l=this.lookaheadRegExp.exec(e.source)}}},{name:"quoteByBlock",match:"^<<<\\n",termRegExp:/(^<<<(\n|$))/gm,element:"blockquote",handler:config.formatterHelpers.createElementAndWikify},{name:"quoteByLine",match:"^>+",lookaheadRegExp:/^>+/gm,termRegExp:/(\n)/gm,element:"blockquote",handler:function(e){var t,i,n=[e.output],r=0,o=e.matchLength;do{if(o>r)for(t=r;o>t;t++)n.push(createTiddlyElement(n[n.length-1],this.element));else if(r>o)for(t=r;t>o;t--)n.pop();r=o,e.subWikifyTerm(n[n.length-1],this.termRegExp),createTiddlyElement(n[n.length-1],"br"),this.lookaheadRegExp.lastIndex=e.nextMatch;var a=this.lookaheadRegExp.exec(e.source);i=a&&a.index==e.nextMatch,i&&(o=a[0].length,e.nextMatch+=a[0].length)}while(i)}},{name:"rule",match:"^----+$\\n?|<hr ?/?>\\n?",handler:function(e){createTiddlyElement(e.output,"hr")}},{name:"monospacedByLine",match:"^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",element:"pre",handler:function(e){switch(e.matchText){case"/*{{{*/\n":this.lookaheadRegExp=/\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/gm;break;case"{{{\n":this.lookaheadRegExp=/^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/gm;break;case"//{{{\n":this.lookaheadRegExp=/^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/gm;break;case"<!--{{{-->\n":this.lookaheadRegExp=/<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/gm}config.formatterHelpers.enclosedTextHelper.call(this,e)}},{name:"wikifyComment",match:"^(?:/\\*\\*\\*|<!---)\\n",handler:function(e){var t="/***\n"==e.matchText?/(^\*\*\*\/\n)/gm:/(^--->\n)/gm;e.subWikifyTerm(e.output,t)}},{name:"macro",match:"<<",lookaheadRegExp:/<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);t&&t.index==e.matchStart&&t[1]&&(e.nextMatch=this.lookaheadRegExp.lastIndex,invokeMacro(e.output,t[1],t[2],e,e.tiddler))}},{name:"prettyLink",match:"\\[\\[",lookaheadRegExp:/\[\[(.*?)(?:\|(~)?(.*?))?\]\]/gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);if(t&&t.index==e.matchStart){var i,n=t[1];if(t[3]){var r=t[3];i=!t[2]&&config.formatterHelpers.isExternalLink(r)?createExternalLink(e.output,r):createTiddlyLink(e.output,r,!1,null,e.isStatic,e.tiddler)}else i=createTiddlyLink(e.output,n,!1,null,e.isStatic,e.tiddler);createTiddlyText(i,n),e.nextMatch=this.lookaheadRegExp.lastIndex}}},{name:"wikiLink",match:config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,handler:function(e){if(e.matchText.substr(0,1)==config.textPrimitives.unWikiLink)return void e.outputText(e.output,e.matchStart+1,e.nextMatch);if(e.matchStart>0){var t=new RegExp(config.textPrimitives.anyLetterStrict,"mg");t.lastIndex=e.matchStart-1;var i=t.exec(e.source);if(i.index==e.matchStart-1)return void e.outputText(e.output,e.matchStart,e.nextMatch)}if(e.autoLinkWikiWords||store.isShadowTiddler(e.matchText)){var n=createTiddlyLink(e.output,e.matchText,!1,null,e.isStatic,e.tiddler);e.outputText(n,e.matchStart,e.nextMatch)}else e.outputText(e.output,e.matchStart,e.nextMatch)}},{name:"urlLink",match:config.textPrimitives.urlPattern,handler:function(e){e.outputText(createExternalLink(e.output,e.matchText),e.matchStart,e.nextMatch)}},{name:"image",match:"\\[[<>]?[Ii][Mm][Gg]\\[",lookaheadRegExp:/\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);if(t&&t.index==e.matchStart){var i=e.output;if(t[5]){var n=t[5];i=config.formatterHelpers.isExternalLink(n)?createExternalLink(e.output,n):createTiddlyLink(e.output,n,!1,null,e.isStatic,e.tiddler),jQuery(i).addClass("imageLink")}var r=createTiddlyElement(i,"img");t[1]?r.align="left":t[2]&&(r.align="right"),t[3]&&(r.title=t[3],r.setAttribute("alt",t[3])),r.src=t[4],e.nextMatch=this.lookaheadRegExp.lastIndex}}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookaheadRegExp:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);t&&t.index==e.matchStart&&(createTiddlyElement(e.output,"span").innerHTML=t[1],e.nextMatch=this.lookaheadRegExp.lastIndex)}},{name:"commentByBlock",match:"/%",lookaheadRegExp:/\/%((?:.|\n)*?)%\//gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);t&&t.index==e.matchStart&&(e.nextMatch=this.lookaheadRegExp.lastIndex)}},{name:"characterFormat",match:"''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",handler:function(e){switch(e.matchText){case"''":e.subWikifyTerm(e.output.appendChild(document.createElement("strong")),/('')/gm);break;case"//":e.subWikifyTerm(createTiddlyElement(e.output,"em"),/(\/\/)/gm);break;case"__":e.subWikifyTerm(createTiddlyElement(e.output,"u"),/(__)/gm);break;case"^^":e.subWikifyTerm(createTiddlyElement(e.output,"sup"),/(\^\^)/gm);break;case"~~":e.subWikifyTerm(createTiddlyElement(e.output,"sub"),/(~~)/gm);break;case"--":e.subWikifyTerm(createTiddlyElement(e.output,"strike"),/(--)/gm);break;case"{{{":var t=/\{\{\{((?:.|\n)*?)\}\}\}/gm;t.lastIndex=e.matchStart;var i=t.exec(e.source);i&&i.index==e.matchStart&&(createTiddlyElement(e.output,"code",null,null,i[1]),e.nextMatch=t.lastIndex)}}},{name:"customFormat",match:"@@|\\{\\{",handler:function(e){switch(e.matchText){case"@@":var t=createTiddlyElement(e.output,"span"),i=config.formatterHelpers.inlineCssHelper(e);0==i.length?t.className="marked":config.formatterHelpers.applyCssHelper(t,i),e.subWikifyTerm(t,/(@@)/gm);break;case"{{":var n=/\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/gm;n.lastIndex=e.matchStart;var r=n.exec(e.source);r&&(e.nextMatch=n.lastIndex,t=createTiddlyElement(e.output,"\n"==r[2]?"div":"span",null,r[1]),e.subWikifyTerm(t,/(\}\}\})/gm))}}},{name:"mdash",match:"--",handler:function(e){createTiddlyElement(e.output,"span").innerHTML="&mdash;"}},{name:"lineBreak",match:"\\n|<br ?/?>",handler:function(e){createTiddlyElement(e.output,"br")}},{name:"rawText",match:'"{3}|<nowiki>',lookaheadRegExp:/(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/gm,handler:function(e){this.lookaheadRegExp.lastIndex=e.matchStart;var t=this.lookaheadRegExp.exec(e.source);t&&t.index==e.matchStart&&(createTiddlyElement(e.output,"span",null,null,t[1]),e.nextMatch=this.lookaheadRegExp.lastIndex)}},{name:"htmlEntitiesEncoding",match:"(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",handler:function(e){createTiddlyElement(e.output,"span").innerHTML=e.matchText}}],Wikifier.prototype.wikifyPlain=function(){var e=createTiddlyElement(document.body,"div");e.style.display="none",this.subWikify(e);var t=jQuery(e).text();return jQuery(e).remove(),t},Wikifier.prototype.subWikify=function(e,t){try{t?this.subWikifyTerm(e,new RegExp("("+t+")","mg")):this.subWikifyUnterm(e)}catch(i){showException(i)}},Wikifier.prototype.subWikifyUnterm=function(e){var t=this.output;this.output=e,this.formatter.formatterRegExp.lastIndex=this.nextMatch;for(var i=this.formatter.formatterRegExp.exec(this.source);i;){i.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,i.index),this.matchStart=i.index,this.matchLength=i[0].length,this.matchText=i[0],this.nextMatch=this.formatter.formatterRegExp.lastIndex;var n;for(n=1;n<i.length;n++)if(i[n]){this.formatter.formatters[n-1].handler(this),this.formatter.formatterRegExp.lastIndex=this.nextMatch;break}i=this.formatter.formatterRegExp.exec(this.source)}this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length),this.output=t},Wikifier.prototype.subWikifyTerm=function(e,t){var i=this.output;this.output=e,t.lastIndex=this.nextMatch;var n=t.exec(this.source);this.formatter.formatterRegExp.lastIndex=this.nextMatch;for(var r=this.formatter.formatterRegExp.exec(n?this.source.substr(0,n.index):this.source);n||r;){if(n&&(!r||n.index<=r.index))return n.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,n.index),this.matchText=n[1],this.matchLength=n[1].length,this.matchStart=n.index,this.nextMatch=this.matchStart+this.matchLength,void(this.output=i);r.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,r.index),this.matchStart=r.index,this.matchLength=r[0].length,this.matchText=r[0],this.nextMatch=this.formatter.formatterRegExp.lastIndex;var o;for(o=1;o<r.length;o++)if(r[o]){this.formatter.formatters[o-1].handler(this),this.formatter.formatterRegExp.lastIndex=this.nextMatch;break}t.lastIndex=this.nextMatch,n=t.exec(this.source),r=this.formatter.formatterRegExp.exec(n?this.source.substr(0,n.index):this.source)}this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length),this.output=i},Wikifier.prototype.outputText=function(e,t,i){for(;this.highlightMatch&&this.highlightRegExp.lastIndex>t&&this.highlightMatch.index<i&&i>t;){this.highlightMatch.index>t&&(createTiddlyText(e,this.source.substring(t,this.highlightMatch.index)),t=this.highlightMatch.index);var n=Math.min(this.highlightRegExp.lastIndex,i);createTiddlyElement(e,"span",null,"highlight",this.source.substring(t,n)),t=n,t>=this.highlightRegExp.lastIndex&&(this.highlightMatch=this.highlightRegExp.exec(this.source))}i>t&&createTiddlyText(e,this.source.substring(t,i))},config.macros.version.handler=function(e){jQuery("<span/>").text(formatVersion()).appendTo(e)},config.macros.today.handler=function(e,t,i){var n=new Date,r=i[0]?n.formatString(i[0].trim()):n.toLocaleString();jQuery("<span/>").text(r).appendTo(e)},config.macros.list.template="<<view title link>>",config.macros.list.handler=function(e,t,i,n,r){var o=document.createElement("ul");jQuery(o).attr({refresh:"macro",macroName:t}).data("params",r),e.appendChild(o),this.refresh(o)},config.macros.list.refresh=function(e){var t=jQuery(e).data("params"),i=t.readMacroParams(),n=t.parseParams("anon",null,null)[0],r=n.anon?n.anon[0]:"all";jQuery(e).empty().addClass("list list-"+r);var o=n.template?store.getTiddlerText(n.template[0]):!1;o||(o=config.macros.list.template),this[r].prompt&&createTiddlyElement(e,"li",null,"listTitle",this[r].prompt);var a;this[r].handler&&(a=this[r].handler(i));var s;for(s=0;s<a.length;s++){var l=document.createElement("li");e.appendChild(l);var d=a[s];"string"==typeof d&&(d=store.getTiddler(d)||new Tiddler(d)),wikify(o,l,null,d)}0===a.length&&n.emptyMessage&&(jQuery(e).addClass("emptyList"),jQuery("<li />").text(n.emptyMessage[0]).appendTo(e))},config.macros.list.all.handler=function(e){return store.reverseLookup("tags","excludeLists",!1,"title")},config.macros.list.missing.handler=function(e){return store.getMissingLinks()},config.macros.list.orphans.handler=function(e){return store.getOrphans()},config.macros.list.shadowed.handler=function(e){return store.getShadowed()},config.macros.list.touched.handler=function(e){return store.getTouched()},config.macros.list.filter.handler=function(e){var t=e[1],i=[];if(t){var n,r=store.filterTiddlers(t);for(n=0;n<r.length;n++)i.push(r[n].title)}return i},config.macros.allTags.handler=function(e,t,i){var n=store.getTags(i[0]),r=createTiddlyElement(e,"ul");0==n.length&&createTiddlyElement(r,"li",null,"listTitle",this.noTags);var o;for(o=0;o<n.length;o++){var a=n[o][0],s=getTiddlyLinkInfo(a),l=createTiddlyElement(r,"li"),d=createTiddlyButton(l,a+" ("+n[o][1]+")",this.tooltip.format([a]),onClickTag,s.classes);d.setAttribute("tag",a),d.setAttribute("refresh","link"),d.setAttribute("tiddlyLink",a),i[1]&&d.setAttribute("sortby",i[1])}};var macro=config.macros.timeline;merge(macro,{handler:function(e,t,i,n,r,o){var a=jQuery("<div />").attr("params",r).attr("macroName",t).appendTo(e)[0];macro.refresh(a)},refresh:function(e){jQuery(e).attr("refresh","macro").empty();var t=jQuery(e).attr("params"),i=t.parseParams("anon",null,null)[0],n=i.anon||[],r=n[0]||"modified",o=r.charAt(0),a="-"===o||"+"===o?r.substr(1,r.length):r,s=n[2]||this.dateFormat,l=macro.groupTemplate.format(a,s);l=i.groupTemplate?store.getTiddlerText(i.groupTemplate[0])||l:l;var d=macro.itemTemplate;d=i.template?store.getTiddlerText(i.template[0])||d:d;var c,u,f=i.filter?store.sortTiddlers(store.filterTiddlers(i.filter[0]),r):store.reverseLookup("tags","excludeLists",!1,r),p="",h=n[1]?f.length-Math.min(f.length,parseInt(n[1],10)):0;for(u=f.length-1;u>=h;u--){var g=f[u],m=wikifyPlainText(l,0,g);("undefined"==typeof c||m!=p)&&(c=document.createElement("ul"),jQuery(c).addClass("timeline"),e.appendChild(c),createTiddlyElement(c,"li",null,"listTitle",m),p=m);var y=createTiddlyElement(c,"li",null,"listLink");wikify(d,y,null,g)}},groupTemplate:"<<view %0 date '%1'>>",itemTemplate:"<<view title link>>"}),config.macros.tiddler.handler=function(e,t,i,n,r,o){var a=!0,s=config.macros.tiddler.tiddlerStack;if(s.length>0&&"system"==config.evaluateMacroParameters){var l=s[s.length-1],d=l.indexOf(config.textPrimitives.sectionSeparator);-1!=d&&(l=l.substr(0,d));var c=store.getTiddler(l);c&&-1!=c.tags.indexOf("systemAllowEval")||(a=!1)}i=r.parseParams("name",null,a,!1,!0);var u=i[0].name,f=u[0],p=u[1]||null,h=i[0]["with"],g=createTiddlyElement(e,"span",null,p,null,{refresh:"content",tiddler:f});void 0!==h&&g.setAttribute("args","[["+h.join("]] [[")+"]]"),this.transclude(g,f,h)},config.macros.tiddler.transclude=function(e,t,i){var n=store.getTiddlerText(t);if(n){var r=config.macros.tiddler.tiddlerStack;if(-1===r.indexOf(t)){r.push(t);try{"string"==typeof i&&(i=i.readBracketedList());var o,a=i?Math.min(i.length,9):0;for(o=0;a>o;o++){var s=new RegExp("\\$"+(o+1),"mg");n=n.replace(s,i[o])}config.macros.tiddler.renderText(e,n,t)}finally{r.pop()}}}},config.macros.tiddler.renderText=function(e,t,i){wikify(t,e,null,store.getTiddler(i))},config.macros.tiddler.tiddlerStack=[],config.macros.tag.handler=function(e,t,i){var n=createTagButton(e,i[0],null,i[1],i[2]);i[3]&&n.setAttribute("sortby",i[3])},config.macros.tags.handler=function(e,t,i,n,r,o){i=r.parseParams("anon",null,!0,!1,!1);var a=createTiddlyElement(e,"ul"),s=getParam(i,"anon","");s&&store.tiddlerExists(s)&&(o=store.getTiddler(s));var l,d=getParam(i,"sep"," "),c=config.views.wikified.tag,u=null;for(l=0;l<o.tags.length;l++){var f=store.getTiddler(o.tags[l]);f&&f.tags.contains("excludeLists")||(u||(u=createTiddlyElement(a,"li",null,"listTitle",c.labelTags.format([o.title]))),createTagButton(createTiddlyElement(a,"li"),o.tags[l],o.title),l<o.tags.length-1&&createTiddlyText(a,d))}u||createTiddlyElement(a,"li",null,"listTitle",c.labelNoTags.format([o.title]))},config.macros.tagging.handler=function(e,t,i,n,r,o){i=r.parseParams("anon",null,!0,!1,!1);var a=createTiddlyElement(e,"ul"),s=getParam(i,"anon","");""==s&&o instanceof Tiddler&&(s=o.title);var l=getParam(i,"sep"," ");a.setAttribute("title",this.tooltip.format([s]));var d=getParam(i,"sortBy",!1),c=store.getTaggedTiddlers(s,d),u=0==c.length?this.labelNotTag:this.label;createTiddlyElement(a,"li",null,"listTitle",u.format([s,c.length]));var f;for(f=0;f<c.length;f++)createTiddlyLink(createTiddlyElement(a,"li"),c[f].title,!0),f<c.length-1&&createTiddlyText(a,l)},config.macros.closeAll.handler=function(e){createTiddlyButton(e,this.label,this.prompt,this.onClick)},config.macros.closeAll.onClick=function(e){return story.closeAllTiddlers(),!1},config.macros.permaview.handler=function(e){createTiddlyButton(e,this.label,this.prompt,this.onClick)},config.macros.permaview.onClick=function(e){return story.permaView(),!1},config.macros.saveChanges.handler=function(e,t,i){readOnly||createTiddlyButton(e,i[0]||this.label,i[1]||this.prompt,this.onClick,null,null,this.accessKey)},config.macros.saveChanges.onClick=function(e){return saveChanges(),!1},config.macros.slider.onClickSlider=function(e){var t=this.nextSibling,i=t.getAttribute("cookie"),n="none"!=t.style.display;return config.options.chkAnimate&&anim&&"function"==typeof Slider?anim.startAnimating(new Slider(t,!n,null,"none")):t.style.display=n?"none":"block",config.options[i]=!n,saveOption(i),!1},config.macros.slider.createSlider=function(e,t,i,n){var r=t||"";createTiddlyButton(e,i,n,this.onClickSlider);var o=createTiddlyElement(null,"div",null,"sliderPanel");return o.setAttribute("cookie",r),o.style.display=config.options[r]?"block":"none",e.appendChild(o),o},config.macros.slider.handler=function(e,t,i){var n=this.createSlider(e,i[0],i[2],i[3]),r=store.getTiddlerText(i[1]);n.setAttribute("refresh","content"),n.setAttribute("tiddler",i[1]),r&&wikify(r,n,null,store.getTiddler(i[1]))},config.macros.gradient.handler=function(e,t,i,n,r,o){var a=n?createTiddlyElement(e,"div",null,"gradient"):e;if(a.style.position="relative",a.style.overflow="hidden",a.style.zIndex="0",n){var s=config.formatterHelpers.inlineCssHelper(n);config.formatterHelpers.applyCssHelper(a,s)}i=r.parseParams("color");var l,d=[],c=[];for(l=2;l<i.length;l++){var u=i[l].value;"snap"==i[l].name?c[c.length-1]=u:(d.push(u),c.push(u))}drawGradient(a,"vert"!=i[1].value,d,c),n&&n.subWikify(a,">>"),document.all&&(a.style.height="100%",a.style.width="100%")},config.macros.message.handler=function(e,t,i){if(i[0]){var n=i[0].split("."),r=function(e,t){return e[n[t]]?t<n.length-1?r(e[n[t]],t+1):e[n[t]]:null},o=r(config,0);null==o&&(o=r(window,0)),createTiddlyText(e,o.toString().format(i.splice(1)))}},config.macros.view.depth=0,config.macros.view.values=[],config.macros.view.views={text:function(e,t,i,n,r,o){highlightify(e,t,highlightHack,o)},link:function(e,t,i,n,r,o){createTiddlyLink(t,e,!0)},wikified:function(e,t,i,n,r,o){config.macros.view.depth>50||config.macros.view.depth>0&&e==config.macros.view.values[config.macros.view.depth-1]||(config.macros.view.values[config.macros.view.depth]=e,config.macros.view.depth++,i[2]&&(e=i[2].unescapeLineBreaks().format([e])),wikify(e,t,highlightHack,o),config.macros.view.depth--,config.macros.view.values[config.macros.view.depth]=null)},date:function(e,t,i,n,r,o){e=Date.convertFromYYYYMMDDHHMM(e),createTiddlyText(t,e.formatString(i[2]||config.views.wikified.dateFormat))}},config.macros.view.handler=function(e,t,i,n,r,o){if(o instanceof Tiddler&&i[0]){var a=store.getValue(o,i[0]);if(a){var s=i[1]||config.macros.view.defaultView,l=config.macros.view.views[s];l&&l(a,e,i,n,r,o)}}},config.macros.edit.handler=function(e,t,i,n,r,o){var a=i[0],s=i[1]||0,l=i[2]||"";if(o instanceof Tiddler&&a){story.setDirty(o.title,!0);var d,c;if("text"==a||s){var u=createTiddlyElement(null,"fieldset",null,"fieldsetFix"),f=createTiddlyElement(u,"div");d=createTiddlyElement(f,"textarea"),d.value=c=store.getValue(o,a)||l,s=s||10;var p=c.match(/\n/gm),h=Math.max(parseInt(config.options.txtMaxEditRows,10),5);null!=p&&p.length>s&&(s=p.length+5),s=Math.min(s,h),d.setAttribute("rows",s),d.setAttribute("edit",a),e.appendChild(u)}else d=createTiddlyElement(null,"input",null,null,null,{type:"text",edit:a,size:"40",autocomplete:"off"}),d.value=store.getValue(o,a)||l,e.appendChild(d);return o.isReadOnly()&&(d.setAttribute("readOnly","readOnly"),jQuery(d).addClass("readOnly")),d}},config.macros.tagChooser.onClick=function(e){var t=e||window.event,i=config.views.editor.tagChooser,n=Popup.create(this),r=store.getTags(this.getAttribute("tags"));0==r.length&&jQuery("<li/>").text(i.popupNone).appendTo(n);var o;for(o=0;o<r.length;o++){var a=createTiddlyButton(createTiddlyElement(n,"li"),r[o][0],i.tagTooltip.format([r[o][0]]),config.macros.tagChooser.onTagClick);a.setAttribute("tag",r[o][0]),a.setAttribute("tiddler",this.getAttribute("tiddler"))}return Popup.show(),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!1},config.macros.tagChooser.onTagClick=function(e){var t=e||window.event;(t.metaKey||t.ctrlKey)&&stopEvent(t);var i=this.getAttribute("tag"),n=this.getAttribute("tiddler");return readOnly||story.setTiddlerTag(n,i,0),!1},config.macros.tagChooser.handler=function(e,t,i,n,r,o){if(o instanceof Tiddler){var a=config.views.editor.tagChooser,s=createTiddlyButton(e,a.text,a.tooltip,this.onClick);s.setAttribute("tiddler",o.title),s.setAttribute("tags",i[0])}},config.macros.refreshDisplay.handler=function(e){createTiddlyButton(e,this.label,this.prompt,this.onClick)},config.macros.refreshDisplay.onClick=function(e){return refreshAll(),!1},config.macros.annotations.handler=function(e,t,i,n,r,o){var a=o?o.title:null,s=a?config.annotations[a]:null;if(o&&a&&s){var l=s.format([a]);wikify(l,createTiddlyElement(e,"div",null,"annotation"),null,o)}},config.macros.newTiddler.createNewTiddlerButton=function(e,t,i,n,r,o,a,s){
var l,d=[];for(l=1;l<i.length;l++)("anon"==i[l].name&&1!=l||"tag"==i[l].name)&&d.push(i[l].value);n=getParam(i,"label",n),r=getParam(i,"prompt",r),o=getParam(i,"accessKey",o),a=getParam(i,"focus",a);var c=getParam(i,"fields","");c||store.isShadowTiddler(t)||(c=String.encodeHashMap(config.defaultCustomFields));var u=createTiddlyButton(e,n,r,this.onClickNewTiddler,null,null,o);u.setAttribute("newTitle",t),u.setAttribute("isJournal",s?"true":"false"),d.length>0&&u.setAttribute("params",d.join("|")),u.setAttribute("newFocus",a),u.setAttribute("newTemplate",getParam(i,"template",DEFAULT_EDIT_TEMPLATE)),""!==c&&u.setAttribute("customFields",c);var f=getParam(i,"text");return void 0!==f&&u.setAttribute("newText",f),u},config.macros.newTiddler.onClickNewTiddler=function(){var e=this.getAttribute("newTitle");"true"==this.getAttribute("isJournal")&&(e=(new Date).formatString(e.trim()));var t=this.getAttribute("params"),i=t?t.split("|"):[],n=this.getAttribute("newFocus"),r=this.getAttribute("newTemplate"),o=this.getAttribute("customFields");o||store.isShadowTiddler(e)||(o=String.encodeHashMap(config.defaultCustomFields)),story.displayTiddler(null,e,r,!1,null,null);var a=story.getTiddler(e);o&&story.addCustomFields(a,o);var s=this.getAttribute("newText");"string"==typeof s&&story.getTiddlerField(e,"text")&&(story.getTiddlerField(e,"text").value=s.format([e]));var l;for(l=0;l<i.length;l++)story.setTiddlerTag(e,i[l],1);return story.focusTiddler(e,n),!1},config.macros.newTiddler.handler=function(e,t,i,n,r){if(!readOnly){i=r.parseParams("anon",null,!0,!1,!1);var o=i[1]&&"anon"==i[1].name?i[1].value:this.title;o=getParam(i,"title",o),this.createNewTiddlerButton(e,o,i,this.label,this.prompt,this.accessKey,"title",!1)}},config.macros.newJournal.handler=function(e,t,i,n,r){if(!readOnly){i=r.parseParams("anon",null,!0,!1,!1);var o=i[1]&&"anon"==i[1].name?i[1].value:config.macros.timeline.dateFormat;o=getParam(i,"title",o),config.macros.newTiddler.createNewTiddlerButton(e,o,i,this.label,this.prompt,this.accessKey,"text",!0)}},config.macros.search.handler=function(e,t,i,n,r,o){i=r.parseParams("anon",null,!1,!1,!1),createTiddlyButton(e,this.label,this.prompt,this.onClick,"searchButton");var a=createTiddlyElement(null,"input",null,"txtOptionInput searchField");a.value=getParam(i,"anon",""),config.browser.isSafari?(a.setAttribute("type","search"),a.setAttribute("results","5")):a.setAttribute("type","text"),e.appendChild(a),a.onkeyup=this.onKeyPress,a.onfocus=this.onFocus,a.setAttribute("size",this.sizeTextbox),a.setAttribute("accessKey",getParam(i,"accesskey",this.accessKey)),a.setAttribute("autocomplete","off"),a.setAttribute("lastSearchText",""),a.setAttribute("placeholder",getParam(i,"placeholder",this.placeholder))},config.macros.search.timeout=null,config.macros.search.doSearch=function(e){e.value.length>0&&(story.search(e.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch),e.setAttribute("lastSearchText",e.value))},config.macros.search.onClick=function(e){return config.macros.search.doSearch(this.nextSibling),!1},config.macros.search.onKeyPress=function(e){var t=config.macros.search,i=e||window.event;switch(i.keyCode){case 9:return;case 13:case 10:t.doSearch(this);break;case 27:this.value="",clearMessage()}if(config.options.chkIncrementalSearch)if(this.value.length>2){if(this.value!=this.getAttribute("lastSearchText")){t.timeout&&clearTimeout(t.timeout);var n=this;t.timeout=setTimeout(function(){t.doSearch(n)},500)}}else t.timeout&&clearTimeout(t.timeout)},config.macros.search.onFocus=function(e){this.select()},config.macros.tabs.handler=function(e,t,i){var n=i[0],r=(i.length-1)/3,o=createTiddlyElement(null,"div",null,"tabsetWrapper "+n),a=createTiddlyElement(o,"div",null,"tabset");a.setAttribute("cookie",n);var s,l=!1;for(s=0;r>s;s++){var d=i[3*s+1],c=i[3*s+2],u=i[3*s+3],f=createTiddlyButton(a,d,c,this.onClickTab,"tab tabUnselected");createTiddlyElement(f,"span",null,null," ",{style:"font-size:0pt;line-height:0px"}),f.setAttribute("tab",d),f.setAttribute("content",u),f.title=c,config.options[n]==d&&(l=!0)}l||(config.options[n]=i[1]),e.appendChild(o),this.switchTab(a,config.options[n])},config.macros.tabs.onClickTab=function(e){return config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab")),!1},config.macros.tabs.switchTab=function(e,t){var i,n=e.getAttribute("cookie"),r=null,o=e.childNodes;for(i=0;i<o.length;i++)o[i].getAttribute&&o[i].getAttribute("tab")==t?(r=o[i],r.className="tab tabSelected"):o[i].className="tab tabUnselected";if(r){e.nextSibling&&"tabContents"==e.nextSibling.className&&jQuery(e.nextSibling).remove();var a=createTiddlyElement(null,"div",null,"tabContents");e.parentNode.insertBefore(a,e.nextSibling);var s=r.getAttribute("content");wikify(store.getTiddlerText(s),a,null,store.getTiddler(s)),n&&(config.options[n]=t,saveOption(n))}},config.macros.toolbar.createCommand=function(e,t,i,n){if("string"!=typeof t){var r,o=null;for(r in config.commands)config.commands[r]==t&&(o=r);t=o}if(i instanceof Tiddler&&"string"==typeof t){var a=config.commands[t];if(a.isEnabled?a.isEnabled(i):this.isCommandEnabled(a,i)){var s=a.getText?a.getText(i):this.getCommandText(a,i),l=a.getTooltip?a.getTooltip(i):this.getCommandTooltip(a,i),d="popup"==a.type?this.onClickPopup:this.onClickCommand,c=createTiddlyButton(null,s,l,d);c.setAttribute("commandName",t),c.setAttribute("tiddler",i.title),jQuery(c).addClass("command_"+t),n&&jQuery(c).addClass(n),e.appendChild(c)}}},config.macros.toolbar.isCommandEnabled=function(e,t){var i=t.title,n=t.isReadOnly(),r=store.isShadowTiddler(i)&&!store.tiddlerExists(i);return!(n&&(!n||e.hideReadOnly)||r&&e.hideShadow)},config.macros.toolbar.getCommandText=function(e,t){return t.isReadOnly()&&e.readOnlyText||e.text},config.macros.toolbar.getCommandTooltip=function(e,t){return t.isReadOnly()&&e.readOnlyTooltip||e.tooltip},config.macros.toolbar.onClickCommand=function(e){var t=e||window.event;t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var i=config.commands[this.getAttribute("commandName")];return i.handler(t,this,this.getAttribute("tiddler"))},config.macros.toolbar.onClickPopup=function(e){var t=e||window.event;t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation();var i=Popup.create(this),n=config.commands[this.getAttribute("commandName")],r=this.getAttribute("tiddler");return i.setAttribute("tiddler",r),n.handlePopup(i,r),Popup.show(),!1},config.macros.toolbar.invokeCommand=function(e,t,i){var n,r=e.getElementsByTagName("a");for(n=0;n<r.length;n++){var o=r[n];if(jQuery(o).hasClass(t)&&o.getAttribute&&o.getAttribute("commandName")){o.onclick instanceof Function&&o.onclick.call(o,i);break}}},config.macros.toolbar.onClickMore=function(e){var t=this.nextSibling;return t.style.display="inline",this.style.display="none",!1},config.macros.toolbar.onClickLess=function(e){var t=this.parentNode,i=t.previousSibling;return t.style.display="none",i.style.display="inline",!1},config.macros.toolbar.handler=function(e,t,i,n,r,o){var a;for(a=0;a<i.length;a++){var s,l=i[a];switch(l){case"!":createTiddlyText(e,this.separator);break;case"*":createTiddlyElement(e,"br");break;case"<":s=createTiddlyButton(e,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess),jQuery(s).addClass("lessCommand");break;case">":s=createTiddlyButton(e,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore),jQuery(s).addClass("moreCommand");var d=createTiddlyElement(e,"span",null,"moreCommand");d.style.display="none",e=d;break;default:var c="";switch(l.substr(0,1)){case"+":c="defaultCommand",l=l.substr(1);break;case"-":c="cancelCommand",l=l.substr(1)}config.commands[l]?this.createCommand(e,l,o,c):this.customCommand(e,l,n,o)}}},config.macros.toolbar.customCommand=function(e,t,i,n){},config.commands.closeTiddler.handler=function(e,t,i){return!story.isDirty(i)||readOnly||confirm(config.commands.cancelTiddler.warning.format([i]))?(story.setDirty(i,!1),story.closeTiddler(i,!0),!1):!1},config.commands.closeOthers.handler=function(e,t,i){return story.closeAllTiddlers(i),!1},config.commands.editTiddler.handler=function(e,t,i){clearMessage();var n=story.getTiddler(i),r=n.getAttribute("tiddlyFields");story.displayTiddler(null,i,DEFAULT_EDIT_TEMPLATE,!1,null,r);var o=story.getTiddlerField(i,config.options.txtEditorFocus||"text");return o&&setCaretPosition(o,0),!1},config.commands.saveTiddler.handler=function(e,t,i){var n=story.saveTiddler(i,e.shiftKey);return n&&story.displayTiddler(null,n),!1},config.commands.cancelTiddler.handler=function(e,t,i){return!story.hasChanges(i)||readOnly||confirm(this.warning.format([i]))?(story.setDirty(i,!1),story.displayTiddler(null,i),!1):!1},config.commands.deleteTiddler.handler=function(e,t,i){var n=!0;return config.options.chkConfirmDelete&&(n=confirm(this.warning.format([i]))),n&&(store.removeTiddler(i),story.closeTiddler(i,!0),autoSaveChanges()),!1},config.commands.permalink.handler=function(e,t,i){var n=encodeURIComponent(String.encodeTiddlyLink(i));return window.location.hash!=n&&(window.location.hash=n),!1},config.commands.references.handlePopup=function(e,t){var i,n=store.getReferringTiddlers(t),r=!1;for(i=0;i<n.length;i++)n[i].title==t||n[i].isTagged("excludeLists")||(createTiddlyLink(createTiddlyElement(e,"li"),n[i].title,!0),r=!0);r||createTiddlyElement(e,"li",null,"disabled",this.popupNone)},config.commands.jump.handlePopup=function(e,t){story.forEachTiddler(function(t,i){createTiddlyLink(createTiddlyElement(e,"li"),t,!0,null,!1,null,!0)})},config.commands.fields.handlePopup=function(e,t){var i=store.fetchTiddler(t);if(i){var n=[];store.forEachField(i,function(e,t,i){n.push({field:t,value:i})},!0),n.sort(function(e,t){return e.field<t.field?-1:e.field==t.field?0:1}),n.length>0?ListView.create(e,n,this.listViewTemplate):createTiddlyElement(e,"div",null,null,this.emptyText)}},Tiddler.prototype.getLinks=function(){return 0==this.linksUpdated&&this.changed(),this.links},Tiddler.prototype.getInheritedFields=function(){var e,t={};for(e in this.fields)("server.host"==e||"server.workspace"==e||"wikiformat"==e||"server.type"==e)&&(t[e]=this.fields[e]);return String.encodeHashMap(t)},Tiddler.prototype.incChangeCount=function(){var e=this.fields.changecount;e=e?parseInt(e,10):0,this.fields.changecount=String(e+1)},Tiddler.prototype.clearChangeCount=function(){this.fields.changecount&&delete this.fields.changecount},Tiddler.prototype.doNotSave=function(){return this.fields.doNotSave},Tiddler.prototype.isTouched=function(){var e=this.fields.changecount||0;return e>0},Tiddler.prototype.set=function(e,t,i,n,r,o,a,s){return this.assign(e,t,i,n,r,o,a,s),this.changed(),this},Tiddler.prototype.assign=function(e,t,i,n,r,o,a,s){return void 0!=e&&(this.title=e),void 0!=t&&(this.text=t),void 0!=i&&(this.modifier=i),void 0!=n&&(this.modified=n),void 0!=s&&(this.creator=s),void 0!=o&&(this.created=o),void 0!=a&&(this.fields=a),void 0!=r?this.tags="string"==typeof r?r.readBracketedList():r:void 0==this.tags&&(this.tags=[]),this},Tiddler.prototype.getTags=function(){return String.encodeTiddlyLinkList(this.tags)},Tiddler.prototype.isTagged=function(e){return-1!=this.tags.indexOf(e)},Tiddler.unescapeLineBreaks=function(e){return e?e.unescapeLineBreaks():""},Tiddler.prototype.escapeLineBreaks=function(){return this.text.escapeLineBreaks()},Tiddler.prototype.changed=function(){this.links=[];var e=this.text;e=e.replace(/\/%((?:.|\n)*?)%\//g,"").replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").replace(/"""((?:.|\n)*?)"""/g,"").replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").replace(/<script((?:.|\n)*?)<\/script\>/g,"");var t=this.autoLinkWikiWords()?0:1,i=0==t?config.textPrimitives.tiddlerAnyLinkRegExp:config.textPrimitives.tiddlerForcedLinkRegExp;i.lastIndex=0;for(var n=i.exec(e);n;){var r=i.lastIndex;if(0==t&&n[1]&&n[1]!=this.title)if(n.index>0){var o=new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");o.lastIndex=n.index-1;var a=o.exec(e);a.index!=n.index-1&&this.links.pushUnique(n[1])}else this.links.pushUnique(n[1]);else n[2-t]&&!config.formatterHelpers.isExternalLink(n[3-t])?this.links.pushUnique(n[3-t]):n[4-t]&&n[4-t]!=this.title&&this.links.pushUnique(n[4-t]);i.lastIndex=r,n=i.exec(e)}this.linksUpdated=!0},Tiddler.prototype.getSubtitle=function(){var e=this.modifier;e||(e=config.messages.subtitleUnknown||"");var t=this.modified;t=t?t.toLocaleString():config.messages.subtitleUnknown||"";var i=config.messages.tiddlerLinkTooltip||"%0 - %1, %2";return i.format([this.title,e,t])},Tiddler.prototype.isReadOnly=function(){return readOnly},Tiddler.prototype.autoLinkWikiWords=function(){return!(this.isTagged("systemConfig")||this.isTagged("excludeMissing"))},Tiddler.prototype.getServerType=function(){var e=null;return this.fields["server.type"]&&(e=this.fields["server.type"]),e||(e=this.fields.wikiformat),e&&!config.adaptors[e]&&(e=null),e},Tiddler.prototype.getAdaptor=function(){var e=this.getServerType();return e?new config.adaptors[e]:null},TiddlyWiki.prototype.setDirty=function(e){this.dirty=e},TiddlyWiki.prototype.isDirty=function(){return this.dirty},TiddlyWiki.prototype.tiddlerExists=function(e){var t=this.fetchTiddler(e);return void 0!=t},TiddlyWiki.prototype.isShadowTiddler=function(e){return void 0===config.shadowTiddlers[e]?!1:!0},TiddlyWiki.prototype.isAvailable=function(e){if(!e)return!1;var t=e?e.indexOf(config.textPrimitives.sectionSeparator):-1;return-1!=t&&(e=e.substr(0,t)),this.tiddlerExists(e)||this.isShadowTiddler(e)},TiddlyWiki.prototype.createTiddler=function(e){var t=this.fetchTiddler(e);return t||(t=new Tiddler(e),this.addTiddler(t),this.setDirty(!0)),t},TiddlyWiki.prototype.getTiddler=function(e){var t=this.fetchTiddler(e);return void 0!=t?t:null},TiddlyWiki.prototype.getShadowTiddlerText=function(e){return"string"==typeof config.shadowTiddlers[e]?config.shadowTiddlers[e]:""},TiddlyWiki.prototype.getTiddlerText=function(e,t){if(!e)return t;var i=e.indexOf(config.textPrimitives.sectionSeparator),n=null;if(-1!=i&&(n=e.substr(i+config.textPrimitives.sectionSeparator.length),e=e.substr(0,i)),i=e.indexOf(config.textPrimitives.sliceSeparator),-1!=i){var r=this.getTiddlerSlice(e.substr(0,i),e.substr(i+config.textPrimitives.sliceSeparator.length));if(r)return r}var o=this.fetchTiddler(e),a=o?o.text:null;if(!o&&this.isShadowTiddler(e)&&(a=this.getShadowTiddlerText(e)),a){if(!n)return a;var s=new RegExp("(^!{1,6}[ 	]*"+n.escapeRegExp()+"[ 	]*\n)","mg");s.lastIndex=0;var l=s.exec(a);if(l){var d=a.substr(l.index+l[1].length),c=/^!/gm;return c.lastIndex=0,l=c.exec(d),l&&(d=d.substr(0,l.index-1)),d}return t}return void 0!=t?t:null},TiddlyWiki.prototype.getRecursiveTiddlerText=function(e,t,i){var n=new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg"),r=this.getTiddlerText(e,null);if(null==r)return t;var o,a=[],s=0;do o=n.exec(r),o?(a.push(r.substr(s,o.index-s)),o[1]&&(0>=i?a.push(o[1]):a.push(this.getRecursiveTiddlerText(o[1],"",i-1))),s=o.index+o[0].length):a.push(r.substr(s));while(o);return a.join("")},TiddlyWiki.prototype.slicesRE=/(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm,TiddlyWiki.prototype.calcAllSlices=function(e){var t={},i=this.getTiddlerText(e,"");this.slicesRE.lastIndex=0;for(var n=this.slicesRE.exec(i);n;)n[2]?t[n[2]]=n[3]:t[n[5]]=n[6],n=this.slicesRE.exec(i);return t},TiddlyWiki.prototype.getTiddlerSlice=function(e,t){var i=this.slices[e];return i||(i=this.calcAllSlices(e),this.slices[e]=i),i[t]},TiddlyWiki.prototype.getTiddlerSlices=function(e,t){var i,n={};for(i=0;i<t.length;i++){var r=this.getTiddlerSlice(e,t[i]);r&&(n[t[i]]=r)}return n},TiddlyWiki.prototype.suspendNotifications=function(){this.notificationLevel--},TiddlyWiki.prototype.resumeNotifications=function(){this.notificationLevel++},TiddlyWiki.prototype.notify=function(e,t){if(!this.notificationLevel){var i;for(i=0;i<this.namedNotifications.length;i++){var n=this.namedNotifications[i];(null==n.name&&t||n.name==e)&&n.notify(e)}}},TiddlyWiki.prototype.notifyAll=function(){if(!this.notificationLevel){var e;for(e=0;e<this.namedNotifications.length;e++){var t=this.namedNotifications[e];t.name&&t.notify(t.name)}}},TiddlyWiki.prototype.addNotification=function(e,t){var i;for(i=0;i<this.namedNotifications.length;i++)if(this.namedNotifications[i].name==e&&this.namedNotifications[i].notify==t)return this;return this.namedNotifications.push({name:e,notify:t}),this},TiddlyWiki.prototype.removeTiddler=function(e){var t=this.fetchTiddler(e);t&&(this.deleteTiddler(e),this.notify(e,!0),this.setDirty(!0))},TiddlyWiki.prototype.resetTiddler=function(e){var t=this.fetchTiddler(e);t&&(t.clearChangeCount(),this.notify(e,!0),this.setDirty(!0))},TiddlyWiki.prototype.setTiddlerTag=function(e,t,i){var n=this.fetchTiddler(e);if(n){var r=n.tags.indexOf(i);-1!=r&&n.tags.splice(r,1),t&&n.tags.push(i),n.changed(),n.incChangeCount(),this.notify(e,!0),this.setDirty(!0)}},TiddlyWiki.prototype.addTiddlerFields=function(e,t){var i=this.fetchTiddler(e);i&&(merge(i.fields,t),i.changed(),i.incChangeCount(),this.notify(e,!0),this.setDirty(!0))},TiddlyWiki.prototype.saveTiddler=function(e,t,i,n,r,o,a,s,l,d){var c;return e instanceof Tiddler?(c=e,c.fields=merge(merge({},c.fields),config.defaultCustomFields,!0),e=c.title,t=e):(c=this.fetchTiddler(e),c?(l=l||c.created,d=d||c.creator,this.deleteTiddler(e)):(l=l||r,c=new Tiddler),a=merge(merge({},a),config.defaultCustomFields,!0),c.set(t,i,n,r,o,l,a,d)),this.addTiddler(c),s?c.clearChangeCount():c.incChangeCount(),e!=t&&this.notify(e,!0),this.notify(t,!0),this.setDirty(!0),c},TiddlyWiki.prototype.incChangeCount=function(e){var t=this.fetchTiddler(e);t&&t.incChangeCount()},TiddlyWiki.prototype.getLoader=function(){return this.loader||(this.loader=new TW21Loader),this.loader},TiddlyWiki.prototype.getSaver=function(){return this.saver||(this.saver=new TW21Saver),this.saver},TiddlyWiki.prototype.allTiddlersAsHtml=function(){return this.getSaver().externalize(store)},TiddlyWiki.prototype.loadFromDiv=function(e,t,i){this.idPrefix=t;var n="string"==typeof e?document.getElementById(e):e;if(n){var r=this.getLoader().loadTiddlers(this,n.childNodes);if(this.setDirty(!1),!i){var o;for(o=0;o<r.length;o++)r[o].changed()}jQuery(document).trigger("loadTiddlers")}},TiddlyWiki.prototype.importTiddlyWiki=function(e){var t=locateStoreArea(e);if(!t)return null;var i="<html><body>"+e.substring(t[0],t[1]+endSaveArea.length)+"</body></html>",n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n);var r=n.document;n.contentDocument?r=n.contentDocument:n.contentWindow&&(r=n.contentWindow.document),r.open(),r.writeln(i),r.close();var o=r.getElementById("storeArea");return this.loadFromDiv(o,"store"),n.parentNode.removeChild(n),this},TiddlyWiki.prototype.updateTiddlers=function(){this.tiddlersUpdated=!0,this.forEachTiddler(function(e,t){t.changed()})},TiddlyWiki.prototype.search=function(e,t,i,n){var r,o=this.reverseLookup("tags",i,!!n),a=[];for(r=0;r<o.length;r++)(-1!=o[r].title.search(e)||-1!=o[r].text.search(e))&&a.push(o[r]);return t||(t="title"),a.sort(function(e,i){return e[t]<i[t]?-1:e[t]==i[t]?0:1}),a},TiddlyWiki.prototype.getTags=function(e){var t=[];return this.forEachTiddler(function(i,n){var r,o;for(r=0;r<n.tags.length;r++){var a=n.tags[r],s=!0;for(o=0;o<t.length;o++)t[o][0]==a&&(s=!1,t[o][1]++);if(s&&e){var l=this.fetchTiddler(a);l&&l.isTagged(e)&&(s=!1)}s&&t.push([a,1])}}),t.sort(function(e,t){return e[0].toLowerCase()<t[0].toLowerCase()?-1:e[0].toLowerCase()==t[0].toLowerCase()?0:1}),t},TiddlyWiki.prototype.getTaggedTiddlers=function(e,t){return this.reverseLookup("tags",e,!0,t)},TiddlyWiki.prototype.getValueTiddlers=function(e,t,i){return this.reverseLookup(e,t,!0,i)},TiddlyWiki.prototype.getReferringTiddlers=function(e,t,i){return this.tiddlersUpdated||this.updateTiddlers(),this.reverseLookup("links",e,!0,i)},TiddlyWiki.prototype.reverseLookup=function(e,t,i,n){var r=[];return this.forEachTiddler(function(n,o){var a,s=!i;if(["links","tags"].contains(e))a=o[e];else{var l=TiddlyWiki.standardFieldAccess[e];a=l?[l.get(o)]:o.fields[e]?[o.fields[e]]:[]}var d;for(d=0;d<a.length;d++)a[d]==t&&(s=i);s&&r.push(o)}),n||(n="title"),this.sortTiddlers(r,n)},TiddlyWiki.prototype.getTiddlers=function(e,t){var i=[];return this.forEachTiddler(function(e,n){void 0!=t&&n.isTagged(t)||i.push(n)}),e&&i.sort(function(t,i){return t[e]<i[e]?-1:t[e]==i[e]?0:1}),i},TiddlyWiki.prototype.getMissingLinks=function(){this.tiddlersUpdated||this.updateTiddlers();var e=[];return this.forEachTiddler(function(t,i){if(!i.isTagged("excludeMissing")&&!i.isTagged("systemConfig")){var n;for(n=0;n<i.links.length;n++){var r=i.links[n];null!=this.getTiddlerText(r,null)||this.isShadowTiddler(r)||config.macros[r]||e.pushUnique(r)}}}),e.sort(),e},TiddlyWiki.prototype.getOrphans=function(){var e=[];return this.forEachTiddler(function(t,i){0!=this.getReferringTiddlers(t).length||i.isTagged("excludeLists")||e.push(t)}),e.sort(),e},TiddlyWiki.prototype.getShadowed=function(){var e,t=[];for(e in config.shadowTiddlers)this.isShadowTiddler(e)&&t.push(e);return t.sort(),t},TiddlyWiki.prototype.getTouched=function(){var e=[];return this.forEachTiddler(function(t,i){i.isTouched()&&e.push(i)}),e.sort(),e},TiddlyWiki.prototype.resolveTiddler=function(e){var t="string"==typeof e?this.getTiddler(e):e;return t instanceof Tiddler?t:null},TiddlyWiki.prototype.sortTiddlers=function(e,t){var i=1;switch(t.substr(0,1)){case"-":i=-1,t=t.substr(1);break;case"+":t=t.substr(1)}return TiddlyWiki.standardFieldAccess[t]?"title"==t?e.sort(function(e,n){return e[t].toLowerCase()<n[t].toLowerCase()?-i:e[t].toLowerCase()==n[t].toLowerCase()?0:i}):e.sort(function(e,n){return e[t]<n[t]?-i:e[t]==n[t]?0:i}):e.sort(function(e,n){return e.fields[t]<n.fields[t]?-i:e.fields[t]==n.fields[t]?0:+i}),e},config.filters={tiddler:function(e,t){var i=t[1]||t[4],n=this.fetchTiddler(i);return n?e.pushUnique(n):this.isShadowTiddler(i)?(n=new Tiddler,n.set(i,this.getTiddlerText(i)),e.pushUnique(n)):e.pushUnique(new Tiddler(i)),e},tag:function(e,t){var i,n=this.getTaggedTiddlers(t[3]);for(i=0;i<n.length;i++)e.pushUnique(n[i]);return e},sort:function(e,t){return this.sortTiddlers(e,t[3])},limit:function(e,t){return e.slice(0,parseInt(t[3],10))},field:function(e,t){var i,n=this.getValueTiddlers(t[2],t[3]);for(i=0;i<n.length;i++)e.pushUnique(n[i]);return e}},TiddlyWiki.prototype.filterTiddlers=function(e){var t=/([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/gm,i=[];if(e)for(var n=t.exec(e);n;){var r=n[1]||n[4]?"tiddler":config.filters[n[2]]?n[2]:"field";i=config.filters[r].call(this,i,n),n=t.exec(e)}return i},TiddlyWiki.isValidFieldName=function(e){var t=/[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(e);return t&&t[0]==e},TiddlyWiki.checkFieldName=function(e){if(!TiddlyWiki.isValidFieldName(e))throw config.messages.invalidFieldName.format([e])},TiddlyWiki.standardFieldAccess={title:new StringFieldAccess("title",!0),tiddler:new StringFieldAccess("title",!0),text:new StringFieldAccess("text"),modifier:new StringFieldAccess("modifier"),modified:new DateFieldAccess("modified"),creator:new StringFieldAccess("creator"),created:new DateFieldAccess("created"),tags:new LinksFieldAccess("tags")},TiddlyWiki.isStandardField=function(e){return void 0!=TiddlyWiki.standardFieldAccess[e]},TiddlyWiki.prototype.setValue=function(e,t,i){TiddlyWiki.checkFieldName(t);var n=this.resolveTiddler(e);if(n){t=t.toLowerCase();var r=void 0===i||null===i,o=TiddlyWiki.standardFieldAccess[t];if(o){if(r)return;var a=TiddlyWiki.standardFieldAccess[t];if(!a.set(n,i))return}else{var s=n.fields[t];if(r)if(void 0!==s)delete n.fields[t];else{var l,d=new RegExp("^"+t+"\\."),c=!1;for(l in n.fields)l.match(d)&&(delete n.fields[l],c=!0);if(!c)return}else{if(i=i instanceof Date?i.convertToYYYYMMDDHHMMSSMMM():String(i),s==i)return;n.fields[t]=i}}this.notify(n.title,!0),t.match(/^temp\./)||this.setDirty(!0)}},TiddlyWiki.prototype.getValue=function(e,t){var i=this.resolveTiddler(e);if(!i)return void 0;if(0===t.indexOf(config.textPrimitives.sectionSeparator)||0===t.indexOf(config.textPrimitives.sliceSeparator)){var n=t.substr(0,2),r=t.substring(2);return store.getTiddlerText("%0%1%2".format(i.title,n,r))}t=t.toLowerCase();var o=TiddlyWiki.standardFieldAccess[t];return o?o.get(i):i.fields[t]},TiddlyWiki.prototype.forEachField=function(e,t,i){var n=this.resolveTiddler(e);if(!n)return void 0;var r,o;for(r in n.fields)if(o=t(n,r,n.fields[r]))return o;if(i)return void 0;for(r in TiddlyWiki.standardFieldAccess)if("tiddler"!=r&&(o=t(n,r,TiddlyWiki.standardFieldAccess[r].get(n))))return o;return void 0},Story.prototype.getTiddler=function(e){return document.getElementById(this.tiddlerId(e))},Story.prototype.getContainer=function(){return document.getElementById(this.containerId())},Story.prototype.forEachTiddler=function(e){var t=this.getContainer();if(t)for(var i=t.firstChild;i;){var n=i.nextSibling,r=i.getAttribute("tiddler");r&&e.call(this,r,i),i=n}},Story.prototype.displayDefaultTiddlers=function(){this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")))},Story.prototype.displayTiddlers=function(e,t,i,n,r,o,a){var s;for(s=t.length-1;s>=0;s--)this.displayTiddler(e,t[s],i,n,r,o)},Story.prototype.displayTiddler=function(e,t,i,n,r,o,a,s){var l=t instanceof Tiddler?t.title:t,d=this.getTiddler(l);if(d)a?"true"!=d.getAttribute("dirty")&&this.closeTiddler(l,!0):this.refreshTiddler(l,i,!1,o);else{var c=this.getContainer(),u=this.positionTiddler(e);d=this.createTiddler(c,u,l,i,o)}return s&&"string"!=typeof s&&(e=s),e&&"string"!=typeof e&&(config.options.chkAnimate&&(void 0==n||1==n)&&anim&&"function"==typeof Zoomer&&"function"==typeof Scroller?anim.startAnimating(new Zoomer(l,e,d),new Scroller(d)):window.scrollTo(0,ensureVisible(d))),d},Story.prototype.positionTiddler=function(e){var t=this.getContainer(),i=null;if("string"==typeof e)switch(e){case"top":i=t.firstChild;break;case"bottom":i=null}else{var n=this.findContainingTiddler(e);null==n?i=t.firstChild:n.nextSibling&&(i=n.nextSibling,1!=i.nodeType&&(i=null))}return i},Story.prototype.createTiddler=function(e,t,i,n,r){var o=createTiddlyElement(null,"div",this.tiddlerId(i),"tiddler");o.setAttribute("refresh","tiddler"),r&&o.setAttribute("tiddlyFields",r),e.insertBefore(o,t);var a=null;return store.tiddlerExists(i)||store.isShadowTiddler(i)||(a=this.loadMissingTiddler(i,r)),this.refreshTiddler(i,n,!1,r,a),o},Story.prototype.loadMissingTiddler=function(e,t,i){var n=function(e){if(e.status){var t=e.tiddler;t.created||(t.created=new Date),t.modified||(t.modified=t.created);var n=store.isDirty();e.tiddler=store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,!0,t.created,t.creator),window.allowSave()||store.setDirty(n),autoSaveChanges()}else story.refreshTiddler(e.title,null,!0);e.adaptor.close(),i&&i(e)},r=new Tiddler(e);r.fields="string"==typeof t?t.decodeHashMap():t||{};var o={serverType:r.getServerType()};if(!o.serverType)return"";o.host=r.fields["server.host"],o.workspace=r.fields["server.workspace"];var a=new config.adaptors[o.serverType];return a.getTiddler(e,o,null,n),config.messages.loadingMissingTiddler.format([e,o.serverType,o.host,o.workspace])},Story.prototype.chooseTemplateForTiddler=function(e,t){return t||(t=DEFAULT_VIEW_TEMPLATE),(t==DEFAULT_VIEW_TEMPLATE||t==DEFAULT_EDIT_TEMPLATE)&&(t=config.tiddlerTemplates[t]),t},Story.prototype.getTemplateForTiddler=function(e,t,i){return store.getRecursiveTiddlerText(t,null,10)},Story.prototype.refreshTiddler=function(e,t,i,n,r){var o=this.getTiddler(e);if(o){if("true"==o.getAttribute("dirty")&&!i)return o;t=this.chooseTemplateForTiddler(e,t);var a=o.getAttribute("template");if(t!=a||i){var s=store.getTiddler(e);if(!s)if(s=new Tiddler,store.isShadowTiddler(e)){var l=[];s.set(e,store.getTiddlerText(e),config.views.wikified.shadowModifier,version.date,l,version.date)}else{var d="EditTemplate"==t?config.views.editor.defaultText.format([e]):config.views.wikified.defaultText.format([e]);d=r||d;var c=n?n.decodeHashMap():null;s.set(e,d,config.views.wikified.defaultModifier,version.date,[],version.date,c)}o.setAttribute("tags",s.tags.join(" ")),o.setAttribute("tiddler",e),o.setAttribute("template",t),o.onmouseover=this.onTiddlerMouseOver,o.onmouseout=this.onTiddlerMouseOut,o.ondblclick=this.onTiddlerDblClick,o[window.event?"onkeydown":"onkeypress"]=this.onTiddlerKeyPress,o.innerHTML=this.getTemplateForTiddler(e,t,s),applyHtmlMacros(o,s),store.getTaggedTiddlers(e).length>0?jQuery(o).addClass("isTag"):jQuery(o).removeClass("isTag"),store.tiddlerExists(e)?(jQuery(o).removeClass("shadow"),jQuery(o).removeClass("missing")):jQuery(o).addClass(store.isShadowTiddler(e)?"shadow":"missing"),n&&this.addCustomFields(o,n)}}return o},Story.prototype.addCustomFields=function(e,t){var i=t.decodeHashMap(),n=createTiddlyElement(e,"div",null,"customFields");n.style.display="none";var r;for(r in i){var o=document.createElement("input");o.setAttribute("type","text"),o.setAttribute("value",i[r]),n.appendChild(o),o.setAttribute("edit",r)}},Story.prototype.refreshAllTiddlers=function(e){for(var t=this.getContainer().firstChild;t;){var i=t.getAttribute("template");i&&"true"!=t.getAttribute("dirty")&&this.refreshTiddler(t.getAttribute("tiddler"),e?null:i,!0),t=t.nextSibling}},Story.prototype.onTiddlerMouseOver=function(e){jQuery(this).addClass("selected")},Story.prototype.onTiddlerMouseOut=function(e){jQuery(this).removeClass("selected")},Story.prototype.onTiddlerDblClick=function(e){var t=e||window.event,i=resolveTarget(t);return i&&"input"!=i.nodeName.toLowerCase()&&"textarea"!=i.nodeName.toLowerCase()?(document.selection&&document.selection.empty&&document.selection.empty(),config.macros.toolbar.invokeCommand(this,"defaultCommand",t),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),!0):!1},Story.prototype.onTiddlerKeyPress=function(e){var t=e||window.event;clearMessage();var i=!1,n=this.getAttribute("tiddler"),r=resolveTarget(t);switch(t.keyCode){case 9:var o=story.getTiddlerField(n,"text");"input"==r.tagName.toLowerCase()&&o.value==config.views.editor.defaultText.format([n])&&(o.focus(),o.select(),i=!0),config.options.chkInsertTabs&&"textarea"==r.tagName.toLowerCase()&&(replaceSelection(r,String.fromCharCode(9)),i=!0),config.isOpera&&(r.onblur=function(){this.focus(),this.onblur=null});break;case 13:case 10:case 77:t.ctrlKey&&(blurElement(this),config.macros.toolbar.invokeCommand(this,"defaultCommand",t),i=!0);break;case 27:blurElement(this),config.macros.toolbar.invokeCommand(this,"cancelCommand",t),i=!0}return t.cancelBubble=i,i&&(t.stopPropagation&&t.stopPropagation(),t.returnValue=!0,t.preventDefault&&t.preventDefault()),!i},Story.prototype.getTiddlerField=function(e,t){var i=this.getTiddler(e),n=null;if(i){var r,o=i.getElementsByTagName("*");for(r=0;r<o.length;r++){var a=o[r];("input"==a.tagName.toLowerCase()||"textarea"==a.tagName.toLowerCase())&&(n||(n=a),a.getAttribute("edit")==t&&(n=a))}}return n},Story.prototype.focusTiddler=function(e,t){var i=this.getTiddlerField(e,t);i&&(i.focus(),i.select())},Story.prototype.blurTiddler=function(e){var t=this.getTiddler(e);t&&t.focus&&t.blur&&(t.focus(),t.blur())},Story.prototype.setTiddlerField=function(e,t,i,n){var r=this.getTiddlerField(e,n),o=r.value.readBracketedList();o.setItem(t,i),r.value=String.encodeTiddlyLinkList(o)},Story.prototype.setTiddlerTag=function(e,t,i){this.setTiddlerField(e,t,i,"tags")},Story.prototype.closeTiddler=function(e,t,i){var n=this.getTiddler(e);n&&(clearMessage(),this.scrubTiddler(n),config.options.chkAnimate&&t&&anim&&"function"==typeof Slider?anim.startAnimating(new Slider(n,!1,null,"all")):jQuery(n).remove())},Story.prototype.scrubTiddler=function(e){e.id=null},Story.prototype.setDirty=function(e,t){var i=this.getTiddler(e);i&&i.setAttribute("dirty",t?"true":"false")},Story.prototype.isDirty=function(e){var t=this.getTiddler(e);return t?"true"==t.getAttribute("dirty"):null},Story.prototype.areAnyDirty=function(){var e=!1;
return this.forEachTiddler(function(t,i){this.isDirty(t)&&(e=!0)}),e},Story.prototype.closeAllTiddlers=function(e){clearMessage(),this.forEachTiddler(function(t,i){t!=e&&"true"!=i.getAttribute("dirty")&&this.closeTiddler(t)}),window.scrollTo(0,ensureVisible(this.container))},Story.prototype.isEmpty=function(){var e=this.getContainer();return e&&null==e.firstChild},Story.prototype.search=function(e,t,i){this.closeAllTiddlers(),highlightHack=new RegExp(i?e:e.escapeRegExp(),t?"mg":"img");var n=store.search(highlightHack,"title","excludeSearch");this.displayTiddlers(null,n),highlightHack=null;var r=i?"/":"'";displayMessage(n.length>0?config.macros.search.successMsg.format([n.length.toString(),r+e+r]):config.macros.search.failureMsg.format([r+e+r]))},Story.prototype.findContainingTiddler=function(e){for(;e&&!jQuery(e).hasClass("tiddler");)e=jQuery(e).hasClass("popup")&&Popup.stack[0]?Popup.stack[0].root:e.parentNode;return e},Story.prototype.gatherSaveFields=function(e,t){if(e&&e.getAttribute){var i=e.getAttribute("edit");if(i&&(t[i]=e.value.replace(/\r/gm,"")),e.hasChildNodes()){var n,r=e.childNodes;for(n=0;n<r.length;n++)this.gatherSaveFields(r[n],t)}}},Story.prototype.hasChanges=function(e){var t=this.getTiddler(e);if(t){var i={};if(this.gatherSaveFields(t,i),!store.fetchTiddler(e))return store.isShadowTiddler(e)&&store.getShadowTiddlerText(e)==i.text?!1:!0;var n;for(n in i)if(store.getValue(e,n)!=i[n])return!0}return!1},Story.prototype.saveTiddler=function(e,t){var i=this.getTiddler(e);if(i){var n={};this.gatherSaveFields(i,n);var r=n.title||e;if(!store.tiddlerExists(r)){r=r.trim();var o=config.options.txtUserName}if(store.tiddlerExists(r)&&r!=e){if(!confirm(config.messages.overwriteWarning.format([r.toString()])))return null;e=r}r!=e&&this.closeTiddler(r,!1),i.id=this.tiddlerId(r),i.setAttribute("tiddler",r),i.setAttribute("template",DEFAULT_VIEW_TEMPLATE),i.setAttribute("dirty","false"),config.options.chkForceMinorUpdate&&(t=!t),store.tiddlerExists(r)||(t=!1);var a=new Date;if(store.tiddlerExists(e)){var s=store.fetchTiddler(e),l=s.fields;o=s.creator}else l=merge({},config.defaultCustomFields);var d;for(d in n)TiddlyWiki.isStandardField(d)||(l[d]=n[d]);var c=store.saveTiddler(e,r,n.text,t?void 0:config.options.txtUserName,t?void 0:a,n.tags,l,null,null,o);return autoSaveChanges(null,[c]),r}return null},Story.prototype.permaView=function(){var e=[];this.forEachTiddler(function(t,i){e.push(String.encodeTiddlyLink(t))});var t=encodeURIComponent(e.join(" "));""==t&&(t="#"),window.location.hash!=t&&(window.location.hash=t)},Story.prototype.switchTheme=function(e){if(!safeMode){var t,i=function(e,t){var i;return readOnly&&(i=store.getTiddlerSlice(e,t+"ReadOnly")||store.getTiddlerSlice(e,"Web"+t)),i=i||store.getTiddlerSlice(e,t),i&&0==i.indexOf(config.textPrimitives.sectionSeparator)&&(i=e+i),store.isAvailable(i)?i:t},n=function(e,t,n,r){var o=i(n,r);return t!=o&&store.namedNotifications[e].name==t?(store.namedNotifications[e].name=o,o):t},r=config.refresherData.pageTemplate,o=DEFAULT_VIEW_TEMPLATE,a=config.tiddlerTemplates[o],s=DEFAULT_EDIT_TEMPLATE,l=config.tiddlerTemplates[s];for(t=0;t<config.notifyTiddlers.length;t++){var d=config.notifyTiddlers[t].name;switch(d){case"PageTemplate":config.refresherData.pageTemplate=n(t,config.refresherData.pageTemplate,e,d);break;case"StyleSheet":removeStyleSheet(config.refresherData.styleSheet),config.refresherData.styleSheet=n(t,config.refresherData.styleSheet,e,d);break;case"ColorPalette":config.refresherData.colorPalette=n(t,config.refresherData.colorPalette,e,d)}}config.tiddlerTemplates[o]=i(e,"ViewTemplate"),config.tiddlerTemplates[s]=i(e,"EditTemplate"),startingUp||(config.refresherData.pageTemplate!=r||config.tiddlerTemplates[o]!=a||config.tiddlerTemplates[s]!=l?(refreshAll(),this.refreshAllTiddlers(!0)):setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet),config.options.txtTheme=e,saveOption("txtTheme"))}},config.tasks.save.action=saveChanges;var backstage={area:null,toolbar:null,button:null,showButton:null,hideButton:null,cloak:null,panel:null,panelBody:null,panelFooter:null,currTabName:null,currTabElem:null,content:null,init:function(){var e=config.messages.backstage;this.area=document.getElementById("backstageArea"),this.toolbar=jQuery("#backstageToolbar").empty()[0],this.button=jQuery("#backstageButton").empty()[0],this.button.style.display="block";var t=e.open.text+" "+glyph("bentArrowLeft");for(this.showButton=createTiddlyButton(this.button,t,e.open.tooltip,function(e){return backstage.show(),!1},null,"backstageShow"),t=glyph("bentArrowRight")+" "+e.close.text,this.hideButton=createTiddlyButton(this.button,t,e.close.tooltip,function(e){return backstage.hide(),!1},null,"backstageHide"),this.cloak=document.getElementById("backstageCloak"),this.panel=document.getElementById("backstagePanel"),this.panelFooter=createTiddlyElement(this.panel,"div",null,"backstagePanelFooter"),this.panelBody=createTiddlyElement(this.panel,"div",null,"backstagePanelBody"),this.cloak.onmousedown=function(e){backstage.switchTab(null)},createTiddlyText(this.toolbar,e.prompt),t=0;t<config.backstageTasks.length;t++){var i=config.backstageTasks[t],n=config.tasks[i],r=n.action?this.onClickCommand:this.onClickTab,o=n.text+(n.action?"":glyph("downTriangle")),a=createTiddlyButton(this.toolbar,o,n.tooltip,r,"backstageTab");jQuery(a).addClass(n.action?"backstageAction":"backstageTask"),a.setAttribute("task",i)}this.content=document.getElementById("contentWrapper"),config.options.chkBackstage?this.show():this.hide()},isVisible:function(){return this.area?"block"==this.area.style.display:!1},show:function(){if(this.area.style.display="block",anim&&config.options.chkAnimate){backstage.toolbar.style.left=findWindowWidth()+"px";var e=[{style:"left",start:findWindowWidth(),end:0,template:"%0px"}];anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,e))}else backstage.area.style.left="0px";jQuery(this.showButton).hide(),jQuery(this.hideButton).show(),config.options.chkBackstage=!0,saveOption("chkBackstage"),jQuery(this.content).addClass("backstageVisible")},hide:function(){if(this.currTabElem)this.switchTab(null);else{if(backstage.toolbar.style.left="0px",anim&&config.options.chkAnimate){var e=[{style:"left",start:0,end:findWindowWidth(),template:"%0px"}],t=function(e,t){backstage.area.style.display="none"};anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,e,t))}else this.area.style.display="none";this.showButton.style.display="block",this.hideButton.style.display="none",config.options.chkBackstage=!1,saveOption("chkBackstage"),jQuery(this.content).removeClass("backstageVisible")}},onClickCommand:function(e){var t=config.tasks[this.getAttribute("task")];return t.action&&(backstage.switchTab(null),t.action()),!1},onClickTab:function(e){return backstage.switchTab(this.getAttribute("task")),!1},switchTab:function(e){for(var t=null,i=this.toolbar.firstChild;i;)i.getAttribute&&i.getAttribute("task")==e&&(t=i),i=i.nextSibling;if(e==backstage.currTabName)return void backstage.hidePanel();if(backstage.currTabElem&&jQuery(this.currTabElem).removeClass("backstageSelTab"),t&&e){backstage.preparePanel(),jQuery(t).addClass("backstageSelTab");var n=config.tasks[e];wikify(n.content,backstage.panelBody,null,null),backstage.showPanel()}else backstage.currTabElem&&backstage.hidePanel();backstage.currTabName=e,backstage.currTabElem=t},isPanelVisible:function(){return backstage.panel?"block"==backstage.panel.style.display:!1},preparePanel:function(){return backstage.cloak.style.height=findDocHeight()+"px",backstage.cloak.style.display="block",jQuery(backstage.panelBody).empty(),backstage.panelBody},showPanel:function(){if(backstage.panel.style.display="block",anim&&config.options.chkAnimate){backstage.panel.style.top=-backstage.panel.offsetHeight+"px";var e=[{style:"top",start:-backstage.panel.offsetHeight,end:0,template:"%0px"}];anim.startAnimating(new Morpher(backstage.panel,config.animDuration,e),new Scroller(backstage.panel,!1))}else backstage.panel.style.top="0px";return backstage.panelBody},hidePanel:function(){if(backstage.currTabElem&&jQuery(backstage.currTabElem).removeClass("backstageSelTab"),backstage.currTabElem=null,backstage.currTabName=null,anim&&config.options.chkAnimate){var e=[{style:"top",start:0,end:-backstage.panel.offsetHeight,template:"%0px"},{style:"display",atEnd:"none"}],t=function(e,t){backstage.cloak.style.display="none"};anim.startAnimating(new Morpher(backstage.panel,config.animDuration,e,t))}else jQuery([backstage.panel,backstage.cloak]).hide()}};config.macros.backstage={},config.macros.backstage.handler=function(e,t,i){var n=config.tasks[i[0]];n&&createTiddlyButton(e,n.text,n.tooltip,function(e){return backstage.switchTab(i[0]),!1})},config.macros.importTiddlers.handler=function(e,t,i,n,r,o){if(readOnly)return void createTiddlyElement(e,"div",null,"marked",this.readOnlyWarning);var a=new Wizard;a.createWizard(e,this.wizardTitle),this.restart(a)},config.macros.importTiddlers.onCancel=function(e){var t=new Wizard(this);return t.clear(),config.macros.importTiddlers.restart(t),!1},config.macros.importTiddlers.onClose=function(e){return backstage.hidePanel(),!1},config.macros.importTiddlers.restart=function(e){var t=config.macros.importTiddlers;e.addStep(this.step1Title,this.step1Html);var i,n=e.getElement("selTypes");for(i in config.adaptors){var r=createTiddlyElement(n,"option",null,null,config.adaptors[i].serverLabel||i);r.value=i}config.defaultAdaptor&&(n.value=config.defaultAdaptor),n=e.getElement("selFeeds");var o=this.getFeeds();for(i in o)r=createTiddlyElement(n,"option",null,null,i),r.value=i;e.setValue("feeds",o),n.onchange=t.onFeedChange;var a=e.getElement("txtBrowse");a.onchange=t.onBrowseChange,a.onkeyup=t.onBrowseChange,e.setButtons([{caption:this.openLabel,tooltip:this.openPrompt,onClick:t.onOpen}]),e.formElem.action="javascript:;",e.formElem.onsubmit=function(){(!this.txtPath||this.txtPath.value.length)&&this.lastChild.firstChild.onclick()}},config.macros.importTiddlers.getFeeds=function(){var e,t={},i=store.getTaggedTiddlers("systemServer","title");for(e=0;e<i.length;e++){var n=i[e].title,r=store.getTiddlerSlice(n,"Type");r||(r="file"),t[n]={title:n,url:store.getTiddlerSlice(n,"URL"),workspace:store.getTiddlerSlice(n,"Workspace"),workspaceList:store.getTiddlerSlice(n,"WorkspaceList"),tiddlerFilter:store.getTiddlerSlice(n,"TiddlerFilter"),serverType:r,description:store.getTiddlerSlice(n,"Description")}}return t},config.macros.importTiddlers.onFeedChange=function(e){var t=new Wizard(this),i=t.getElement("selTypes"),n=t.getElement("txtPath"),r=t.getValue("feeds"),o=r[this.value];return o&&(i.value=o.serverType,n.value=o.url,t.setValue("feedName",o.serverType),t.setValue("feedHost",o.url),t.setValue("feedWorkspace",o.workspace),t.setValue("feedWorkspaceList",o.workspaceList),t.setValue("feedTiddlerFilter",o.tiddlerFilter)),!1},config.macros.importTiddlers.onBrowseChange=function(e){var t=new Wizard(this),i=this.value;if(i=i.replace(/^C:\\fakepath\\/i,""),this.files&&this.files[0])try{netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead"),i=this.files[0].fileName}catch(n){var r=getLocalPath(document.location.href),o=r.lastIndexOf("/");-1==o&&(o=r.lastIndexOf("\\")),-1!=o&&(r=r.substr(0,o+1)),i=r+i}var a=t.getElement("txtPath");a.value=config.macros.importTiddlers.getURLFromLocalPath(i);var s=t.getElement("selTypes");return s.value="file",!0},config.macros.importTiddlers.getURLFromLocalPath=function(e){if(!e||!e.length)return e;e=e.replace(/\\/g,"/");var t,i=e.split(":"),n=i[1]||i[0];if(!i[1]||"http"!=i[0]&&"https"!=i[0]&&"file"!=i[0])if("/"==n.substr(0,1))t=document.location.protocol+"//"+document.location.hostname+(i[1]?"/":"")+e;else{var r=document.location.href.replace(/\\/g,"/"),o=r.lastIndexOf("/");-1!=o&&(r=r.substr(0,o)),t=r+"/"+n}else t=e;return t},config.macros.importTiddlers.onOpen=function(e){var t=config.macros.importTiddlers,i=new Wizard(this),n=i.getElement("txtPath"),r=n.value,o=i.getElement("selTypes").value||config.defaultAdaptor,a=new config.adaptors[o];return i.setValue("adaptor",a),i.setValue("serverType",o),i.setValue("host",r),a.openHost(r,null,i,t.onOpenHost),i.setButtons([{caption:t.cancelLabel,tooltip:t.cancelPrompt,onClick:t.onCancel}],t.statusOpenHost),!1},config.macros.importTiddlers.onOpenHost=function(e,t){var i=config.macros.importTiddlers,n=t.getValue("adaptor");e.status!==!0&&displayMessage("Error in importTiddlers.onOpenHost: "+e.statusText),n.getWorkspaceList(e,t,i.onGetWorkspaceList),t.setButtons([{caption:i.cancelLabel,tooltip:i.cancelPrompt,onClick:i.onCancel}],i.statusGetWorkspaceList)},config.macros.importTiddlers.onGetWorkspaceList=function(e,t){var i=config.macros.importTiddlers;e.status!==!0&&displayMessage("Error in importTiddlers.onGetWorkspaceList: "+e.statusText),t.setValue("context",e);var n=t.getValue("feedWorkspace");if(n||1!=e.workspaces.length||(n=e.workspaces[0].title),n)return e.adaptor.openWorkspace(n,e,t,i.onOpenWorkspace),t.setValue("workspace",n),void t.setButtons([{caption:i.cancelLabel,tooltip:i.cancelPrompt,onClick:i.onCancel}],i.statusOpenWorkspace);t.addStep(i.step2Title,i.step2Html);var r,o=t.getElement("selWorkspace");for(o.onchange=i.onWorkspaceChange,r=0;r<e.workspaces.length;r++){var a=createTiddlyElement(o,"option",null,null,e.workspaces[r].title);a.value=e.workspaces[r].title}var s=t.getValue("feedWorkspaceList");if(s){var l,d=s.parseParams("workspace",null,!1,!0);for(l=1;l<d.length;l++)null==e.workspaces.findByField("title",d[l].value)&&(a=createTiddlyElement(o,"option",null,null,d[l].value),a.value=d[l].value)}n&&(r=t.getElement("txtWorkspace"),r.value=n),t.setButtons([{caption:i.openLabel,tooltip:i.openPrompt,onClick:i.onChooseWorkspace}])},config.macros.importTiddlers.onWorkspaceChange=function(e){var t=new Wizard(this),i=t.getElement("txtWorkspace");return i.value=this.value,this.selectedIndex=0,!1},config.macros.importTiddlers.onChooseWorkspace=function(e){var t=config.macros.importTiddlers,i=new Wizard(this),n=i.getValue("adaptor"),r=i.getElement("txtWorkspace").value;i.setValue("workspace",r);var o=i.getValue("context");return n.openWorkspace(r,o,i,t.onOpenWorkspace),i.setButtons([{caption:t.cancelLabel,tooltip:t.cancelPrompt,onClick:t.onCancel}],t.statusOpenWorkspace),!1},config.macros.importTiddlers.onOpenWorkspace=function(e,t){var i=config.macros.importTiddlers;e.status!==!0&&displayMessage("Error in importTiddlers.onOpenWorkspace: "+e.statusText);var n=t.getValue("adaptor"),r=t.getElement("txtBrowse");r.files&&(e.file=r.files[0]),n.getTiddlerList(e,t,i.onGetTiddlerList,t.getValue("feedTiddlerFilter")),t.setButtons([{caption:i.cancelLabel,tooltip:i.cancelPrompt,onClick:i.onCancel}],i.statusGetTiddlerList)},config.macros.importTiddlers.onGetTiddlerList=function(e,t){var i=config.macros.importTiddlers;if(e.status!==!0){var n=e.statusText||i.errorGettingTiddlerList;return n=0===e.host.indexOf("file://")?i.errorGettingTiddlerListFile:e.xhr&&404==e.xhr.status?i.errorGettingTiddlerListHttp404:i.errorGettingTiddlerListHttp,t.setButtons([{caption:i.cancelLabel,tooltip:i.cancelPrompt,onClick:i.onCancel}],""),void jQuery("span.status",t.footerEl).html(n)}var r=[];if(e.tiddlers){var o;for(o=0;o<e.tiddlers.length;o++){var a=e.tiddlers[o];r.push({title:a.title,modified:a.modified,modifier:a.modifier,text:a.text?wikifyPlainText(a.text,100):"",tags:a.tags,size:a.text?a.text.length:0,tiddler:a})}}r.sort(function(e,t){return e.title<t.title?-1:e.title==t.title?0:1}),t.addStep(i.step3Title,i.step3Html);var s=t.getElement("markList"),l=document.createElement("div");s.parentNode.insertBefore(l,s);var d=ListView.create(l,r,i.listViewTemplate);t.setValue("listView",d),t.setValue("context",e);var c=t.getElement("txtSaveTiddler");c.value=i.generateSystemServerName(t),t.setButtons([{caption:i.cancelLabel,tooltip:i.cancelPrompt,onClick:i.onCancel},{caption:i.importLabel,tooltip:i.importPrompt,onClick:i.doImport}])},config.macros.importTiddlers.generateSystemServerName=function(e){var t=e.getValue("serverType"),i=e.getValue("host"),n=e.getValue("workspace"),r=config.macros.importTiddlers[n?"systemServerNamePattern":"systemServerNamePatternNoWorkspace"];return r.format([t,i,n])},config.macros.importTiddlers.saveServerTiddler=function(e){var t=config.macros.importTiddlers,i=e.getElement("txtSaveTiddler").value;if(store.tiddlerExists(i)){if(!confirm(t.confirmOverwriteSaveTiddler.format([i])))return;store.suspendNotifications(),store.removeTiddler(i),store.resumeNotifications()}var n=e.getValue("serverType"),r=e.getValue("host"),o=e.getValue("workspace"),a=t.serverSaveTemplate.format([n,r,o]);store.saveTiddler(i,i,a,t.serverSaveModifier,new Date,["systemServer"])},config.macros.importTiddlers.doImport=function(e){var t=config.macros.importTiddlers,i=new Wizard(this);i.getElement("chkSave").checked&&t.saveServerTiddler(i);var n=i.getElement("chkSync").checked;i.setValue("sync",n);var r,o=i.getValue("listView"),a=ListView.getSelectedRows(o),s=i.getValue("adaptor"),l=[];for(r=0;r<a.length;r++)store.tiddlerExists(a[r])&&l.push(a[r]);if(l.length>0&&!confirm(t.confirmOverwriteText.format([l.join(", ")])))return!1;for(i.addStep(t.step4Title.format([a.length]),t.step4Html),r=0;r<a.length;r++){var d=document.createElement("div");createTiddlyLink(d,a[r],!0);var c=i.getElement("markReport");c.parentNode.insertBefore(d,c)}i.setValue("remainingImports",a.length),i.setButtons([{caption:t.cancelLabel,tooltip:t.cancelPrompt,onClick:t.onCancel}],t.statusDoingImport);var u=i.getValue("context"),f=u?u.tiddlers:[];for(r=0;r<a.length;r++){var p={allowSynchronous:!0,tiddler:f[f.findByField("title",a[r])]};s.getTiddler(a[r],p,i,t.onGetTiddler)}return!1},config.macros.importTiddlers.onGetTiddler=function(e,t){var i=config.macros.importTiddlers;e.status||displayMessage("Error in importTiddlers.onGetTiddler: "+e.statusText);var n=e.tiddler;store.suspendNotifications(),store.saveTiddler(n.title,n.title,n.text,n.modifier,n.modified,n.tags,n.fields,!0,n.created),t.getValue("sync")||store.setValue(n.title,"server",null),store.resumeNotifications(),e.isSynchronous||store.notify(n.title,!0);var r=t.getValue("remainingImports")-1;t.setValue("remainingImports",r),0==r&&(e.isSynchronous&&(store.notifyAll(),refreshDisplay()),t.setButtons([{caption:i.doneLabel,tooltip:i.donePrompt,onClick:i.onClose}],i.statusDoneImport),autoSaveChanges())},config.macros.upgrade.handler=function(e){var t=new Wizard;t.createWizard(e,this.wizardTitle),t.addStep(this.step1Title,this.step1Html.format([this.source,this.source])),t.setButtons([{caption:this.upgradeLabel,tooltip:this.upgradePrompt,onClick:this.onClickUpgrade}])},config.macros.upgrade.onClickUpgrade=function(e){var t=config.macros.upgrade,i=new Wizard(this);if(!window.allowSave())return alert(t.errorCantUpgrade),!1;if(story.areAnyDirty()||store.isDirty())return alert(t.errorNotSaved),!1;var n=getLocalPath(document.location.toString()),r=getBackupPath(n,t.backupExtension);i.setValue("backupPath",r),i.setButtons([],t.statusPreparingBackup);var o=loadOriginal(n);i.setButtons([],t.statusSavingBackup);var a=copyFile(r,n);if(a||(a=saveFile(r,o)),!a)return i.setButtons([],t.errorSavingBackup),alert(t.errorSavingBackup),!1;i.setButtons([],t.statusLoadingCore);var s={type:"GET",url:t.source,processData:!1,success:function(e,n,r){t.onLoadCore(!0,i,r.responseText,t.source,r)},error:function(e,n,r){t.onLoadCore(!1,i,null,t.source,e)}};return ajaxReq(s),!1},config.macros.upgrade.onLoadCore=function(e,t,i,n,r){var o,a=config.macros.upgrade,s=t;e||(o=a.errorLoadingCore);var l=a.extractVersion(i);if(l||(o=a.errorCoreFormat),o)return s.setButtons([],o),void alert(o);var d=function(e){s.setButtons([],a.statusSavingCore);var t=getLocalPath(document.location.toString());saveFile(t,i),s.setButtons([],a.statusReloadingCore);var n=s.getValue("backupPath"),r=document.location.toString()+"?time="+(new Date).convertToYYYYMMDDHHMM()+"#upgrade:[["+encodeURI(n)+"]]";window.setTimeout(function(){window.location=r},10)},c=[a.step2Html_downgrade,a.step2Html_restore,a.step2Html_upgrade][compareVersions(version,l)+1];s.addStep(a.step2Title,c.format([formatVersion(l),formatVersion(version)])),s.setButtons([{caption:a.startLabel,tooltip:a.startPrompt,onClick:d},{caption:a.cancelLabel,tooltip:a.cancelPrompt,onClick:a.onCancel}])},config.macros.upgrade.onCancel=function(e){var t=config.macros.upgrade,i=new Wizard(this);return i.addStep(t.step3Title,t.step3Html),i.setButtons([]),!1},config.macros.upgrade.extractVersion=function(e){var t=/^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/gm,i=t.exec(e);return i?{title:i[1],major:i[2],minor:i[3],revision:i[4],beta:i[6],date:new Date(i[7])}:null},config.macros.plugins.handler=function(e,t,i,n,r){var o=new Wizard;o.createWizard(e,this.wizardTitle),o.addStep(this.step1Title,this.step1Html);var a=o.getElement("markList"),s=document.createElement("div");a.parentNode.insertBefore(s,a),s.setAttribute("refresh","macro"),s.setAttribute("macroName","plugins"),s.setAttribute("params",r),this.refresh(s,r)},config.macros.plugins.refresh=function(e,t){var i=config.macros.plugins,n=new Wizard(e),r=[];ListView.forEachSelector(e,function(e,t){e.checked&&r.push(e.getAttribute("rowName"))}),jQuery(e).empty(),t=t.parseParams("anon");var o,a,s,l=installedPlugins.slice(0),d=store.getTaggedTiddlers("systemConfig");for(o=0;o<d.length;o++)a=d[o],null==l.findByField("title",a.title)&&(s=getPluginInfo(a),s.executed=!1,s.log.splice(0,0,this.skippedText),l.push(s));for(o=0;o<l.length;o++)s=l[o],s.size=s.tiddler.text?s.tiddler.text.length:0,s.forced=s.tiddler.isTagged("systemConfigForce"),s.disabled=s.tiddler.isTagged("systemConfigDisable"),s.Selected=-1!=r.indexOf(l[o].title);if(0==l.length)createTiddlyElement(e,"em",null,null,this.noPluginText),n.setButtons([]);else{var c=readOnly?this.listViewTemplateReadOnly:this.listViewTemplate,u=ListView.create(e,l,c,this.onSelectCommand);n.setValue("listView",u),readOnly||n.setButtons([{caption:i.removeLabel,tooltip:i.removePrompt,onClick:i.doRemoveTag},{caption:i.deleteLabel,tooltip:i.deletePrompt,onClick:i.doDelete}])}},config.macros.plugins.doRemoveTag=function(e){var t=new Wizard(this),i=t.getValue("listView"),n=ListView.getSelectedRows(i);if(0==n.length)alert(config.messages.nothingSelected);else{var r;for(r=0;r<n.length;r++)store.setTiddlerTag(n[r],!1,"systemConfig");autoSaveChanges()}},config.macros.plugins.doDelete=function(e){var t=new Wizard(this),i=t.getValue("listView"),n=ListView.getSelectedRows(i);if(0==n.length)alert(config.messages.nothingSelected);else{if(confirm(config.macros.plugins.confirmDeleteText.format([n.join(", ")]))){var r;for(r=0;r<n.length;r++)store.removeTiddler(n[r]),story.closeTiddler(n[r],!0)}autoSaveChanges()}},config.notifyTiddlers=[{name:"SystemSettings",notify:onSystemSettingsChange},{name:"StyleSheetLayout",notify:refreshStyles},{name:"StyleSheetColors",notify:refreshStyles},{name:"StyleSheet",notify:refreshStyles},{name:"StyleSheetPrint",notify:refreshStyles},{name:"PageTemplate",notify:refreshPageTemplate},{name:"SiteTitle",notify:refreshPageTitle},{name:"SiteSubtitle",notify:refreshPageTitle},{name:"WindowTitle",notify:refreshPageTitle},{name:"ColorPalette",notify:refreshColorPalette},{name:null,notify:refreshDisplay}],config.refreshers={link:function(e,t){var i=e.getAttribute("tiddlyLink");return refreshTiddlyLink(e,i),!0},tiddler:function(e,t){var i=e.getAttribute("tiddler"),n=e.getAttribute("template");return t&&t.indexOf&&-1!=t.indexOf(i)&&!story.isDirty(i)?story.refreshTiddler(i,n,!0):refreshElements(e,t),!0},content:function(e,t){var i=e.getAttribute("tiddler"),n=e.getAttribute("force"),r=e.getAttribute("args");return null!=n||null==t||t.indexOf&&-1!=t.indexOf(i)?(jQuery(e).empty(),config.macros.tiddler.transclude(e,i,r),!0):!1},macro:function(e,t){var i=e.getAttribute("macroName"),n=e.getAttribute("params");return i&&(i=config.macros[i]),i&&i.refresh&&i.refresh(e,n),!0}},config.refresherData={styleSheet:"StyleSheet",defaultStyleSheet:"StyleSheet",pageTemplate:"PageTemplate",defaultPageTemplate:"PageTemplate",colorPalette:"ColorPalette",defaultColorPalette:"ColorPalette"},config.optionHandlers={txt:{get:function(e){return encodeCookie(config.options[e].toString())},set:function(e,t){config.options[e]=decodeCookie(t)}},chk:{get:function(e){return config.options[e]?"true":"false"},set:function(e,t){config.options[e]="true"==t}}};var loadOptionsCookie=loadOptions,saveOptionCookie=saveOption,systemSettingSave;config.macros.option.genericCreate=function(e,t,i,n,r){var o=config.macros.option.types[t],a=document.createElement(o.elementType);return o.typeValue&&a.setAttribute("type",o.typeValue),a[o.eventName]=o.onChange,a.setAttribute("option",i),a.className=n||o.className,config.optionsDesc[i]&&a.setAttribute("title",config.optionsDesc[i]),e.appendChild(a),"no"!=r&&createTiddlyText(e,config.optionsDesc[i]||i),a[o.valueField]=config.options[i],a},config.macros.option.genericOnChange=function(e){var t=this.getAttribute("option");if(t){var i=t.substr(0,3),n=config.macros.option.types[i];n.elementType&&n.valueField&&config.macros.option.propagateOption(t,n.valueField,this[n.valueField],n.elementType,this)}return!0},config.macros.option.types={txt:{elementType:"input",valueField:"value",eventName:"onchange",className:"txtOptionInput",create:config.macros.option.genericCreate,onChange:config.macros.option.genericOnChange},chk:{elementType:"input",valueField:"checked",eventName:"onclick",className:"chkOptionInput",typeValue:"checkbox",create:config.macros.option.genericCreate,onChange:config.macros.option.genericOnChange}},config.macros.option.propagateOption=function(e,t,i,n,r){config.options[e]=i,saveOption(e);var o,a=document.getElementsByTagName(n);for(o=0;o<a.length;o++){var s=a[o].getAttribute("option");e==s&&a[o]!=r&&(a[o][t]=i)}},config.macros.option.handler=function(e,t,i,n,r){i=r.parseParams("anon",null,!0,!1,!1);var o=i[1]&&"anon"==i[1].name?i[1].value:getParam(i,"name",null),a=i[2]&&"anon"==i[2].name?i[2].value:getParam(i,"class",null),s=getParam(i,"desc","no"),l=o.substr(0,3),d=config.macros.option.types[l];d&&d.create&&d.create(e,l,o,a,s)},config.macros.options.handler=function(e,t,i,n,r){i=r.parseParams("anon",null,!0,!1,!1);var o=getParam(i,"showUnknown","no"),a=new Wizard;a.createWizard(e,this.wizardTitle),a.addStep(this.step1Title,this.step1Html);var s=a.getElement("markList"),l=a.getElement("chkUnknown");l.checked="yes"==o,l.onchange=this.onChangeUnknown;var d=document.createElement("div");s.parentNode.insertBefore(d,s),a.setValue("listWrapper",d),this.refreshOptions(d,"yes"==o)},config.macros.options.refreshOptions=function(e,t){var i,n=[];for(i in config.options){var r={};r.option="",r.name=i,r.lowlight=!config.optionsDesc[i],r.description=r.lowlight?this.unknownDescription:config.optionsDesc[i],(!r.lowlight||t)&&n.push(r)}for(n.sort(function(e,t){return e.name.substr(3)<t.name.substr(3)?-1:e.name.substr(3)==t.name.substr(3)?0:1}),ListView.create(e,n,this.listViewTemplate),i=0;i<n.length;i++){var o=n[i].name.substr(0,3),a=config.macros.option.types[o];a&&a.create&&a.create(n[i].colElements.option,o,n[i].name,null,"no")}},config.macros.options.onChangeUnknown=function(e){var t=new Wizard(this),i=t.getValue("listWrapper");return jQuery(i).empty(),config.macros.options.refreshOptions(i,this.checked),!1};var saveUsingSafari=!1,startSaveArea='<div id="storeArea">',startSaveAreaRE=/<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/,endSaveArea="</div>",endSaveAreaCaps="</DIV>";window.getLocalPath=window.getLocalPath||function(e){var t=convertUriToUTF8(e,config.options.txtFileSystemCharSet),i=t.indexOf("?");-1!=i&&(t=t.substr(0,i));var n=t.indexOf("#");-1!=n&&(t=t.substr(0,n)),0==t.indexOf("file://localhost/")&&(t="file://"+t.substr(16));var r;return r=":"==t.charAt(9)?unescape(t.substr(8)).replace(new RegExp("/","g"),"\\"):0==t.indexOf("file://///")?"\\\\"+unescape(t.substr(10)).replace(new RegExp("/","g"),"\\"):0==t.indexOf("file:///")?unescape(t.substr(7)):0==t.indexOf("file:/")?unescape(t.substr(5)):"\\\\"+unescape(t.substr(7)).replace(new RegExp("/","g"),"\\")},tiddlerToRssItem=function(e,t){var i="<title>"+e.title.htmlEncode()+"</title>\n";i+="<description>"+wikifyStatic(e.text,null,e).htmlEncode()+"</description>\n";var n;for(n=0;n<e.tags.length;n++)i+="<category>"+e.tags[n]+"</category>\n";return i+="<link>"+t+"#"+encodeURIComponent(String.encodeTiddlyLink(e.title))+"</link>\n",i+="<pubDate>"+e.modified.toGMTString()+"</pubDate>\n"},window.copyFile=window.copyFile||function(e,t){return config.browser.isIE?ieCopyFile(e,t):!1},window.saveFile=window.saveFile||function(e,t){var i=mozillaSaveFile(e,t);return i||(i=ieSaveFile(e,t)),i||(i=javaSaveFile(e,t)),i||(i=HTML5DownloadSaveFile(e,t)),i||(i=manualSaveFile(e,t)),i},window.loadFile=window.loadFile||function(e){var t=mozillaLoadFile(e);return(null==t||0==t)&&(t=ieLoadFile(e)),(null==t||0==t)&&(t=javaLoadFile(e)),t};var LOG_TIDDLYSAVER=!0;AdaptorBase.prototype.close=function(){return!0},AdaptorBase.prototype.fullHostName=function(e){return e?(e=e.trim(),e.match(/:\/\//)||(e="http://"+e),"/"==e.substr(e.length-1)&&(e=e.substr(0,e.length-1)),e):""},AdaptorBase.minHostName=function(e){return e},AdaptorBase.prototype.setContext=function(e,t,i){return e||(e={}),e.userParams=t,i&&(e.callback=i),e.adaptor=this,e.host||(e.host=this.host),e.host=this.fullHostName(e.host),e.workspace||(e.workspace=this.workspace),e},AdaptorBase.prototype.openHost=function(e,t,i,n){return this.host=e,t=this.setContext(t,i,n),t.status=!0,n&&window.setTimeout(function(){t.callback(t,i)},10),!0},AdaptorBase.prototype.openWorkspace=function(e,t,i,n){return this.workspace=e,t=this.setContext(t,i,n),t.status=!0,n&&window.setTimeout(function(){n(t,i)},10),!0},FileAdaptor.prototype=new AdaptorBase,FileAdaptor.serverType="file",FileAdaptor.serverLabel="TiddlyWiki",FileAdaptor.loadTiddlyWikiSuccess=function(e,t){e.status=!0,e.adaptor.store=new TiddlyWiki,e.adaptor.store.importTiddlyWiki(t.responseText)||(e.statusText=config.messages.invalidFileError.format([e.host]),e.status=!1),e.complete(e,e.userParams)},FileAdaptor.loadTiddlyWikiError=function(e,t){e.status=!1,e.statusText=t.message,e.complete(e,e.userParams)},FileAdaptor.prototype.getWorkspaceList=function(e,t,i){return e=this.setContext(e,t,i),e.workspaces=[{title:"(default)"}],e.status=!0,i&&window.setTimeout(function(){i(e,t)},10),!0},FileAdaptor.prototype.getTiddlerList=function(e,t,i,n){if(e=this.setContext(e,t,i),e.filter||(e.filter=n),e.complete=FileAdaptor.getTiddlerListComplete,this.store)return e.complete(e,e.userParams);var r={type:"GET",url:e.host,file:e.file,processData:!1,success:function(t,i,n){FileAdaptor.loadTiddlyWikiSuccess(e,n)},error:function(t,i,n){e.xhr=t,FileAdaptor.loadTiddlyWikiError(e,t)}};return ajaxReq(r)},FileAdaptor.getTiddlerListComplete=function(e,t){if(e.status){e.filter?e.tiddlers=e.adaptor.store.filterTiddlers(e.filter):(e.tiddlers=[],e.adaptor.store.forEachTiddler(function(t,i){e.tiddlers.push(i)}));var i;for(i=0;i<e.tiddlers.length;i++)e.tiddlers[i].fields["server.type"]=FileAdaptor.serverType,e.tiddlers[i].fields["server.host"]=AdaptorBase.minHostName(e.host),e.tiddlers[i].fields["server.page.revision"]=e.tiddlers[i].modified.convertToYYYYMMDDHHMM();e.status=!0}return e.callback&&window.setTimeout(function(){e.callback(e,t)},10),!0},FileAdaptor.prototype.generateTiddlerInfo=function(e){var t={};return t.uri=e.fields["server.host"]+"#"+e.title,t},FileAdaptor.prototype.getTiddler=function(e,t,i,n){if(t=this.setContext(t,i,n),t.title=e,t.complete=FileAdaptor.getTiddlerComplete,t.adaptor.store)return t.complete(t,t.userParams);var r={type:"GET",url:t.host,processData:!1,success:function(e,i,n){FileAdaptor.loadTiddlyWikiSuccess(t,n)},error:function(e,i,n){FileAdaptor.loadTiddlyWikiError(t,e)}};return ajaxReq(r)},FileAdaptor.getTiddlerComplete=function(e,t){
var i=e.adaptor.store.fetchTiddler(e.title);return i?(i.fields["server.type"]=FileAdaptor.serverType,i.fields["server.host"]=AdaptorBase.minHostName(e.host),i.fields["server.page.revision"]=i.modified.convertToYYYYMMDDHHMM(),e.tiddler=i,e.status=!0):e.status=!1,e.allowSynchronous?(e.isSynchronous=!0,e.callback(e,t)):window.setTimeout(function(){e.callback(e,t)},10),!0},FileAdaptor.prototype.close=function(){this.store=null},config.adaptors[FileAdaptor.serverType]=FileAdaptor,config.defaultAdaptor=FileAdaptor.serverType,Animator.prototype.startAnimating=function(){var e;for(e=0;e<arguments.length;e++)this.animations.push(arguments[e]);if(0==this.running){var t=this;this.timerID=window.setInterval(function(){t.doAnimate(t)},10)}this.running+=arguments.length},Animator.prototype.doAnimate=function(e){for(var t=0;t<e.animations.length;){var i=e.animations[t];i.tick()?t++:(e.animations.splice(t,1),0==--e.running&&window.clearInterval(e.timerID))}},Animator.slowInSlowOut=function(e){return 1-(Math.cos(e*Math.PI)+1)/2},Morpher.prototype.assignStyle=function(e,t,i){switch(t){case"-tw-vertScroll":window.scrollTo(findScrollX(),i);break;case"-tw-horizScroll":window.scrollTo(i,findScrollY());break;default:e.style[t]=i}},Morpher.prototype.stop=function(){var e;for(e=0;e<this.properties.length;e++){var t=this.properties[e];void 0!==t.atEnd&&this.assignStyle(this.element,t.style,t.atEnd)}this.callback&&this.callback(this.element,this.properties)},Morpher.prototype.tick=function(){var e,t=Number(new Date),i=Animator.slowInSlowOut(Math.min(1,(t-this.startTime)/this.duration));for(e=0;e<this.properties.length;e++){var n=this.properties[e];if(void 0!==n.start&&void 0!==n.end){var r=n.template||"%0";switch(n.format){case void 0:case"style":var o=n.start+(n.end-n.start)*i;this.assignStyle(this.element,n.style,r.format([o]));break;case"color":}}}return t>=this.endTime?(this.stop(),!1):!0};var Popup={stack:[]};Popup.create=function(e,t,i){var n=this.find(e,"popup");Popup.remove(n+1);var r=createTiddlyElement(document.body,t||"ol","popup",i||"popup");return r.stackPosition=n,Popup.stack.push({root:e,popup:r}),r},Popup.onDocumentClick=function(e){var t=e||window.event;return void 0==t.eventPhase?Popup.remove():(t.eventPhase==Event.BUBBLING_PHASE||t.eventPhase==Event.AT_TARGET)&&Popup.remove(),!0},Popup.show=function(e,t,i){var n=Popup.stack[Popup.stack.length-1];this.place(n.root,n.popup,e,t,i),jQuery(n.root).addClass("highlight"),config.options.chkAnimate&&anim&&"function"==typeof Scroller?anim.startAnimating(new Scroller(n.popup)):window.scrollTo(0,ensureVisible(n.popup))},Popup.place=function(e,t,i,n,r){r||(r={x:0,y:0}),t.stackPosition>=0&&!i&&!n?r.x=r.x+e.offsetWidth:(r.x="right"==n?r.x+e.offsetWidth:r.x,r.y="top"==i?r.y:r.y+e.offsetHeight);var o=findPosX(e),a=findPosY(e),s=o+r.x,l=a+r.y,d=findWindowWidth();t.offsetWidth>.75*d&&(t.style.width=.75*d+"px");var c=t.offsetWidth,u=d-document.body.offsetWidth;s+c>d-u-1&&(s="right"==n?s-e.offsetWidth-c:d-c-u-1),t.style.left=s+"px",t.style.top=l+"px",t.style.display="block"},Popup.find=function(e){var t,i=-1;for(t=this.stack.length-1;t>=0;t--)isDescendant(e,this.stack[t].popup)&&(i=t);return i},Popup.remove=function(e){e||(e=0),Popup.stack.length>e&&Popup.removeFrom(e)},Popup.removeFrom=function(e){var t;for(t=Popup.stack.length-1;t>=e;t--){var i=Popup.stack[t];jQuery(i.root).removeClass("highlight"),jQuery(i.popup).remove()}Popup.stack=Popup.stack.slice(0,e)},Wizard.prototype.setValue=function(e,t){jQuery(this.formElem).data(e,t)},Wizard.prototype.getValue=function(e){return this.formElem?jQuery(this.formElem).data(e):null},Wizard.prototype.createWizard=function(e,t){return this.formElem=createTiddlyElement(e,"form",null,"wizard"),createTiddlyElement(this.formElem,"h1",null,null,t),this.bodyElem=createTiddlyElement(this.formElem,"div",null,"wizardBody"),this.footElem=createTiddlyElement(this.formElem,"div",null,"wizardFooter"),this.formElem},Wizard.prototype.clear=function(){jQuery(this.bodyElem).empty()},Wizard.prototype.setButtons=function(e,t){jQuery(this.footElem).empty();var i;for(i=0;i<e.length;i++)createTiddlyButton(this.footElem,e[i].caption,e[i].tooltip,e[i].onClick),insertSpacer(this.footElem);"string"==typeof t&&createTiddlyElement(this.footElem,"span",null,"status",t)},Wizard.prototype.addStep=function(e,t){jQuery(this.bodyElem).empty();var i=createTiddlyElement(this.bodyElem,"div");createTiddlyElement(i,"h2",null,null,e);var n=createTiddlyElement(i,"div",null,"wizardStep");n.innerHTML=t,applyHtmlMacros(n,tiddler)},Wizard.prototype.getElement=function(e){return this.formElem.elements[e]};var ListView={};ListView.create=function(e,t,i,n,r){var o,a=createTiddlyElement(e,"table",null,r||"listView twtable"),s=createTiddlyElement(a,"thead"),l=createTiddlyElement(s,"tr");for(o=0;o<i.columns.length;o++){var d=i.columns[o],c=createTiddlyElement(l,"th"),u=ListView.columnTypes[d.type];u&&u.createHeader&&(u.createHeader(c,d,o),d.className&&jQuery(c).addClass(d.className))}var f,p=createTiddlyElement(a,"tbody");for(f=0;f<t.length;f++){var h=t[f];for(l=createTiddlyElement(p,"tr"),c=0;c<i.rowClasses.length;c++)h[i.rowClasses[c].field]&&jQuery(l).addClass(i.rowClasses[c].className);h.rowElement=l,h.colElements={};var g;for(g=0;g<i.columns.length;g++){c=createTiddlyElement(l,"td"),d=i.columns[g];var m=d.field;u=ListView.columnTypes[d.type],u&&u.createItem&&(u.createItem(c,h,m,d,g,f),d.className&&jQuery(c).addClass(d.className)),h.colElements[m]=c}}if(n&&i.actions&&createTiddlyDropDown(e,ListView.getCommandHandler(n),i.actions),n&&i.buttons)for(o=0;o<i.buttons.length;o++){var y=i.buttons[o];y&&""!=y.name&&createTiddlyButton(e,y.caption,null,ListView.getCommandHandler(n,y.name,y.allowEmptySelection))}return a},ListView.getCommandHandler=function(e,t,i){return function(n){var r=findRelated(this,"TABLE",null,"previousSibling"),o=[];ListView.forEachSelector(r,function(e,t){e.checked&&o.push(t)}),0!=o.length||i?"select"==this.nodeName.toLowerCase()?(e(r,this.value,o),this.selectedIndex=0):e(r,t,o):alert(config.messages.nothingSelected)}},ListView.forEachSelector=function(e,t){var i,n=e.getElementsByTagName("input"),r=!1;for(i=0;i<n.length;i++){var o=n[i];if("checkbox"==o.getAttribute("type")){var a=o.getAttribute("rowName");a&&(t(o,a),r=!0)}}return r},ListView.getSelectedRows=function(e){var t=[];return ListView.forEachSelector(e,function(e,i){e.checked&&t.push(i)}),t},ListView.columnTypes={},ListView.columnTypes.String={createHeader:function(e,t,i){createTiddlyText(e,t.title)},createItem:function(e,t,i,n,r,o){var a=t[i];void 0!=a&&createTiddlyText(e,a)}},ListView.columnTypes.WikiText={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];void 0!=a&&wikify(a,e,null,null)}},ListView.columnTypes.Tiddler={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];void 0!=a&&a.title&&createTiddlyPopup(e,a.title,config.messages.listView.tiddlerTooltip,a)}},ListView.columnTypes.Size={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=config.messages.sizeTemplates,s=t[i];if(void 0!=s){for(var l=0;l<a.length-1&&s<a[l].unit;)l++;createTiddlyText(e,a[l].template.format([Math.round(s/a[l].unit)]))}}},ListView.columnTypes.Link={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i],s=n.text;void 0!=a&&createExternalLink(e,a,s||a)}},ListView.columnTypes.Date={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];void 0!=a&&createTiddlyText(e,a.formatString(n.dateFormat))}},ListView.columnTypes.StringList={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];if(void 0!=a){var s;for(s=0;s<a.length;s++)createTiddlyText(e,a[s]),createTiddlyElement(e,"br")}}},ListView.columnTypes.Selector={createHeader:function(e,t,i){createTiddlyCheckbox(e,null,!1,this.onHeaderChange)},createItem:function(e,t,i,n,r,o){var a=createTiddlyCheckbox(e,null,t[i],null);a.setAttribute("rowName",t[n.rowName])},onHeaderChange:function(e){var t=this.checked,i=findRelated(this,"TABLE");i&&ListView.forEachSelector(i,function(e,i){e.checked=t})}},ListView.columnTypes.Tags={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];createTiddlyText(e,String.encodeTiddlyLinkList(a))}},ListView.columnTypes.Boolean={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){1==t[i]&&createTiddlyText(e,n.trueText),0==t[i]&&createTiddlyText(e,n.falseText)}},ListView.columnTypes.TagCheckbox={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=createTiddlyCheckbox(e,null,t[i],this.onChange);a.setAttribute("tiddler",t.title),a.setAttribute("tag",n.tag)},onChange:function(e){var t=this.getAttribute("tag"),i=this.getAttribute("tiddler");store.setTiddlerTag(i,this.checked,t)}},ListView.columnTypes.TiddlerLink={createHeader:ListView.columnTypes.String.createHeader,createItem:function(e,t,i,n,r,o){var a=t[i];if(void 0!=a){var s=createTiddlyLink(e,t[n.tiddlerLink],!1,null);createTiddlyText(s,t[i])}}},Array.indexOf||(Array.prototype.indexOf=function(e,t){t||(t=0);var i;for(i=t;i<this.length;i++)if(this[i]===e)return i;return-1}),Array.prototype.findByField=function(e,t){var i;for(i=0;i<this.length;i++)if(this[i][e]===t)return i;return null},Array.prototype.contains=function(e){return-1!=this.indexOf(e)},Array.prototype.setItem=function(e,t){var i=this.indexOf(e);0==t&&(t=-1==i?1:-1),1==t?-1==i&&this.push(e):-1==t&&-1!=i&&this.splice(i,1)},Array.prototype.containsAny=function(e){var t;for(t=0;t<e.length;t++)if(-1!=this.indexOf(e[t]))return!0;return!1},Array.prototype.containsAll=function(e){var t;for(t=0;t<e.length;t++)if(-1==this.indexOf(e[t]))return!1;return!0},Array.prototype.pushUnique=function(e,t){t===!1?this.push(e):-1==this.indexOf(e)&&this.push(e)},Array.prototype.remove=function(e){var t=this.indexOf(e);-1!=t&&this.splice(t,1)},Array.prototype.map||(Array.prototype.map=function(e,t){var i,n,r=t||window,o=[];for(i=0,n=this.length;n>i;++i)o.push(e.call(r,this[i],i,this));return o}),String.prototype.right=function(e){return e<this.length?this.slice(this.length-e):this},String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")},String.prototype.unDash=function(){var e,t=this.split("-");if(t.length>1)for(e=1;e<t.length;e++)t[e]=t[e].substr(0,1).toUpperCase()+t[e].substr(1);return t.join("")},String.prototype.format=function(e){var t,i=e&&e.constructor==Array?e:arguments,n=/(?:%(\d+))/gm,r=0,o=[];do t=n.exec(this),t&&t[1]&&(t.index>r&&o.push(this.substring(r,t.index)),o.push(i[parseInt(t[1],10)]),r=n.lastIndex);while(t);return r<this.length&&o.push(this.substring(r,this.length)),o.join("")},String.prototype.escapeRegExp=function(){var e,t="\\^$*+?()=!|,{}[].",i=this;for(e=0;e<t.length;e++)i=i.replace(new RegExp("\\"+t.substr(e,1),"g"),"\\"+t.substr(e,1));return i},String.prototype.escapeLineBreaks=function(){return this.replace(/\\/gm,"\\s").replace(/\n/gm,"\\n").replace(/\r/gm,"")},String.prototype.unescapeLineBreaks=function(){return this.replace(/\\n/gm,"\n").replace(/\\b/gm," ").replace(/\\s/gm,"\\").replace(/\r/gm,"")},String.prototype.htmlEncode=function(){return this.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/\"/gm,"&quot;")},String.prototype.htmlDecode=function(){return this.replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"').replace(/&amp;/gm,"&")},String.prototype.parseParams=function(e,t,i,n,r){var o,a=function(e,t){var n;if(e[t])n=e[t];else if(e[t+1])n=e[t+1];else if(e[t+2])n=e[t+2];else if(e[t+3])try{n=e[t+3],i&&"none"!=config.evaluateMacroParameters&&("restricted"==config.evaluateMacroParameters?window.restrictedEval&&(n=window.restrictedEval(n)):n=window.eval(n))}catch(r){throw"Unable to evaluate {{"+e[t+3]+"}}: "+exceptionText(r)}else e[t+4]?n=e[t+4]:e[t+5]&&(n="");return n},s=[{}],l='(?:"((?:(?:\\\\")|[^"])+)")',d="(?:'((?:(?:\\\\')|[^'])+)')",c="(?:\\[\\[((?:\\s|\\S)*?)\\]\\])",u="(?:\\{\\{((?:\\s|\\S)*?)\\}\\})",f=n?"([^\"'\\s]\\S*)":"([^\"':\\s][^\\s:]*)",p="((?:\"\")|(?:''))",h="(?:\\s*)",g="(?:"+l+"|"+d+"|"+c+"|"+u+"|"+f+"|"+p+")",m=n?new RegExp(g,"mg"):new RegExp(h+g+h+"(?:(\\:)"+h+g+")?","mg");do if(o=m.exec(this)){var y=a(o,1);if(n)s.push({name:"",value:y});else{var v=a(o,8);null==v&&e?(v=y,y=e):null==v&&t&&(v=t),s.push({name:y,value:v}),r&&(e=y,t=v)}}while(o);var T;for(T=1;T<s.length;T++)s[0][s[T].name]?s[0][s[T].name].push(s[T].value):s[0][s[T].name]=[s[T].value];return s},String.prototype.readMacroParams=function(e){var t,i=this.parseParams("list",null,!e,!0),n=[];for(t=1;t<i.length;t++)n.push(i[t].value);return n},String.prototype.readBracketedList=function(e){var t,i=this.parseParams("list",null,!1,!0),n=[];for(t=1;t<i.length;t++)i[t].value&&n.pushUnique(i[t].value,e);return n},String.prototype.getChunkRange=function(e,t){var i=this.indexOf(e);if(-1!=i){i+=e.length;var n=this.indexOf(t,i);if(-1!=n)return[i,n]}},String.prototype.replaceChunk=function(e,t,i){var n=this.getChunkRange(e,t);return n?this.substring(0,n[0])+i+this.substring(n[1]):this},String.prototype.getChunk=function(e,t){var i=this.getChunkRange(e,t);return i?this.substring(i[0],i[1]):void 0},String.encodeTiddlyLink=function(e){return-1==e.indexOf(" ")?e:"[["+e+"]]"},String.encodeTiddlyLinkList=function(e){if(e){var t,i=[];for(t=0;t<e.length;t++)i.push(String.encodeTiddlyLink(e[t]));return i.join(" ")}return""},String.prototype.decodeHashMap=function(){var e,t=this.parseParams("anon","",!1),i={};for(e=1;e<t.length;e++)i[t[e].name]=t[e].value;return i},String.encodeHashMap=function(e){var t,i=[];for(t in e)i.push(t+':"'+e[t]+'"');return i.join(" ")},String.zeroPad=function(e,t){var i=e.toString();return i.length<t&&(i="000000000000000000000000000".substr(0,t-i.length)+i),i},String.prototype.startsWith=function(e){return!e||this.substring(0,e.length)==e},Date.prototype.formatString=function(e){var t=e.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));t=t.replace(/hh12/g,this.getHours12()),t=t.replace(/0hh/g,String.zeroPad(this.getHours(),2)),t=t.replace(/hh/g,this.getHours()),t=t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]),t=t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2)),t=t.replace(/mm/g,this.getMinutes()),t=t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2)),t=t.replace(/ss/g,this.getSeconds()),t=t.replace(/[ap]m/g,this.getAmPm().toLowerCase()),t=t.replace(/[AP]M/g,this.getAmPm().toUpperCase()),t=t.replace(/wYYYY/g,this.getYearForWeekNo()),t=t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2e3,2)),t=t.replace(/YYYY/g,this.getFullYear()),t=t.replace(/YY/g,String.zeroPad(this.getFullYear()-2e3,2)),t=t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]),t=t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2)),t=t.replace(/MM/g,this.getMonth()+1),t=t.replace(/0WW/g,String.zeroPad(this.getWeek(),2)),t=t.replace(/WW/g,this.getWeek()),t=t.replace(/DDD/g,config.messages.dates.days[this.getDay()]),t=t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]),t=t.replace(/0DD/g,String.zeroPad(this.getDate(),2)),t=t.replace(/DDth/g,this.getDate()+this.daySuffix()),t=t.replace(/DD/g,this.getDate());var i=this.getTimezoneOffset(),n=Math.abs(i);return t=t.replace(/TZD/g,(0>i?"+":"-")+String.zeroPad(Math.floor(n/60),2)+":"+String.zeroPad(n%60,2)),t=t.replace(/\\/g,"")},Date.prototype.getWeek=function(){var e=new Date(this.getTime()),t=e.getDay();0==t&&(t=7),e.setTime(e.getTime()+864e5*(4-t));var i=Math.floor((e.getTime()-new Date(e.getFullYear(),0,1)+36e5)/864e5);return Math.floor(i/7)+1},Date.prototype.getYearForWeekNo=function(){var e=new Date(this.getTime()),t=e.getDay();return 0==t&&(t=7),e.setTime(e.getTime()+864e5*(4-t)),e.getFullYear()},Date.prototype.getHours12=function(){var e=this.getHours();return e>12?e-12:e>0?e:12},Date.prototype.getAmPm=function(){return this.getHours()>=12?config.messages.dates.pm:config.messages.dates.am},Date.prototype.daySuffix=function(){return config.messages.dates.daySuffixes[this.getDate()-1]},Date.prototype.convertToLocalYYYYMMDDHHMM=function(){return this.getFullYear()+String.zeroPad(this.getMonth()+1,2)+String.zeroPad(this.getDate(),2)+String.zeroPad(this.getHours(),2)+String.zeroPad(this.getMinutes(),2)},Date.prototype.convertToYYYYMMDDHHMM=function(){return this.getUTCFullYear()+String.zeroPad(this.getUTCMonth()+1,2)+String.zeroPad(this.getUTCDate(),2)+String.zeroPad(this.getUTCHours(),2)+String.zeroPad(this.getUTCMinutes(),2)},Date.prototype.convertToYYYYMMDDHHMMSSMMM=function(){return this.getUTCFullYear()+String.zeroPad(this.getUTCMonth()+1,2)+String.zeroPad(this.getUTCDate(),2)+"."+String.zeroPad(this.getUTCHours(),2)+String.zeroPad(this.getUTCMinutes(),2)+String.zeroPad(this.getUTCSeconds(),2)+String.zeroPad(this.getUTCMilliseconds(),3)+"0"},Date.convertFromYYYYMMDDHHMM=function(e){return e=e?e.replace(/[^0-9]/g,""):"",Date.convertFromYYYYMMDDHHMMSSMMM(e.substr(0,12))},Date.convertFromYYYYMMDDHHMMSS=function(e){return e=e?e.replace(/[^0-9]/g,""):"",Date.convertFromYYYYMMDDHHMMSSMMM(e.substr(0,14))},Date.convertFromYYYYMMDDHHMMSSMMM=function(e){return e=e?e.replace(/[^0-9]/g,""):"",new Date(Date.UTC(parseInt(e.substr(0,4),10),parseInt(e.substr(4,2),10)-1,parseInt(e.substr(6,2),10),parseInt(e.substr(8,2)||"00",10),parseInt(e.substr(10,2)||"00",10),parseInt(e.substr(12,2)||"00",10),parseInt(e.substr(14,3)||"000",10)))},RGB.prototype.mix=function(e,t){return new RGB(this.r+(e.r-this.r)*t,this.g+(e.g-this.g)*t,this.b+(e.b-this.b)*t)},RGB.prototype.toString=function(){var e=function(e,t,i){return t>e?t:e>i?i:e};return"#"+("0"+Math.floor(255*e(this.r,0,1)).toString(16)).right(2)+("0"+Math.floor(255*e(this.g,0,1)).toString(16)).right(2)+("0"+Math.floor(255*e(this.b,0,1)).toString(16)).right(2)},LoaderBase.prototype.loadTiddler=function(e,t,i){var n=this.getTitle(e,t);if((!safeMode||!e.isShadowTiddler(n))&&n){var r=e.createTiddler(n);this.internalizeTiddler(e,r,n,t),i.push(r)}},LoaderBase.prototype.loadTiddlers=function(e,t){var i,n=[];for(i=0;i<t.length;i++)try{this.loadTiddler(e,t[i],n)}catch(r){showException(r,config.messages.tiddlerLoadError.format([this.getTitle(e,t[i])]))}return n},SaverBase.prototype.externalize=function(e){var t,i=[],n=e.getTiddlers("title");for(t=0;t<n.length;t++)n[t].doNotSave()||i.push(this.externalizeTiddler(e,n[t]));return i.join("\n")},TW21Loader.prototype=new LoaderBase,TW21Loader.prototype.getTitle=function(e,t){var i=null;if(t.getAttribute&&(i=t.getAttribute("title"),i||(i=t.getAttribute("tiddler"))),!i&&t.id){var n=e.idPrefix.length;t.id.substr(0,n)==e.idPrefix&&(i=t.id.substr(n))}return i},TW21Loader.prototype.internalizeTiddler=function(e,t,i,n){var r=n.firstChild,o=null;if(n.getAttribute("tiddler"))o=getNodeText(r).unescapeLineBreaks();else{for(;"PRE"!=r.nodeName&&"pre"!=r.nodeName;)r=r.nextSibling;o=r.innerHTML.replace(/\r/gm,"").htmlDecode()}var a,s=n.getAttribute("creator"),l=n.getAttribute("modifier"),d=n.getAttribute("created"),c=n.getAttribute("modified"),u=d?Date.convertFromYYYYMMDDHHMMSS(d):version.date,f=c?Date.convertFromYYYYMMDDHHMMSS(c):u,p=n.getAttribute("tags"),h={},g=n.attributes;for(a=g.length-1;a>=0;a--){var m=g[a].name;g[a].specified&&!TiddlyWiki.isStandardField(m)&&(h[m]=g[a].value.unescapeLineBreaks())}return t.assign(i,o,l,f,p,u,h,s),t},TW21Saver.prototype=new SaverBase,TW21Saver.prototype.externalizeTiddler=function(e,t){try{var i="",n=config.options.chkUsePreForStorage;e.forEachField(t,function(e,t,n){"string"!=typeof n&&(n=""),t.match(/^temp\./)||(i+=' %0="%1"'.format([t,n.escapeLineBreaks().htmlEncode()]))},!0);var r=t.created,o=t.modified,a=t.creator?' creator="'+t.creator.htmlEncode()+'"':"";a+=t.modifier?' modifier="'+t.modifier.htmlEncode()+'"':"",a+=n&&r==version.date?"":' created="'+r.convertToYYYYMMDDHHMM()+'"',a+=n&&o==r?"":' modified="'+o.convertToYYYYMMDDHHMM()+'"';var s=t.getTags();return(!n||s)&&(a+=' tags="'+s.htmlEncode()+'"'),'<div %0="%1"%2%3>%4</div>'.format([n?"title":"tiddler",t.title.htmlEncode(),a,i,n?"\n<pre>"+t.text.htmlEncode()+"</pre>\n":t.text.escapeLineBreaks().htmlEncode()])}catch(l){throw exceptionText(l,config.messages.tiddlerSaveError.format([t.title]))}},Crypto.strToBe32s=function(e){return jQuery.encoding.strToBe32s(e)},Crypto.be32sToStr=function(e){return jQuery.encoding.be32sToStr(e)},Crypto.be32sToHex=function(e){return jQuery.encoding.be32sToHex(e)},Crypto.hexSha1Str=function(e){return jQuery.encoding.digests.hexSha1Str(e)},Crypto.sha1Str=function(e){return jQuery.encoding.digests.sha1Str(e)},Crypto.sha1=function(e,t){return jQuery.encoding.digests.sha1(e,t)},config.formatterHelpers.charFormatHelper=function(e){e.subWikify(createTiddlyElement(e.output,this.element),this.terminator)},config.formatterHelpers.monospacedByLineHelper=function(e){var t=new RegExp(this.lookahead,"mg");t.lastIndex=e.matchStart;var i=t.exec(e.source);if(i&&i.index==e.matchStart){var n=i[1];config.browser.isIE&&(n=n.replace(/\n/g,"\r")),createTiddlyElement(e.output,"pre",null,null,n),e.nextMatch=t.lastIndex}},config.macros.br={},config.macros.br.handler=function(e){createTiddlyElement(e,"br")},Array.prototype.find=function(e){var t=this.indexOf(e);return-1==t?null:t},Tiddler.prototype.loadFromDiv=function(e,t){return store.getLoader().internalizeTiddler(store,this,t,e)},Tiddler.prototype.saveToDiv=function(){return store.getSaver().externalizeTiddler(store,this)};var createTiddlerPopup=Popup.create,scrollToTiddlerPopup=Popup.show,hideTiddlerPopup=Popup.remove,regexpBackSlashEn=new RegExp("\\\\n","mg"),regexpBackSlash=new RegExp("\\\\","mg"),regexpBackSlashEss=new RegExp("\\\\s","mg"),regexpNewLine=new RegExp("\n","mg"),regexpCarriageReturn=new RegExp("\r","mg");FileAdaptor.loadTiddlyWikiCallback=function(e,t,i,n,r){t.status=e,e?(t.adaptor.store=new TiddlyWiki,t.adaptor.store.importTiddlyWiki(i)||(t.statusText=config.messages.invalidFileError.format([n]),t.status=!1)):t.statusText="Error reading file",t.complete(t,t.userParams)},String.prototype.toJSONString=function(){var e={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t",'"':'\\"',"\\":"\\\\"},t=function(t,i){var n=e[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))};return/["\\\x00-\x1f]/.test(this)?'"'+this.replace(/([\x00-\x1f\\"])/g,t)+'"':'"'+this+'"'},Tiddler.prototype.toRssItem=function(e){return tiddlerToRssItem(this,e)},Tiddler.prototype.saveToRss=function(e){return"<item>\n"+tiddlerToRssItem(this,e)+"\n</item>"},Tiddler.prototype.generateFingerprint=function(){return"0x"+Crypto.hexSha1Str(this.text)},Number.prototype.clamp=function(e,t){var i=this;return e>i&&(i=e),i>t&&(i=t),Number(i)},function(e,t){function i(e){var t=he[e]={};return J.each(e.split(te),function(e,i){t[i]=!0}),t}function n(e,i,n){if(n===t&&1===e.nodeType){var r="data-"+i.replace(me,"-$1").toLowerCase();if(n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:ge.test(n)?J.parseJSON(n):n}catch(o){}J.data(e,i,n)}else n=t}return n}function r(e){var t;for(t in e)if(("data"!==t||!J.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function o(){return!1}function a(){return!0}function s(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function l(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function d(e,t,i){if(t=t||0,J.isFunction(t))return J.grep(e,function(e,n){var r=!!t.call(e,n,e);return r===i});if(t.nodeType)return J.grep(e,function(e,n){return e===t===i});if("string"==typeof t){var n=J.grep(e,function(e){return 1===e.nodeType});if(Oe.test(t))return J.filter(t,n,!i);t=J.filter(t,n)}return J.grep(e,function(e,n){return J.inArray(e,t)>=0===i})}function c(e){var t=Re.split("|"),i=e.createDocumentFragment();if(i.createElement)for(;t.length;)i.createElement(t.pop());return i}function u(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function f(e,t){if(1===t.nodeType&&J.hasData(e)){var i,n,r,o=J._data(e),a=J._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(i in s)for(n=0,r=s[i].length;r>n;n++)J.event.add(t,i,s[i][n])}a.data&&(a.data=J.extend({},a.data))}}function p(e,t){var i;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),i=t.nodeName.toLowerCase(),"object"===i?(t.parentNode&&(t.outerHTML=e.outerHTML),J.support.html5Clone&&e.innerHTML&&!J.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===i&&Ge.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===i?t.selected=e.defaultSelected:"input"===i||"textarea"===i?t.defaultValue=e.defaultValue:"script"===i&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(J.expando))}function h(e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName("*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll("*"):[]}function g(e){Ge.test(e.type)&&(e.defaultChecked=e.checked)}function m(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=yt.length;r--;)if(t=yt[r]+i,t in e)return t;return n}function y(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)}function v(e,t){for(var i,n,r=[],o=0,a=e.length;a>o;o++)i=e[o],i.style&&(r[o]=J._data(i,"olddisplay"),t?(!r[o]&&"none"===i.style.display&&(i.style.display=""),""===i.style.display&&y(i)&&(r[o]=J._data(i,"olddisplay",w(i.nodeName)))):(n=it(i,"display"),!r[o]&&"none"!==n&&J._data(i,"olddisplay",n)));for(o=0;a>o;o++)i=e[o],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?r[o]||"":"none"));return e}function T(e,t,i){var n=ct.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function b(e,t,i,n){for(var r=i===(n?"border":"content")?4:"width"===t?1:0,o=0;4>r;r+=2)"margin"===i&&(o+=J.css(e,i+mt[r],!0)),n?("content"===i&&(o-=parseFloat(it(e,"padding"+mt[r]))||0),"margin"!==i&&(o-=parseFloat(it(e,"border"+mt[r]+"Width"))||0)):(o+=parseFloat(it(e,"padding"+mt[r]))||0,"padding"!==i&&(o+=parseFloat(it(e,"border"+mt[r]+"Width"))||0));return o}function x(e,t,i){var n="width"===t?e.offsetWidth:e.offsetHeight,r=!0,o=J.support.boxSizing&&"border-box"===J.css(e,"boxSizing");if(0>=n||null==n){if(n=it(e,t),(0>n||null==n)&&(n=e.style[t]),ut.test(n))return n;r=o&&(J.support.boxSizingReliable||n===e.style[t]),n=parseFloat(n)||0}return n+b(e,t,i||(o?"border":"content"),r)+"px"}function w(e){if(pt[e])return pt[e];var t=J("<"+e+">").appendTo(U.body),i=t.css("display");return t.remove(),("none"===i||""===i)&&(nt=U.body.appendChild(nt||J.extend(U.createElement("iframe"),{frameBorder:0,width:0,height:0})),rt&&nt.createElement||(rt=(nt.contentWindow||nt.contentDocument).document,rt.write("<!doctype html><html><body>"),rt.close()),t=rt.body.appendChild(rt.createElement(e)),i=it(t,"display"),U.body.removeChild(nt)),pt[e]=i,i}function k(e,t,i,n){var r;if(J.isArray(t))J.each(t,function(t,r){i||bt.test(e)?n(e,r):k(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==J.type(t))n(e,t);else for(r in t)k(e+"["+r+"]",t[r],i,n)}function S(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r,o,a=t.toLowerCase().split(te),s=0,l=a.length;if(J.isFunction(i))for(;l>s;s++)n=a[s],o=/^\+/.test(n),o&&(n=n.substr(1)||"*"),r=e[n]=e[n]||[],r[o?"unshift":"push"](i)}}function E(e,i,n,r,o,a){o=o||i.dataTypes[0],a=a||{},a[o]=!0;for(var s,l=e[o],d=0,c=l?l.length:0,u=e===Ot;c>d&&(u||!s);d++)s=l[d](i,n,r),"string"==typeof s&&(!u||a[s]?s=t:(i.dataTypes.unshift(s),s=E(e,i,n,r,s,a)));return(u||!s)&&!a["*"]&&(s=E(e,i,n,r,"*",a)),s}function C(e,i){var n,r,o=J.ajaxSettings.flatOptions||{};for(n in i)i[n]!==t&&((o[n]?e:r||(r={}))[n]=i[n]);r&&J.extend(!0,e,r)}function A(e,i,n){var r,o,a,s,l=e.contents,d=e.dataTypes,c=e.responseFields;for(o in c)o in n&&(i[c[o]]=n[o]);for(;"*"===d[0];)d.shift(),r===t&&(r=e.mimeType||i.getResponseHeader("content-type"));if(r)for(o in l)if(l[o]&&l[o].test(r)){d.unshift(o);break}if(d[0]in n)a=d[0];else{for(o in n){if(!d[0]||e.converters[o+" "+d[0]]){a=o;break}s||(s=o)}a=a||s}return a?(a!==d[0]&&d.unshift(a),n[a]):void 0}function L(e,t){var i,n,r,o,a=e.dataTypes.slice(),s=a[0],l={},d=0;if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a[1])for(i in e.converters)l[i.toLowerCase()]=e.converters[i];for(;r=a[++d];)if("*"!==r){if("*"!==s&&s!==r){if(i=l[s+" "+r]||l["* "+r],!i)for(n in l)if(o=n.split(" "),o[1]===r&&(i=l[s+" "+o[0]]||l["* "+o[0]])){i===!0?i=l[n]:l[n]!==!0&&(r=o[0],a.splice(d--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+s+" to "+r}}}s=r}return{state:"success",data:t}}function M(){try{return new e.XMLHttpRequest}catch(t){}}function P(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function D(){return setTimeout(function(){Qt=t},0),Qt=J.now()}function F(e,t){J.each(t,function(t,i){for(var n=(Zt[t]||[]).concat(Zt["*"]),r=0,o=n.length;o>r;r++)if(n[r].call(e,t,i))return})}function N(e,t,i){var n,r=0,o=Jt.length,a=J.Deferred().always(function(){delete s.elem}),s=function(){for(var t=Qt||D(),i=Math.max(0,l.startTime+l.duration-t),n=i/l.duration||0,r=1-n,o=0,s=l.tweens.length;s>o;o++)l.tweens[o].run(r);return a.notifyWith(e,[l,r,i]),1>r&&s?i:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:Qt||D(),duration:i.duration,tweens:[],createTween:function(t,i,n){var r=J.Tween(e,l.opts,t,i,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){for(var i=0,n=t?l.tweens.length:0;n>i;i++)l.tweens[i].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),d=l.props;for(W(d,l.opts.specialEasing);o>r;r++)if(n=Jt[r].call(l,e,d,l.opts))return n;return F(l,d),J.isFunction(l.opts.start)&&l.opts.start.call(e,l),J.fx.timer(J.extend(s,{anim:l,queue:l.opts.queue,elem:e})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function W(e,t){var i,n,r,o,a;for(i in e)if(n=J.camelCase(i),r=t[n],o=e[i],J.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),a=J.cssHooks[n],a&&"expand"in a){o=a.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function H(e,t,i){var n,r,o,a,s,l,d,c,u,f=this,p=e.style,h={},g=[],m=e.nodeType&&y(e);i.queue||(c=J._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,u=c.empty.fire,c.empty.fire=function(){c.unqueued||u()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,J.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===J.css(e,"display")&&"none"===J.css(e,"float")&&(J.support.inlineBlockNeedsLayout&&"inline"!==w(e.nodeName)?p.zoom=1:p.display="inline-block")),i.overflow&&(p.overflow="hidden",J.support.shrinkWrapBlocks||f.done(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}));for(n in t)if(o=t[n],Gt.exec(o)){if(delete t[n],l=l||"toggle"===o,o===(m?"hide":"show"))continue;g.push(n)}if(a=g.length){s=J._data(e,"fxshow")||J._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),l&&(s.hidden=!m),m?J(e).show():f.done(function(){J(e).hide()}),f.done(function(){var t;J.removeData(e,"fxshow",!0);for(t in h)J.style(e,t,h[t])});for(n=0;a>n;n++)r=g[n],d=f.createTween(r,m?s[r]:0),h[r]=s[r]||J.style(e,r),r in s||(s[r]=d.start,m&&(d.end=d.start,d.start="width"===r||"height"===r?1:0))}}function O(e,t,i,n,r){return new O.prototype.init(e,t,i,n,r)}function B(e,t){var i,n={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)i=mt[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function I(e){return J.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var R,j,U=e.document,V=e.location,z=e.navigator,Y=e.jQuery,_=e.$,q=Array.prototype.push,Q=Array.prototype.slice,$=Array.prototype.indexOf,G=Object.prototype.toString,X=Object.prototype.hasOwnProperty,K=String.prototype.trim,J=function(e,t){
return new J.fn.init(e,t,R)},Z=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,ee=/\S/,te=/\s+/,ie=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ne=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,re=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,oe=/^[\],:{}\s]*$/,ae=/(?:^|:|,)(?:\s*\[)+/g,se=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,le=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,de=/^-ms-/,ce=/-([\da-z])/gi,ue=function(e,t){return(t+"").toUpperCase()},fe=function(){U.addEventListener?(U.removeEventListener("DOMContentLoaded",fe,!1),J.ready()):"complete"===U.readyState&&(U.detachEvent("onreadystatechange",fe),J.ready())},pe={};J.fn=J.prototype={constructor:J,init:function(e,i,n){var r,o,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:ne.exec(e),r&&(r[1]||!i)){if(r[1])return i=i instanceof J?i[0]:i,a=i&&i.nodeType?i.ownerDocument||i:U,e=J.parseHTML(r[1],a,!0),re.test(r[1])&&J.isPlainObject(i)&&this.attr.call(e,i,!0),J.merge(this,e);if(o=U.getElementById(r[2]),o&&o.parentNode){if(o.id!==r[2])return n.find(e);this.length=1,this[0]=o}return this.context=U,this.selector=e,this}return!i||i.jquery?(i||n).find(e):this.constructor(i).find(e)}return J.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return Q.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e,t,i){var n=J.merge(this.constructor(),e);return n.prevObject=this,n.context=this.context,"find"===t?n.selector=this.selector+(this.selector?" ":"")+i:t&&(n.selector=this.selector+"."+t+"("+i+")"),n},each:function(e,t){return J.each(this,e,t)},ready:function(e){return J.ready.promise().done(e),this},eq:function(e){return e=+e,-1===e?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(Q.apply(this,arguments),"slice",Q.call(arguments).join(","))},map:function(e){return this.pushStack(J.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:q,sort:[].sort,splice:[].splice},J.fn.init.prototype=J.fn,J.extend=J.fn.extend=function(){var e,i,n,r,o,a,s=arguments[0]||{},l=1,d=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"!=typeof s&&!J.isFunction(s)&&(s={}),d===l&&(s=this,--l);d>l;l++)if(null!=(e=arguments[l]))for(i in e)n=s[i],r=e[i],s!==r&&(c&&r&&(J.isPlainObject(r)||(o=J.isArray(r)))?(o?(o=!1,a=n&&J.isArray(n)?n:[]):a=n&&J.isPlainObject(n)?n:{},s[i]=J.extend(c,a,r)):r!==t&&(s[i]=r));return s},J.extend({noConflict:function(t){return e.$===J&&(e.$=_),t&&e.jQuery===J&&(e.jQuery=Y),J},isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){if(e===!0?!--J.readyWait:!J.isReady){if(!U.body)return setTimeout(J.ready,1);J.isReady=!0,e!==!0&&--J.readyWait>0||(j.resolveWith(U,[J]),J.fn.trigger&&J(U).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray||function(e){return"array"===J.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):pe[G.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==J.type(e)||e.nodeType||J.isWindow(e))return!1;try{if(e.constructor&&!X.call(e,"constructor")&&!X.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}var n;for(n in e);return n===t||X.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){var n;return e&&"string"==typeof e?("boolean"==typeof t&&(i=t,t=0),t=t||U,(n=re.exec(e))?[t.createElement(n[1])]:(n=J.buildFragment([e],t,i?null:[]),J.merge([],(n.cacheable?J.clone(n.fragment):n.fragment).childNodes))):null},parseJSON:function(t){return t&&"string"==typeof t?(t=J.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):oe.test(t.replace(se,"@").replace(le,"]").replace(ae,""))?new Function("return "+t)():void J.error("Invalid JSON: "+t)):null},parseXML:function(i){var n,r;if(!i||"string"!=typeof i)return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(i,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(i))}catch(o){n=t}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+i),n},noop:function(){},globalEval:function(t){t&&ee.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(de,"ms-").replace(ce,ue)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,i,n){var r,o=0,a=e.length,s=a===t||J.isFunction(e);if(n)if(s){for(r in e)if(i.apply(e[r],n)===!1)break}else for(;a>o&&i.apply(e[o++],n)!==!1;);else if(s){for(r in e)if(i.call(e[r],r,e[r])===!1)break}else for(;a>o&&i.call(e[o],o,e[o++])!==!1;);return e},trim:K&&!K.call("\ufeff ")?function(e){return null==e?"":K.call(e)}:function(e){return null==e?"":(e+"").replace(ie,"")},makeArray:function(e,t){var i,n=t||[];return null!=e&&(i=J.type(e),null==e.length||"string"===i||"function"===i||"regexp"===i||J.isWindow(e)?q.call(n,e):J.merge(n,e)),n},inArray:function(e,t,i){var n;if(t){if($)return $.call(t,e,i);for(n=t.length,i=i?0>i?Math.max(0,n+i):i:0;n>i;i++)if(i in t&&t[i]===e)return i}return-1},merge:function(e,i){var n=i.length,r=e.length,o=0;if("number"==typeof n)for(;n>o;o++)e[r++]=i[o];else for(;i[o]!==t;)e[r++]=i[o++];return e.length=r,e},grep:function(e,t,i){var n,r=[],o=0,a=e.length;for(i=!!i;a>o;o++)n=!!t(e[o],o),i!==n&&r.push(e[o]);return r},map:function(e,i,n){var r,o,a=[],s=0,l=e.length,d=e instanceof J||l!==t&&"number"==typeof l&&(l>0&&e[0]&&e[l-1]||0===l||J.isArray(e));if(d)for(;l>s;s++)r=i(e[s],s,n),null!=r&&(a[a.length]=r);else for(o in e)r=i(e[o],o,n),null!=r&&(a[a.length]=r);return a.concat.apply([],a)},guid:1,proxy:function(e,i){var n,r,o;return"string"==typeof i&&(n=e[i],i=e,e=n),J.isFunction(e)?(r=Q.call(arguments,2),o=function(){return e.apply(i,r.concat(Q.call(arguments)))},o.guid=e.guid=e.guid||J.guid++,o):t},access:function(e,i,n,r,o,a,s){var l,d=null==n,c=0,u=e.length;if(n&&"object"==typeof n){for(c in n)J.access(e,i,c,n[c],1,a,r);o=1}else if(r!==t){if(l=s===t&&J.isFunction(r),d&&(l?(l=i,i=function(e,t,i){return l.call(J(e),i)}):(i.call(e,r),i=null)),i)for(;u>c;c++)i(e[c],n,l?r.call(e[c],c,i(e[c],n)):r,s);o=1}return o?e:d?i.call(e):u?i(e[0],n):a},now:function(){return(new Date).getTime()}}),J.ready.promise=function(t){if(!j)if(j=J.Deferred(),"complete"===U.readyState)setTimeout(J.ready,1);else if(U.addEventListener)U.addEventListener("DOMContentLoaded",fe,!1),e.addEventListener("load",J.ready,!1);else{U.attachEvent("onreadystatechange",fe),e.attachEvent("onload",J.ready);var i=!1;try{i=null==e.frameElement&&U.documentElement}catch(n){}i&&i.doScroll&&function r(){if(!J.isReady){try{i.doScroll("left")}catch(e){return setTimeout(r,50)}J.ready()}}()}return j.promise(t)},J.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){pe["[object "+t+"]"]=t.toLowerCase()}),R=J(U);var he={};J.Callbacks=function(e){e="string"==typeof e?he[e]||i(e):J.extend({},e);var n,r,o,a,s,l,d=[],c=!e.once&&[],u=function(t){for(n=e.memory&&t,r=!0,l=a||0,a=0,s=d.length,o=!0;d&&s>l;l++)if(d[l].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}o=!1,d&&(c?c.length&&u(c.shift()):n?d=[]:f.disable())},f={add:function(){if(d){var t=d.length;!function i(t){J.each(t,function(t,n){var r=J.type(n);"function"===r?(!e.unique||!f.has(n))&&d.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),o?s=d.length:n&&(a=t,u(n))}return this},remove:function(){return d&&J.each(arguments,function(e,t){for(var i;(i=J.inArray(t,d,i))>-1;)d.splice(i,1),o&&(s>=i&&s--,l>=i&&l--)}),this},has:function(e){return J.inArray(e,d)>-1},empty:function(){return d=[],this},disable:function(){return d=c=n=t,this},disabled:function(){return!d},lock:function(){return c=t,n||f.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],d&&(!r||c)&&(o?c.push(t):u(t)),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!r}};return f},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(i){J.each(t,function(t,n){var o=n[0],a=e[t];r[n[1]](J.isFunction(a)?function(){var e=a.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o+"With"](this===r?i:this,[e])}:i[o])}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,n):n}},r={};return n.pipe=n.then,J.each(t,function(e,o){var a=o[2],s=o[3];n[o[1]]=a.add,s&&a.add(function(){i=s},t[1^e][2].disable,t[2][2].lock),r[o[0]]=a.fire,r[o[0]+"With"]=a.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=Q.call(arguments),a=o.length,s=1!==a||e&&J.isFunction(e.promise)?a:0,l=1===s?e:J.Deferred(),d=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?Q.call(arguments):r,n===t?l.notifyWith(i,n):--s||l.resolveWith(i,n)}};if(a>1)for(t=new Array(a),i=new Array(a),n=new Array(a);a>r;r++)o[r]&&J.isFunction(o[r].promise)?o[r].promise().done(d(r,n,o)).fail(l.reject).progress(d(r,i,t)):--s;return s||l.resolveWith(n,o),l.promise()}}),J.support=function(){var t,i,n,r,o,a,s,l,d,c,u,f=U.createElement("div");if(f.setAttribute("className","t"),f.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=f.getElementsByTagName("*"),n=f.getElementsByTagName("a")[0],!i||!n||!i.length)return{};r=U.createElement("select"),o=r.appendChild(U.createElement("option")),a=f.getElementsByTagName("input")[0],n.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:3===f.firstChild.nodeType,tbody:!f.getElementsByTagName("tbody").length,htmlSerialize:!!f.getElementsByTagName("link").length,style:/top/.test(n.getAttribute("style")),hrefNormalized:"/a"===n.getAttribute("href"),opacity:/^0.5/.test(n.style.opacity),cssFloat:!!n.style.cssFloat,checkOn:"on"===a.value,optSelected:o.selected,getSetAttribute:"t"!==f.className,enctype:!!U.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==U.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===U.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,r.disabled=!0,t.optDisabled=!o.disabled;try{delete f.test}catch(p){t.deleteExpando=!1}if(!f.addEventListener&&f.attachEvent&&f.fireEvent&&(f.attachEvent("onclick",u=function(){t.noCloneEvent=!1}),f.cloneNode(!0).fireEvent("onclick"),f.detachEvent("onclick",u)),a=U.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","checked"),a.setAttribute("name","t"),f.appendChild(a),s=U.createDocumentFragment(),s.appendChild(f.lastChild),t.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,s.removeChild(a),s.appendChild(f),f.attachEvent)for(d in{submit:!0,change:!0,focusin:!0})l="on"+d,c=l in f,c||(f.setAttribute(l,"return;"),c="function"==typeof f[l]),t[d+"Bubbles"]=c;return J(function(){var i,n,r,o,a="padding:0;margin:0;border:0;display:block;overflow:hidden;",s=U.getElementsByTagName("body")[0];s&&(i=U.createElement("div"),i.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",s.insertBefore(i,s.firstChild),n=U.createElement("div"),i.appendChild(n),n.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=n.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",t.reliableHiddenOffsets=c&&0===r[0].offsetHeight,n.innerHTML="",n.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===n.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(n,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(n,null)||{width:"4px"}).width,o=U.createElement("div"),o.style.cssText=n.style.cssText=a,o.style.marginRight=o.style.width="0",n.style.width="1px",n.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),"undefined"!=typeof n.style.zoom&&(n.innerHTML="",n.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===n.offsetWidth,n.style.display="block",n.style.overflow="visible",n.innerHTML="<div></div>",n.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==n.offsetWidth,i.style.zoom=1),s.removeChild(i),i=n=r=o=null)}),s.removeChild(f),i=n=r=o=a=s=f=null,t}();var ge=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,me=/([A-Z])/g;J.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(J.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?J.cache[e[J.expando]]:e[J.expando],!!e&&!r(e)},data:function(e,i,n,r){if(J.acceptData(e)){var o,a,s=J.expando,l="string"==typeof i,d=e.nodeType,c=d?J.cache:e,u=d?e[s]:e[s]&&s;if(u&&c[u]&&(r||c[u].data)||!l||n!==t)return u||(d?e[s]=u=J.deletedIds.pop()||J.guid++:u=s),c[u]||(c[u]={},d||(c[u].toJSON=J.noop)),("object"==typeof i||"function"==typeof i)&&(r?c[u]=J.extend(c[u],i):c[u].data=J.extend(c[u].data,i)),o=c[u],r||(o.data||(o.data={}),o=o.data),n!==t&&(o[J.camelCase(i)]=n),l?(a=o[i],null==a&&(a=o[J.camelCase(i)])):a=o,a}},removeData:function(e,t,i){if(J.acceptData(e)){var n,o,a,s=e.nodeType,l=s?J.cache:e,d=s?e[J.expando]:J.expando;if(l[d]){if(t&&(n=i?l[d]:l[d].data)){J.isArray(t)||(t in n?t=[t]:(t=J.camelCase(t),t=t in n?[t]:t.split(" ")));for(o=0,a=t.length;a>o;o++)delete n[t[o]];if(!(i?r:J.isEmptyObject)(n))return}(i||(delete l[d].data,r(l[d])))&&(s?J.cleanData([e],!0):J.support.deleteExpando||l!=l.window?delete l[d]:l[d]=null)}}},_data:function(e,t,i){return J.data(e,t,i,!0)},acceptData:function(e){var t=e.nodeName&&J.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),J.fn.extend({data:function(e,i){var r,o,a,s,l,d=this[0],c=0,u=null;if(e===t){if(this.length&&(u=J.data(d),1===d.nodeType&&!J._data(d,"parsedAttrs"))){for(a=d.attributes,l=a.length;l>c;c++)s=a[c].name,s.indexOf("data-")||(s=J.camelCase(s.substring(5)),n(d,s,u[s]));J._data(d,"parsedAttrs",!0)}return u}return"object"==typeof e?this.each(function(){J.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",o=r[1]+"!",J.access(this,function(i){return i===t?(u=this.triggerHandler("getData"+o,[r[0]]),u===t&&d&&(u=J.data(d,e),u=n(d,e,u)),u===t&&r[1]?this.data(r[0]):u):(r[1]=i,void this.each(function(){var t=J(this);t.triggerHandler("setData"+o,r),J.data(this,e,i),t.triggerHandler("changeData"+o,r)}))},null,i,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){J.removeData(this,e)})}}),J.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=J._data(e,t),i&&(!n||J.isArray(i)?n=J._data(e,t,J.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=J.queue(e,t),n=i.length,r=i.shift(),o=J._queueHooks(e,t),a=function(){J.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,a,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return J._data(e,i)||J._data(e,i,{empty:J.Callbacks("once memory").add(function(){J.removeData(e,t+"queue",!0),J.removeData(e,i,!0)})})}}),J.fn.extend({queue:function(e,i){var n=2;return"string"!=typeof e&&(i=e,e="fx",n--),arguments.length<n?J.queue(this[0],e):i===t?this:this.each(function(){var t=J.queue(this,e,i);J._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},delay:function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){var n,r=1,o=J.Deferred(),a=this,s=this.length,l=function(){--r||o.resolveWith(a,[a])};for("string"!=typeof e&&(i=e,e=t),e=e||"fx";s--;)n=J._data(a[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(l));return l(),o.promise(i)}});var ye,ve,Te,be=/[\t\r\n]/g,xe=/\r/g,we=/^(?:button|input)$/i,ke=/^(?:button|input|object|select|textarea)$/i,Se=/^a(?:rea|)$/i,Ee=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,Ce=J.support.getSetAttribute;J.fn.extend({attr:function(e,t){return J.access(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})},prop:function(e,t){return J.access(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return e=J.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(i){}})},addClass:function(e){var t,i,n,r,o,a,s;if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(te),i=0,n=this.length;n>i;i++)if(r=this[i],1===r.nodeType)if(r.className||1!==t.length){for(o=" "+r.className+" ",a=0,s=t.length;s>a;a++)o.indexOf(" "+t[a]+" ")<0&&(o+=t[a]+" ");r.className=J.trim(o)}else r.className=e;return this},removeClass:function(e){var i,n,r,o,a,s,l;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(i=(e||"").split(te),s=0,l=this.length;l>s;s++)if(r=this[s],1===r.nodeType&&r.className){for(n=(" "+r.className+" ").replace(be," "),o=0,a=i.length;a>o;o++)for(;n.indexOf(" "+i[o]+" ")>=0;)n=n.replace(" "+i[o]+" "," ");r.className=e?J.trim(n):""}return this},toggleClass:function(e,t){var i=typeof e,n="boolean"==typeof t;return J.isFunction(e)?this.each(function(i){J(this).toggleClass(e.call(this,i,this.className,t),t)}):this.each(function(){if("string"===i)for(var r,o=0,a=J(this),s=t,l=e.split(te);r=l[o++];)s=n?s:!a.hasClass(r),a[s?"addClass":"removeClass"](r);else("undefined"===i||"boolean"===i)&&(this.className&&J._data(this,"__className__",this.className),this.className=this.className||e===!1?"":J._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(be," ").indexOf(t)>=0)return!0;return!1},val:function(e){var i,n,r,o=this[0];{if(arguments.length)return r=J.isFunction(e),this.each(function(n){var o,a=J(this);1===this.nodeType&&(o=r?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":J.isArray(o)&&(o=J.map(o,function(e){return null==e?"":e+""})),i=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,o,"value")!==t||(this.value=o))});if(o)return i=J.valHooks[o.type]||J.valHooks[o.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(xe,""):null==n?"":n)}}}),J.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,a=o?null:[],s=o?r+1:n.length,l=0>r?s:o?r:0;s>l;l++)if(i=n[l],!(!i.selected&&l!==r||(J.support.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&J.nodeName(i.parentNode,"optgroup"))){if(t=J(i).val(),o)return t;a.push(t)}return a},set:function(e,t){var i=J.makeArray(t);return J(e).find("option").each(function(){this.selected=J.inArray(J(this).val(),i)>=0}),i.length||(e.selectedIndex=-1),i}}},attrFn:{},attr:function(e,i,n,r){var o,a,s,l=e.nodeType;if(e&&3!==l&&8!==l&&2!==l)return r&&J.isFunction(J.fn[i])?J(e)[i](n):"undefined"==typeof e.getAttribute?J.prop(e,i,n):(s=1!==l||!J.isXMLDoc(e),s&&(i=i.toLowerCase(),a=J.attrHooks[i]||(Ee.test(i)?ve:ye)),n!==t?null===n?void J.removeAttr(e,i):a&&"set"in a&&s&&(o=a.set(e,n,i))!==t?o:(e.setAttribute(i,n+""),n):a&&"get"in a&&s&&null!==(o=a.get(e,i))?o:(o=e.getAttribute(i),null===o?t:o))},removeAttr:function(e,t){var i,n,r,o,a=0;if(t&&1===e.nodeType)for(n=t.split(te);a<n.length;a++)r=n[a],r&&(i=J.propFix[r]||r,o=Ee.test(r),o||J.attr(e,r,""),e.removeAttribute(Ce?r:i),o&&i in e&&(e[i]=!1))},attrHooks:{type:{set:function(e,t){if(we.test(e.nodeName)&&e.parentNode)J.error("type property can't be changed");else if(!J.support.radioValue&&"radio"===t&&J.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}},value:{get:function(e,t){return ye&&J.nodeName(e,"button")?ye.get(e,t):t in e?e.value:null},set:function(e,t,i){return ye&&J.nodeName(e,"button")?ye.set(e,t,i):void(e.value=t)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,i,n){var r,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!J.isXMLDoc(e),a&&(i=J.propFix[i]||i,o=J.propHooks[i]),n!==t?o&&"set"in o&&(r=o.set(e,n,i))!==t?r:e[i]=n:o&&"get"in o&&null!==(r=o.get(e,i))?r:e[i]},propHooks:{tabIndex:{get:function(e){var i=e.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):ke.test(e.nodeName)||Se.test(e.nodeName)&&e.href?0:t}}}}),ve={get:function(e,i){var n,r=J.prop(e,i);return r===!0||"boolean"!=typeof r&&(n=e.getAttributeNode(i))&&n.nodeValue!==!1?i.toLowerCase():t},set:function(e,t,i){var n;return t===!1?J.removeAttr(e,i):(n=J.propFix[i]||i,n in e&&(e[n]=!0),e.setAttribute(i,i.toLowerCase())),i}},Ce||(Te={name:!0,id:!0,coords:!0},ye=J.valHooks.button={get:function(e,i){var n;return n=e.getAttributeNode(i),n&&(Te[i]?""!==n.value:n.specified)?n.value:t},set:function(e,t,i){var n=e.getAttributeNode(i);return n||(n=U.createAttribute(i),e.setAttributeNode(n)),n.value=t+""}},J.each(["width","height"],function(e,t){J.attrHooks[t]=J.extend(J.attrHooks[t],{set:function(e,i){return""===i?(e.setAttribute(t,"auto"),i):void 0}})}),J.attrHooks.contenteditable={get:ye.get,set:function(e,t,i){""===t&&(t="false"),ye.set(e,t,i)}}),J.support.hrefNormalized||J.each(["href","src","width","height"],function(e,i){J.attrHooks[i]=J.extend(J.attrHooks[i],{get:function(e){var n=e.getAttribute(i,2);return null===n?t:n}})}),J.support.style||(J.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),J.support.optSelected||(J.propHooks.selected=J.extend(J.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),J.support.enctype||(J.propFix.enctype="encoding"),J.support.checkOn||J.each(["radio","checkbox"],function(){J.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]=J.extend(J.valHooks[this],{set:function(e,t){return J.isArray(t)?e.checked=J.inArray(J(e).val(),t)>=0:void 0}})});var Ae=/^(?:textarea|input|select)$/i,Le=/^([^\.]*|)(?:\.(.+)|)$/,Me=/(?:^|\s)hover(\.\S+|)\b/,Pe=/^key/,De=/^(?:mouse|contextmenu)|click/,Fe=/^(?:focusinfocus|focusoutblur)$/,Ne=function(e){return J.event.special.hover?e:e.replace(Me,"mouseenter$1 mouseleave$1")};J.event={add:function(e,i,n,r,o){var a,s,l,d,c,u,f,p,h,g,m;if(3!==e.nodeType&&8!==e.nodeType&&i&&n&&(a=J._data(e))){for(n.handler&&(h=n,n=h.handler,o=h.selector),n.guid||(n.guid=J.guid++),l=a.events,l||(a.events=l={}),s=a.handle,s||(a.handle=s=function(e){return"undefined"==typeof J||e&&J.event.triggered===e.type?t:J.event.dispatch.apply(s.elem,arguments)},s.elem=e),i=J.trim(Ne(i)).split(" "),d=0;d<i.length;d++)c=Le.exec(i[d])||[],u=c[1],f=(c[2]||"").split(".").sort(),m=J.event.special[u]||{},u=(o?m.delegateType:m.bindType)||u,m=J.event.special[u]||{},p=J.extend({type:u,origType:c[1],data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&J.expr.match.needsContext.test(o),namespace:f.join(".")},h),g=l[u],g||(g=l[u]=[],g.delegateCount=0,m.setup&&m.setup.call(e,r,f,s)!==!1||(e.addEventListener?e.addEventListener(u,s,!1):e.attachEvent&&e.attachEvent("on"+u,s))),m.add&&(m.add.call(e,p),p.handler.guid||(p.handler.guid=n.guid)),o?g.splice(g.delegateCount++,0,p):g.push(p),J.event.global[u]=!0;e=null}},global:{},remove:function(e,t,i,n,r){var o,a,s,l,d,c,u,f,p,h,g,m=J.hasData(e)&&J._data(e);if(m&&(f=m.events)){for(t=J.trim(Ne(t||"")).split(" "),o=0;o<t.length;o++)if(a=Le.exec(t[o])||[],s=l=a[1],d=a[2],s){for(p=J.event.special[s]||{},s=(n?p.delegateType:p.bindType)||s,h=f[s]||[],c=h.length,d=d?new RegExp("(^|\\.)"+d.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,u=0;u<h.length;u++)g=h[u],!(!r&&l!==g.origType||i&&i.guid!==g.guid||d&&!d.test(g.namespace)||n&&n!==g.selector&&("**"!==n||!g.selector)||(h.splice(u--,1),g.selector&&h.delegateCount--,!p.remove||!p.remove.call(e,g)));0===h.length&&c!==h.length&&((!p.teardown||p.teardown.call(e,d,m.handle)===!1)&&J.removeEvent(e,s,m.handle),delete f[s])}else for(s in f)J.event.remove(e,s+t[o],i,n,!0);J.isEmptyObject(f)&&(delete m.handle,J.removeData(e,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(i,n,r,o){if(!r||3!==r.nodeType&&8!==r.nodeType){var a,s,l,d,c,u,f,p,h,g,m=i.type||i,y=[];if(Fe.test(m+J.event.triggered))return;if(m.indexOf("!")>=0&&(m=m.slice(0,-1),s=!0),m.indexOf(".")>=0&&(y=m.split("."),m=y.shift(),y.sort()),(!r||J.event.customEvent[m])&&!J.event.global[m])return;if(i="object"==typeof i?i[J.expando]?i:new J.Event(m,i):new J.Event(m),i.type=m,i.isTrigger=!0,i.exclusive=s,i.namespace=y.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,u=m.indexOf(":")<0?"on"+m:"",!r){a=J.cache;for(l in a)a[l].events&&a[l].events[m]&&J.event.trigger(i,n,a[l].handle.elem,!0);return}if(i.result=t,i.target||(i.target=r),n=null!=n?J.makeArray(n):[],n.unshift(i),f=J.event.special[m]||{},f.trigger&&f.trigger.apply(r,n)===!1)return;if(h=[[r,f.bindType||m]],!o&&!f.noBubble&&!J.isWindow(r)){for(g=f.delegateType||m,d=Fe.test(g+m)?r:r.parentNode,c=r;d;d=d.parentNode)h.push([d,g]),c=d;c===(r.ownerDocument||U)&&h.push([c.defaultView||c.parentWindow||e,g])}for(l=0;l<h.length&&!i.isPropagationStopped();l++)d=h[l][0],i.type=h[l][1],p=(J._data(d,"events")||{})[i.type]&&J._data(d,"handle"),p&&p.apply(d,n),p=u&&d[u],p&&J.acceptData(d)&&p.apply&&p.apply(d,n)===!1&&i.preventDefault();return i.type=m,!(o||i.isDefaultPrevented()||f._default&&f._default.apply(r.ownerDocument,n)!==!1||"click"===m&&J.nodeName(r,"a")||!J.acceptData(r)||!u||!r[m]||("focus"===m||"blur"===m)&&0===i.target.offsetWidth||J.isWindow(r)||(c=r[u],c&&(r[u]=null),J.event.triggered=m,r[m](),J.event.triggered=t,!c||!(r[u]=c))),i.result}},dispatch:function(i){i=J.event.fix(i||e.event);var n,r,o,a,s,l,d,c,u,f=(J._data(this,"events")||{})[i.type]||[],p=f.delegateCount,h=Q.call(arguments),g=!i.exclusive&&!i.namespace,m=J.event.special[i.type]||{},y=[];if(h[0]=i,i.delegateTarget=this,!m.preDispatch||m.preDispatch.call(this,i)!==!1){if(p&&(!i.button||"click"!==i.type))for(o=i.target;o!=this;o=o.parentNode||this)if(o.disabled!==!0||"click"!==i.type){for(s={},d=[],n=0;p>n;n++)c=f[n],u=c.selector,s[u]===t&&(s[u]=c.needsContext?J(u,this).index(o)>=0:J.find(u,this,null,[o]).length),s[u]&&d.push(c);d.length&&y.push({elem:o,matches:d})}for(f.length>p&&y.push({elem:this,matches:f.slice(p)}),n=0;n<y.length&&!i.isPropagationStopped();n++)for(l=y[n],i.currentTarget=l.elem,r=0;r<l.matches.length&&!i.isImmediatePropagationStopped();r++)c=l.matches[r],(g||!i.namespace&&!c.namespace||i.namespace_re&&i.namespace_re.test(c.namespace))&&(i.data=c.data,i.handleObj=c,a=((J.event.special[c.origType]||{}).handle||c.handler).apply(l.elem,h),a!==t&&(i.result=a,a===!1&&(i.preventDefault(),i.stopPropagation())));return m.postDispatch&&m.postDispatch.call(this,i),i.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,i){var n,r,o,a=i.button,s=i.fromElement;return null==e.pageX&&null!=i.clientX&&(n=e.target.ownerDocument||U,r=n.documentElement,o=n.body,e.pageX=i.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=i.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?i.toElement:s),!e.which&&a!==t&&(e.which=1&a?1:2&a?3:4&a?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,i,n=e,r=J.event.fixHooks[e.type]||{},o=r.props?this.props.concat(r.props):this.props;for(e=J.Event(n),t=o.length;t;)i=o[--t],e[i]=n[i];return e.target||(e.target=n.srcElement||U),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,r.filter?r.filter(e,n):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,i){J.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,i,n){var r=J.extend(new J.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?J.event.trigger(r,null,t):J.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},J.event.handle=J.event.dispatch,J.removeEvent=U.removeEventListener?function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)}:function(e,t,i){var n="on"+t;e.detachEvent&&("undefined"==typeof e[n]&&(e[n]=null),e.detachEvent(n,i))},J.Event=function(e,t){return this instanceof J.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?a:o):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),this[J.expando]=!0,void 0):new J.Event(e,t)},J.Event.prototype={preventDefault:function(){this.isDefaultPrevented=a;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=a;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=a,this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,isImmediatePropagationStopped:o},J.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;o.selector;return(!r||r!==n&&!J.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),J.support.submitBubbles||(J.event.special.submit={setup:function(){return J.nodeName(this,"form")?!1:void J.event.add(this,"click._submit keypress._submit",function(e){var i=e.target,n=J.nodeName(i,"input")||J.nodeName(i,"button")?i.form:t;n&&!J._data(n,"_submit_attached")&&(J.event.add(n,"submit._submit",function(e){
e._submit_bubble=!0}),J._data(n,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&J.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return J.nodeName(this,"form")?!1:void J.event.remove(this,"._submit")}}),J.support.changeBubbles||(J.event.special.change={setup:function(){return Ae.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(J.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),J.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),J.event.simulate("change",this,e,!0)})),!1):void J.event.add(this,"beforeactivate._change",function(e){var t=e.target;Ae.test(t.nodeName)&&!J._data(t,"_change_attached")&&(J.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&J.event.simulate("change",this.parentNode,e,!0)}),J._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return J.event.remove(this,"._change"),!Ae.test(this.nodeName)}}),J.support.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,n=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){0===i++&&U.addEventListener(e,n,!0)},teardown:function(){0===--i&&U.removeEventListener(e,n,!0)}}}),J.fn.extend({on:function(e,i,n,r,a){var s,l;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=t);for(l in e)this.on(l,i,n,e[l],a);return this}if(null==n&&null==r?(r=i,n=i=t):null==r&&("string"==typeof i?(r=n,n=t):(r=n,n=i,i=t)),r===!1)r=o;else if(!r)return this;return 1===a&&(s=r,r=function(e){return J().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=J.guid++)),this.each(function(){J.event.add(this,e,r,n,i)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,i,n){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,J(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(a in e)this.off(a,i,e[a]);return this}return(i===!1||"function"==typeof i)&&(n=i,i=t),n===!1&&(n=o),this.each(function(){J.event.remove(this,e,n,i)})},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,i){return J(this.context).on(e,this.selector,t,i),this},die:function(e,t){return J(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){return this[0]?J.event.trigger(e,t,this[0],!0):void 0},toggle:function(e){var t=arguments,i=e.guid||J.guid++,n=0,r=function(i){var r=(J._data(this,"lastToggle"+e.guid)||0)%n;return J._data(this,"lastToggle"+e.guid,r+1),i.preventDefault(),t[r].apply(this,arguments)||!1};for(r.guid=i;n<t.length;)t[n++].guid=i;return this.click(r)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,i){return null==i&&(i=e,e=null),arguments.length>0?this.on(t,null,e,i):this.trigger(t)},Pe.test(t)&&(J.event.fixHooks[t]=J.event.keyHooks),De.test(t)&&(J.event.fixHooks[t]=J.event.mouseHooks)}),function(e,t){function i(e,t,i,n){i=i||[],t=t||D;var r,o,a,s,l=t.nodeType;if(!e||"string"!=typeof e)return i;if(1!==l&&9!==l)return[];if(a=x(t),!a&&!n&&(r=ie.exec(e)))if(s=r[1]){if(9===l){if(o=t.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&w(t,o)&&o.id===s)return i.push(o),i}else{if(r[2])return O.apply(i,B.call(t.getElementsByTagName(e),0)),i;if((s=r[3])&&fe&&t.getElementsByClassName)return O.apply(i,B.call(t.getElementsByClassName(s),0)),i}return g(e.replace(K,"$1"),t,i,n,a)}function n(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function r(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function o(e){return R(function(t){return t=+t,R(function(i,n){for(var r,o=e([],i.length,t),a=o.length;a--;)i[r=o[a]]&&(i[r]=!(n[r]=i[r]))})})}function a(e,t,i){if(e===t)return i;for(var n=e.nextSibling;n;){if(n===t)return-1;n=n.nextSibling}return 1}function s(e,t){var n,r,o,a,s,l,d,c=V[M][e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],d=T.preFilter;s;){(!n||(r=Z.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(o=[])),n=!1,(r=ee.exec(s))&&(o.push(n=new P(r.shift())),s=s.slice(n.length),n.type=r[0].replace(K," "));for(a in T.filter)(r=se[a].exec(s))&&(!d[a]||(r=d[a](r)))&&(o.push(n=new P(r.shift())),s=s.slice(n.length),n.type=a,n.matches=r);if(!n)break}return t?s.length:s?i.error(e):V(e,l).slice(0)}function l(e,t,i){var n=t.dir,r=i&&"parentNode"===t.dir,o=W++;return t.first?function(t,i,o){for(;t=t[n];)if(r||1===t.nodeType)return e(t,i,o)}:function(t,i,a){if(a){for(;t=t[n];)if((r||1===t.nodeType)&&e(t,i,a))return t}else for(var s,l=N+" "+o+" ",d=l+y;t=t[n];)if(r||1===t.nodeType){if((s=t[M])===d)return t.sizset;if("string"==typeof s&&0===s.indexOf(l)){if(t.sizset)return t}else{if(t[M]=d,e(t,i,a))return t.sizset=!0,t;t.sizset=!1}}}}function d(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function c(e,t,i,n,r){for(var o,a=[],s=0,l=e.length,d=null!=t;l>s;s++)(o=e[s])&&(!i||i(o,n,r))&&(a.push(o),d&&t.push(s));return a}function u(e,t,i,n,r,o){return n&&!n[M]&&(n=u(n)),r&&!r[M]&&(r=u(r,o)),R(function(o,a,s,l){var d,u,f,p=[],g=[],m=a.length,y=o||h(t||"*",s.nodeType?[s]:s,[]),v=!e||!o&&t?y:c(y,p,e,s,l),T=i?r||(o?e:m||n)?[]:a:v;if(i&&i(v,T,s,l),n)for(d=c(T,g),n(d,[],s,l),u=d.length;u--;)(f=d[u])&&(T[g[u]]=!(v[g[u]]=f));if(o){if(r||e){if(r){for(d=[],u=T.length;u--;)(f=T[u])&&d.push(v[u]=f);r(null,T=[],d,l)}for(u=T.length;u--;)(f=T[u])&&(d=r?I.call(o,f):p[u])>-1&&(o[d]=!(a[d]=f))}}else T=c(T===a?T.splice(m,T.length):T),r?r(null,a,T,l):O.apply(a,T)})}function f(e){for(var t,i,n,r=e.length,o=T.relative[e[0].type],a=o||T.relative[" "],s=o?1:0,c=l(function(e){return e===t},a,!0),p=l(function(e){return I.call(t,e)>-1},a,!0),h=[function(e,i,n){return!o&&(n||i!==C)||((t=i).nodeType?c(e,i,n):p(e,i,n))}];r>s;s++)if(i=T.relative[e[s].type])h=[l(d(h),i)];else{if(i=T.filter[e[s].type].apply(null,e[s].matches),i[M]){for(n=++s;r>n&&!T.relative[e[n].type];n++);return u(s>1&&d(h),s>1&&e.slice(0,s-1).join("").replace(K,"$1"),i,n>s&&f(e.slice(s,n)),r>n&&f(e=e.slice(n)),r>n&&e.join(""))}h.push(i)}return d(h)}function p(e,t){var n=t.length>0,r=e.length>0,o=function(a,s,l,d,u){var f,p,h,g=[],m=0,v="0",b=a&&[],x=null!=u,w=C,k=a||r&&T.find.TAG("*",u&&s.parentNode||s),S=N+=null==w?1:Math.E;for(x&&(C=s!==D&&s,y=o.el);null!=(f=k[v]);v++){if(r&&f){for(p=0;h=e[p];p++)if(h(f,s,l)){d.push(f);break}x&&(N=S,y=++o.el)}n&&((f=!h&&f)&&m--,a&&b.push(f))}if(m+=v,n&&v!==m){for(p=0;h=t[p];p++)h(b,g,s,l);if(a){if(m>0)for(;v--;)!b[v]&&!g[v]&&(g[v]=H.call(d));g=c(g)}O.apply(d,g),x&&!a&&g.length>0&&m+t.length>1&&i.uniqueSort(d)}return x&&(N=S,C=w),b};return o.el=0,n?R(o):o}function h(e,t,n){for(var r=0,o=t.length;o>r;r++)i(e,t[r],n);return n}function g(e,t,i,n,r){var o,a,l,d,c,u=s(e);u.length;if(!n&&1===u.length){if(a=u[0]=u[0].slice(0),a.length>2&&"ID"===(l=a[0]).type&&9===t.nodeType&&!r&&T.relative[a[1].type]){if(t=T.find.ID(l.matches[0].replace(ae,""),t,r)[0],!t)return i;e=e.slice(a.shift().length)}for(o=se.POS.test(e)?-1:a.length-1;o>=0&&(l=a[o],!T.relative[d=l.type]);o--)if((c=T.find[d])&&(n=c(l.matches[0].replace(ae,""),ne.test(a[0].type)&&t.parentNode||t,r))){if(a.splice(o,1),e=n.length&&a.join(""),!e)return O.apply(i,B.call(n,0)),i;break}}return k(e,u)(n,t,r,i,ne.test(e)),i}function m(){}var y,v,T,b,x,w,k,S,E,C,A=!0,L="undefined",M=("sizcache"+Math.random()).replace(".",""),P=String,D=e.document,F=D.documentElement,N=0,W=0,H=[].pop,O=[].push,B=[].slice,I=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},R=function(e,t){return e[M]=null==t||t,e},j=function(){var e={},t=[];return R(function(i,n){return t.push(i)>T.cacheLength&&delete e[t.shift()],e[i+" "]=n},e)},U=j(),V=j(),z=j(),Y="[\\x20\\t\\r\\n\\f]",_="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",q=_.replace("w","w#"),Q="([*^$|!~]?=)",$="\\["+Y+"*("+_+")"+Y+"*(?:"+Q+Y+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+Y+"*\\]",G=":("+_+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+$+")|[^:]|\\\\.)*|.*))\\)|)",X=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Y+"*((?:-\\d)?\\d*)"+Y+"*\\)|)(?=[^-]|$)",K=new RegExp("^"+Y+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Y+"+$","g"),Z=new RegExp("^"+Y+"*,"+Y+"*"),ee=new RegExp("^"+Y+"*([\\x20\\t\\r\\n\\f>+~])"+Y+"*"),te=new RegExp(G),ie=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,ne=/[\x20\t\r\n\f]*[+~]/,re=/h\d/i,oe=/input|select|textarea|button/i,ae=/\\(?!\\)/g,se={ID:new RegExp("^#("+_+")"),CLASS:new RegExp("^\\.("+_+")"),NAME:new RegExp("^\\[name=['\"]?("+_+")['\"]?\\]"),TAG:new RegExp("^("+_.replace("w","w*")+")"),ATTR:new RegExp("^"+$),PSEUDO:new RegExp("^"+G),POS:new RegExp(X,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+Y+"*(even|odd|(([+-]|)(\\d*)n|)"+Y+"*(?:([+-]|)"+Y+"*(\\d+)|))"+Y+"*\\)|)","i"),needsContext:new RegExp("^"+Y+"*[>+~]|"+X,"i")},le=function(e){var t=D.createElement("div");try{return e(t)}catch(i){return!1}finally{t=null}},de=le(function(e){return e.appendChild(D.createComment("")),!e.getElementsByTagName("*").length}),ce=le(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&"#"===e.firstChild.getAttribute("href")}),ue=le(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),fe=le(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),pe=le(function(e){e.id=M+0,e.innerHTML="<a name='"+M+"'></a><div name='"+M+"'></div>",F.insertBefore(e,F.firstChild);var t=D.getElementsByName&&D.getElementsByName(M).length===2+D.getElementsByName(M+0).length;return v=!D.getElementById(M),F.removeChild(e),t});try{B.call(F.childNodes,0)[0].nodeType}catch(he){B=function(e){for(var t,i=[];t=this[e];e++)i.push(t);return i}}i.matches=function(e,t){return i(e,null,null,t)},i.matchesSelector=function(e,t){return i(t,null,null,[e]).length>0},b=i.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=b(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n];n++)i+=b(t);return i},x=i.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},w=i.contains=F.contains?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!!(n&&1===n.nodeType&&i.contains&&i.contains(n))}:F.compareDocumentPosition?function(e,t){return t&&!!(16&e.compareDocumentPosition(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},i.attr=function(e,t){var i,n=x(e);return n||(t=t.toLowerCase()),(i=T.attrHandle[t])?i(e):n||ue?e.getAttribute(t):(i=e.getAttributeNode(t),i?"boolean"==typeof e[t]?e[t]?t:null:i.specified?i.value:null:null)},T=i.selectors={cacheLength:50,createPseudo:R,match:se,attrHandle:ce?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:v?function(e,t,i){if(typeof t.getElementById!==L&&!i){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}}:function(e,i,n){if(typeof i.getElementById!==L&&!n){var r=i.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},TAG:de?function(e,t){return typeof t.getElementsByTagName!==L?t.getElementsByTagName(e):void 0}:function(e,t){var i=t.getElementsByTagName(e);if("*"===e){for(var n,r=[],o=0;n=i[o];o++)1===n.nodeType&&r.push(n);return r}return i},NAME:pe&&function(e,t){return typeof t.getElementsByName!==L?t.getElementsByName(name):void 0},CLASS:fe&&function(e,t,i){return typeof t.getElementsByClassName===L||i?void 0:t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ae,""),e[3]=(e[4]||e[5]||"").replace(ae,""),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1]?(e[2]||i.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2])):e[2]&&i.error(e[0]),e},PSEUDO:function(e){var t,i;return se.CHILD.test(e[0])?null:(e[3]?e[2]=e[3]:(t=e[4])&&(te.test(t)&&(i=s(t,!0))&&(i=t.indexOf(")",t.length-i)-t.length)&&(t=t.slice(0,i),e[0]=e[0].slice(0,i)),e[2]=t),e.slice(0,3))}},filter:{ID:v?function(e){return e=e.replace(ae,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(ae,""),function(t){var i=typeof t.getAttributeNode!==L&&t.getAttributeNode("id");return i&&i.value===e}},TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(ae,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=U[M][e+" "];return t||(t=new RegExp("(^|"+Y+")"+e+"("+Y+"|$)"))&&U(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,o){var a=i.attr(r,e);return null==a?"!="===t:t?(a+="","="===t?a===n:"!="===t?a!==n:"^="===t?n&&0===a.indexOf(n):"*="===t?n&&a.indexOf(n)>-1:"$="===t?n&&a.substr(a.length-n.length)===n:"~="===t?(" "+a+" ").indexOf(n)>-1:"|="===t?a===n||a.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n){return"nth"===e?function(e){var t,r,o=e.parentNode;if(1===i&&0===n)return!0;if(o)for(r=0,t=o.firstChild;t&&(1!==t.nodeType||(r++,e!==t));t=t.nextSibling);return r-=n,r===i||r%i===0&&r/i>=0}:function(t){var i=t;switch(e){case"only":case"first":for(;i=i.previousSibling;)if(1===i.nodeType)return!1;if("first"===e)return!0;i=t;case"last":for(;i=i.nextSibling;)if(1===i.nodeType)return!1;return!0}}},PSEUDO:function(e,t){var n,r=T.pseudos[e]||T.setFilters[e.toLowerCase()]||i.error("unsupported pseudo: "+e);return r[M]?r(t):r.length>1?(n=[e,e,"",t],T.setFilters.hasOwnProperty(e.toLowerCase())?R(function(e,i){for(var n,o=r(e,t),a=o.length;a--;)n=I.call(e,o[a]),e[n]=!(i[n]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:R(function(e){var t=[],i=[],n=k(e.replace(K,"$1"));return n[M]?R(function(e,t,i,r){for(var o,a=n(e,null,r,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,r,o){return t[0]=e,n(t,null,o,i),!i.pop()}}),has:R(function(e){return function(t){return i(e,t).length>0}}),contains:R(function(e){return function(t){return(t.textContent||t.innerText||b(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!T.pseudos.empty(e)},empty:function(e){var t;for(e=e.firstChild;e;){if(e.nodeName>"@"||3===(t=e.nodeType)||4===t)return!1;e=e.nextSibling}return!0},header:function(e){return re.test(e.nodeName)},text:function(e){var t,i;return"input"===e.nodeName.toLowerCase()&&"text"===(t=e.type)&&(null==(i=e.getAttribute("type"))||i.toLowerCase()===t)},radio:n("radio"),checkbox:n("checkbox"),file:n("file"),password:n("password"),image:n("image"),submit:r("submit"),reset:r("reset"),button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return oe.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:o(function(){return[0]}),last:o(function(e,t){return[t-1]}),eq:o(function(e,t,i){return[0>i?i+t:i]}),even:o(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:o(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:o(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:o(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},S=F.compareDocumentPosition?function(e,t){return e===t?(E=!0,0):(e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t):e.compareDocumentPosition)?-1:1}:function(e,t){if(e===t)return E=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var i,n,r=[],o=[],s=e.parentNode,l=t.parentNode,d=s;if(s===l)return a(e,t);if(!s)return-1;if(!l)return 1;for(;d;)r.unshift(d),d=d.parentNode;for(d=l;d;)o.unshift(d),d=d.parentNode;i=r.length,n=o.length;for(var c=0;i>c&&n>c;c++)if(r[c]!==o[c])return a(r[c],o[c]);return c===i?a(e,o[c],-1):a(r[c],t,1)},[0,0].sort(S),A=!E,i.uniqueSort=function(e){var t,i=[],n=1,r=0;if(E=A,e.sort(S),E){for(;t=e[n];n++)t===e[n-1]&&(r=i.push(n));for(;r--;)e.splice(i[r],1)}return e},i.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},k=i.compile=function(e,t){var i,n=[],r=[],o=z[M][e+" "];if(!o){for(t||(t=s(e)),i=t.length;i--;)o=f(t[i]),o[M]?n.push(o):r.push(o);o=z(e,p(r,n))}return o},D.querySelectorAll&&function(){var e,t=g,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,o=[":focus"],a=[":active"],l=F.matchesSelector||F.mozMatchesSelector||F.webkitMatchesSelector||F.oMatchesSelector||F.msMatchesSelector;le(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||o.push("\\["+Y+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||o.push(":checked")}),le(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&o.push("[*^$]="+Y+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||o.push(":enabled",":disabled")}),o=new RegExp(o.join("|")),g=function(e,i,r,a,l){if(!a&&!l&&!o.test(e)){var d,c,u=!0,f=M,p=i,h=9===i.nodeType&&e;if(1===i.nodeType&&"object"!==i.nodeName.toLowerCase()){for(d=s(e),(u=i.getAttribute("id"))?f=u.replace(n,"\\$&"):i.setAttribute("id",f),f="[id='"+f+"'] ",c=d.length;c--;)d[c]=f+d[c].join("");p=ne.test(e)&&i.parentNode||i,h=d.join(",")}if(h)try{return O.apply(r,B.call(p.querySelectorAll(h),0)),r}catch(g){}finally{u||i.removeAttribute("id")}}return t(e,i,r,a,l)},l&&(le(function(t){e=l.call(t,"div");try{l.call(t,"[test!='']:sizzle"),a.push("!=",G)}catch(i){}}),a=new RegExp(a.join("|")),i.matchesSelector=function(t,n){if(n=n.replace(r,"='$1']"),!x(t)&&!a.test(n)&&!o.test(n))try{var s=l.call(t,n);if(s||e||t.document&&11!==t.document.nodeType)return s}catch(d){}return i(n,null,null,[t]).length>0})}(),T.pseudos.nth=T.pseudos.eq,T.filters=m.prototype=T.pseudos,T.setFilters=new m,i.attr=J.attr,J.find=i,J.expr=i.selectors,J.expr[":"]=J.expr.pseudos,J.unique=i.uniqueSort,J.text=i.getText,J.isXMLDoc=i.isXML,J.contains=i.contains}(e);var We=/Until$/,He=/^(?:parents|prev(?:Until|All))/,Oe=/^.[^:#\[\.,]*$/,Be=J.expr.match.needsContext,Ie={children:!0,contents:!0,next:!0,prev:!0};J.fn.extend({find:function(e){var t,i,n,r,o,a,s=this;if("string"!=typeof e)return J(e).filter(function(){for(t=0,i=s.length;i>t;t++)if(J.contains(s[t],this))return!0});for(a=this.pushStack("","find",e),t=0,i=this.length;i>t;t++)if(n=a.length,J.find(e,this[t],a),t>0)for(r=n;r<a.length;r++)for(o=0;n>o;o++)if(a[o]===a[r]){a.splice(r--,1);break}return a},has:function(e){var t,i=J(e,this),n=i.length;return this.filter(function(){for(t=0;n>t;t++)if(J.contains(this,i[t]))return!0})},not:function(e){return this.pushStack(d(this,e,!1),"not",e)},filter:function(e){return this.pushStack(d(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?Be.test(e)?J(e,this.context).index(this[0])>=0:J.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var i,n=0,r=this.length,o=[],a=Be.test(e)||"string"!=typeof e?J(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i.ownerDocument&&i!==t&&11!==i.nodeType;){if(a?a.index(i)>-1:J.find.matchesSelector(i,e)){o.push(i);break}i=i.parentNode}return o=o.length>1?J.unique(o):o,this.pushStack(o,"closest",e)},index:function(e){return e?"string"==typeof e?J.inArray(this[0],J(e)):J.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var i="string"==typeof e?J(e,t):J.makeArray(e&&e.nodeType?[e]:e),n=J.merge(this.get(),i);return this.pushStack(s(i[0])||s(n[0])?n:J.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.fn.andSelf=J.fn.addBack,J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,i){return J.dir(e,"parentNode",i)},next:function(e){return l(e,"nextSibling")},prev:function(e){return l(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,i){return J.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return J.dir(e,"previousSibling",i)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return J.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(i,n){var r=J.map(this,t,i);return We.test(e)||(n=i),n&&"string"==typeof n&&(r=J.filter(n,r)),r=this.length>1&&!Ie[e]?J.unique(r):r,this.length>1&&He.test(e)&&(r=r.reverse()),this.pushStack(r,e,Q.call(arguments).join(","))}}),J.extend({filter:function(e,t,i){return i&&(e=":not("+e+")"),1===t.length?J.find.matchesSelector(t[0],e)?[t[0]]:[]:J.find.matches(e,t)},dir:function(e,i,n){for(var r=[],o=e[i];o&&9!==o.nodeType&&(n===t||1!==o.nodeType||!J(o).is(n));)1===o.nodeType&&r.push(o),o=o[i];return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var Re="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",je=/ jQuery\d+="(?:null|\d+)"/g,Ue=/^\s+/,Ve=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ze=/<([\w:]+)/,Ye=/<tbody/i,_e=/<|&#?\w+;/,qe=/<(?:script|style|link)/i,Qe=/<(?:script|object|embed|option|style)/i,$e=new RegExp("<(?:"+Re+")[\\s/>]","i"),Ge=/^(?:checkbox|radio)$/,Xe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ke=/\/(java|ecma)script/i,Je=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Ze={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},et=c(U),tt=et.appendChild(U.createElement("div"));Ze.optgroup=Ze.option,Ze.tbody=Ze.tfoot=Ze.colgroup=Ze.caption=Ze.thead,Ze.th=Ze.td,J.support.htmlSerialize||(Ze._default=[1,"X<div>","</div>"]),J.fn.extend({text:function(e){return J.access(this,function(e){return e===t?J.text(this):this.empty().append((this[0]&&this[0].ownerDocument||U).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(J.isFunction(e))return this.each(function(t){J(this).wrapAll(e.call(this,t))});if(this[0]){var t=J(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return J.isFunction(e)?this.each(function(t){J(this).wrapInner(e.call(this,t))}):this.each(function(){var t=J(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(i){J(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!s(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=J.clean(arguments);return this.pushStack(J.merge(e,this),"before",this.selector)}},after:function(){if(!s(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=J.clean(arguments);return this.pushStack(J.merge(this,e),"after",this.selector)}},remove:function(e,t){for(var i,n=0;null!=(i=this[n]);n++)(!e||J.filter(e,[i]).length)&&(!t&&1===i.nodeType&&(J.cleanData(i.getElementsByTagName("*")),J.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&J.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return J.access(this,function(e){var i=this[0]||{},n=0,r=this.length;if(e===t)return 1===i.nodeType?i.innerHTML.replace(je,""):t;if(!("string"!=typeof e||qe.test(e)||!J.support.htmlSerialize&&$e.test(e)||!J.support.leadingWhitespace&&Ue.test(e)||Ze[(ze.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ve,"<$1></$2>");try{for(;r>n;n++)i=this[n]||{},1===i.nodeType&&(J.cleanData(i.getElementsByTagName("*")),i.innerHTML=e);i=0}catch(o){}}i&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return s(this[0])?this.length?this.pushStack(J(J.isFunction(e)?e():e),"replaceWith",e):this:J.isFunction(e)?this.each(function(t){var i=J(this),n=i.html();i.replaceWith(e.call(this,t,n))}):("string"!=typeof e&&(e=J(e).detach()),this.each(function(){var t=this.nextSibling,i=this.parentNode;J(this).remove(),t?J(t).before(e):J(i).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,i,n){e=[].concat.apply([],e);var r,o,a,s,l=0,d=e[0],c=[],f=this.length;if(!J.support.checkClone&&f>1&&"string"==typeof d&&Xe.test(d))return this.each(function(){J(this).domManip(e,i,n)});if(J.isFunction(d))return this.each(function(r){var o=J(this);e[0]=d.call(this,r,i?o.html():t),o.domManip(e,i,n)});if(this[0]){if(r=J.buildFragment(e,this,c),a=r.fragment,o=a.firstChild,1===a.childNodes.length&&(a=o),o)for(i=i&&J.nodeName(o,"tr"),s=r.cacheable||f-1;f>l;l++)n.call(i&&J.nodeName(this[l],"table")?u(this[l],"tbody"):this[l],l===s?a:J.clone(a,!0,!0));a=o=null,c.length&&J.each(c,function(e,t){t.src?J.ajax?J.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):J.error("no ajax"):J.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Je,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),J.buildFragment=function(e,i,n){var r,o,a,s=e[0];return i=i||U,i=!i.nodeType&&i[0]||i,i=i.ownerDocument||i,1===e.length&&"string"==typeof s&&s.length<512&&i===U&&"<"===s.charAt(0)&&!Qe.test(s)&&(J.support.checkClone||!Xe.test(s))&&(J.support.html5Clone||!$e.test(s))&&(o=!0,r=J.fragments[s],a=r!==t),r||(r=i.createDocumentFragment(),J.clean(e,i,r,n),o&&(J.fragments[s]=a&&r)),{fragment:r,cacheable:o}},J.fragments={},J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(i){var n,r=0,o=[],a=J(i),s=a.length,l=1===this.length&&this[0].parentNode;if((null==l||l&&11===l.nodeType&&1===l.childNodes.length)&&1===s)return a[t](this[0]),this;for(;s>r;r++)n=(r>0?this.clone(!0):this).get(),J(a[r])[t](n),o=o.concat(n);return this.pushStack(o,e,a.selector)}}),J.extend({clone:function(e,t,i){var n,r,o,a;if(J.support.html5Clone||J.isXMLDoc(e)||!$e.test("<"+e.nodeName+">")?a=e.cloneNode(!0):(tt.innerHTML=e.outerHTML,tt.removeChild(a=tt.firstChild)),!(J.support.noCloneEvent&&J.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(p(e,a),n=h(e),r=h(a),o=0;n[o];++o)r[o]&&p(n[o],r[o]);if(t&&(f(e,a),i))for(n=h(e),r=h(a),o=0;n[o];++o)f(n[o],r[o]);return n=r=null,a},clean:function(e,t,i,n){var r,o,a,s,l,d,u,f,p,h,m,y=t===U&&et,v=[];for(t&&"undefined"!=typeof t.createDocumentFragment||(t=U),r=0;null!=(a=e[r]);r++)if("number"==typeof a&&(a+=""),a){if("string"==typeof a)if(_e.test(a)){for(y=y||c(t),u=t.createElement("div"),y.appendChild(u),a=a.replace(Ve,"<$1></$2>"),s=(ze.exec(a)||["",""])[1].toLowerCase(),l=Ze[s]||Ze._default,d=l[0],u.innerHTML=l[1]+a+l[2];d--;)u=u.lastChild;if(!J.support.tbody)for(f=Ye.test(a),p="table"!==s||f?"<table>"!==l[1]||f?[]:u.childNodes:u.firstChild&&u.firstChild.childNodes,o=p.length-1;o>=0;--o)J.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o]);!J.support.leadingWhitespace&&Ue.test(a)&&u.insertBefore(t.createTextNode(Ue.exec(a)[0]),u.firstChild),a=u.childNodes,u.parentNode.removeChild(u)}else a=t.createTextNode(a);a.nodeType?v.push(a):J.merge(v,a)}if(u&&(a=u=y=null),!J.support.appendChecked)for(r=0;null!=(a=v[r]);r++)J.nodeName(a,"input")?g(a):"undefined"!=typeof a.getElementsByTagName&&J.grep(a.getElementsByTagName("input"),g);if(i)for(h=function(e){return!e.type||Ke.test(e.type)?n?n.push(e.parentNode?e.parentNode.removeChild(e):e):i.appendChild(e):void 0},r=0;null!=(a=v[r]);r++)J.nodeName(a,"script")&&h(a)||(i.appendChild(a),"undefined"!=typeof a.getElementsByTagName&&(m=J.grep(J.merge([],a.getElementsByTagName("script")),h),v.splice.apply(v,[r+1,0].concat(m)),r+=m.length));return v},cleanData:function(e,t){for(var i,n,r,o,a=0,s=J.expando,l=J.cache,d=J.support.deleteExpando,c=J.event.special;null!=(r=e[a]);a++)if((t||J.acceptData(r))&&(n=r[s],i=n&&l[n])){if(i.events)for(o in i.events)c[o]?J.event.remove(r,o):J.removeEvent(r,o,i.handle);l[n]&&(delete l[n],d?delete r[s]:r.removeAttribute?r.removeAttribute(s):r[s]=null,J.deletedIds.push(n))}}}),function(){var e,t;J.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=J.uaMatch(z.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),J.browser=t,J.sub=function(){function e(t,i){return new e.fn.init(t,i)}J.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(i,n){return n&&n instanceof J&&!(n instanceof e)&&(n=e(n)),J.fn.init.call(this,i,n,t)},e.fn.init.prototype=e.fn;var t=e(U);return e}}();var it,nt,rt,ot=/alpha\([^)]*\)/i,at=/opacity=([^)]*)/,st=/^(top|right|bottom|left)$/,lt=/^(none|table(?!-c[ea]).+)/,dt=/^margin/,ct=new RegExp("^("+Z+")(.*)$","i"),ut=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),ft=new RegExp("^([-+])=("+Z+")","i"),pt={BODY:"block"},ht={position:"absolute",visibility:"hidden",display:"block"},gt={letterSpacing:0,fontWeight:400},mt=["Top","Right","Bottom","Left"],yt=["Webkit","O","Moz","ms"],vt=J.fn.toggle;J.fn.extend({
css:function(e,i){return J.access(this,function(e,i,n){return n!==t?J.style(e,i,n):J.css(e,i)},e,i,arguments.length>1)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(e,t){var i="boolean"==typeof e;return J.isFunction(e)&&J.isFunction(t)?vt.apply(this,arguments):this.each(function(){(i?e:y(this))?J(this).show():J(this).hide()})}}),J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=it(e,"opacity");return""===i?"1":i}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":J.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,i,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=J.camelCase(i),d=e.style;if(i=J.cssProps[l]||(J.cssProps[l]=m(d,l)),s=J.cssHooks[i]||J.cssHooks[l],n===t)return s&&"get"in s&&(o=s.get(e,!1,r))!==t?o:d[i];if(a=typeof n,"string"===a&&(o=ft.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(J.css(e,i)),a="number"),!(null==n||"number"===a&&isNaN(n)||("number"===a&&!J.cssNumber[l]&&(n+="px"),s&&"set"in s&&(n=s.set(e,n,r))===t)))try{d[i]=n}catch(c){}}},css:function(e,i,n,r){var o,a,s,l=J.camelCase(i);return i=J.cssProps[l]||(J.cssProps[l]=m(e.style,l)),s=J.cssHooks[i]||J.cssHooks[l],s&&"get"in s&&(o=s.get(e,!0,r)),o===t&&(o=it(e,i)),"normal"===o&&i in gt&&(o=gt[i]),n||r!==t?(a=parseFloat(o),n||J.isNumeric(a)?a||0:o):o},swap:function(e,t,i){var n,r,o={};for(r in t)o[r]=e.style[r],e.style[r]=t[r];n=i.call(e);for(r in t)e.style[r]=o[r];return n}}),e.getComputedStyle?it=function(t,i){var n,r,o,a,s=e.getComputedStyle(t,null),l=t.style;return s&&(n=s.getPropertyValue(i)||s[i],""===n&&!J.contains(t.ownerDocument,t)&&(n=J.style(t,i)),ut.test(n)&&dt.test(i)&&(r=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=n,n=s.width,l.width=r,l.minWidth=o,l.maxWidth=a)),n}:U.documentElement.currentStyle&&(it=function(e,t){var i,n,r=e.currentStyle&&e.currentStyle[t],o=e.style;return null==r&&o&&o[t]&&(r=o[t]),ut.test(r)&&!st.test(t)&&(i=o.left,n=e.runtimeStyle&&e.runtimeStyle.left,n&&(e.runtimeStyle.left=e.currentStyle.left),o.left="fontSize"===t?"1em":r,r=o.pixelLeft+"px",o.left=i,n&&(e.runtimeStyle.left=n)),""===r?"auto":r}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,i,n){return i?0===e.offsetWidth&&lt.test(it(e,"display"))?J.swap(e,ht,function(){return x(e,t,n)}):x(e,t,n):void 0},set:function(e,i,n){return T(e,i,n?b(e,t,n,J.support.boxSizing&&"border-box"===J.css(e,"boxSizing")):0)}}}),J.support.opacity||(J.cssHooks.opacity={get:function(e,t){return at.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var i=e.style,n=e.currentStyle,r=J.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=n&&n.filter||i.filter||"";i.zoom=1,t>=1&&""===J.trim(o.replace(ot,""))&&i.removeAttribute&&(i.removeAttribute("filter"),n&&!n.filter)||(i.filter=ot.test(o)?o.replace(ot,r):o+" "+r)}}),J(function(){J.support.reliableMarginRight||(J.cssHooks.marginRight={get:function(e,t){return J.swap(e,{display:"inline-block"},function(){return t?it(e,"marginRight"):void 0})}}),!J.support.pixelPosition&&J.fn.position&&J.each(["top","left"],function(e,t){J.cssHooks[t]={get:function(e,i){if(i){var n=it(e,t);return ut.test(n)?J(e).position()[t]+"px":n}}}})}),J.expr&&J.expr.filters&&(J.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!J.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||it(e,"display"))},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(i){var n,r="string"==typeof i?i.split(" "):[i],o={};for(n=0;4>n;n++)o[e+mt[n]+t]=r[n]||r[n-2]||r[0];return o}},dt.test(e)||(J.cssHooks[e+t].set=T)});var Tt=/%20/g,bt=/\[\]$/,xt=/\r?\n/g,wt=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,kt=/^(?:select|textarea)/i;J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?J.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||kt.test(this.nodeName)||wt.test(this.type))}).map(function(e,t){var i=J(this).val();return null==i?null:J.isArray(i)?J.map(i,function(e,i){return{name:t.name,value:e.replace(xt,"\r\n")}}):{name:t.name,value:i.replace(xt,"\r\n")}}).get()}}),J.param=function(e,i){var n,r=[],o=function(e,t){t=J.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(i===t&&(i=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){o(this.name,this.value)});else for(n in e)k(n,e[n],i,o);return r.join("&").replace(Tt,"+")};var St,Et,Ct=/#.*$/,At=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lt=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Mt=/^(?:GET|HEAD)$/,Pt=/^\/\//,Dt=/\?/,Ft=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Nt=/([?&])_=[^&]*/,Wt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ht=J.fn.load,Ot={},Bt={},It=["*/"]+["*"];try{Et=V.href}catch(Rt){Et=U.createElement("a"),Et.href="",Et=Et.href}St=Wt.exec(Et.toLowerCase())||[],J.fn.load=function(e,i,n){if("string"!=typeof e&&Ht)return Ht.apply(this,arguments);if(!this.length)return this;var r,o,a,s=this,l=e.indexOf(" ");return l>=0&&(r=e.slice(l,e.length),e=e.slice(0,l)),J.isFunction(i)?(n=i,i=t):i&&"object"==typeof i&&(o="POST"),J.ajax({url:e,type:o,dataType:"html",data:i,complete:function(e,t){n&&s.each(n,a||[e.responseText,t,e])}}).done(function(e){a=arguments,s.html(r?J("<div>").append(e.replace(Ft,"")).find(r):e)}),this},J.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J.each(["get","post"],function(e,i){J[i]=function(e,n,r,o){return J.isFunction(n)&&(o=o||r,r=n,n=t),J.ajax({type:i,url:e,data:n,success:r,dataType:o})}}),J.extend({getScript:function(e,i){return J.get(e,t,i,"script")},getJSON:function(e,t,i){return J.get(e,t,i,"json")},ajaxSetup:function(e,t){return t?C(e,J.ajaxSettings):(t=e,e=J.ajaxSettings),C(e,t),e},ajaxSettings:{url:Et,isLocal:Lt.test(St[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":It},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:S(Ot),ajaxTransport:S(Bt),ajax:function(e,i){function n(e,i,n,a){var d,u,v,T,x,k=i;2!==b&&(b=2,l&&clearTimeout(l),s=t,o=a||"",w.readyState=e>0?4:0,n&&(T=A(f,w,n)),e>=200&&300>e||304===e?(f.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(J.lastModified[r]=x),x=w.getResponseHeader("Etag"),x&&(J.etag[r]=x)),304===e?(k="notmodified",d=!0):(d=L(f,T),k=d.state,u=d.data,v=d.error,d=!v)):(v=k,(!k||e)&&(k="error",0>e&&(e=0))),w.status=e,w.statusText=(i||k)+"",d?g.resolveWith(p,[u,k,w]):g.rejectWith(p,[w,k,v]),w.statusCode(y),y=t,c&&h.trigger("ajax"+(d?"Success":"Error"),[w,f,d?u:v]),m.fireWith(p,[w,k]),c&&(h.trigger("ajaxComplete",[w,f]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=t),i=i||{};var r,o,a,s,l,d,c,u,f=J.ajaxSetup({},i),p=f.context||f,h=p!==f&&(p.nodeType||p instanceof J)?J(p):J.event,g=J.Deferred(),m=J.Callbacks("once memory"),y=f.statusCode||{},v={},T={},b=0,x="canceled",w={readyState:0,setRequestHeader:function(e,t){if(!b){var i=e.toLowerCase();e=T[i]=T[i]||e,v[e]=t}return this},getAllResponseHeaders:function(){return 2===b?o:null},getResponseHeader:function(e){var i;if(2===b){if(!a)for(a={};i=At.exec(o);)a[i[1].toLowerCase()]=i[2];i=a[e.toLowerCase()]}return i===t?null:i},overrideMimeType:function(e){return b||(f.mimeType=e),this},abort:function(e){return e=e||x,s&&s.abort(e),n(0,e),this}};if(g.promise(w),w.success=w.done,w.error=w.fail,w.complete=m.add,w.statusCode=function(e){if(e){var t;if(2>b)for(t in e)y[t]=[y[t],e[t]];else t=e[w.status],w.always(t)}return this},f.url=((e||f.url)+"").replace(Ct,"").replace(Pt,St[1]+"//"),f.dataTypes=J.trim(f.dataType||"*").toLowerCase().split(te),null==f.crossDomain&&(d=Wt.exec(f.url.toLowerCase()),f.crossDomain=!(!d||d[1]===St[1]&&d[2]===St[2]&&(d[3]||("http:"===d[1]?80:443))==(St[3]||("http:"===St[1]?80:443)))),f.data&&f.processData&&"string"!=typeof f.data&&(f.data=J.param(f.data,f.traditional)),E(Ot,f,i,w),2===b)return w;if(c=f.global,f.type=f.type.toUpperCase(),f.hasContent=!Mt.test(f.type),c&&0===J.active++&&J.event.trigger("ajaxStart"),!f.hasContent&&(f.data&&(f.url+=(Dt.test(f.url)?"&":"?")+f.data,delete f.data),r=f.url,f.cache===!1)){var k=J.now(),S=f.url.replace(Nt,"$1_="+k);f.url=S+(S===f.url?(Dt.test(f.url)?"&":"?")+"_="+k:"")}(f.data&&f.hasContent&&f.contentType!==!1||i.contentType)&&w.setRequestHeader("Content-Type",f.contentType),f.ifModified&&(r=r||f.url,J.lastModified[r]&&w.setRequestHeader("If-Modified-Since",J.lastModified[r]),J.etag[r]&&w.setRequestHeader("If-None-Match",J.etag[r])),w.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+It+"; q=0.01":""):f.accepts["*"]);for(u in f.headers)w.setRequestHeader(u,f.headers[u]);if(!f.beforeSend||f.beforeSend.call(p,w,f)!==!1&&2!==b){x="abort";for(u in{success:1,error:1,complete:1})w[u](f[u]);if(s=E(Bt,f,i,w)){w.readyState=1,c&&h.trigger("ajaxSend",[w,f]),f.async&&f.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},f.timeout));try{b=1,s.send(v,n)}catch(C){if(!(2>b))throw C;n(-1,C)}}else n(-1,"No Transport");return w}return w.abort()},active:0,lastModified:{},etag:{}});var jt=[],Ut=/\?/,Vt=/(=)\?(?=&|$)|\?\?/,zt=J.now();J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jt.pop()||J.expando+"_"+zt++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(i,n,r){var o,a,s,l=i.data,d=i.url,c=i.jsonp!==!1,u=c&&Vt.test(d),f=c&&!u&&"string"==typeof l&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vt.test(l);return"jsonp"===i.dataTypes[0]||u||f?(o=i.jsonpCallback=J.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,a=e[o],u?i.url=d.replace(Vt,"$1"+o):f?i.data=l.replace(Vt,"$1"+o):c&&(i.url+=(Ut.test(d)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return s||J.error(o+" was not called"),s[0]},i.dataTypes[0]="json",e[o]=function(){s=arguments},r.always(function(){e[o]=a,i[o]&&(i.jsonpCallback=n.jsonpCallback,jt.push(o)),s&&J.isFunction(a)&&a(s[0]),s=a=t}),"script"):void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),J.ajaxTransport("script",function(e){if(e.crossDomain){var i,n=U.head||U.getElementsByTagName("head")[0]||U.documentElement;return{send:function(r,o){i=U.createElement("script"),i.async="async",e.scriptCharset&&(i.charset=e.scriptCharset),i.src=e.url,i.onload=i.onreadystatechange=function(e,r){(r||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,n&&i.parentNode&&n.removeChild(i),i=t,r||o(200,"success"))},n.insertBefore(i,n.firstChild)},abort:function(){i&&i.onload(0,1)}}}});var Yt,_t=e.ActiveXObject?function(){for(var e in Yt)Yt[e](0,1)}:!1,qt=0;J.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&M()||P()}:M,function(e){J.extend(J.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(J.ajaxSettings.xhr()),J.support.ajax&&J.ajaxTransport(function(i){if(!i.crossDomain||J.support.cors){var n;return{send:function(r,o){var a,s,l=i.xhr();if(i.username?l.open(i.type,i.url,i.async,i.username,i.password):l.open(i.type,i.url,i.async),i.xhrFields)for(s in i.xhrFields)l[s]=i.xhrFields[s];i.mimeType&&l.overrideMimeType&&l.overrideMimeType(i.mimeType),!i.crossDomain&&!r["X-Requested-With"]&&(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)l.setRequestHeader(s,r[s])}catch(d){}l.send(i.hasContent&&i.data||null),n=function(e,r){var s,d,c,u,f;try{if(n&&(r||4===l.readyState))if(n=t,a&&(l.onreadystatechange=J.noop,_t&&delete Yt[a]),r)4!==l.readyState&&l.abort();else{s=l.status,c=l.getAllResponseHeaders(),u={},f=l.responseXML,f&&f.documentElement&&(u.xml=f);try{u.text=l.responseText}catch(p){}try{d=l.statusText}catch(p){d=""}s||!i.isLocal||i.crossDomain?1223===s&&(s=204):s=u.text?200:404}}catch(h){r||o(-1,h)}u&&o(s,d,u,c)},i.async?4===l.readyState?setTimeout(n,0):(a=++qt,_t&&(Yt||(Yt={},J(e).unload(_t)),Yt[a]=n),l.onreadystatechange=n):n()},abort:function(){n&&n(0,1)}}}});var Qt,$t,Gt=/^(?:toggle|show|hide)$/,Xt=new RegExp("^(?:([-+])=|)("+Z+")([a-z%]*)$","i"),Kt=/queueHooks$/,Jt=[H],Zt={"*":[function(e,t){var i,n,r=this.createTween(e,t),o=Xt.exec(t),a=r.cur(),s=+a||0,l=1,d=20;if(o){if(i=+o[2],n=o[3]||(J.cssNumber[e]?"":"px"),"px"!==n&&s){s=J.css(r.elem,e,!0)||i||1;do l=l||".5",s/=l,J.style(r.elem,e,s+n);while(l!==(l=r.cur()/a)&&1!==l&&--d)}r.unit=n,r.start=s,r.end=o[1]?s+(o[1]+1)*i:i}return r}]};J.Animation=J.extend(N,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],Zt[i]=Zt[i]||[],Zt[i].unshift(t)},prefilter:function(e,t){t?Jt.unshift(e):Jt.push(e)}}),J.Tween=O,O.prototype={constructor:O,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(J.cssNumber[i]?"":"px")},cur:function(){var e=O.propHooks[this.prop];return e&&e.get?e.get(this):O.propHooks._default.get(this)},run:function(e){var t,i=O.propHooks[this.prop];return this.options.duration?this.pos=t=J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):O.propHooks._default.set(this),this}},O.prototype.init.prototype=O.prototype,O.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,!1,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},O.propHooks.scrollTop=O.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.each(["toggle","show","hide"],function(e,t){var i=J.fn[t];J.fn[t]=function(n,r,o){return null==n||"boolean"==typeof n||!e&&J.isFunction(n)&&J.isFunction(r)?i.apply(this,arguments):this.animate(B(t,!0),n,r,o)}}),J.fn.extend({fadeTo:function(e,t,i,n){return this.filter(y).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=J.isEmptyObject(e),o=J.speed(t,i,n),a=function(){var t=N(this,J.extend({},e),o);r&&t.stop(!0)};return r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,i,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=i,i=e,e=t),i&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=J.timers,a=J._data(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&Kt.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem===this&&(null==e||o[i].queue===e)&&(o[i].anim.stop(n),t=!1,o.splice(i,1));(t||!n)&&J.dequeue(this,e)})}}),J.each({slideDown:B("show"),slideUp:B("hide"),slideToggle:B("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),J.speed=function(e,t,i){var n=e&&"object"==typeof e?J.extend({},e):{complete:i||!i&&t||J.isFunction(e)&&e,duration:e,easing:i&&t||t&&!J.isFunction(t)&&t};return n.duration=J.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in J.fx.speeds?J.fx.speeds[n.duration]:J.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){J.isFunction(n.old)&&n.old.call(this),n.queue&&J.dequeue(this,n.queue)},n},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.timers=[],J.fx=O.prototype.init,J.fx.tick=function(){var e,i=J.timers,n=0;for(Qt=J.now();n<i.length;n++)e=i[n],!e()&&i[n]===e&&i.splice(n--,1);i.length||J.fx.stop(),Qt=t},J.fx.timer=function(e){e()&&J.timers.push(e)&&!$t&&($t=setInterval(J.fx.tick,J.fx.interval))},J.fx.interval=13,J.fx.stop=function(){clearInterval($t),$t=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fx.step={},J.expr&&J.expr.filters&&(J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length});var ei=/^(?:body|html)$/i;J.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){J.offset.setOffset(this,e,t)});var i,n,r,o,a,s,l,d={top:0,left:0},c=this[0],u=c&&c.ownerDocument;if(u)return(n=u.body)===c?J.offset.bodyOffset(c):(i=u.documentElement,J.contains(i,c)?("undefined"!=typeof c.getBoundingClientRect&&(d=c.getBoundingClientRect()),r=I(u),o=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,s=r.pageYOffset||i.scrollTop,l=r.pageXOffset||i.scrollLeft,{top:d.top+s-o,left:d.left+l-a}):d)},J.offset={bodyOffset:function(e){var t=e.offsetTop,i=e.offsetLeft;return J.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(J.css(e,"marginTop"))||0,i+=parseFloat(J.css(e,"marginLeft"))||0),{top:t,left:i}},setOffset:function(e,t,i){var n=J.css(e,"position");"static"===n&&(e.style.position="relative");var r,o,a=J(e),s=a.offset(),l=J.css(e,"top"),d=J.css(e,"left"),c=("absolute"===n||"fixed"===n)&&J.inArray("auto",[l,d])>-1,u={},f={};c?(f=a.position(),r=f.top,o=f.left):(r=parseFloat(l)||0,o=parseFloat(d)||0),J.isFunction(t)&&(t=t.call(e,i,s)),null!=t.top&&(u.top=t.top-s.top+r),null!=t.left&&(u.left=t.left-s.left+o),"using"in t?t.using.call(e,u):a.css(u)}},J.fn.extend({position:function(){if(this[0]){var e=this[0],t=this.offsetParent(),i=this.offset(),n=ei.test(t[0].nodeName)?{top:0,left:0}:t.offset();return i.top-=parseFloat(J.css(e,"marginTop"))||0,i.left-=parseFloat(J.css(e,"marginLeft"))||0,n.top+=parseFloat(J.css(t[0],"borderTopWidth"))||0,n.left+=parseFloat(J.css(t[0],"borderLeftWidth"))||0,{top:i.top-n.top,left:i.left-n.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||U.body;e&&!ei.test(e.nodeName)&&"static"===J.css(e,"position");)e=e.offsetParent;return e||U.body})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var n=/Y/.test(i);J.fn[e]=function(r){return J.access(this,function(e,r,o){var a=I(e);return o===t?a?i in a?a[i]:a.document.documentElement[r]:e[r]:void(a?a.scrollTo(n?J(a).scrollLeft():o,n?o:J(a).scrollTop()):e[r]=o)},e,r,arguments.length,null)}}),J.each({Height:"height",Width:"width"},function(e,i){J.each({padding:"inner"+e,content:i,"":"outer"+e},function(n,r){J.fn[r]=function(r,o){var a=arguments.length&&(n||"boolean"!=typeof r),s=n||(r===!0||o===!0?"margin":"border");return J.access(this,function(i,n,r){var o;return J.isWindow(i)?i.document.documentElement["client"+e]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+e],o["scroll"+e],i.body["offset"+e],o["offset"+e],o["client"+e])):r===t?J.css(i,n,r,s):J.style(i,n,r,s)},i,a?r:t,a,null)}})}),e.jQuery=e.$=J,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return J})}(window),function(e){e.encoding||(e.encoding={}),e.extend(e.encoding,{strToBe32s:function(e){var t,i,n=[],r=Math.floor(e.length/4);for(t=0,i=0;r>t;t++,i+=4)n[t]=(255&e.charCodeAt(i))<<24|(255&e.charCodeAt(i+1))<<16|(255&e.charCodeAt(i+2))<<8|255&e.charCodeAt(i+3);for(;i<e.length;)n[i>>2]|=(255&e.charCodeAt(i))<<24-8*i%32,i++;return n},be32sToStr:function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>24-i%32&255);return t},be32sToHex:function(e){for(var t="0123456789ABCDEF",i="",n=0;n<4*e.length;n++)i+=t.charAt(e[n>>2]>>8*(3-n%4)+4&15)+t.charAt(e[n>>2]>>8*(3-n%4)&15);return i}})}(jQuery),function(e){function t(e,t){function i(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i}function n(e,t,i,n,r){t=t>>>27|t<<5;var o=(65535&e)+(65535&t)+(65535&i)+(65535&n)+(65535&r),a=(e>>16)+(t>>16)+(i>>16)+(n>>16)+(r>>16)+(o>>16);return a<<16|65535&o}function r(e,t){var i=e[t-3]^e[t-8]^e[t-14]^e[t-16];return i>>>31|i<<1}var o=8*t;e[o>>5]|=128<<24-o%32,e[(o+64>>9<<4)+15]=o;for(var a=new Array(80),s=1518500249,l=1859775393,d=2400959708,c=3395469782,u=1732584193,f=4023233417,p=2562383102,h=271733878,g=3285377520,m=0;m<e.length;m+=16){for(var y,v=0,T=u,b=f,x=p,w=h,k=g;16>v;)a[v]=e[m+v],y=n(k,T,w^b&(x^w),a[v],s),k=w,w=x,x=b>>>2|b<<30,b=T,T=y,v++;for(;20>v;)a[v]=r(a,v),y=n(k,T,w^b&(x^w),a[v],s),k=w,w=x,x=b>>>2|b<<30,b=T,T=y,v++;for(;40>v;)a[v]=r(a,v),y=n(k,T,b^x^w,a[v],l),k=w,w=x,x=b>>>2|b<<30,b=T,T=y,v++;for(;60>v;)a[v]=r(a,v),y=n(k,T,b&x|w&(b|x),a[v],d),k=w,w=x,x=b>>>2|b<<30,b=T,T=y,v++;for(;80>v;)a[v]=r(a,v),y=n(k,T,b^x^w,a[v],c),k=w,w=x,x=b>>>2|b<<30,b=T,T=y,v++;u=i(u,T),f=i(f,b),p=i(p,x),h=i(h,w),g=i(g,k)}return[u,f,p,h,g]}e.encoding.digests||(e.encoding.digests={}),e.extend(e.encoding.digests,{hexSha1Str:function(t){return e.encoding.be32sToHex(e.encoding.digests.sha1Str(t))},sha1Str:function(i){return t(e.encoding.strToBe32s(i),i.length)},sha1:function(i,n){return t(e.encoding.strToBe32s(str),str.length)}})}(jQuery),function(e){var t="customStyleSheet";e.twStylesheet=function(e,i){i=i||{};var n=i.id||t,r=i.doc||document,o=r.getElementById(n);r.createStyleSheet?(o&&o.parentNode.removeChild(o),r.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",'&nbsp;<style id="'+n+'" type="text/css">'+e+"</style>")):o?o.replaceChild(r.createTextNode(e),o.firstChild):(o=r.createElement("style"),o.type="text/css",o.id=n,o.appendChild(r.createTextNode(e)),r.getElementsByTagName("head")[0].appendChild(o))},e.twStylesheet.remove=function(e){e=e||{};var i=e.id||t,n=e.doc||document,r=n.getElementById(i);r&&r.parentNode.removeChild(r)}}(jQuery);